{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome!","text":"<p>Welcome to the Smart Citizen project documentation! Check the different sections or get started with our guides.</p> <p></p> <p>A note about versions</p> <p></p> <p>The new Smart Citizen Kit and the Smart Citizen Station development was possible thanks to  iSCAPE, a project under European Community\u2019s H2020 Programme (Grant Agreement No. 689954)</p>"},{"location":"#sections","title":"Sections","text":"<ul> <li> <p>Main: Contains the Smart Citizen Kit and Smart Citizen Station documentation to help you get started. Visit the Hardware architecture page to understand a bit better how you can better use all the SCK possibilities</p> </li> <li> <p>Data: Contains all the documentation on data, from collection, storage to analysis and calibration:</p> <ul> <li>Platform: Contains all the documentation on the online platform where data is collected, stored and visualised</li> <li>API: the documentation of our RESTFUL API and how to interact with it</li> <li>Data Analysis: Contains all the documentation on the data post-processing framework to analyse the sensors data</li> </ul> </li> <li> <p>Use cases: Contains documentation and use cases examples how to use our tools with your local community.</p> </li> <li> <p>Guides: Contains step-by-step guides for different features of the kit, how to get started, use the shell, or make some more advanced analysis of the sensor readings!</p> </li> <li> <p>Legacy Hardware: Are you a pioneer of participatory sensing looking for the original SCK 1.0 and SCK 1.1 documentation? Check the Legacy Hardware section!</p> </li> </ul>"},{"location":"#guides","title":"Guides","text":"<p>The documentation contains multiple guides as step-by-step tutorials to perform essential tasks as installing a kit or upgrading it's firmware:</p> <p></p> <p>Example guides</p> <ul> <li>Installing the Smart Citizen Kit</li> <li>Installing the Smart Citizen Station</li> <li>Installing the Smart Citizen Kit 1.0 / 1.1</li> <li>Onboarding new Sensors</li> <li>Uploading SD Card Data</li> <li>Update the Firmware</li> <li>Edit the Firmware</li> </ul>"},{"location":"#open-source","title":"Open Source","text":"<p>We're against black boxes!</p> <p>The entire project is released under open source licenses:\u2028</p> <ul> <li>Hardware components: CERN Open Hardware License v1.2</li> <li>Core firmware: GNU GPL v3.0</li> <li>Software platform: GNU AGLP v3.0</li> </ul> <p>Info</p> <p>Check the Source files section for each component and explore the software source code and the hardware blueprints.</p> <p></p>"},{"location":"Smart%20Citizen%20Kit/","title":"Smart Citizen Kit","text":"<p>A note about versions</p> <p>The SCK 2.0 was the development version for the now commercially available SCK 2.1 sponsored thanks to the iSCAPE project under European Community\u2019s H2020 Programme under Grant Agreement No. 689954</p> <p>Quick links</p> <p> Buy: seeedstudio.com</p> <p> Installation: start.smartcitizen.me</p> <p> Platform: smartcitizen.me</p> <p> Discuss: forum.smartcitizen.me</p> <p> Support: support@smartcitizen.me</p> <p> Something big?: info@smartcitizen.me</p> <p> Platform status: uptimerobot.com</p>"},{"location":"Smart%20Citizen%20Kit/#what-is-it","title":"What is it?","text":"<p>The Smart Citizen Kit is the core of what we call the Smart Citizen System: a complete set of modular hardware components aiming to provide tools for environmental monitoring, ranging from citizen science and educational activities to more advanced scientific research.</p> <p></p> <p>The system is designed in a extendable way, with a central data logger (the Data Board) with network connectivity to which the different components are branched. The system is based on the principle of reproducibility, also integrating non-hardware components such as a dedicated Storage platform and a Sensor analysis framework.</p> <p></p> <p>On top of that, the system is meant to serve as a base solution for more complex settings, not only related with air quality monitoring. For that purpose, in addition to the Urban Board, the system also provides off-the-shelf support for a wide variety of third party sensors, using the expansion bus as a common port. One example is what we call the Smart Citizen Station: a full solution for low cost air pollution monitoring.</p> <p>The sensors</p> <p>Have a look a the supported sensors in the Firmware!</p>"},{"location":"Smart%20Citizen%20Kit/#measurements","title":"Measurements","text":"<p>All the Smart Citizen Kit new sensors generation measure at least air temperature, relative humidity, noise level, ambient light, barometric pressure and particulate matter (PM).</p>"},{"location":"Smart%20Citizen%20Kit/#sck-21","title":"SCK 2.1","text":"<p>Here is the table summarising the sensors:</p> Measurement Units Sensors Air temperature \u00baC Sensirion SHT-31 Relative Humidity % REL Sensirion SHT-31 Noise level dBA Invensense ICS-434342 Ambient light Lux Rohm BH1721FVC Barometric pressure Pa NXP MPL3115A26 Equivalent Carbon Dioxide ppm AMS CCS811 Volatile Organic Compounds ppb AMS CCS811 Particulate Matter PM 1 / 2.5 / 10 \u00b5g/m3 Planttower PMS 5003 <p>Sensor performance</p> <p>Make sure you visit the sensor performance page for further information about the sensors.</p>"},{"location":"Smart%20Citizen%20Kit/#installation-instructions","title":"Installation instructions","text":"<p>The sensor comes mounted and almost ready to be used:</p> <p></p> <p>The first step is to connect the battery. The kit will light in red (configuration mode) and we will be able to configure it by following the instructions at start.smartcitizen.me.</p> <p></p> <p>Detailed guide</p> <p>Have a look at this guide for a step-by-step installation.</p> <p>After the configuration process, data will be available on the SmartCitizen platform. You can explore the data there or download it using the <code>CSV Download</code> option (you can check a more detailed guide here)</p> <p></p>"},{"location":"Smart%20Citizen%20Kit/#power-management","title":"Power management","text":""},{"location":"Smart%20Citizen%20Kit/#battery-duration","title":"Battery duration","text":"<p>The SCK comes with a 2000mAh LiPo battery. The battery is meant to be a complete power option for short-term measurements and a backup solution when the kit it is used for long periods. For long exposures, we recommend to permanently connect the USB to kit. The battery duration is dependent on which sensors are enabled or disabled.</p> <p>You will note that the kit turns itself off while operating on battery. Actually, this is what we call <code>sleep-mode</code>, an operation mode implemented to reduce consumption while on battery operation. Check the operation modes section below.</p> <p>PM Sensor management</p> <p>If you want to save battery, the basic interval for the sensors shouldn't be below 30s. This is because the minimum stabilisation time the PM sensor requires to take stable readings is around 15-20s. For this reason, the minimum interval available without turning off the PM sensor between readings is 30s. If a lower interval is required, the PM sensor will be permanently ON and battery will drain faster.</p>"},{"location":"Smart%20Citizen%20Kit/#battery-calculator","title":"Battery calculator","text":"<p>You can use the battery calculator to estimate how much your battery would last.</p> <p>SCK Battery Calculator</p> <p>WIP!</p> <p></p> <p>What's the SCK's Shell?<p>Learn how to use the powerful SCK Shell. Check the guide.</p> </p>"},{"location":"Smart%20Citizen%20Kit/#battery-charging","title":"Battery charging","text":"<p>The SCK has a micro USB port and can be charged like any smartphone or tablet using a dedicated adapter or a computer USB port.</p> <p>We recommend using an external USB power adaptor, instead of a computer USB port, for quicker charging. Autonomy can be extended by using a Power Bank, or a 5V PV Panel.</p>"},{"location":"Smart%20Citizen%20Kit/#power-supply","title":"Power Supply","text":"<p>The SCK needs 5V input via the micro USB connector. A normal 5V power charger can be used, although for outdoor developments we recommend using a waterproof power supply. Find more info in the power supply section.</p>"},{"location":"Smart%20Citizen%20Kit/#user-feedback","title":"User feedback","text":"<p>The LED serves as an indication of the battery status. If the LED is flashing orange   it indicates that the battery must be charged. The battery takes about 4 hours to fully charge. When the battery is fully charged, the LED will change from orange to green  .</p> <p></p> <p>Remember that in addition to these colors you will have the state color of the kit: configuration, network and sd.</p> <p>More details</p> <p>Find more details under the data board section</p>"},{"location":"Smart%20Citizen%20Kit/#user-interfaces","title":"User interfaces","text":"<p>The data board features a set of user interfaces which provide feedback to the user, as well as two buttons with different functionalities. The main RGB LED provides general feedback of the data board status. Additionally, two buttons are provided for user action. A hardware reset button, which forces a power cut to the board, and a power button, used to change the device's mode, turn on and off the device, and to perform a factory reset. You can see both buttons below:</p> <p></p>"},{"location":"Smart%20Citizen%20Kit/#the-button","title":"The button","text":"<p>The main button interaction is detailed below:</p> Function Button action ON Push the button OFF Push the button for 5 seconds CHANGE MODE Push the button multiple times to choose: Setup Wi-Fi mode SD Card mode (offline) FACTORY RESET Push the button 15 seconds for a full reset <p>An example is shown below:</p> <p></p> <p>Troubleshooting</p> <p>Have a look at the troubleshoothing section to check how you can use the buttons in case of problems with your SCK!</p>"},{"location":"Smart%20Citizen%20Kit/#operation-modes","title":"Operation modes","text":"<p>New WARNING feature</p> <p>After release <code>0.9.8</code>, a new warning feature was introduced. In an overall sense, this is the interpretation of each state:</p> <ul> <li>Normal: no problem! Slow fading in the LED.</li> <li>Warning: can take readings, but can't save them in the sdcard or can't send them to the platform (problem with network). Data is stored in the onboard Flash memory and will be saved after the problem is solved - either network comes back or the sdcard is OK. Partial blink in LED.</li> <li>Error: can't take readings. Either there is \"no time\", or there is a big problem that prevents data to be read. Full fast blink in LED.</li> </ul> <p> Remember, you can check your SCK firmware version quickly following this guide.</p>"},{"location":"Smart%20Citizen%20Kit/#setup-mode","title":"Setup mode","text":"<p>In this mode, the Kit is ready to be configured in network mode or SD card in start.smartcitizen.me.</p> LED color Kit status  Ready to be setup  Ready to be setup but battery is low, charge the Kit  Ready to be setup, battery charging  Ready to be setup, battery charged"},{"location":"Smart%20Citizen%20Kit/#wi-fi-mode","title":"Wi-Fi mode","text":"<p>This is the standard mode for a network that requires a Wi-Fi connection. In this way, the device will publish the data every minute on the smartcitizen.me platform. If there is an inserted micro SD card, the data will be stored in it as well.</p> LED color Kit status  Collecting data online  Warning. Collecting data but not sending it online \u274c Error. Not collecting data  Collecting data online but battery is low, charge the Kit  Collecting data online, battery charging  Collecting data online, battery charged  Sleep-mode. Collecting data online and saving battery <p>Warning</p> <p> The kit supports Wi-Fi WEP, WPA/WPA2 and open networks that are common networks in domestic environments and small businesses.</p> <p> But, it does not support WPA/WPA2 Enterprise networks such as EDUROAM or networks with captive portals such as those found in Airports and Hotels</p> <p>Error in network mode</p> <p>If you configure the SCK with a network that is not visible at the moment of configuring it, it will raise an error and it will not take data.</p>"},{"location":"Smart%20Citizen%20Kit/#flash-memory","title":"Flash memory","text":"<p>After firmware version <code>0.9.8</code>, a new flash memory feature was implemented. That changed completely the arrangement of sensor readings vs publication/storage, and how errors are handled. From there on, data is always stored in flash memory before stored in\u00a0SD card\u00a0or published over Wi-Fi. That means that data can be always recovered if there is a problem with the\u00a0SD card\u00a0or the connection to the Internet fails, i.e. if we lose connection, the SCK will still store data and publish it in batch once the network is back!</p> <p>Check and update your Kit software version</p> <p> Remember, you can check your SCK firmware version quickly following this guide. Later, learn here how to update it.</p> <p>Flash chip and sizes</p> <p>The flash chip S25FL064L that we use is an 8\u00a0MB SPI flash nonvolatile memory. The minimum erasable unit is a 4kb sector, the full memory contains 2,048 sectors with a total of 8,388,608 bytes or 8\u00a0MB.</p> <p>A normal reading group with the default urban board hardware installed is composed of 11 readings, hence we expect each reading to take 7 bytes: an average of 5 bytes for the reading itself plus 2 overhead bytes for <code>SensorType</code> and size. Each group should have a total of 77 bytes of readings, 2 bytes of size, 2 bytes of flags and 4 bytes of the time stamp. That means we can expect a normal group to be around 85 bytes. This means we can store almost 100,000 groups of readings, or around 70 days of readings with standard sensor hardware. This number can vary a little, though.</p> <p>About flash memory lifespan, rounding numbers we can say we have enough space to store 2 months (60 days) of readings, according to the Flash memory datasheet we have at least 100,000 erase cycles: 2 months per cycle means 200,000 months, so we can expect more than 16k years!.</p> <p>That can be very useful in many situations, for instance, where we cannot use permanent network connectivity, or we have intermittent electrical blackouts (standard battery required). Of course, everything has its limitations, and the flash memory follows a circular buffer, which means that when the flash memory is full, it will start overwriting data no matter if it was published or not. In a normal SCK, the flash memory will last for some weeks though, but it's better to always be on the safe side and not lose any data.</p> <p>When the SCK loses connection, after three attempts to connect, it will enter warning mode (see here). After this, it will try again after 5 times the publication interval (by default 3'), which means, after the Internet connection is back the SCK will take a maximum of 15' to connect to it and start pushing data. The data publication is not immediate and will take some minutes. If you are in a hurry, click the user button twice (blue-red-blue mode) or reset the kit and data will start being posted right away.</p> <p>Be careful!</p> <p>Having a non-permanent WiFi connection means that we can also risk entering error mode if the SCK runs out of battery because it obtains the time from the internet (or from a phone during the SD card setup process). Losing the network connection and running out of battery means the device will lose the internal clock time, and the device will stop taking readings until it has power and can connect to the internet to sync, again. </p> <p>Debugging commands</p> <p>Check this guide for more debugging commands.</p>"},{"location":"Smart%20Citizen%20Kit/#sd-card-mode-offline","title":"SD card mode (offline)","text":"<p>If we do not have an internet connection we can use the SD mode. In this case the device will record the data on the micro SD card. Later we can read the card using a card reader. The data can be visually spaced in a spreadsheet but also published on the smartcitizen.me platform using the UPLOAD CSV option.</p> LED color Kit status  Collecting data offline  Warning. Collecting data but not storing it in sdcard \u274c Error. Not collecting data  Collecting data offline but battery is low, charge the Kit  Collecting data offline,  battery charging  Collecting data offline, battery charged  Sleep-mode. Collecting data offline and saving battery <p>Guide</p> <p>Check the guide on how to upload the sd card data here</p> <p>Weird files?</p> <p>The files in the sdcard have the following naming: YY-MM-DD.CSV, however, you will find in the some extra files (.01, .02...) These are data files that the sensor creates once there is a reset and, to avoid corruption, it creates a new file in the sd-card, by changing the file-extension. </p> <p>A reset takes place every night at 3-4am with the purpose to avoid data loss because a problem. The SCK then stores the data in a file with a sequential name, and does so by changing the filename to YY-MM-DD.01, .02\u2026 etc depending on the amount of resets it sees during that day. You can see the data and work with it by changing the name from YY-MM-DD.01 to YY-MM-DD_01.CSV. Check the guide on how to organise your data to automatise this.</p>"},{"location":"Smart%20Citizen%20Kit/#especial-status","title":"Especial status","text":"<p>You will see these colors in special moments, mostly when the kit is booting or being updated.</p> LED color Kit status   Busy, please wait!  Software update going on!  Shell mode more info here"},{"location":"Smart%20Citizen%20Kit/#software-updates","title":"Software Updates","text":"<p>Sofware updates are release frequently in the Firmware repository. These updates will need to be applied periodically to the two main components of the SCK: the SAMD21 (main processor) and the ESP8266 (Wi-Fi module). Check the instructions under the Update the Firmware section for more information.</p> <p></p> <p>Test plan</p> <p>You can find the Test plan, in case you are producing the SCK here.</p>"},{"location":"Smart%20Citizen%20Station/","title":"Smart Citizen Station","text":"<p>The Smart Citizen Station is a modular open-source environmental monitoring system. Multiple sensors can be added easily added, expanding the capabilities of the installation or replaced when they are damaged or the sensors lifetime is over. From a costs perspective, while being more expensive than the Smart Citizen Kit, it is also conceived as a low-cost solution. The design builds on top of the Smart Citizen Kit, adding an extra set of more accurate sensors, primarily aimed at measuring air pollutants. It aims at providing a solution that can be used by Citizens and Researchers to gather advanced air pollution data not only from a scientific point of view but also as a tool to engage local communities on air pollution-related issues.</p> <p>Note that the Stations sometimes will look a bit smaller...</p> <p></p> <p>Questions?</p> <p>How can we collaborate for my next research project? How much will it cost to make one? Is it hard to install? Contact our team at info@smartcitizen.me</p> <p></p> <p>Intentionally fabbable</p> <p>The Smart Citizen Station enclosure, as well as some of the electronics, can be fabricated and assembled in a Fablab. By doing so, we hope to encourage fully open environmental systems, ensuring reproducibility through accessible resources.</p> <p>The sensors can include some, or all of:</p> <ul> <li>Up to 16 analog sensors!, some of which can be gas sensors detailed as below</li> <li>Gas sensors for gases such as B4 or A4 sensors from Alphasense Ltd. such as: CO, NO2, NO, O3, SO2, H2S. These are normally in configurations of 2, 4, or 6 sensors (normally O3 needs NO2 to compensate for cross-sensitivity)</li> <li>CO2 NDIR Sensor with a sensirion SCD30</li> <li>PM sensors from Plantower or others similar optical particle counters (OPC)</li> <li>Temperature probe: external temperature probe for more reliable air temperature sensing</li> <li>Ultra-violet radiation</li> <li>Noise levels and FFT spectrum from the Smart Citizen Kit</li> <li>Environmental metrics: temperature, humidity, ambient pressure from the Smart Citizen Kit</li> </ul> <p></p> <p>From the ground up</p> <p>The station uses the same core functionality, interface and feedback as the Smart Citizen Kit. Make sure you are familiar with them before jumping into the station!</p> <ul> <li>User feedback </li> <li>LED states and operation modes</li> <li>User interfaces</li> </ul> <p></p> <p>Dimensions</p> <p>If you are looking at the dimensions and mechanical/electrical information about the Smart Citizen Station, have a look at the enclosures repository</p>"},{"location":"Smart%20Citizen%20Station/#exposure-methods","title":"Exposure methods","text":"<p>Two possible options are available:</p> <ul> <li>Passive sensor exposure</li> <li>Forced ventilation sensor exposure (experimental)</li> </ul> <p> Passive exposure example</p>"},{"location":"Smart%20Citizen%20Station/#power","title":"Power","text":"<p>Currently, the Smart Citizen Station is only available with an external power supply (230VAC to 5V). Find more info in the power supply section. </p> <p>Battery operation?</p> <p>The Smart Citizen Station currently does not support battery operation.</p>"},{"location":"Smart%20Citizen%20Station/#connectivity","title":"Connectivity","text":"<p>Currently, the Smart Citizen Station requires a Wi-Fi connection to report data to the online platform and it can also store data offline locally. Read more about the operation modes and the supported networks.</p> <p>Connectivity Units</p> <p>We tested customized connectivity units capable of deploying a local Wi-Fi network where multiple Smart Citizen Station can connect, data can be relied over GSM (\u00be/5G) or other IoT connectivity standards.</p>"},{"location":"Smart%20Citizen%20Station/#development-versions","title":"Development versions","text":"<p> Final iSCAPE Station version (iSCAPE-V2.0)</p> <p>A note about versions</p> <p>The iScape Living Lab Station 1.0 was the development version for the 2.0 version. It was sponsored thanks to the iSCAPE project under European Community\u2019s H2020 Programme under Grant Agreement No. 689954</p> <p> Middle iSCAPE Station version (iSCAPE-V1.0)</p>"},{"location":"Troubleshooting/","title":"Troubleshooting","text":""},{"location":"Troubleshooting/#first-reboot-your-kit","title":"First, reboot your kit","text":"<p>The magical reset button</p> <p>Before trying anything else, the data board of your SCK comes with a very functional button that makes a hardware reset on the whole device. This is probably our best first try once the kit has any problem. You can see it here:</p> <p></p> <p>Some issues this might help solving:</p> <ul> <li>The kit hasn't been posting data for a while</li> <li>The kit doesn't respond to user interaction with the ON/OFF button</li> <li>The LED is fixed and does not react to anything</li> <li>...</li> </ul> <p>Pressing the reset button will not delete any configuration, it will simply restart your device. The light will go off and on and the device will start again with a white LED.</p> <p>This button is also to be used when reflashing the firmware, by double clicking it. Have a look at the guide here.</p> <p>You can also perform a reboot by disconnecting the battery and the USB cable so that the kit is restarted. In this way we will not lose any data or configuration. However, if we are in <code>SD card mode</code>, the kit won't know what time it is and we will need to give to him. For doing so:</p> <ul> <li>Press the ON/OFF button once. The LED should be breathing RED.</li> <li>Connect to the network <code>SmartCitizen[...]</code> and set it up again to log in <code>SD card mode</code>.</li> </ul>"},{"location":"Troubleshooting/#the-network-wont-show-up","title":"The network won't show up","text":"<p>Before configuring the Kit, if the <code>SmartCitizen[...]</code> network doesn't show up, make sure the LED is red. If not, press the button until the LED turns red.</p> <p></p>"},{"location":"Troubleshooting/#factory-reset-your-kit","title":"Factory reset your kit","text":"<p>You can fully reset the Kit to the default settings so you can register again your device. Press the main button for 15 seconds.</p> <p>After 5 seconds the light will go off and will go on again after 15 seconds. Then you can release the button and your device will be fully resetted as a brand new Kit.</p>"},{"location":"Troubleshooting/#the-led-does-not-turn-on-and-the-kit-does-not-work","title":"The LED does not turn on and the kit does not work","text":"<p>First of all, push the kit button. Maybe it's simply off.</p> <p>If this does not work, most likely the kit has been left without battery. You will have to charge it using the USB charger. Any other mobile charger will also work.</p> <p>We will know that it is charging when the LED emits  orange pulses and once the battery is charged it will emit green  .</p> <p>If the kit does not respond at all, it is probably worth trying with another USB cable, in case there is some problem there. If not, drop us an email or post on the  forum</p>"},{"location":"Troubleshooting/#the-kit-does-not-store-the-data-on-the-sd-card","title":"The kit does not store the data on the SD card","text":"<p>Some SD cards may have problems over time. We can try formatting it, but in case it does not work any micro SD card we buy at any mobile or computer store it will work. The size is not important and any micro SD or micro SDHC 512MB card up to 32GB will work.</p>"},{"location":"Troubleshooting/#the-kit-does-not-boot-with-the-pms-sensor","title":"The kit does not boot with the PMS Sensor","text":"<p>Make sure that you power the Smart Citizen Kit with a good enough USB cable and with an adaptor that can provide at least 1A. We have found some issues when powering the sensor with a thin cable, or from a weak power source, like a screen.</p>"},{"location":"Troubleshooting/#known-fixed-issues","title":"Known (fixed) issues","text":"<p>In this section, we will detail some problems you might have found in the early firmware versions of SCK 2.1.</p>"},{"location":"Troubleshooting/#light-sensor-reads-0-and-temperaturehumidity-sensor-does-not-work","title":"Light sensor reads 0 and temperature/humidity sensor does not work","text":"<p>The issue is caused due to a firmware bug (light) and a problem with some SHT31 sensors (also fixed by firmware). A full explanation is detailed in the forum and the fix was released with V0.9.4 of the SAMD firmware.</p>"},{"location":"Troubleshooting/#noise-readings-dont-go-below-45dba","title":"Noise readings don't go below 45dBA","text":"<p>This issue is caused due to a firmware bug that initialized badly the I2S microphone in SCK2.0 and SCK2.1 sensors. A full explanation is detailed in the forum and and the fix was released with a pre-releasue V0.9.8 of the SAMD firmware.</p>"},{"location":"Troubleshooting/#pm-sensor-always-reads-0ugm3","title":"PM Sensor always reads 0ug/m3","text":"<p>This issue has been detected after a batch from Plantower PMS5003 sensors during 2021 that yields 0ug/m3. A full explanation is detailed this AN and in the forum and the fix release is V0.9.9. The sensor operation is correct, and there is no need for hardware replacement.</p>"},{"location":"_FAQ/","title":"Frequently asked questions","text":""},{"location":"_FAQ/#can-the-sensors-be-placed-outdoors","title":"Can the sensors be placed outdoors?","text":"<p>Yes. The sensor is designed for both indoors and outdoors use. But if you\u2019re planning to use it outdoors, you will have to consider purchasing or making a rainproof enclosure.</p>"},{"location":"_FAQ/#can-i-make-my-own-rainproof-enclosure","title":"Can I make my own rainproof enclosure?","text":"<p>Of course! The manufacturing files for the 3D printed enclosure will be available to download in the Enclosures repository. Throughout the history of the Smart Citizen project, we\u2019ve seen many inventive solutions for placing the sensor outdoors.</p>"},{"location":"_FAQ/#can-i-charge-the-sensors-with-a-solar-panel","title":"Can I charge the sensors with a solar panel?","text":"<p>Sure! But note that the sensor requires a 5V solar panel to work properly. More information here</p>"},{"location":"_FAQ/#can-i-add-external-sensors-to-the-system","title":"Can I add external sensors to the system?","text":"<p>Yes. The sensor has an independently configurable auxiliary bus at 3.3V with a SEEED Grove connector. The Bus has native support for I2C, but it can also be setup on firmware as a GPIO or UART. It can supply power up to 750mA, and it can be enabled or disabled by software. More info here</p>"},{"location":"_FAQ/#what-happens-if-there-is-a-loss-of-network-connectivity","title":"What happens if there is a loss of network connectivity?","text":"<p>If the sensor is working in network mode and at any time the network is not available, it will store the data on its internal memory and publish all the collected data as soon as the network is available again.</p>"},{"location":"_FAQ/#which-external-sensors-can-be-added","title":"Which external sensors can be added?","text":"<p>Quite a few! Check here</p>"},{"location":"_FAQ/#will-i-be-able-to-access-the-collected-data","title":"Will I be able to access the collected data?","text":"<p>Of course! The data collected by your sensor is available for anyone on the Smart Citizen Platform, and you can download it at any time as a CSV file. Besides, you can also use the API to built custom applications to interact with your device. If you are familiar with python, check also scdata</p>"},{"location":"_FAQ/#how-does-the-kit-record-the-data","title":"How does the kit record the data?","text":"<p>The sensor can work in network and SD card modes. In network mode, the sensor publish data to the SC platform over Wi-Fi (every minute by default, but configurable). In SD card mode, all the collected data is stored locally in CSV format, and it can be later uploaded manually to the platform using the \"Manual Data Upload\" option.</p>"},{"location":"_FAQ/#what-networks-does-it-support","title":"What networks does it support?","text":"<p>The SCK supports Wi-Fi WEP, WPA/WPA2 and open networks that are common networks in domestic environments and small businesses. However, like many other embedded devices such as Apple TV\u00ae or Chromecast\u00ae, it does not support networks with captive portals such as those found in Airports and Hotels. Currently, it also does not WPA/WPA2 Enterprise networks such as EDUROAM. However, they will be supported in the future after a firmware updated. </p>"},{"location":"_FAQ/#i-have-a-firewall-what-do-i-need-to-know","title":"I have a firewall. What do I need to know?","text":"<p>Here are the ports and protocols used by the Kit to communicate with the platform:</p> Service Function Protocol Port Address MQTT Send Data TCP 1883 (80 legacy firmware) mqtt.smartcitizen.me NTP Sync Time UDP 80 ntp.smartcitizen.me <p>Notice we use custom ports already to avoid some firewall restrictions</p>"},{"location":"_FAQ/#is-there-a-mobile-phone-app-that-lets-me-view-the-data","title":"Is there a mobile phone app that lets me view the data?","text":"<p>Currently there is an android app available, but we are working to make the website fully mobile device friendly, so that no mobile phone app is required. We would rather focus the time of our small team on the kits themselves instead of maintaining apps. So our final aim is to be app free, but fully mobile friendly.</p>"},{"location":"_FAQ/#how-accurate-are-the-measurements","title":"How accurate are the measurements?","text":"<p>Weather, noise, light and PM sensor measurements have been calibrated and validated against reference sensors through both in-house and external validations and they provide accurate data. Make sure you check the performance section for more information.</p>"},{"location":"_FAQ/#are-there-any-notable-case-studies-using-similar-sensors","title":"Are there any notable case studies using similar sensors?","text":"<p>Yes! Check all of them here. A particularly interesting case study is the Making Sense project at Plac\u0327a del Sol in Barcelona, where a group of 15 technology enthusiasts and environmentalists joined a community of neighbours from a middle-class district that has been suffering from noise issues due to the nightlife in the square. You can find more information about this case study at: www.making-sense.eu</p>"},{"location":"_FAQ/#what-happens-if-i-want-to-move-the-device-or-give-it-to-someone-else","title":"What happens if I want to move the device or give it to someone else?","text":"<p>Just by pressing the button you can fully reset your sensor and configure it again using your account or a new one. All your previous data will remain available on the platform as it was before the reset.</p>"},{"location":"_FAQ/#what-about-using-other-wireless-technologies","title":"What about using other wireless technologies?","text":"<p>We are working closely with Barcelona\u2019s The Things Network community to develop a TTN enabled sensor. A LoRA prototype has been tested, but we don\u2019t have dates for the final version yet. BLE, Zigbee, or others are not currently supported, and except for G5, we are not planning to implement them unless there is a custom hardware integration demand.</p>"},{"location":"_FAQ/#can-i-remove-my-data-from-the-platform","title":"Can I remove my data from the platform?","text":"<p>Of course. You are the owner of the data that you collect, and you can download and/or delete all your sensor data at any time.</p>"},{"location":"_FAQ/#how-can-i-retrieve-the-mac-address-from-my-device","title":"How can I retrieve the MAC address from my device?","text":"<p>You can retrieve the MAC address with two methods: either you can use your phone (see below), or follow this guide if you want to try out the console interface in the kit. </p> <p>Using your phone</p> <ol> <li>Set the SCK in setup mode (press the button once, the LED should turn red).</li> <li>With your phone, join the Wi-Fi network created by your Kit; it should be SmartCitizen[\u2026].</li> <li>Once you are on your Kit configuration page, go to the Info section. You will see a page with all the information about your Kit.</li> <li>Your MAC address is listed as seen below:</li> </ol> <p></p>"},{"location":"_FAQ/#what-batteries-are-shipped-with-the-kits","title":"What batteries are shipped with the kits?","text":"<p>The default SCK 2.1 Kits come with a 2000mAh LiPo battery model PL804050 (see datasheet and material safety data sheets).</p> <p>For custom projects we also offer a bigger 6000mAh LiPo battery model DTP605068 (see datasheet and material safety data sheets).</p> <p>The connector is JST-PHR-2. When looking at the data board from the top (white side), the positive of the battery (red) should be on the left.</p> <p>We are working on a new dynamic battery calculator. Currently, you can find some approximate data here for the SCK 2.1.</p>"},{"location":"_FAQ/#are-the-electronics-waterproof","title":"Are the electronics waterproof?","text":"<p>No. They cannot be exposed to water, high humidity, corrosive environments, or moisture. Always use an enclosure when exposed outdoors. Highly humid environments can provoke corrosion in the sensors (symptom of this is blue powder near the sensors in the urban board). To help protect them, we recommend using transparent nail polish in these areas. Do not obscure the areas in red:</p> <p></p> <p>If you are using any enclosure from the repository, we also recommend using a filtration foam (PPI-20/10) like this one. More info here</p>"},{"location":"Components/","title":"Hardware Architecture","text":"<p>The Smart Citizen sensor portfolio aims to create a boilerplate for individuals and communities with different sensing expertise levels in a modular, expandable and intuitive way. Building on the legacy of previous Smart Citizen Kit generations, the hardware is especially aimed at providing meaningful data insights on a low budget. The core of the system is a central data logger with network connectivity to which the different components can be connected and aims to give support to a wide range of activities ranging from education to more advanced scientific research, in various environmental fields such as air, water or soil quality.</p> <p>A bit of philosophy</p> <p>The hardware architecture is always evolving, and it will always remain as a set of tools for experimentation. As so, it should be seen more as a toolset for communities, research, education, and not as a final commercial product with full-fledged big-corporation-type-of-support.</p>"},{"location":"Components/#core","title":"Core","text":"<p>The core system provides the logging, interface and management features creating a solid while highly configurable framework for environmental monitoring activities. It's made out of the two main components listed below:</p> <ul> <li> <p>Data Board: A datalogger at the heart of the sensors architecure supporting the Smart Citizen Kit and the Smart Citizen Stations.</p> </li> <li> <p>Firmware: The software running inside the Data Board.</p> </li> </ul>"},{"location":"Components/#air","title":"Air","text":"<ul> <li> <p>Sensor Boards: Multiple sensor board have been developed. They can be combined to built the different sensor solutions as the Smart Citizen Kit and the Smart Citizen Stations:</p> <ul> <li> <p>Urban Sensor Board: A selection of low-cost sensors in a board ready to measure the urban environment: temperature, humidity, noise, light, and PM2.5, among others. Together with the Data Board they create the Smart Citizen Kit.</p> </li> <li> <p>PM Sensor Board: An auxiliary board capable of driving two Particulate Matter sensor as well as other auxiliary sensors required for specific deployments as an external temperature sensor or an anemometer. It is used in the Smart Citizen Stations.</p> </li> <li> <p>Gas Pro Sensor Board: An auxiliary board driving 3 Alphasense Ltd. Electrochemical Series B Gas Sensors designed for ultra-low noise, high-performance and low power operation. It is used in the Smart Citizen Stations for sensors with no offset voltage compensation, i.e. it's not valid for NO, NO2 or OX sensors</p> </li> <li> <p>Analog Sensors Board: An auxiliary board using a high-resolution ADC capable of reading 4 or 8 analog channels at 16bit resolution. It is used in the Smart Citizen Stations for the Analog front-end by Alphasense Ltd. which interface with any type of Electrochemical Series B Gas Sensors (NO, NO2 or OX sensors as well)</p> </li> </ul> </li> </ul> <p>Expand the SCK</p> <p>Check how to expand the SCK for air quality in the auxiliary connector section</p>"},{"location":"Components/#soil-and-water","title":"Soil and Water","text":"<p>Having a robust portfolio of the sensor for measuring soil and water characteristics is a need found by many research communities. In this direction, we include a collection of sensors that despite not being low cost or open source, they are still affordable and well documented when compared to other commercial solution. From a cost perspective, they are not aimed at being massively deployed but instead used individually in a specific site for specific needs.</p> <p></p> <p>Take a deeper look</p> <p>Soil and water sensors are fully detailed in the Soil and water section.</p>"},{"location":"Components/#open-source","title":"Open Source","text":"<p>We're against black boxes!</p> <p>The entire project it is released under open source licenses:\u2028</p> <ul> <li>Hardware components: CERN Open Hardware License v1.2</li> <li>Core firmware: GNU GPL v3.0</li> <li>Software platform: GNU AGLP v3.0</li> </ul> <p>Info</p> <p>Check the Source files section for each component and explore the software source code and the hardware blueprints.</p> <p></p>"},{"location":"Components/Auxiliary%20Connector/","title":"Auxiliary connector","text":"<p>The data board features a standard Grove connector where off-the-shelf modules from the same manufacturer can be connected. The connector supports an independent I2C bus by default, but by software it can be configured to support other uses (GPIO, I2C and UART). It can supply power up to 750mA, and it can be enabled or disabled by software to save power.</p> <p></p> <p>There is a lot more to it!</p> <p>The Smart Citizen Kit is designed with a modular approach in mind. This means that the Urban Board is only a selection of low cost sensors for air quality, but the hardware itself can be expanded for other use cases such as a more advanced air quality monitoring setup, soil monitoring, or water quality. Make sure you check our guide on how to use them.</p>"},{"location":"Components/Auxiliary%20Connector/#supported-sensors","title":"Supported sensors","text":"<p>This is a list of supported sensors that you can connect directly to the auxiliary port.</p> <p>Looking for datasheets?</p> <p>Refer to the Performance section for more information and datasheets.</p>"},{"location":"Components/Auxiliary%20Connector/#general-purpose","title":"General purpose","text":"<ul> <li>Seeed Grove ADC - 12 bit ADC from Seeed Studio</li> <li>Adafruit INA219 - Supports Bus voltage, shunt voltage, current and load voltage</li> <li>SparkFun ToF Range Finder Sensor - VL6180 - supports distance and light. Can be used for water level measurements</li> <li>ADS1X15 - 16 bit ADC from Texas instruments also found in Adafruit development boards</li> </ul>"},{"location":"Components/Auxiliary%20Connector/#air","title":"Air","text":"<ul> <li>Seeed Grove SHT31 Temperature/Humidity</li> <li>Adafruit dev kit for Bosch BME680 - supports temperature, humidity, barometric pressure and VOC gas</li> <li>Sparkfun dev kit for AMS CCS811 - supports temperature, humidity, barometric pressure and VOC gas</li> <li>Atlas Scientific Temperature - can be used with any PT-100 or PT-1000 temperature probes</li> </ul> <p>Smart Citizen Station</p> <p>Expanding the base air quality solution, the Smart Citizen Station is a more advanced setup in a more rugged enclosure. The sensors below can be directly plugged in and detected by the SCK:</p> <ul> <li>Smart Citizen Gases Pro Board: supports 3 electrochemical alphasense sensors, temperature and humidity </li> <li>Smart Citizen PM Board: supports 2 Plantower PMS5003 sensors, I2C extension, 4 ADC pins, 2 GPIO and a UART Serial port</li> <li>Smart Citizen Analog Sensor Board: supports 4 or 8 analog channels at 16bit resolution.</li> </ul> <p></p>"},{"location":"Components/Auxiliary%20Connector/#soil-and-water","title":"Soil and Water","text":"<p>Check the Soil and water measurements documentation with examples on sensors such as:</p> <ul> <li>Atlas Scientific Dissolved Oxygen</li> <li>DS18B20 Water Temperature for water</li> <li>Chirp Soil Moisture, with support of soil moisture (requires calibration), temperature and ambient light.</li> </ul>"},{"location":"Components/Auxiliary%20Connector/#other-auxiliaries","title":"Other auxiliaries","text":"<ul> <li>Seeed Grove OLED screen (128x128), check the documentation for more details. </li> <li>Sparkfun GPS NEO-M8U</li> <li>SparkFun GPS XA1110</li> <li>SparkFun GPS SAM-M8Q, only in a forked repository for now by serialc here. Read this post here</li> <li>SEEED Grove GPS Module (only via PM Board as it uses UART to communicate)</li> </ul> <p>Sparkfun QWIIC GPS</p> <p>If you are using Sparkfun QWIIC GPS, note that you will need an adaptor from GROVE to QWIIC</p> <p>Implement your own</p> <p>Contact on how to implement sensors made by others.</p>"},{"location":"Components/Auxiliary%20Connector/#full-list","title":"Full list","text":"<p>This is a list of supported sensors. Find also the datasheets for more information regarding accuracies:</p> <p>WIP</p> <p>This list is always a WIP!</p> Field SCK sensor name Units Location Sensor and datasheet Air Temperature \u00baC Urban Board Sensirion SHT31 Air Humidity %RH Urban Board Sensirion SHT31 Air Light lux Urban Board ROHM BH1730 Air Noise dBA na (dBA scale) Urban Board INVENSENSE 43432 Air Noise dBC na (dBC scale) Urban Board INVENSENSE 43432 Air Noise dBZ na (dBZ scale) Urban Board INVENSENSE 43432 Air Noise FFT na Urban Board INVENSENSE 43432 Air Barometric pressure kPa Urban Board NXP MPL3115A2 Air VOC Gas CCS811 ppb Urban Board AMS CCS811 Air eCO2 Gas CCS811 ppm Urban Board AMS CCS811 Air PM_X (X = [1.0, 2.5, 10]) ug/m3 Urban Board PLANTOWER PMS5003 Air PN_X (X = [0.3, 0.5, 1.0, 2.5, 5.0, 10]) #/0.1l Urban Board PLANTOWER PMS5003 Air, soil and water PM board Dallas Temperature \u00baC External Sensor MAXIM DS18B20 Air Ext PM_X (X = [1.0, 2.5, 10]) ug/m3 External Sensor PLANTOWER PMS5003 Air Ext PN_X (X = [0.3, 0.5, 1.0, 2.5, 5.0, 10]) #/0.1l External Sensor PLANTOWER PMS5003 Air SCD30_CO2 ppm External Sensor Sensirion SCD30 Air SCD30_T \u00baC External Sensor Sensirion SCD30 Air SCD30_H %RH External Sensor Sensirion SCD30 Generic ADS1x15 ADC 0x4X ChY (X = [8, 9, A, B)], Y = [0, 1, 2, 3]) V External Sensor ADS 1115 Generic Grove ADC V External Sensor Seeed Grove ADC Location GPS Fix Quality na External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Latitude Deg External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Longitude Deg External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Altitude m External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Speed m/s External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Horizontal Dilution of Position - External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Traked Satellites - External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Soil and water Atlas PH PH External Sensor Atlas Scientific pH Driver - Probe - Calibration Solution Water Atlas Dissolved Oxygen mg/L External Sensor Atlas Scientific Dissolved Oxygen Driver - Probe - Calibration solution Water Atlas DO Saturation % External Sensor Atlas Scientific Oxygen Saturation Driver - Probe - Calibration solution Soil and water Atlas Conductivity \u00b5S/cm External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Total Dissolved Solids ppm External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Salinity PSU(ppt) External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Specific gravity - External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil Soil Moisture Raw - External Sensor Chirp Soil Moisture Soil Soil Moisture Percent % External Sensor Chirp Soil Moisture Soil Soil Temperature degC External Sensor Chirp Soil Moisture Soil Soil Light - External Sensor Chirp Soil Moisture Air, soil and water Atlas Temperature degC External Sensor PT-100 or PT-1000 Atlas Scientific Temperature Other Battery % Urban Board - Other Battery Voltage V Urban Board - Other INA219 Bus voltage V External Sensor Adafruit INA219 Other INA219 Shunt voltage mV External Sensor Adafruit INA219 Other INA219 Current mA External Sensor Adafruit INA219 Other INA219 Load voltage V External Sensor Adafruit INA219"},{"location":"Components/Firmware/","title":"Firmware","text":"<p>The firmware is OOP and is entirely written in C++. Both processors the core ARM MCU and the ESP8266 WIFI are developed as part of the same framework integrating seemingly by using a set of bridge libraries that provide a unifies the RPC architecture.</p> <p>A note about versions</p> <p>The first version of the software was initially developed for the Making Sense project under European Community\u2019s H2020 Programme under Grant Agreement No. 688620.</p> <p>The current version has been funded by the iSCAPE project project under European Community\u2019s H2020 Programme under Grant Agreement No. 689954.</p> <p></p> <p>Firmware updates are done via the micro USB port using the Platform IO software available for Linux, Mac and Windows. </p>"},{"location":"Components/Firmware/#architecture","title":"Architecture","text":""},{"location":"Components/Firmware/#core-microcontroller","title":"Core Microcontroller","text":"Name Functions Pins Definition for the MCU pinout Sensors Definition for all the supported sensors SckBase Manages the core operations: power, connectivity, peripherials SckAux Manages the sensors connected on the AUX connector SckList Manages internal Flash memory data storage SckUrban Manages the sensors on the Urban Sensor Board SckBatt Manages the battery charging process SckButton Manages users button interaction actions SckLed Manages light status for user feedback Commands Library to absracts the core features on to a simple shell interface"},{"location":"Components/Firmware/#dependencies","title":"Dependencies","text":"<ul> <li>SPIMemory Library</li> <li>RTCZero Library</li> <li>SdFat Library</li> <li>Arduino Json Library</li> <li>Adafruit INA219 Library</li> <li>U8g2 Library</li> <li>RadioHead Library</li> <li>FlashStorage Library</li> <li>Dallas Temperature Library</li> <li>Sparkfun CCS811 Library</li> <li>Sparkfun MediaTek I2C Interface Library</li> <li>Sparkfun u-blox Arduino GNSS Library</li> <li>TinyGPSPlus Library</li> <li>LinkedList Library</li> <li>Adafruit ADS1015 Library</li> <li>ArduinoZero PMUX Report Library</li> <li>MCP342X Analog-to-Digital Converter Library</li> <li>DS2482 Library</li> <li>Adafruit MPL3115A2 Library</li> <li>I2C Soil Moisture Sensor Library</li> <li>SmartSmart Citizen Kit Gases Pro Board Library</li> <li>Sparkfun ToF Range Finder - VL6180 Arduino Library</li> <li>Adafruit BME680 Library</li> <li>Adafruit Unified Sensor Driver Library</li> <li>Sparkfun SCD30 CO\u2082 Sensor Library Library</li> </ul>"},{"location":"Components/Firmware/#wifi-module","title":"WiFi Module","text":"Name Functions SckESP Runs all the Wi-Fi networking related functions"},{"location":"Components/Firmware/#dependencies_1","title":"Dependencies","text":"<ul> <li>Time Library</li> <li>ArduinoJson Library</li> <li>RemoteDebug Library</li> <li>RadioHead Library</li> <li>PubSubclient Library</li> <li>ESPAsyncWebServer Library</li> </ul>"},{"location":"Components/Firmware/#shared","title":"Shared","text":"Name Functions Config Provides a shared configuration between the two MCUs"},{"location":"Components/Firmware/#data-management","title":"Data management","text":"<p>The board is capable of storing the recorded data offline on its internal dedicated flash memory of 8MB and later publish this over Wi-Fi connectivity provided by an Espressif ESP8266. Data is published using MQTT messages to the Smart Citizen Platform. NTP is used for syncing the built-in RTC. For long term offline storage, the board provides a standard microSD socket where card in the orders of GB can be employed. That ensures extended periods of data in the order of decades can be stored.</p>"},{"location":"Components/Firmware/#configuration","title":"Configuration","text":"<p>The board firmware is fully customizable without requiring any changes to the core software. That includes enabling or disabling sensors, the sampling frequency of the sensors or the operation mode. There different configuration options via the Serial Shell available when the board is connected over USB.</p> <pre><code>Detecting: AlphaDelta 1A... found, Enabling AlphaDelta 1A\nDetecting: AlphaDelta 1W... found, already enabled!!!\nDetecting: AlphaDelta 2A... found, already enabled!!!\nDetecting: AlphaDelta 2W... found, already enabled!!!\nDetecting: AlphaDelta 3A... found, already enabled!!!\nDetecting: AlphaDelta 3W... found, already enabled!!!\nDetecting: AlphaDelta Temperature... found, already enabled!!!\nDetecting: AlphaDelta Humidity... found, already enabled!!!\nDetecting: Grove ADC... nothing!\nDetecting: INA219 Bus voltage... nothing!\nDetecting: INA219 Shunt voltage... nothing!\nDetecting: INA219 Current... nothing!\nDetecting: INA219 Load voltage... nothing!\nDetecting: DS18B20 Water temperature... nothing!\nDetecting: Atlas PH... nothing!\nDetecting: Atlas Conductivity... nothing!\nDetecting: Atlas Specific gravity... nothing!\nDetecting: Atlas Dissolved Oxygen... nothing!\nDetecting: Atlas DO Saturation... nothing!\nDetecting: Grove OLED... nothing!\n</code></pre>"},{"location":"Components/Firmware/#shell","title":"Shell","text":"<p>The firmware provides a comprehensive command shell over USB to manage all the kits functionalities for advanced users. </p> <p>Use any Serial console as <code>screen</code>, <code>platformio device monitor</code>, or the serial monitor on the Arduino IDE</p> <p>Info</p> <p>Have a look at the guide for different platforms here</p>"},{"location":"Components/Firmware/#storage","title":"Storage","text":""},{"location":"Components/Firmware/#readings-files-yy-mm-ddcsv","title":"Readings files YY-MM-DD.CSV","text":"<p>These files are generated and updated by the kit in a daily manner. When a SD is detected the SCK will automatically save the sensors into it. </p> <p>The SCK creates an additional CSV file once there is a hardware reset. A reset takes place every night at 3-4am with the purpose to avoid data loss because a software problem (i.e. blocked software). The SCK then stores the data in a file with a sequential name, and does so by changing the filename to YY-MM-DD.01, .02... depending on the amount of resets it sees during a certain day. The latest data is always in the file with .CSV extension. An example of a day with two resets (ad hoc and the programmed one):</p> <pre><code>YY-MM-DD.01 -&gt; first reset\nYY-MM-DD.02 -&gt; second reset\nYY-MM-DD.CSV -&gt; latest file\n</code></pre> <p>The user can safely change the extension of these files back to .CSV and concatenate them:</p> <pre><code>YY-MM-DD.01 -&gt; YY-MM-DD_01.CSV\nYY-MM-DD.02 -&gt; YY-MM-DD_02.CSV\nYY-MM-DD.CSV -&gt; YY-MM-DD.CSV\n</code></pre> <p>Warning</p> <p>If there is a problem with the device, sometimes it can be that the SD card contains many files for a single day. These resets might go unnoticed, and the SD card files can be a way of detecting an issue.</p>"},{"location":"Components/Firmware/#debug-log-file-debugtxt","title":"Debug log file DEBUG.txt","text":"<p>The debug file is generated and updated by the kit, only if the debug mode is enabled on the configuration.</p> <p>When the debug mode is enabled the verbosity level of this file is defined by the outlevel (normal, verbose or silent).</p>"},{"location":"Components/Firmware/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Components/Flash%20Storage/","title":"Flash storing","text":""},{"location":"Components/Flash%20Storage/#introduction","title":"Introduction","text":"<p>With this implementation, the Smartcitizen kit 2.1 readings will be stored in a flash memory buffer before being published. If SCK RTC clock is in sync the kit will start taking readings and save them, if a SD card is available it will also save them there and if the Wi-Fi and platform token are configured it will publish the data to the network via MQTT. This means we will always have a backup for the readings taken the last ~70 days.</p> <p>Info</p> <p>The memory chip that we use (S25FL064L), it's an 8 MB SPI flash nonvolatile memory. To manage it, we use the SPI Memory Arduino library.</p>"},{"location":"Components/Flash%20Storage/#data-organization","title":"Data organization","text":""},{"location":"Components/Flash%20Storage/#flash-sectors","title":"Flash sectors","text":"<p>The minimum erasable unit is a sector (4 KB), so we use this as a base for data organization. On the first 3 bytes of each sector we store information about its contents, in this way we can find which ones are empty, currently in use or have valid data.  </p> <pre><code>enum SectorAddr {\nSECTOR_STATE = 0x00,\nSECTOR_NET   = 0x01,\nSECTOR_SD    = 0x02\n};\n</code></pre> <p>The first byte of each sector (<code>SECTOR_STATE</code>) describes if the sector is empty or already used. On boot, we scan sector by sector until we find an empty one to store new data.</p> <p>The <code>SECTOR_NET</code> and <code>SECTOR_SD</code> bytes of each sector contain the flags related to the publish state of contained data. This bytes are only marked if all the groups of the sector are already published and the sector is full.</p> <p>When all flash sectors are marked as used we will erase the oldest data sector and reuse it.</p>"},{"location":"Components/Flash%20Storage/#data-groups","title":"Data Groups","text":"<p>Readings are grouped by the time there were taken and saved sequentially inside flash memory sectors. On the beginning of each group, we store information about it.</p> <pre><code>enum GroupAddr {\n    GROUP_SIZE =        0x00,\n    GROUP_NET  =        0x02,\n    GROUP_SD   =        0x03,\n    GROUP_TIME =        0x04,\n    GROUP_READINGS =    0x08\n};\n</code></pre> <p>In the <code>GROUP_SIZE</code> bytes, we store the size in bytes of the full group with all its contents. This allows us to start reading the sector starting on the first group and jump from group to group very fast.</p> <p>The <code>GROUP_NET</code> and <code>GROUP_SD</code> bytes of each group contain the flags related to the publishing state of contained data, as default they are in <code>NOT_PUBLISHED</code> state until we set them to <code>PUBLISHED</code>.</p> <p>The time and date of when these readings were taken is stored in the <code>GROUP_TIME</code> bytes in Epoch time format.</p> <p>Starting on the <code>GROUP_READINGS</code> byte, we store the sensor readings data (256 max). The first byte of each reading contains its full size in bytes, the second byte the sensor identifier (<code>SensorType</code>) and starting on the third byte the sensor data is stored in ASCII chars.</p>"},{"location":"Components/Flash%20Storage/#sizes","title":"Sizes","text":"<p>A normal reading group with the default urban board hardware installed is composed by 11 readings, we expect each reading to take 7 bytes: an average of 5 bytes for the reading itself plus 2 overhead bytes for <code>SensorType</code> and size, so each group should have a total of 77 bytes of readings, 2 bytes of size, 2 bytes of flags and 4 bytes of the time stamp. That means we can expect a normal group to be around 85 bytes.</p> <p>Info</p> <p>We have 8 MB (8,388,608 bytes) of flash memory that means storing almost 100,000 groups of readings or around 70 days of readings with standard sensor hardware. This number can vary a little, because we will lose some space at the end of each sector.</p> <p>About flash memory lifespan, rounding numbers we can say we have enough space to store 2 months (60 days) of readings, according to the Flash memory datasheet we have at least 100,000 erase cycles: 2 months per cycle means 200,000 months that's more than 16k years!!. </p>"},{"location":"Components/Flash%20Storage/#user-interface","title":"User interface","text":"<p>Some aspects of the flash memory can be managed by the user via the SCK shell interface, issuing the <code>help</code> command you can see a brief description of the <code>flash</code> command interface:  <pre><code>flash:       Shows and manage flash memory state [no-param -&gt; info] [-format (be carefull)] [-dump sect-num (0-2040)] [-sector sect-num] [-recover sect-num/all net/sd]\n</code></pre></p> <p>Without any parameter, the <code>flash</code> command will scan the memory and print out a table of its contents, showing totals at the end. Be patient, scanning can take a long time if your flash has data. The <code>-format</code> option will erase the full flash memory. The <code>-dump</code> option will dump (in hexadecimal values) the content of the requested sector. The <code>-sector</code> option will show general information about the data contained on the requested sector. The <code>-recover</code> option takes 2 parameters: the sector number or the keyword all and one keyword to indicate how to recover the data (net or sd)</p>"},{"location":"Components/GPS/","title":"GPS","text":"<p>You can now connect a GPS to the SCK2.1. The supported GPS units are in this list. We recommend using a ceramic patch antenna for better gain:</p> <p></p> <p>The U.FL antenna connector does not need to be unplugged from the board, specially never when the board is being powered in order to avoid damaging the circuitry:</p> <p></p> <p>Antenna images by Sparkfun (License CC BY 2.0) and edited by Smart Citizen.</p> <p>Harsher environments?</p> <p>In harser environments, a magnetic mounted waterproof antenna like this one would be preferred.</p>"},{"location":"Components/GPS/#data-acquisition","title":"Data Acquisition","text":"<p>Data can be recorded offline or published online to the Smart Citizen Platform. The SCK owner needs to configure how the data is going to be stored in the Setup process, either in the SD card or via network connectivity (WiFi) to the platform.</p> <p>When the SCK is configured in sdcard mode, it will store the data at the requested interval* in the SD card.</p> <p>In the case of network connectivity, in normal conditions, the device will send data over to the Smart Citizen Platform via WiFi (WPA2 Personal or WEP). Additionally, when configured to send data over WiFi, if there is a SD card present, it will also store the data in it as a backup. Finally, in the special case of mobile sensors, where network connectivity is not always present, the data can be recorded offline on its internal dedicated flash memory of 8MB and later publish this over WiFi connectivity. Data is published using MQTT messages to the Smart Citizen Platform. NTP is used for syncing the built-in RTC.</p> <p>Make sure data is recorded</p> <p>It is important to follow the steps below in order to select the correct kit blueprint while registering the sensor:</p> <ol> <li> <p>Click the \ud83d\udee0\ufe0f icon in the bottom right corner</p> </li> <li> <p>Choose the blueprint of the device you want to setup, in this case: <code>#32 SCK 2.1 GPS</code></p> </li> <li> <p>Click save and continue the process as usual</p> </li> </ol>"},{"location":"Components/GPS/#recording-interval","title":"Recording interval","text":"<p>In order to understand the reading and publication intervals, it is important to describe how the structure of the measurements is done:</p> <ol> <li>Overall reading interval: base period for the SCK to take a measurement</li> <li>Individual sensor reading interval: period for each sensor to take a measurement. It is defined as N times the Overall reading interval</li> <li>Publication interval: time for the SCK to publish to the Smart Citizen Platform, independent of the reading interval.</li> </ol> <p>Each of the sensors can be configured independently, with a reading interval N times the overall reading interval. When a GPS is connected, all the sensors are read every 60s if the sensors are static. When a GPS movement is detected, the reading interval goes down to 5s.</p> <p>If you use the sensor out of WiFi connectivity (i.e. moving), the sensors store data internally in the Flash memory during the trips and publish it in batch when the configured WiFi network is visible. Data is also stored in the SD card for later use in CSV file format.</p> <p></p>"},{"location":"Components/GPS/#data-formats","title":"Data formats","text":"<p>Data from the GPS are timestamped in ISO8601 format with the following metrics:</p> Metric Units Description GPS_ALT m GPS Altitude GPS_DIL n/a GPS Horizontal Dilution of Position GPS_FIX_QUALITY n/a GPS Fix Quality GPS_LAT \u00ba GPS Latitude GPS_LONG \u00ba GPS Longitude GPS_SAT_N n/a GPS Number Tracked Satellites GPS_SPEED m/s GPS Horizontal Speed"},{"location":"Components/GPS/#gps-specifics","title":"GPS Specifics","text":""},{"location":"Components/GPS/#neo-m8u","title":"NEO-M8U","text":"<p>The selected NEO-M8U GPS Breakout from Sparkfun is a high quality GPS board. The NEO-M8U takes advantage of u-blox's Untethered Dead Reckoning (UDR) technology. The NEO-M8U module is a 72-channel u-blox M8 engine GNSS receiver, meaning it can receive signals from the GPS, GLONASS, Galileo, and BeiDou constellations with ca. 2.5 meter accuracy. The module supports concurrent reception of three GNSS systems. The combination of GNSS and integrated 3D sensor measurements on the NEO-M8U provide accurate, real-time positioning rates of up to 30Hz.</p> <p>Compared to other GPS modules, this breakout maximizes position accuracy in dense cities or covered areas. Even under poor signal conditions, continuous positioning is provided in urban environments and is also available during complete signal loss (e.g. short tunnels and parking garages). Lock time is further reduced with on-board rechargeable battery; there is a backup power enabling the GPS to get a hot lock within seconds.</p> <p>The SparkFun NEO-M8U GPS Breakout is also equipped with an on-board rechargeable battery that provides power to the RTC on the NEO-M8U. This reduces the time-to-first fix from a cold start (ca. 26s) to a hot start (ca. 1.5s). The battery will maintain RTC and GNSS orbit data without being connected to power for plenty of time.</p> <p></p> <p>GPS image by Sparkfun (License CC BY 2.0) and edited by Smart Citizen.</p>"},{"location":"Components/Soil%20and%20water/","title":"Soil and water sensors","text":"<p>Although most of the time we have been working with air quality sensors and air metrics, we also like to keep an eye on soil and water sensors. This page details our integration of water and soil sensors, often interchangeable in some cases.</p> <p>Different sensor probes can be combined for different configurations. For example the setup shown above is designed for soil measurements and includes Atlas Scientific temperature, conductivity and PH probes and a GPS. Additional sensors include a Chirp Moisture Sensor as described in the soil section. Another example is the setup in the figure below is designed for water monitoring on aquaponics systems and includes Atlas Scientific probes for PH, conductivity and dissolved oxygen.</p> <p></p> <p>Some of the sensors selected are from Atlas Scientific, a New York-based company that converts devices that were originally designed to be used by humans into devices that are specifically designed to be used by robots. The sensors are not entirely open source as the other sensors (the Chirp Sensor is a low cost moisture and temperature sensor developed by WeMakeThings: a hackers and engineers collective based in Vilnius, Lithuania). However, they are modular and exceptionally well documented by the manufacturer. That includes excellent documentation on how to install, calibrate and integrate them with additional existing hardware. In this direction, we developed a full library for the SCK to support the sensors via the Auxiliary sensor connector. As the sensors can be configured in different ways, we do not provide a full step-by-step guide. Instead, we refer to the documentation on the project's repository.</p> <p>Use cases</p> <p>Check how we have used the water or soil sensors in various projects in the Use cases section</p>"},{"location":"Components/Soil%20and%20water/#hardware","title":"Hardware","text":""},{"location":"Components/Soil%20and%20water/#available-measurements","title":"Available measurements","text":"<p>The sensors described below are additional to those already supported on the Smart Citizen Kit base sensors. </p> Metric Usage Probe Driver Calibration Temperature Soil and water Atlas PT-100 + PT-1000 Atlas EZO-RTD Not required PH Water Atlas ENV-40-PH or ENV-35-PH Atlas EZO-PH Atlas CHEM-PH PH Soil Atlas ENV-45-PH Atlas EZO-PH Atlas CHEM-PH Electrical Conductivity Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Total Dissolved Solids Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Salinity Soil and water Atlas ENV-40-EC-K Atlas Atlas EZO-EC Atlas Atlas CHEM-EC Specific Gravity Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Dissolved Oxygen Water Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Oxygen Saturation Water Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Soil Moisture Soil Catnip Chirp! None Cup of water <p>Soil and water</p> <p>For probes that can be used in both, soil and water, make sure to follow this procedure.</p>"},{"location":"Components/Soil%20and%20water/#atlas-scientific-carrier-board","title":"Atlas Scientific Carrier board","text":"<p>We recommend using Whitebox Labs Tentacle T3 that hosts up to 3 Atlas Scientific Probes, and can be stacked with several units. It connects to the SCK via the Aux sensor connector, and needs external 5V connection, which means that it can't run on battery directly connected to the SCK without extras. If you want to make your own, before the Tentacle T3 existed we designed a custom board in collaboration in with Aquapiooners.</p> <p></p> <p>Ready to set it all up</p> <p>Visit this guide to get started.</p>"},{"location":"Components/Soil%20and%20water/#enclosures","title":"Enclosures","text":"<p>A normal IP enclosure can be used for this setup. More information about the BOM and design files can be found in the enclosures repository.</p> <p></p> <p>Thanks!</p> <p>This enclosure and development has been done in collaboration with ICM-CSIC and the Club Pati Vela de Barcelona.</p>"},{"location":"Components/Soil%20and%20water/#legacy-enclosures","title":"Legacy enclosures","text":"<p>In collaboration in with Aquapiooners we designed the custom enclosure below.</p> <p></p> <p>The enclosure of the monitoring board and the smart citizen have been designed on Onshape, you can either download the STL files or copy the project to your onshape account and modify them as you wish : The Onshape documents of the monitoring case</p> <p></p> <p>We have also designed a probe holder if you want to hold your probes on the side of you fish tank. Here you can find the Onshape document of the probes holder</p> <p></p>"},{"location":"Components/Soil%20and%20water/#soil-station","title":"Soil Station","text":"<p>More soil sensors can be added as well, not only Atlas Scientific sensors, or  the WeMakeThings Chirp sensor for Soil moisture. More developments available upon request.</p> <p></p>"},{"location":"Components/Soil%20and%20water/#water-station","title":"Water Station","text":"<p>An specific Water Station was designed as part of the Pati Scientific project in colaboration with the Institut de Ci\u00e8ncies del Mar. The station currently measures the sensors below, but virtually any supported sensor can be added:</p> <p> Image credit: Pati Scientific</p> <ul> <li>Temperature</li> <li>PH</li> <li>Electrical Conductivity</li> <li>Dissolved Oxygen</li> <li>GPS location</li> </ul> <p>Came to stay</p> <p>This unit is here to stay. It is used in MINKE and it's also available upon request!</p>"},{"location":"Components/Solar%20Panel/","title":"Solar Panel","text":"<p>We recommend a Solar Panel from Voltaic Systems, either the 6W 6V option or the 5W 6V version.</p> <p>What is this for?</p> <p>Currently, this option is only usable for the Smart Citizen Kit 2.1 with small accessories, like a CO2 sensor or some electrochemical sensors, but it's not suitable for a larger options like the Smart Citizen Station. For this, we recommend a larger solar panel with a lead-acid battery instead as back-up.</p> <p> Image credit: Voltaic System</p> <p>We use an MPTT Sunflower Solar power manager 5V from DF Robot for managing the solar input with an additional 2Ah battery. It is fitted inside the enclosure with a small laser cut (or 3D printed if not available) flange. This is the BOM for this option.</p> <p></p> <p>Installation</p> <p>Have a look at the installation guide for Solar Panel</p> <p>Source files</p> <p>Find all the information here</p>"},{"location":"Components/boards/Analog%20Sensor%20Board/","title":"Analog Sensor Board","text":"<p>The SmartCitizen ASB is an expansion board for the Smart Citizen Kit that provides connectivity to analog sensors with a high precission ADS1115 via I2C, with four configurable addresses. It also gives the possibility to directly hook up this ADC by Adafruit.</p> <p></p> <p>We use it to measure low power sensors such as the Alphasense Ltd. electrochemical sensors.</p>"},{"location":"Components/boards/Analog%20Sensor%20Board/#characteristics","title":"Characteristics","text":""},{"location":"Components/boards/Analog%20Sensor%20Board/#operating-voltage","title":"Operating voltage","text":"<p>Natively operates at 3.3V, but can use also up to 5.5V in EXT-V, and with a selectable jumper. It integrates a level-shifter from the GROVE connector's voltage to EXT-V.</p>"},{"location":"Components/boards/Analog%20Sensor%20Board/#connectivity","title":"Connectivity","text":"<p>I2C, from 3.3V up to 5.5V.</p>"},{"location":"Components/boards/Analog%20Sensor%20Board/#inputs","title":"Inputs","text":"<ul> <li>4 channels in the 4-channel version. Daisy chainable up to 4 boards - with a total of 16 analog channels!</li> <li>8 channels in the 8-channel version.</li> </ul> <p>Check the source</p>"},{"location":"Components/boards/Data%20Board/","title":"Data Board","text":"<p>The data board is a data-logger at the core of the sensors architecture supporting the Smart Citizen Kit and the Smart Citizen Station. This module is powered by an ARM M0+ 32-bits 48Mhz SAMD21 running the Smart Citizen Firmware, combining the low power consumption of the ARM M0 family with the power of a 32-bits processor with 32KB of RAM and 256KB of FLASH memory. This solution offers enough program storage and memory space to support multiple auxiliary sensors. This chip is used by the Arduino Zero and MKR boards, therefore benefiting from the open community built around these boards in particular and the Arduino project in general.</p> <p></p> <p>Check the source code</p> <p>The data board also includes a Wi-Fi module, a micro SD card slot, an internal Flash and a battery management solution. In addition, it includes 4MB of extra Flash Memory for offline data storage, in case of network brownouts. The Wi-Fi Module is the well-known Espressif ESP8266 IEEE 802.11 b/g/n Wi-Fi with 4MB Internal Flash for web content storage:</p> <p></p> <p>The Data Board connects to the sensor board providing power, analog and digital communications (12 bits ADC, GPIO, I2C, I2S, VCC). The data board also includes a Seeed Studio standard Grove connector where off-the-shelf modules from the same manufacturer can be connected. The connector supports an independent I2C bus by default, but by software it can be configured to support other uses (GPIO, I2C and UART). It can supply power up to 750mA, and it can be enabled or disabled by software to save power.</p> <p>The board includes a power unit, with a battery management system, capable of handling a variety of Lithium polymer cells. The batteries are connected to a standard JST-2 pin battery connector. The Smart Citizen Kit by default uses a 2000mAh battery, but larger capacities can be used. Under normal conditions, and depending on the sensors enabled, a 2000mAh battery can last between 24 hours (with all sensors enabled, and a 1-minute recording frequency) to more than a week. The board also features a sleep mode, through which drastically lower average consumption are achieved.</p> <p>The controller allows the batteries to be easily charged using the boards micro USB connector using any standard USB power adapter like the ones used on Smartphones. On remote areas, it can also be powered using a selection of PV Panels like Voltaics Systems 6W panel.</p>"},{"location":"Components/boards/Data%20Board/#firmware","title":"Firmware","text":"<p>The Smart Citizen Kit firmware is comprised of two parts: 1) the primary processing tasks are done by the SAMD21 microcontroller firmware; 2) the tasks related to network communication are run through the ESP8266. The SAMD21 is built on top of the Arduino Zero with a custom variant for the Data Board main MCU. The ESP8266 is also built using the Arduino ESP Core. Both firmwares are built and managed with Platform IO, an open-source IDE for embedded development. Platform IO features built-in dependency management and allows you to compile and upload both processors with a single command. Using the SWD ARM connector you can change the MCU bootloader and debug the firmware using Open Source tools.</p> <p>Info</p> <p>Learn more about the software running inside the Data Board on the Firmware section. </p> <p>Software guides</p> <p>Check the firmware guides and learn how to update and even modify the software:</p> <ul> <li>Edit the Firmware</li> <li>Update the Firmware</li> <li>Debug the Firmware (advanced)</li> </ul>"},{"location":"Components/boards/Data%20Board/#buses","title":"Buses","text":""},{"location":"Components/boards/Data%20Board/#sensor-boards-connector","title":"Sensor Boards connector","text":"<p>The Kit features a modular architecture where sensors can be updated independently by replacing any individual Sensor Board. The Sensor Boards features GPIO, ADC, I2C, UART and I2S connections at 3.3V. Currently, we only offer the Urban Sensor Board, but more boards are on the way, and you can even design and build a custom one.</p> <p>Example of a Sensor Board</p> <p>This is the V2.0 Urban Board example. </p> <p>Here there is a pinout of the data board connector:</p> <p></p>"},{"location":"Components/boards/Data%20Board/#auxiliary-connector","title":"Auxiliary connector","text":"<p>The Data Board features and independent configurable auxiliary bus at 3.3V with a SEEED Studio Grove connector. The Bus has native support for I2C, but it can also be setup on firmware as a GPIO or UART port. It can supply power up to 750mA, and it can be enabled or disabled by software.</p> <p>Example of devices connected via the AUX connector.</p> <p></p>"},{"location":"Components/boards/Data%20Board/#power-management","title":"Power management","text":"<p>The Smart Smart Citizen Kit gives us the possibility of running directly from a USB power source with or without lithium battery, using the BQ24259 USB Charger. The charger manages external power regulation, battery fast charging (up to 2Ah) and USB OTG that allow us powering other devices from the SCK (currently not implemented).</p> <p>Normaly the SCK uses a 2000 mAh Lithium polymer battery but it is possible to take advantage of larger batteries. The charging current is regulated with a manual imposed limit that can be configured, and also auto adjusts to the connected USB charger capacity. It is also possible to use solar panel (5v) to charge the SCK.</p> <p>The power consumption of the kit depends on which sensors are enabled and how often they are read/published. Between readings the kit goes to sleep mode turning off almost all the subsystems and reducing the power consumption.</p> <p>In previous versions of the kit (V2.0 and before), the most power-hungry sensors were the SGX MICS gas sensors (NO2 and CO) which need an always-on heater with a permanent consumption of around 50 mAh (35 hours per charge). In V2.0 and V2.1, the PM sensor needs a fan with a consumption of 35 mAh (50 hours per charge). To improve the power consumption, the PM Sensor works on one-shot mode which turns the sensor off for \u00beths of the time, and only taking a reading after the sensor has stabilised.</p> <p>The kit normal operation cycle on battery is: read sensors, post, and then go to sleep. Until the battery charge is below 3%. When that threshold is passed it will enter an emergency sleep mode and interrupt all the normal functions until the charge goes over 5%.</p>"},{"location":"Components/boards/Data%20Board/#power-consumption","title":"Power consumption","text":"<p>The base power consumption of the device is 16mA (no sensors or wifi connection). While posting data online, the consumption can go up to 75mA accounting for the ESP8266, with an additional 90mA if all the sensors are to be working at the same time (Urban Sensor Board + PM sensor).</p>"},{"location":"Components/boards/Data%20Board/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Components/boards/Gases%20Pro%20Board/","title":"Gases Pro Sensor Board","text":"<p>Deprecated</p> <p>The Gases Pro Sensor Board is the development board used during the iSCAPE Project. For reading electrochemical sensors, please refer to the Analog Sensor Board section.</p> <p>The Gases Sensor Board is a custom, ultra-low noise, high-performance, low power, digital output driver for 3 Alphasense Ltd. Electrochemical Series B Gas Sensors specifically designed for the project from the ground up.</p> <p></p> <p>Check the source code</p>"},{"location":"Components/boards/Gases%20Pro%20Board/#sensor-measurements","title":"Sensor measurements","text":"<p>The Gases Pro Board is capable of interfacing with Alphasense Ltd. B4 series sensors without offset voltage compensarion, i.e. it can't interface with NO, NO2 or OX sensors, but it can be used for CO, SO2 and H2S. For measuring NO, NO2 or OX, please refer to the Analog Sensor Board</p>"},{"location":"Components/boards/Gases%20Pro%20Board/#design","title":"Design","text":"<p>Each of the three drivers for Alphasense Ltd. Series B Sensors is built around the same design. They include a three stage adjustable amplifier design for the working electrode and and another simetrical design for the auxiliary electrode. Both signals are then feed to a high accuracy delta-sigma A/D converter with differential inputs 18 bits of resolution. All the parameters are digitally adjustable via I2C from the Data Board. Each board also include a unique identifier chip allowing the firmware on the Data Board to identify the board and apply the corresponding calibration values and a humidity and temperature sensor. </p> <p></p>"},{"location":"Components/boards/Gases%20Pro%20Board/#setup","title":"Setup","text":"<p>The board is connected to the Data Board using the AUX connector. Before, the Alphasense sensors need to be in place and properly registered using the board id. The board will be autodetected by the main Firmware running on the Data Board. Multiple sensor board can be daisy-chained as seen on the image.</p> <p></p>"},{"location":"Components/boards/Gases%20Pro%20Board/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Components/boards/PM%20Board/","title":"PM Board","text":"<p>The PM Board is an expansion board which can provide additional measurements, such as two extra Plantower PMS 5003, one wire temperature sensors and extra GPIO and ADC support. This is done with a custom designed PCB with an MCU to provide I2C connectivity with the Data Board.</p> <p></p> <p>Check the source code</p>"},{"location":"Components/boards/PM%20Board/#design","title":"Design","text":"<p>The PM Board runs a dedicated ARM M0+ 32-bits, the same as the Data Board to provide a unified hardware architecture. The board includes an higly efficient step up to provide 5V to drive the PM sensors and a disable/enable circuit to turn off the sensor by software.</p> <p>Info</p> <p>Visit the source files section to download the complete schematics.</p>"},{"location":"Components/boards/PM%20Board/#pinout","title":"Pinout","text":""},{"location":"Components/boards/PM%20Board/#sercom-distribution","title":"SERCOM distribution","text":""},{"location":"Components/boards/PM%20Board/#setup","title":"Setup","text":"<p>The board is connected to the Data Board using the AUX connector. Before, the Plantower PMS sensors need to be connected. The board will autodetect the PMS sensors and present them seamlessly to the main Firmware  running on the Data Board. Multiple sensor board can be daisy-chained as seen on the image.</p> <p></p>"},{"location":"Components/boards/PM%20Board/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Components/boards/Power%20Supply/","title":"Smart Citizen Power Supply","text":"<p>The Smart Citizen Power Supply is a simple power supply to power the SCK and the Smart Citizen Station with 110-230 AC mains power, including a 1.6A input fuse protection and a 5VDC regulated output.</p> <p></p> <p>The power supply can be one of two options:</p> <ul> <li>MeanWell-IRM-10-5 (datasheet in References folder and here)</li> <li>TracoPower-TMPS-10105 (datasheet in References folder and here)</li> </ul> <p>Check the datasheets for other available input convertions and limits.</p> <p>Tips</p> <p>Have a look at the guides for more detailed information on how to operate the power supply.</p>"},{"location":"Components/boards/Power%20Supply/#enclosure","title":"Enclosure","text":"<p>The PCB has the footprint to fit inside a Bopla Ref. 38102200 IP65 Enclosure with two built-in cable glands. </p> <p>A Bopla Polymas PK 102-211 enclosure is used. The models can be found in the manufacturer's site in STP format.</p> <p>Check the source</p>"},{"location":"Components/boards/Urban%20Board/","title":"Urban Sensor Board","text":""},{"location":"Components/boards/Urban%20Board/#what-is-it","title":"What is it?","text":"<p>The Urban Sensor Board is a solution that contains a selection of low-cost sensors for environmental monitoring. Its main purpose is to serve as a tool for citizen science and awareness activities, and for that reason, metrics such as temperature, pressure, and humidity, as well as noise levels, ambient light, air quality indicators and PM sensors are included. The Urban Sensor Board has undergone several modifications throughout its development, and its current version is V2.1:</p> <p></p> <p>An iteration with a different set of sensors was developed as part of the iScape Project and is shown in the image below:</p> <p></p> <p>Check the source code</p> <p>A major effort has been carried out on this design to improve the accuracy of the data provided. The sensors on the board include: Air Temperature, Relative Humidity, Noise Levels and Spectrum, Ambient Light and Barometric Pressure. The board also features a section especially focused on Air Quality including a Particle Matter Sensor, and, in version V2.1, an eCO2 and TVOC sensor. Previously, in version V2.0, a Carbon Monoxide and a Nitrogen Dioxide sensors was included, but due to the high power consumption and the need of important calibration efforts, these were removed. The sensor density of the board design offers more than ten different environmental metrics at a very low cost and differentiates the design from other existing solutions. The following sections describe in detail each of the sensors available.</p> <p>Board assembly</p> <p>The Urban Sensor Board connect to the Data Board connector named Sensor Board</p> <p></p> <p>V2.1 Sensors</p> Measurement Units Sensor Air Temperature \u00baC Sensirion SHT-31 Relative Humidity % REL Sensirion SHT-31 Noise Level and Spectrum dBA, dBC, dBZ Invensense ICS-43432 Ambient Light Lux Rohm BH1721FVC Barometric pressure and AMSL Pa and Meters NXP MPL3115A2 eCO2 and TVOC ppm/ppb AMS CCS811 Particulate Matter PM1/PM2.5/PM10 \u00b5g/m3 PMS 5003 <p>V2.0 Sensors</p> Measurement Units Sensor Air Temperature \u00baC Sensirion SHT-31 Relative Humidity % REL Sensirion SHT-31 Noise Level and Spectrum dBA, dBC, dBZ Invensense ICS-43432 Ambient Light Lux Rohm BH1721FVC Barometric pressure and AMSL Pa and Meters NXP MPL3115A2 Carbon Monoxide ppm (Periodic Baseline Calibration Required) SGX MICS-4514 Nitrogen Dioxide ppb (Periodic Baseline Calibration Required) SGX MICS-4514 Particulate Matter PM2.5 (external - power req) \u00b5g/m3 PMS 5003 <p>Sensor performance</p> <p>Make sure you visit the sensor performance page for further information about the sensors.</p>"},{"location":"Components/enclosures/Enclosures/","title":"Enclosures","text":"<p>Check the source</p> <p>If we want to leave the kit on the outside for a few days you will need to provide it with extra protection. Below you can see the well-known 3D printed enclosure (for versions without PM sensor):</p> <p></p> <p>A note about the enclosures</p> <p>Previous versions of the Smart Citizen Kit, without the PMS5003 sensor, included a 3D printed enclosure that holds the Data Board and Urban Sensor Board, as well as the lithium batteries. Different versions are available for the SCK 2.1, either with a CNC'ed version, or 3D printed one. Currently, there is no mass produced version at SEEED.</p> <p>See the CNC'ed HDPE version:</p> <p></p> <p>Or the 3D printed one:</p> <p></p> <p>Follow the guides</p> <p>Head over to the guides section for instructions on fabricating each enclosure.</p> <p>Want to contribute?</p> <p>Visit the Smart Citizen Enclosures repository to download, modify, or add your own!</p>"},{"location":"Components/legacy/","title":"Getting Started","text":""},{"location":"Components/legacy/#installing-a-smart-smart-citizen-kit-10-11","title":"Installing a Smart Smart Citizen Kit 1.0 / 1.1","text":"<p>Welcome aboard! The Smart Citizen Team wants to thank you for being here, for purchasing a kit, and for joining the community taking part in this adventure.</p> <p>To join the Smart Citizen family, we're going to walk you through the steps to add your Smart Smart Citizen Kit to the platform, we'll refer to the Smart Smart Citizen Kit as the SCK for now on.</p> <p>SIGN UP</p> <p>First, go to smartcitizen.me using your web browser, currently only Google Chrome is supported for the SCK configuration process. Click in Go to the platform and then Sign up on the upper right menu. Complete the required fields, accept the Terms of use and privacy and click the Sign up button.</p> <p>Required Fields:</p> <ul> <li> <p>Username - Pick any name you want as long as someone else isn't already using the it.</p> </li> <li> <p>Email - Enter your email address.</p> </li> <li> <p>Password - Must be at least 6 characters.</p> </li> </ul> <p>You are now registered, you will receive an email notification. You will be able to complete your user details  later on your profile page.</p> <p>ADD YOUR SMART Smart Citizen Kit</p> <p>On the upper right menu click on Log in and write the access credentials you just choose. Go on your user icon on the upper right corner and click Profile. On your kit's profile page click on Add a new kit.</p> <p>Please, provide basic information about your kit so others can understand better how you set it up and how you plan to use it.</p> <ul> <li> <p>Title - Give your SCK a name. This title will be associated with your SCK data.</p> </li> <li> <p>Exposure - The SCK is designed to work outdoors but maybe you like to test it indoors first. Choose INDOOR or OUTDOOR to help others understand the data you will provide.</p> </li> <li> <p>Kit location - Please, let us locate you, later you can adjust the location by dragging the marker on the map.</p> </li> <li> <p>Kit tags - We suggest you to add tags to help other find your kit. Choose from the available tags or submit a tag request on the Forum.</p> </li> <li> <p>Description - This is an optional field that helps  others understand the data you provide.  Why is it for? Is this part of any kind of project? Information like \"outdoors in my balcony facing the road\" or \"in my garden under a tree\" could help others understand why some of your data looks the way it does.</p> </li> </ul> <p>Click on the Next button, you are close to the end.</p> <p>SETUP YOUR SMART Smart Citizen Kit</p> <p>In order to have your kit connected to the Smart Citizen platform, we need a few step involving the connexion of your kit to your computer. This tool will help you register your kit to the platform, setup your kit's Wi-Fi settings and update its firmware. Currently we support Google Chrome in Win, Mac and Linux.</p> <p>If you are on Windows check first How to install the drivers on Windows? section for more information.</p> <p>Click on the ADD TO CHROME button and wait for the extension to install.</p> <p></p> <p>Finally its time to unpack your SCK. Connect the micro USB cable to your SCK and your computer and turn on the SCK switch on the upper left corner.</p> <p>On the dropdown menu you should select the port your SCK is connected.</p> <p>On Mac and Linux the port will be named Smartcitizen or something like /dev/ttyACM0. On Windows this is likely to be COM3 or higher (COM1 and COM2 are usually reserved for hardware serial ports). To find out, you can disconnect your SCK and check the dropdown; the entry that disappears should be the SCK board. Reconnect the board and select that serial port.</p> <p>If you have any issue check your kit is properly connected, switched ON and you do not have the Arduino IDE or other software that uses the serial port open. We recommend you to switch your kit OFF and ON in order to reset the kit before you start.</p> <p>Now just click Start process in order to start configuring your kit.</p> <p>The configurator will try to determine your hardware and firmware version, if your firmware version is below 0.9.3 you need to update the firmware in order to continue with the process.</p> <p></p> <p>If the configurator can't communicate with your board it will report an Unrecognized board, we recommend you to try a couple of times, disconnecting your kit, reloading the page and connecting it again to make sure that this is not just a serial port communication problem.</p> <p>If the configurator still can't communicate with your kit it may be a firmware/hardware problem. You may try to install the firmware and see if this solves the problem.</p> <p></p> <p>If you can't upload the firmware please refer to the Firmware update problem section or try doing a Manual set up.</p> <p>After firmware is installed/updated we can continue with Wi-Fi settings.</p> <p></p> <p>You can add up to 5 different Wi-Fi credentials in your kit. This will allow your kit to connect to multiple networks in case one fails or you will like to move in between to places</p> <p>You should complete the fields with your router or access point information:</p> <p>At home you should find all the requested information below your home fiber or DSL router on schools and companies you can contact your IT team</p> <ul> <li> <p>SSID - This is your Wifi network's name, for example: My Home Wifi.</p> </li> <li> <p>Phrase - This is your Wi-Fi password, you will usually find it written under your router or you can contact your IT team. If your Wi-Fi doesn't have a password just leave it empty and select Open Wi-Fi network on the Encryption dropdown.</p> </li> </ul> <p>Take care the SSID and Phrase can't be longer than 19 characters and they can't contain the <code>$</code> symbol.</p> <ul> <li> <p>Encryption -  Optional  You can leave it to WPA2 this is the default for most modern networks.</p> </li> <li> <p>External Antenna - Optional Is your SCK quite far away from Wi-Fi access point? You can use an external antenna with your SCK. Check the How to use an external antenna? )</p> </li> </ul> <p>Next step is optional, you can set your SCK update interval to optimize the battery performance and sensor resolution ratio.</p> <p></p> <p>By default your SCK will take a reading every minute and post it on-line</p> <ul> <li> <p>Reading interval - This defines every how much time your SCK sensors will take a reading and record it. You can set it from 1 minute to an hour.</p> </li> <li> <p>Number posts - This defines every how much sensor readings your SCK will publish the reading on-line. You can set it from 1 to 20.</p> </li> </ul> <p>Now is time to record the settings on your SCK, just click on Sync Settings and wait for a moment.</p> <p>If there is any issue during the process this will be displayed on the **Message window* above. I f you need help please contact support@smartcitizen.me *</p> <p>Last but now least you will see your SCK Mac Address registered below this is the ID of your SCK. Just click on Save and wait for your kit to publish. Done!</p> <p>You might need to wait up to 2 minutes or more if you changed the time update settings and refresh your browser in order to see your SCK first post in your device page.</p> <p>Did you registered your SCK before or did your SCK belong to someone else before? Take care your SCK can be registered once at a time, in case you registered before check How to unlink your SCK? or contact support@smartcitizen.me .</p> <p>Please, if your kit is not publishing properly contact support@smartcitizen.me or ask for help in the forum .</p>"},{"location":"Components/legacy/#manual-set-up-the-serial-way","title":"Manual set up: The Serial Way","text":"<p>In this tutorial aimed to advanced users you will configure your SCK using serial communication. By using serial communication, you will register your Wi-Fi settings into the SCK and save the SCK\u2019s MAC address in our server.</p> <p>The SCK, like most Arduino chips, has the ability to communicate through serial protocol (when plugged with a proper USB cable). The SCK uses the WiFly module to communicate with your Wi-Fi router. Anyway, through serial communication you will be able to send the commands directly with this module to set your Wi-Fi settings and extract the MAC address used by our server to verify your identity.</p> <p>Note that this tutorial works for both SCK v1.0 (from the Goteo crowdfunding campaign) and SCK v1.1 (from the KickStarter crowdfunding campaign), independently of the firmware version used.</p>"},{"location":"Components/legacy/#configuring-the-wi-fi-settings","title":"Configuring the Wi-Fi settings","text":"<ul> <li>Open Arduino IDE.</li> <li>Connect your SCK via USB.</li> <li>From the Tools &gt; Board menu, choose the right USB port (generally the last one).</li> <li>From the Tools &gt; Serial port menu, select the right board. This is Leonardo for SCK v1.0 (Goteo) or LilyPad Arduino USB for SCK v1.1 (Kickstarter).</li> <li>Open the serial monitor window in the Arduino IDE (button at the top-right of the main window).</li> <li>Set the options to \"115200 baud\" and \u201cNo line return\u201d (drop-down menu at the bottom-right of the monitor window).</li> <li>Wake up the module and activate the Wi-Fi command mode by typing in the serial monitor:</li> </ul> <p><code>$$$</code></p> <ul> <li> <p>Change to \u201cCarriage return\u201d option (drop-down menu at the bottom-right of the monitor window)</p> </li> <li> <p>Add a new SSID to memory by typing:</p> </li> </ul> <p><code>set wlan ssid XXX</code></p> <p>Note: You have to replace XXX with your ssid name, filling any space with the dollar ($) character. Due to hardware limitations it can't be longer than 32 characters.</p> <ul> <li>Add a new phrase to memory (optional, password for WPA1 &amp; WPA2):</li> </ul> <p><code>set wlan phrase XXX</code></p> <p>Note: You have to replace XXX with your phrase, filling any space with the dollar ($) character.</p> <ul> <li>Add a new key to memory  (optional, password for WEP &amp; WEP64):</li> </ul> <p><code>set wlan key XXX</code></p> <ul> <li>Add an authentication method into memory (replace XXX by \u201c0\u201d for Open,  \u201c1\u201d for WEP, \u201c2\u201d for WPA1, \u201c4\u201d for WPA2, \u201c8\u201d for WEP64):</li> </ul> <p><code>set wlan auth XXX</code></p> <ul> <li>Add an antenna type into memory (replace XXX by \u201c0\u201d to use the internal antenna or \u201c1\u201d if you use an external antenna):</li> </ul> <p><code>set wlan ext_antenna XXX</code></p> <ul> <li>Get the MAC address of the kit by typing:</li> </ul> <p><code>get mac</code></p> <ul> <li> <p>Copy/Save the answer for further use.</p> </li> <li> <p>Exit and go back to the normal operational mode by typing:</p> </li> </ul> <p><code>exit</code></p>"},{"location":"Components/legacy/#registering-the-kit-in-the-platform","title":"Registering the kit in the platform","text":"<p>After you've uploaded your settings, don't forget to register your kit in our database by saving it's mac address. To find the mac address, you can use the serial command \"get mac\". Or have a look at the wifi module on the board and read the serial number under the bar code (something like \"131G0006662116E4\" on kit v1.0 or \"0006662116E4\" on kit v.1.1).</p> <p></p> <p>The mac address is the last 12 digit of this serial, separated by a colon every two number. From a number like <code>0006662116E4</code> you would write <code>00:06:66:21:16:E4</code>.</p> <p>In both cases, you have to fill the mac address input field in the configuration page of your kit and press the save button.</p> <p></p> <p>You are now done with the manual configuration of your SCK. Wait for a few minutes to see your data coming on the server and being displayed on the web page. You can also check that everything is ok by looking at the Arduino serial monitor. Debug messages coming from your SCK should look like this:</p> <p>If you want to explore further options with the WiFly module check The SCK Command Line section.</p> <p>If you encounter any issue, please share your problem on the forum</p>"},{"location":"Components/legacy/#manual-set-up-the-compilation-way","title":"Manual set up: The Compilation Way","text":"<p>This tutorial is aimed to advanced users, we will guide you through the process of setting up your kit by editing directly the source code. As the code is Open Source, one way of setting the Wi-Fi of your SCK is to download the latest firmware, edit some lines of code, recompile it and upload it to the kit.</p> <p>One advantage of this method is that it gives you the opportunity to register multiple Wi-Fi networks at the same time and make the persistent. The Wi-fi networks that you register directly in the source code are called hardcoded and the only way to remove them is with the same process of compiling and uploading the firmware again. This is useful if your SCK is traveling from one location to another where the Wi-Fi credentials are known.</p> <p>The downside of this method is that you can not extract the MAC address of your kit, if you don't know it yet you will have to use the method described in The Serial Way or via the configurator in the setup page of your kit.</p>"},{"location":"Components/legacy/#getting-the-firmware","title":"Getting the Firmware","text":"<p>You can download the latest firmware on our Github:</p> <p>https://github.com/fablabbcn/Smart-Citizen-Kit/releases</p> <p>As you may know, the hardware and software are based on the Arduino project. We will use the Arduino IDE to edit the firmware and upload it to the kit. This tutorial have been tested with Arduino 1.6.8, please download and install the Arduino IDE.</p> <p>Once installed open the file <code>Smart-Citizen-Kit/sck_beta_v0_9_0/sck_beta_v0_9.ino</code></p>"},{"location":"Components/legacy/#editing-the-code","title":"Editing the code","text":"<p>If you want to set the network configuration manually, you should go to the <code>Constants.h</code> tab and modify the lines you see below:</p> <pre><code>#define networks 0\n#if (networks &gt; 0)\nstatic char* mySSID[networks]      = {\n  \"SSID1\"      , \"SSID2\"            };\nstatic char* myPassword[networks]  = {\n  \"PASS1\"      , \"PASS2\"            };\nstatic char* wifiEncript[networks] = {\n  WPA2         , WPA2               };\nstatic char* antennaExt[networks]  = {\n  INT_ANT      , INT_ANT            };\n#endif\n</code></pre> <p>The easiest way would be to write <code>\"#define networks X\"</code> (where X is the number of WI-FI networks you are going to use) and fill the options for your network:</p> <ul> <li>Add the name of your network in <code>SSIDX</code> and the corresponding password in <code>PASSX</code>. Due to hardware limitations neither the password or the ssid can't be longer tham 32 characters.</li> <li>On <code>wifiEncript</code> you could also choose the encryption mode that fits with your network's configuration (<code>OPEN</code>, <code>WEP</code>, <code>WPA1</code>, <code>WPA2</code>, <code>WEP64</code>).</li> <li>On <code>antennaExt</code> you can choose the type of antenna you are using (<code>INT_ANT</code> for internal antenna (default) or <code>EXT_ANT</code> for external antenna).</li> </ul> <p>If you register only one wifi credential, you should obtain something like this:</p> <pre><code>#define networks 1\n#if (networks &gt; 0)\nchar* mySSID[networks]      = { \"MyWifiSSID\" };\nchar* myPassword[networks]  = { \"MyPassword\" };\nchar* wifiEncript[networks] = { WPA2 };\nchar* antennaExt[networks]  = { INT_ANT };\n#endif\n</code></pre> <p>Note that if you configure more than one Wi-fi network you have to separate the variables with a comma, for example:</p> <pre><code>char* mySSID[networks] = { \"MyFirstSSID\", \"MySecondSSID\" };\n</code></pre>"},{"location":"Components/legacy/#uploading-the-code","title":"Uploading the code","text":"<p>On the Arduino IDE Tools menu you should select the right Board in the Boards menu:</p> <ul> <li> <p>For SmartSmart Citizen Kit version 1.0 select Arduino Leonardo (ATmega 32U4 at 16Mhz)</p> </li> <li> <p>For SmartSmart Citizen Kit version 1.1 select Arduino LilyPad USB (ATmega 32U4 at 8Mhz)</p> </li> </ul> <p>The Arduino IDE should automatically select the right USB port but you can check it in the Tools &gt;&gt; Port menu.</p> <p></p> <p>Now you just need to click the Upload  button and Arduino will do the rest for you!</p> <p>In case you have any issue please check the Arduino Troubleshooting guide.</p>"},{"location":"Components/legacy/#registering-the-kit-in-the-platform_1","title":"Registering the kit in the platform","text":"<p>After you\u2019ve uploaded your settings, don\u2019t forget to register your kit in our database by saving it\u2019s mac address. To find the mac address, you can use the serial command \u201cget mac\u201d  by following the section The Serial Way. Or have a look at the wifi module on the board and read the serial number under the bar code (something like \u201c131G0006662116E4\u201d on kit v1.0 or \u201c0006662116E4\u201d on kit v.1.1).</p> <p></p> <p>The mac address is the last 12 digit of this serial, separated by a colon every two number. From a number like <code>0006662116E4</code> you would write <code>00:06:66:21:16:E4</code>.</p> <p>In both cases, you have to fill the mac address input field in the configuration page of your kit and press the save button.</p> <p></p> <p>You are now done with the manual configuration of your SCK. Wait for a few minutes to see your data coming on the server and being displayed on the web page. You can also check that everything is ok by looking the output of your kit via the Arduino serial monitor.</p> <p>If you encounter any issue, please share your problem on the forum</p>"},{"location":"Components/legacy/#attaching-the-solar-panel","title":"Attaching the solar panel","text":"<p>The solar panel should fulfill the specification of a voltage bigger than 8v and less than 15v, 12v is the recommended voltage, and a minimum of 500mA.</p> <p>In order to attach the solar panel you have to solder the cables of the solar panel to the pads marked in the next image for version 1.0 of the SCK. For version 1.1 you have to connect the cables to the connector marked in the next image.</p> <p>In both versions, yo have to attach the plus of solar panel to the plus pad of the SCK, and the minus of the solar panel to the minus pad of the SCK.</p> <p> </p>"},{"location":"Components/legacy/Command%20Line/","title":"SCK Command Line","text":"<p>The Smart Smart Citizen Kit can be managed over a basic serial protocol. You just need the Arduino IDE Serial Monitor or any other Serial Utility like Screen in order to use it.</p> <p>How to use it</p> <ul> <li>Connect to your kit using any serial utility, any baud-rate should work but 115200 is recommendable.</li> <li>Send the starting commands.</li> <li>Notice all the commands except the starting command($$$) require a carriage return at the end: CR or \\r. If you are using the Arduino IDE is enough if you change to \u201cCarriage return\u201d option (drop-down menu at the bottom-right of the monitor window).</li> <li>Call any command you want, change XXX with the corresponding value, filling any space with the dollar ($) character.</li> </ul>"},{"location":"Components/legacy/Command%20Line/#sck-wifly-commands","title":"SCK Wifly commands","text":"<ul> <li><code>$$$</code> (Wake up the module and activate the Wi-Fi)</li> <li><code>set wlan ssid XXX</code> (Add a new SSID to memory9)</li> <li><code>set wlan phrase XXX</code> (Add a new phrase to memory)</li> <li><code>set wlan key XXX</code> (Add a new key to memory)</li> <li><code>set wlan auth XXX</code> (Add an authentication method into memory)</li> <li><code>set wlan ext_antenna XXX</code> (Add an antenna type into memory)</li> <li><code>exit</code> (Go back to normal operational mode)</li> </ul> <p>If you want to know more about wifly commands look at the WiFly Command Reference</p>"},{"location":"Components/legacy/Command%20Line/#sck-commands","title":"SCK commands","text":"<ul> <li><code>###</code> (Wake up the module and enter SCK commands mode)</li> <li><code>get mac</code> (Get the MAC address of the kit)</li> <li><code>get time update</code> (Retrieve the sensor update interval)</li> <li><code>set time update XXX</code> (Update the sensor update interval, 10-3600 sec)</li> <li><code>get number updates</code> (Retrieve the max number of bulk updates)</li> <li><code>set number updates XXX</code> (Update the max number of bulk updates, 1-20 updates)</li> <li><code>get apikey</code> (Retrieve the kit APIKEY)</li> <li><code>set apikey XXX</code> (Update the kit APIKEY)</li> <li><code>get wlan ssid</code> (Retrieve the SSID saved on the kit)</li> <li><code>get wlan phrase</code> (Retrieve the phrase and KEY saved on the kit)</li> <li><code>get wlan auth</code> (Retrieve the authentication method saved on the kit)</li> <li><code>get wlan ext_antenna</code> (Retrieve the antenna type saved on the kit)</li> <li><code>clear nets</code> (Remove all saved Wi-Fi configuration information)</li> <li><code>clear memory</code> (Reset to defaults all configuration information)</li> <li><code>get all</code> (Retrieve all settings saved on the kit in a single line: |version|MAC|ssid,phrase,auth,ext_antenna|hardcodedNets|timeUpdate|numUpdate|)</li> <li><code>data</code> (Retrieves sensor readings stored in memory)</li> <li><code>exit</code> (Goes back to normal operational mode)</li> </ul>"},{"location":"Components/legacy/Faq/","title":"FAQ","text":""},{"location":"Components/legacy/Faq/#how-do-i-register-again-my-sck","title":"How do I register again my SCK?","text":"<p>It is really important to understand a SCK can be just registered one time to one device in the platform.</p> <p>Imagine how confusing it will be a single physical device publishing as two separate kits on the platform in two different locations!</p> <p>That's why you will need to unlink your SCK before you can register it again as another kit or when you would like to give your device to someone else to use it.</p> <p></p> <p>Go to your Kits profile page select the kit you will like to unlink and go to Setup. You don't need to connect your SCK, just scroll down, remove the Mad Address number from the field and click Save.</p> <p>This way your kit will keep all the data on the platform but you will be able to register your SCK again as another kit. You can alway register again your SCK on the same device by following the standard setup process.</p>"},{"location":"Components/legacy/Faq/#is-my-home-wireless-internet-going-to-work-with-the-sck","title":"Is my home wireless internet going to work with the SCK?","text":"<p>The Smart Smart Citizen Kit is designed to work with most home and office standard Wi-Fi routers and access points. However we do not support network names or passwords longer than 19 characters or with a <code>$</code> character.</p> <p>We also do not support WPA Enterprise networks or Captive portal log in as the ones on some big companies and airports. We suggest you contact your IT support team, they can enable you special access in the network based on your device Mac Address.</p>"},{"location":"Components/legacy/Faq/#how-to-use-the-sd-card","title":"How to use the SD Card?","text":"<ol> <li> <p>microSD: We recommend formatting micro SD cards using the official SD tool you can download here.</p> </li> <li> <p>RTC: Place a CR1220 cell battery on your kit. Before uploading the SD firmware use the on-line configuration tool at smartcitizen.me to set your Wi-Fi credentials. Turn your kit off and on for a minute, the blue led's will blink and your kit will connect to the internet and sync its the internal clock with our remote servers. Once the time is set the cell battery will keep SCK time in sync for more than 4 years.</p> </li> <li> <p>You can now install the SD firmware using the Arduino IDE.</p> </li> </ol> <p>Dependencies:</p> <ul> <li> <p>In order to compile and upload the firmware you will need to install the SdFat library for Arduino.</p> </li> <li> <p>Download the library here and install the library following the instructions.</p> </li> </ul> <p>Boards:</p> <ul> <li> <p>For SmartSmart Citizen Kit version 1.0 select <code>Tools/Boards/Arduino Leonardo</code> on the Arduino IDE (ATmega 32U4 at 16Mhz)</p> </li> <li> <p>For SmartSmart Citizen Kit version 1.1 select <code>Tools/Boards/Lylipad Arduino USB</code> on the Arduino IDE (ATmega 32U4 at 8Mhz)</p> </li> </ul> <p>SD data format</p> <p>When using the SD firmware on the SCK, data is stored as CSV (comma separated) file on the SD card.</p> <p>This is an example of the output file once opened on a spreadsheet application:</p> Temperature Humidity Light Battery Solar Panel CO NO2 Noise UTC 2821.20 4072.00 4413.10 96.40 0.00 94.67 0.65 5.23 2000-01-01 00:00:02 2784.40 4236.80 5936.70 96.10 0.00 278.27 1.05 2.39 2000-01-01 00:00:02 <p>Data Conversions</p> <p>The data stored is automatically converted to the proper units in firmware.</p> <p>If you prefer to do the conversions manually set <code>DataRaw       false</code> in the <code>Constants.h</code> file and apply the formulas on the following table:</p> ID Sensor Units Conversion Formula 0 Temperature \u00baC T = -53 + 175.72 / 65536.0 * ( Traw * 10 ) 1 Humidity %Rel H = 7 + 125.0 / 65536.0 * ( Hraw * 10 ) 2 Light Lux L = Lraw / 10 3 Battery % Not required 4 Panel mV Not required 5 CO kOhm Not required 6 NO2 kOhm Not required 7 Noise dB Apply the conversion table from mV to dB: CSV 8 Date DD:MM:YY Not required 9 Time hhss Not required"},{"location":"Components/legacy/Faq/#how-to-import-the-sd-card-data","title":"How to import the SD card data?","text":"<p>Sorry, this is temporary disabled! We are working on a new release.</p> <p>You can import the recorded data in to smartcitizen.me</p> <p>In your device page you will find the Import SD along with the Edit and Configure options.</p> <p>Using a microSD card reader get the post.csv file from your card, select it and click import. Data will be imported in to your device, data existing on the file already imported will be skipped. Your kit should be running the latest SD firmware  and the SCK time (RTC) should be set in order data can be imported.</p>"},{"location":"Components/legacy/Faq/#is-my-kit-publishing-data-properly","title":"Is my kit publishing data properly?","text":"<p>Sorry, this is temporary disabled! We are working on a new release.</p> <p>You can easily check each time your kit is publishing data to our platform in real time by enabling the debug mode on your device.</p> <ul> <li>Go to your device edit page in smartcitizen.me, set Debug Enabled and save it.</li> <li>Visit data.smartcitizen.me/debug you will see the data from all the devices on debug mode every time they publish in real time. You can identify your device by the device id. **Note data comes uncalibrated.*</li> </ul> <p></p>"},{"location":"Components/legacy/Faq/#how-to-retrieve-other-kits-data","title":"How to retrieve other kit's data?","text":"<p>Current API allows you full access to all the Smart Citizen Platform. Please, ask in the forum or contact support@smartcitizen.me for any questions regarding the API.</p>"},{"location":"Components/legacy/Faq/#how-to-store-data-in-your-own-database","title":"How to store data in your own database?","text":"<p>Kit's request</p> <p>The Smart Smart Citizen Kit is publishing by default the data as a PUT Http request, the sensor data is encoded as JSON.</p> <p>Here you can see how a kit's request will look like (Note the request is not standard as it do not contains a payload):</p> <pre><code>PUT /add HTTP/1.1\nHost: data.smartcitizen.me\nUser-Agent: SmartCitizen\nX-SmartCitizenMacADDR: 00:00:00:00:00:00\nX-SmartCitizenVersion: 1.1-0.8.5-A\nX-SmartCitizenData: [{\"temp\":\"29090.6\", \"hum\":\"6815.74\", \"light\":\"30000\", \"bat\":\"786\", \"panel\":\"0\", \"co\":\"112500\", \"no2\":\"200000\", \"noise\":\"2\", \"nets\":\"10\", \"timestamp\":\"2013-10-28 1:34:26\"}]\n</code></pre> <p>Here you have a kit's request as a  Curl for test purposes:</p> <pre><code>$ curl -X PUT -H 'Host: data.smartcitizen.me' -H 'User-Agent: SmartCitizen' -H 'X-SmartCitizenMacADDR: 00:00:00:00:00:00' -H 'X-SmartCitizenVersion: 1.1-0.8.5-A' -H 'X-SmartCitizenData: [{\"temp\":\"29090.6\", \"hum\":\"6815.74\", \"light\":\"30000\", \"bat\":\"786\", \"panel\":\"0\", \"co\":\"112500\", \"no2\":\"200000\", \"noise\":\"2\", \"nets\":\"10\", \"timestamp\":\"2013-10-28 1:34:26\"}]' data.smartcitizen.me/add\n</code></pre> <p>Data processing</p> <p>Values are send without the proper scaling and some sensors as temperature, humidity and noise are sent in raw and then calibrated in our platform. This are the conversion required for SCK 1.1 and above.</p> Key Sensor Units Conversion formula Conversion Method temp Temperature \u00baC T = -53 + 175.72 / 65536.0 * Traw SCKSensorData::tempConversion($rawTemp) hum Humidity %Rel H = 7 + 125.0 / 65536.0 * Hraw SCKSensorData::humConversion($rawHum) light Light Lux L = Lraw / 10 SCKSensorData::lightConversion($rawLight) noise Noise dB Apply the conversion table from mV to dB: CSV SCKSensorData::noiseConversion($rawNoise) co CO kOhm CO = COraw / 10000 SCKSensorData::coConversion($rawCO) no2 NO2 kOhm NO2 = NO2raw / 10000 SCKSensorData::no2Conversion($rawNO2) bat Battery % B = Braw / 10 SCKSensorData::batConversion($rawBat) panel Panel mV P = Praw / 10000 SCKSensorData::panelConversion($rawPanel) nets Nets Wi-Fi Networks Not required Not required timestamp Timestamp YYYY-MM-DD hhss Not required Not required <p>You can use the SCKSensorData php class to re-scale and calibrate the received data. Check it on github.</p> <p>Here is an example how to use it to receive a request, converted and store it in a CSV file:</p> <pre><code>&lt;?php\n    include('../sck_sensor_data.php');\n\n    $headers = getallheaders();\n\n    $data = $headers['X-SmartCitizenData'];\n\n    $datapoints = json_decode($data, true);\n\n    foreach ($datapoints as $datapoint) {\n    $datapoint = SCKSensorData::SCK11Convert($datapoint);\n        $csv .= implode(', ', $datapoint);\n    }\n\n    $csv .= PHP_EOL;\n\n    file_put_contents('./data.csv', $csv, FILE_APPEND);\n?&gt;\n</code></pre> <p>You can find the complete example here.</p> <p>Each sensor is implemented as a separate function and some general methods are available for simplifying the work. Here is an example:</p> <pre><code>&lt;?php\n\n    /**\n     * noiseCalibration\n     *\n     * Noise calibration for SCK1.1 sound sensor. Converts mV in to dBs.\n     * Based on a linear regression from a lookup table (db.json)\n     * obtained after real measurements from our test facility.\n     *\n     *\n     * @param float $rawSound\n     * @return float noise as sound pressure in dB\n     *\n     */\n\n    public function noiseCalibration($rawSound)\n    {\n        $dbTable = json_decode(file_get_contents(\"db.json\"), true);\n        return round(self::tableCalibration($dbTable, $rawSound), 2);\n    }\n?&gt;\n</code></pre> <p>How to proceed</p> <p>Here are the different paths you can take in order to built your own backend:</p> <ul> <li> <p>Create a fork of the the Smart Smart Citizen Kit firmware in order to send the data as your custom backend expect it.</p> </li> <li> <p>Create your own custom backend. We can share all the different modules of our backend in order for you to receive data as on the curl example above, calibrate it and store it. Contact us at support@smartcitizen.me.</p> </li> <li> <p>Keep using our backend but request our API developer.smartcitizen.me and then fill database choosen with it.</p> </li> </ul>"},{"location":"Components/legacy/Faq/#how-to-install-the-drivers-on-windows","title":"How to install the drivers on Windows?","text":"<p>In Windows you will need to install the Arduino Drivers if you haven't done it before.</p>"},{"location":"Components/legacy/Faq/#windows-8-7-vista-and-xp","title":"Windows 8, 7, Vista, and XP","text":"<ul> <li>Go to the Arduino download page and download the latest version of the Arduino software for Windows.</li> <li>When the download is finished, un-zip it and open up the Arduino folder to confirm that yes, there are indeed some files and sub-folders inside. The file structure is important so don\u2019t be moving any files around unless you really know what you\u2019re doing.</li> <li>Power up your Smart Smart Citizen Kit by connecting it to your computer with a USB cable. You should see the green LED near the on/off switch light up.</li> <li>If you\u2019re running Windows 8, you\u2019ll need to disable driver signing, so go see the Windows 8 section. If you\u2019re running Windows 7, Vista, or XP, you\u2019ll need to install some drivers, so head to the Windows 7, Vista, and XP section down below.</li> </ul>"},{"location":"Components/legacy/Faq/#windows-8","title":"Windows 8","text":"<p>Windows 8 comes with a nice little security \u2018feature\u2019 that \u2018protects\u2019 you from unsigned driver installation. The Smart Smart Citizen Kit driver is not signed so you\u2019ll have to tell Windows to disable driver signing. This issue has been addressed in newer releases of the Arduino IDE, but if you run into issues, you can try this fix first.</p> <p>For a nice, step-by-step tutorial with pictures click here, otherwise the steps are outlined below.</p> <p>To temporarily disable driver signing:</p> <ul> <li>From the Metro Start Screen, open Settings (move your mouse to the bottom-right-corner of the screen and wait for the pop-out bar to appear, then click the Gear icon)</li> <li>Click \u2018More PC Settings\u2019</li> <li>Click \u2018General\u2019</li> <li>Scroll down, and click \u2018Restart now\u2019 under \u2018Advanced startup\u2019.</li> <li>Wait a bit.</li> <li>Click \u2018Troubleshoot\u2019.</li> <li>Click \u2018Advanced Options\u2019</li> <li>Click \u2018Windows Startup Settings\u2019</li> <li>Click Restart.</li> <li>When your computer restarts, select \u2018Disable driver signature enforcement\u2018 from the list.</li> </ul> <p>To permanently disable driver signing (recommended, but has some minor security implications):</p> <ul> <li>Go to the metro start screen</li> <li>Type in \u201ccmd\u201d</li> <li>Right click \u201cCommand Prompt\u201d and select \u201cRun as Administrator\u201d from the buttons on the bottom of your screen</li> <li>Type/paste in the following commands: bcdedit -set loadoptions DISABLE_INTEGRITY_CHECKS bcdedit -set TESTSIGNING ON</li> <li>Reboot!</li> </ul>"},{"location":"Components/legacy/Faq/#windows-7-vista-and-xp","title":"Windows 7, Vista, and XP","text":"<p>Installing the Drivers for the Arduino Uno (from Arduino.cc)</p> <ul> <li>Plug in your board and wait for Windows to begin it\u2019s driver installation process</li> <li>After a few moments, the process will fail, despite its best efforts</li> <li>Click on the Start Menu, and open up the Control Panel</li> <li>While in the Control Panel, navigate to System and Security. Next, click on System</li> <li>Once the System window is up, open the Device Manager</li> <li>Look under Ports (COM &amp; LPT). You should see an open port named \u201cArduino UNO (COMxx)\u201d. If there is no COM &amp; LPT section, look under \u2018Other Devices\u2019 for \u2018Unknown Device\u2019</li> </ul> <p></p> <ul> <li>Right click on the \u201cArduino UNO (COMxx)\u201d or \u201cUnknown Device\u201d port and choose the \u201cUpdate Driver Software\u201d option</li> <li>Next, choose the \u201cBrowse my computer for Driver software\u201d option</li> </ul> <p></p> <ul> <li>Finally, navigate to and select the Uno\u2019s driver file, named \u201cArduinoUNO.inf\u201d, located in the \u201cDrivers\u201d folder of the Arduino Software download (not the \u201cFTDI USB Drivers\u201d sub-directory). If you cannot see the .inf file, it is probably just hidden. You can select the \u2018drivers\u2019 folder with the \u2018search sub-folders\u2019 option selected instead.</li> <li>Windows will finish up the driver installation from there</li> </ul> <p>This documentation is proudly based on Sparkfun Arduino on Windows tutorial - CC BY-NC-SA 3.0.</p>"},{"location":"Components/legacy/Faq/#which-lipo-batteries-to-use","title":"Which LiPo batteries to use?","text":"<p>The battery that we are providing is 3.7v and 2000mAh</p>"},{"location":"Components/legacy/Faq/#which-solar-panels-to-use","title":"Which solar panels to use?","text":"<p>The solar panel it should fulfill the specification of a voltage bigger than 8v and less than 15v, 12v is the recommended voltage, and a minimum of 500mA.</p>"},{"location":"Components/legacy/Faq/#how-i-can-extend-the-wi-fi-range","title":"How I can extend the Wi-Fi range?","text":"<p>Is your SCK quite far away from Wi-Fi access point? You can use an external antenna with your SCK.</p> <p>The Wi-Fi modules has a U.FL antenna connector. We recommend you to use a U.FL to RP-SMA adaptor in order to use standard Wi-Fi antennas. You then will need to enable the External Antenna on the Wi-Fi setup process by selecting External Antenna.</p>"},{"location":"Components/legacy/Faq/#what-is-the-spec-battery-type-for-the-button-cell-for-the-rtc","title":"What is the spec (battery type) for the button-cell for the RTC?","text":"<p>The RTC battery is a CR1220</p>"},{"location":"Components/legacy/Faq/#why-is-50db-the-microphone-lowest-value","title":"Why is 50dB the microphone lowest value?","text":"<p>Because the actual sensor is limited by the curve bounding from 50dB to 103dB</p>"},{"location":"Components/legacy/Faq/#browsers-compatibility","title":"Browsers compatibility","text":"<p>The SmartCitizen platform is built using the latest Web technologies (such as HTML5, SVG and CSS3). These languages serve as a foundation for today\u2019s websites and web applications.</p> <p>To enjoy Smart Citizen, we recommend you to use:</p> <p>Google Chrome 25+ Firefox Mozilla 20+</p> <p>For the kit setup process only Google Chrome is supported.</p>"},{"location":"Components/legacy/Faq/#what-are-the-leds-for-and-what-does-the-led-blinking-mean","title":"What are the LEDs for, and what does the LED blinking mean?","text":"<p>There are 5 LEDs, they are all on the base half of the SCK.  They can be understood in three groups:</p> <ul> <li> <p>LED2 and LED1 - These are the two yellow (or orange) LEDs in the lower center-left of the board.  You will only see these lit when your USB cable is connected to the SCK and you are configuring or otherwise interacting with the SCK.  LED2 is the \"RX USB\" and will be lit when the SCK is receiving information via the USB connection. LED1 is the \"TX USB\" and will be lit when the SCK is sending information via the USB connection.</p> </li> <li> <p>LED4 and LED3 - These are the two blue LEDs in the lower center of the board.  You will see these blink often. LED3 is the \"WiFi Association\" and LED4 is the \"WiFi Connection.\" The blue LEDs will blink each time the SCK posts new data wirelessly. This is normal behavior and is expected, but it only happens in bursts (then there will be no blue LED lit for about 30-40 seconds). If your blue LEDs are blinking back and forth non-stop, this means your SCK has lost its WiFi connection. Check to make sure your router is still on, and that you're still in range of it.</p> </li> <li> <p>LED5 - This is the green LED in the upper left corner.  It will be lit when the SCK is turned on and has power.</p> </li> </ul>"},{"location":"Components/legacy/Hardware/","title":"Hardware","text":""},{"location":"Components/legacy/Hardware/#inside-the-sck","title":"Inside the SCK","text":""},{"location":"Components/legacy/Hardware/#main-board","title":"Main Board","text":"<p>The main board contains the basic functionality like sensor I/O to read de sensor values, communication with the platform through the wifi module, manage the power and battery charging.</p> <p> </p>"},{"location":"Components/legacy/Hardware/#pinout","title":"PINOUT","text":"<p>The SCK Main Board connects to the Sensor Board 16 pin connector. This is how the pins are laid out on the board. The numbers in brackets are the actual pin numbers of the micro controller. Pins IO are digital and S are analogue.</p> GND GND IO3 (10) IO2 (9) IO1 (13) IO0 (5) SCL SDA S5  (A1) S4  (A0) S3  (A3) S2  (A2) S1  (A5) S0  (A4) VBAT VBAT"},{"location":"Components/legacy/Hardware/#cpu","title":"CPU","text":"<p>Both versions of the SCK (1.0 and 1.1) are using the same CPU, ATMEGA32U4 (Arduino Leonardo). With the difference that the 1.0 works at 5V and 16MHZ and the 1.1 works at 3.3V and 8MHZ. In the 1.1 version we\u2019ve improved the power consumption.</p> <p>This CPU has native USB and an UART TTL port allowing us to connect directly with the WIFI module.</p> <p>ATMEGA32U4 datasheet</p>"},{"location":"Components/legacy/Hardware/#usb-connector","title":"USB CONNECTOR","text":"<p>The 1.0 version uses a Mini USB connector and 1.1 version uses a Micro USB.</p> <p></p>"},{"location":"Components/legacy/Hardware/#wifi-module","title":"WIFI MODULE","text":"<p>The RN-131 module is a standalone, embedded wireless 802.11 b/g networking module. With its small form factor and extremely low power consumption, the RN-131 fits perfectly for the SCK wireless communication requirements.</p> <p> </p> <p>Main features:</p> <ul> <li>Qualified 2.4-GHz IEEE 802.11b/g transceiver</li> <li>Ultra-low power: 4 uA sleep, 40 mA Rx, 210 mA Tx</li> <li>High throughput, 1 Mbps sustained data rate with TCP/IP and WPA2</li> <li>Small, compact surface-mount module</li> <li>On-board ceramic chip antenna and U.FL connector for external antenna</li> <li>8-Mbit flash memory and 128-KB RAM</li> <li>UART hardware interface</li> <li>10 general-purpose digital I/O pins</li> <li>8 analog sensor interfaces</li> <li>Real-time clock for wakeup and time stamping</li> <li>Accepts 3.3-V regulated or 2 to 3 V battery</li> <li>Supports ad hoc and infrastructure networking modes</li> <li>On board ECOS -OS, TCP/IP stacks</li> <li>Wi-Fi Alliance certified for WPA2-PSK</li> <li>FCC/CE/ICS certified and RoHS compliant.</li> <li>Industrial (RN-131G) and commercial (RN-131C) grade temperature options</li> </ul> <p>WIFLY module - RN-131 datasheet</p>"},{"location":"Components/legacy/Hardware/#battery-powering","title":"BATTERY POWERING","text":"<p>For powering the SCK, in both versions, we are using a 3.7v 2000 mAh li-on battery.</p> <p>SCK version 1.0 uses two different voltages, 3.3V and 5V to power the IC\u2019s. To get 5V from 3.3v we are using a step-up based on NCP1400, thus having a stable voltage at 5v and 100mA. On the other hand, to regulate the voltage and to obtain 3.3v, the SCK uses the IC MAX604.</p> <p> </p> <p>NCP1400 datasheet MAX604 datasheet</p> <p>In 1.1 version, to make things simpler, the voltage of entire SCK was unified to 3.3V. The responsible to regulate the voltage from 3.7v to 3.3v is the MCP1725 IC.</p> <p></p> <p>MCP1725 datasheet</p>"},{"location":"Components/legacy/Hardware/#battery-charging","title":"BATTERY CHARGING","text":"<p>For charging the battery there are two ways, USB or solar panel. To carry out the charging we are using MCP73831 IC.</p> <p>For charging the battery in 1.0 version the solar panel have to be 12v and 500mA. In 1.1 version, the solar panel can be more versatile in terms of amperage.</p> <p> </p> <p>MCP73831 datasheet</p>"},{"location":"Components/legacy/Hardware/#solar-panel-charging","title":"SOLAR PANEL CHARGING","text":"<p>Depending on the sunlight conditions the solar panel produces up to 12v, we have to reduce the voltage to 5v to feed up the Vin of the MCP73831 charger IC.</p> <p>To carry out this task we are using the LM2674 IC, a very efficient IC, with a rate of 91% of performance.</p> <p> </p> <p>LM2674 datasheet</p>"},{"location":"Components/legacy/Hardware/#rtc-real-time-clock","title":"RTC (REAL TIME CLOCK)","text":"<p>The SCK has a real time clock for keeping track of time when the kit is offline. For this task we chose the DS1307 IC for the 1.0 version and the DS1339Y-3+ IC for the 1.1 version. Different IC due to the different voltages, 5V for the 1.0 version and 3.3V for the 1.1 version.</p> <p> </p> <p>DS1307 datasheet DS1339Y-3+ datasheet</p>"},{"location":"Components/legacy/Hardware/#sd-card-reader","title":"SD CARD READER","text":"<p>The SD card is used to store the data captured by the sensors when the kit is offline. When the kit gets connected, the data will be reeded from the SD card and uploaded to the platform.</p> <p>To hold the SD card we are using the DM3CS holder. The SD card is powered at 3.3V and communicates with the CPU through SPI protocol.</p> <p> </p> <p>DM3CS datasheet</p>"},{"location":"Components/legacy/Hardware/#eeprom-memory","title":"EEPROM MEMORY","text":"<p>For the users that don\u2019t have a SD card we\u2019ve added an EEPROM memory to store the data when the SCK is offline. We chose the 24LC256 IC that can store 32kBytes, it communicates with the CPU through I2C protocol.</p> <p> </p> <p>24LC256 datasheet</p>"},{"location":"Components/legacy/Hardware/#main-board-basic-sensors","title":"MAIN BOARD BASIC SENSORS","text":"<p>The main board has some basic sensors:</p> <ul> <li>Measurement of the battery level</li> <li>Measurement of the solar panel level</li> <li>Measurement of the wireless networks detected</li> </ul>"},{"location":"Components/legacy/Hardware/#sensor-board","title":"SENSOR BOARD","text":"<p>The sensor board contains the necessary sensors for measuring all the other parameters. This means NO2 and CO gases, sunlight, noise pollution, temperature, humidity. Also, the sensor board has an I2C bus, this allows to expand the SCK to other kind of sensors.</p> <p> </p>"},{"location":"Components/legacy/Hardware/#no2-and-co-sensors","title":"NO2 AND CO SENSORS","text":"<p>To measure these two gases we chose e2v sensors. In particular, metal oxide sensors MICS5525 and MICS2710, for version 1.0. And MICS4514, for version 1.1, that contains both sensors in one.</p> <p>Metal oxide sensors are based on oxide semiconductors. Their electrical conductivity is modulated due to the reaction between the semiconductor and the gases in the atmosphere.</p> <p> </p> <p>MICS5525 datasheet MICS2710 datasheet MICS4514 datasheet</p>"},{"location":"Components/legacy/Hardware/#light-sensor","title":"LIGHT SENSOR","text":"<p>The light sensor is a basic element to know the light pollution. In version 1.0, was used a LDR (light-dependent resistor) whose voltage varies depending on the light conditions.</p> <p>For version 1.1, was used a photodiode BH1730FVC. This sensor contains an I2C bus that gives us directly the amount of lux of ambient and infrared light.</p> <p> </p> <p>BH1730FVC datasheet</p>"},{"location":"Components/legacy/Hardware/#noise-sensor","title":"NOISE SENSOR","text":"<p>The noise sensor is based on an electret microphone. For the version 1.0 WM-61A was used as the microphone, the captured audio signal is passed through an operational amplifier configured as band pass filter.</p> <p></p> <p>For the version 1.1 POM-3044P-R was used.</p> <p></p> <p>WM-61A datasheet POM-3044P-R datasheet</p>"},{"location":"Components/legacy/Hardware/#temperature-and-humidity-sensor","title":"TEMPERATURE AND HUMIDITY SENSOR","text":"<p>To measure temperature and humidity a module that integrates both sensors was used.</p> <p>For version 1.0 the RHT22 was used, it has one wire digital interface.</p> <p></p> <p>For version 1.1 the SHT21 was used, it has I2C protocol and faster response between measures than the RHT22.</p> <p></p> <p>RHT22 datasheet SHT21 datasheet</p>"},{"location":"Components/legacy/Hardware/#3-axis-accelerometer","title":"3 AXIS ACCELEROMETER","text":"<p>In version 1.0 we detected that some measures vary depending on the orientation of the SCK.</p> <p>That's why in version 1.1 we added the ADXL345 accelerometer to detect the position and to compensate the measures depending on the orientation of the SCK. This accelerometer communicates via I2C protocol with the kit.</p> <p></p> <p>ADXL345 datasheet</p>"},{"location":"Components/legacy/Hardware/#i2c-expansion-bus","title":"I2C EXPANSION BUS","text":"<p>Due to the ease of the I2C protocol. We\u2019ve included and I2C bus to provide to the community the opportunity of expanding the SCK.</p> <p> </p>"},{"location":"Components/legacy/Hardware/#detailed-specifications","title":"Detailed specifications","text":"Smart Smart Citizen Kit SCK 1.0 (Goteo Board) SCK 1.1 (Kickstarter Board) SCK 1.5 (Upcoming!) Data Board MCU ATMEGA32U4 ATMEGA32U4 SAMD21 Clock 16Mhz 8Mhz 32Mhz WiFi Microchip RN-131 802.11 b/g Microchip RN-131 802.11 b/g Espressif ESP8266-12E Firmware Repository Repository Repository Design files v1.01 v1.1 v1.5 Ambient Board Light PVD-P8001 BH1730FVC BH1730FVC Type LDR Analog Light Sensor Digital Ambient Light Sensor Digital Ambient Light Sensor Units % Lux Lux Datasheet PDV-P8001.pdf BH-1730FCV.pdf BH-1730FCV.pdf Performance 0.008 - 65535 lx (\u00b1 15%) ** 0.008 - 65535 lx (\u00b1 15%) ** Firmware <code>SCKAmbient::getLight();</code> <code>SCKAmbient::getLight():</code> Under development Temp DHT22 HPP828E031 (SHT21) SHT21 Type Digital Temperature and Relative Humidity Sensor Digital Temperature and Relative Humidity Sensor Digital Temperature and Relative Humidity Sensor Units \u00baC \u00baC \u00baC Datasheet DHT22.pdf HTU-21D.pdf SHT-21.pdf Firmware <code>SCKAmbient::getDHT22();</code> <code>SCKAmbient::getHumidity();</code> <code>SCKAmbient::getSHT21();</code> <code>SCKAmbient::getTemperature();</code> Under development Performance Linearity R\u00b2&gt;0.94 * Under tests Humidity DHT22 HPP828E031 (SHT21) SHT21 Type Digital Temperature and Relative Humidity Sensor Digital Temperature and Relative Humidity Sensor Digital Temperature and Relative Humidity Sensor Units % Rel % Rel % Rel Datasheet DHT22.pdf HTU-21D.pdf SHT21.pdf Firmware <code>SCKAmbient::getDHT22();</code> <code>SCKAmbient::getHumidity();</code> <code>SCKAmbient::getSHT21();</code> <code>SCKAmbient::getHumidity();</code> Under development Performance Linearity R\u00b2&gt;0.97 * Under tests NO\u00b2ise POM-3044P-R POM-3044P-R SPU0414HR5H Type Electret microphone with envelop follower sound pressure sensor Electret microphone with envelop follower sound pressure sensor New MEMS microphone with envelop follower sound pressure sensor Units dB dB dB Datasheet POM-3044P-R.pdf POM-3044P-R.pdf SPU0414HR5H.pdf Firmware <code>SCKAmbient::getNO\u00b2ise();</code> <code>SCKAmbient::getNO\u00b2ise();</code> Under development *Performance Range 50dB - 110dB (\u00b1 15%) ** Under tests CO MICS-5525 MiCS-4514 MiCS-4514 Type MOS CO gas sensor MOS CO and NO\u00b2 gas sensor MOS CO and NO\u00b2 gas sensor Units kOhm (ppm) kOhm (ppm) kOhm (ppm) Datasheet MICS-5525_CO.pdf MiCS-4514_CO_NO2.pdf MiCS-4514_CO_NO2.pdf Firmware <code>SCKAmbient::getMICS();</code> <code>SCKAmbient::getMICS();</code> Under development Performance Linearity 0.45 &lt; R\u00b2 &lt; 0.82 * Under tests NO\u00b22 MICS-2710 MiCS-4514 MiCS-4514 Type MOS NO\u00b2 gas sensor MOS CO and NO\u00b2 gas sensor MOS CO and NO\u00b2 gas sensor Units kOhm (ppm) kOhm (ppm) kOhm (ppm) Datasheet MICS-2710_NO2.pdf MiCS-4514_CO_NO2.pdf MiCS-4514_CO_NO2.pdf Firmware <code>SCKAmbient::getMICS();</code> <code>SCKAmbient::getMICS();</code> Under development Performance Linearity R\u00b2&lt;0.0 * Under tests <p>** * ** South Coast AQMD The correlation coefficient (R\u00b2) is a statistical parameter indicating how well the performance of each sensor compares to that of a Federal Reference or Federal Equivalent Method (FRM and FEM, respectively) instrument. An R\u00b2 approaching the value of 1 reflects a near perfect agreement, whereas a value of 0 indicates a complete lack of correlation</p> <p>** * ** Internal Smart Citizen Team WIP Evaluation Tests</p>"},{"location":"Components/legacy/Hardware/#enclosures","title":"Enclosures","text":"<p>We have designed a laser cut cover for an acrylic material and a 3D-Printed enclosure to better safeguard the hardware, particularly for outdoor applications.</p> <p>You can download the files through this links.</p> <p>Smart Citizen Enclosure 1.0 Smart Citizen Enclosure 1.1</p> <p> </p> <p>Also, we are working in new cases that will be available soon.</p> <p>Smart Citizen Enclosure Assembly Instructions</p>"},{"location":"Components/legacy/Hardware/#acrylic-cases","title":"Acrylic cases","text":"<p>This case has been designed to protect the electronics on the circuit boards and allows for mount the SCK's hardware on walls and other surfaces without much trouble. Particularly for indoor applications.</p> <p>Acrylic cases</p>"},{"location":"Components/legacy/Troubleshooting/","title":"Troubleshooting","text":""},{"location":"Components/legacy/Troubleshooting/#add-an-ssid-with-two-words","title":"Add an SSID with two words","text":"<p>If your SSID has more than one word you have to fill any spaces with the dollar ($) character.</p>"},{"location":"Components/legacy/Troubleshooting/#serial-port-already-in-use","title":"Serial port already in use","text":"<p>This happens when one application is already using the serial port. For example, if you have the Arduino IDE serial monitor opened and you're trying to configure your SCK through the web browser. You have yo close the serial monitor first.</p>"},{"location":"Components/legacy/Troubleshooting/#no-port-available","title":"No port available","text":"<p>This message will appear when you have uploaded the wrong firmware version to your SCK.</p>"},{"location":"Components/legacy/Troubleshooting/#unable-to-connect-to-the-board","title":"Unable to connect to the Board","text":"<p>This happens when one application is already using the serial port. For example, if you have the Arduino IDE serial monitor opened and you're trying to configure your SCK through the web browser. You have yo close the serial monitor first.</p>"},{"location":"Components/legacy/Troubleshooting/#unable-to-connect-to-the-internet","title":"Unable to connect to the Internet","text":"<p>If you're getting the message \"Error in connection\" when you run the SCK firmware this may be due:</p> <ul> <li>Your router works with a protocol different than 802.11AG</li> <li>You have set wrong SSID name and/or password</li> <li>Your network has an encryption different than OPEN, WEP, WPA1, WPA2 OR WEP64</li> <li>Your firewall is blocking the mac address of your SCK</li> <li>Your internet connection is not stable</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#no-data-received-yet","title":"No data received yet","text":"<p>This message appears the first time you register your kit, is due to cache issues. This issue normally is fixed after a few hours, in any case we are working to improve this issue.</p>"},{"location":"Components/legacy/Troubleshooting/#port-is-not-appearing-on-the-drop-down","title":"Port is not appearing on the drop down","text":"<p>This may be due:</p> <ul> <li>The SCK is turned off.</li> <li>The USB cable you're using has wired only power cable and not the data cables.</li> <li>The bootloader is corrupted.</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#firmware-update-problem","title":"Firmware update problem","text":"<p>If you're having problems updating the firmware you can try one of these two options:</p> <ul> <li>Update the latest firmware through the web browser configurator.</li> <li>Update the latest firmware through Arduino IDE.</li> </ul> <p>If you're still having problems it's may be due to a hardware or software issue, contact us at support@smartcitizen.me.</p>"},{"location":"Components/legacy/Troubleshooting/#no-mac-address-registered","title":"No MAC address registered","text":"<p>If you're getting this message, the may be due:</p> <ul> <li>Configuration process is not finished correctly.</li> <li>The WIFI module of your SCK is corrupted, so MAC address is not accessible. To repair your wifi module refer to this tutorial.</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#collapsed-usb-port","title":"Collapsed USB port","text":"<p>First batches of SCK version 1.1 came with this issue. We have a tutorial you can follow to repair it or contact us at support@smartcitizen.me.</p>"},{"location":"Components/legacy/Troubleshooting/#broken-lipo-battery-wire","title":"Broken LiPo battery wire","text":"<p>Depending on the conditions, the battery wires can suffer until its break. We encourage you to read this Battery Common Care Techniques in order to preserve your battery.</p>"},{"location":"Components/legacy/Troubleshooting/#non-stop-blue-led-blinking","title":"Non-Stop Blue LED Blinking","text":"<p>If your blue LEDs are blinking back and forth non-stop, this means your SCK has lost its WiFi connection. Check to make sure your router is still on, and that you're still in range.</p>"},{"location":"Components/legacy/Troubleshooting/#reinstall-the-bootloader-using-another-arduino","title":"Reinstall the bootloader using another Arduino","text":"<p>In this tutorial we are going to show you how turn an Arduino into AVR ISP to burn the bootloader to your SCK.</p> <p>The bootloader is a small piece of code running inside your Smart Smart Citizen Kit allowing it to be programmed and configured over USB. If suddenly you do not see anymore the USB / Serial port when connecting your Kit to a Computer maybe your bootloader crashed and it is time to reinstall it.</p> <p></p>"},{"location":"Components/legacy/Troubleshooting/#parts","title":"Parts:","text":"<ul> <li>Arduino Board</li> <li>6 Patch Cables Male Female</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#software","title":"Software:","text":"<ul> <li>Arduino IDE</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#instructions","title":"Instructions:","text":"<ul> <li>Open the ArduinoISP sketch example in menu <code>File &gt; Examples &gt; ArduinoISP</code>.</li> <li>Select the correct board and ports in the menu <code>Tools &gt; Board &gt;  Port</code> and <code>Tools &gt; Board &gt;  Port</code> that correspond to the board you are using as the programmer (e.g., Arduino UNO).</li> <li>Upload the ArduinoISP sketch.</li> <li>Wire your Arduino board to the SCK as shown in the diagram below using the Patch cables.</li> </ul> <p>Take care the ISCP VCC goes to the 3.3V Pin on the Arduino UNO since the Smart Smart Citizen Kit works at 3.3V</p> <p></p> <ul> <li> <p>Select the  board in the <code>Tools &gt; Board menu</code></p> <ul> <li>For SmartSmart Citizen Kit version 1.0 select Arduino Leonardo (ATmega 32U4 at 16Mhz)</li> <li>For SmartSmart Citizen Kit version 1.1 select Arduino LilyPad USB (ATmega 32U4 at 8Mhz)</li> </ul> </li> <li> <p>Select in <code>Tools &gt; Programmer &gt; Arduino as ISP</code>.</p> </li> <li>Select in <code>Tools &gt; Burn Bootloader</code>. This step can take some minutes.</li> <li>Done! Please, go back to the on-line setup page in order to install the firmware again.</li> </ul> <p></p> <p>We know this is not an easy task! For any question contact support@smartcitizen.me or ask for help in the forum.</p>"},{"location":"Components/legacy/Troubleshooting/#reinstall-the-bootloader-using-the-avrisp-mkii","title":"Reinstall the bootloader using the AVRISP MKII","text":"<p>In this tutorial we are going to show you how to program the SCK with the Atmel AVRISP MKII In-System Programmer. This is not a common tool you might have but we suggest you ask your closest Fab Lab.</p> <p>The bootloader is a small piece of code running inside your Smart Smart Citizen Kit allowing it to be programmed and configured over USB. If suddenly you do not see anymore the USB / Serial port when connecting your Kit to a Computer maybe your bootloader crashed and it is time to reinstall it.</p>"},{"location":"Components/legacy/Troubleshooting/#parts_1","title":"Parts:","text":"<ul> <li>AVRISP mkII</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#software_1","title":"Software:","text":"<ul> <li>Arduino IDE</li> </ul>"},{"location":"Components/legacy/Troubleshooting/#instructions_1","title":"Instructions:","text":"<ul> <li>Connect the AVRISP mkII with the USB cable to the computer.</li> <li>Connect your Smart Smart Citizen Kit to the computer with the micro-USB cable.</li> <li>Connect the six pins bus cable of the AVRISP mkII to the ISP connector of the SCK Board as shown the picture.</li> </ul> <ul> <li>Switch on your Smart Smart Citizen Kit, you'll find out a tiny switch in one side.</li> <li>Select the  board in the <code>Tools &gt; Board menu</code><ul> <li>For SmartSmart Citizen Kit version 1.0 select Arduino Leonardo (ATmega 32U4 at 16Mhz)</li> <li>For SmartSmart Citizen Kit version 1.1 select Arduino LilyPad USB (ATmega 32U4 at 8Mhz)</li> </ul> </li> <li>Select in <code>Tools &gt; Programmer &gt; AVRISP MKII</code>.</li> <li>Select in <code>Tools &gt; Burn Bootloader</code>. This step can take some minutes, the led  AVRISP mkII will blink and after go green.</li> <li>Done! Please, go back to the on-line setup page in order to install the firmware again.</li> </ul> <p>We know this is not an easy task! For any question contact support@smartcitizen.me or ask for help in the forum .</p>"},{"location":"Components/legacy/sck/","title":"Smart Citizen Kit","text":"<p>A note about versions</p> <p>The SCK 2.0 was the development version for the now commercially available SCK 2.1 sponsored thanks to the iSCAPE project under European Community\u2019s H2020 Programme under Grant Agreement No. 689954</p> <p>Quick links</p> <p> Installation: start.smartcitizen.me</p> <p> Platform: smartcitizen.me</p> <p> Discuss: forum.smartcitizen.me</p> <p> Support: support@smartcitizen.me</p>"},{"location":"Components/legacy/sck/#measurements","title":"Measurements","text":"<p>All the Smart Citizen Kit new sensors generation measure at least air temperature, relative humidity, noise level, ambient light, barometric pressure and particulate matter (PM).</p>"},{"location":"Components/legacy/sck/#sck-20","title":"SCK 2.0","text":"<p>The non-commercially available SCK 2.0 components are listed below:</p> <ol> <li>Smart Citizen Kit 2.0 with Particle Sensor and battery with two mounting brackets.</li> <li>MicroSD card and microSD adapter to SD.</li> <li>USB cable and a USB charger.</li> </ol> <p>The measurements of the SCK2.0 are listed below:</p> Measurement Units Sensors Air temperature \u00baC Sensirion SHT-31 Relative Humidity % REL Sensirion SHT-31 Noise level dBA Invensense ICS-434342 Ambient light Lux Rohm BH1721FVC Barometric pressure Pa NXP MPL3115A26 Particulate Matter PM 1 / 2.5 / 10 \u00b5g/m3 Planttower PMS 5003 <p>Find out more</p> <p>Except for the sensors, most information about the SCK2.0 is the same as the one for SCK2.1. More information about the metal oxyde sensors can be found here</p> <p>The firmware for the 2.0 is still maintained and can be found in Github </p>"},{"location":"Components/sensors/performance/","title":"Sensor performance summary","text":""},{"location":"Components/sensors/performance/#metal-oxyde-sensors","title":"Metal Oxyde Sensors","text":"<p>The metal oxyde sensors section is so extense, that we decided to dedicate a full section to them. Have a look at it here!</p> <p>What are normal values?</p> <p>More on the AMS CCS811, eCO2 and TVOC</p>"},{"location":"Components/sensors/performance/#noise-level-sensor","title":"Noise Level Sensor","text":"<p>Version</p> <p>This sensor is supported from V2.0 onwards</p> <p>The noise sensor is based on the INVENSENSE ICS-434322 high-performance, low power, digital output, omnidirectional MEMS microphone with a bottom port and I2S interface. The sensors are similar to the one found on some high-end smartphones. It delivers the information directly in a digital format to the MCU where a custom library has been developed to provide noise data in dB scales A, C and Z. The raw FFT is also accessible to support characterization of specific noise frequencies. The sensor has been calibrated specifically for the project on an anechoic chamber using standard microphone calibration procedures.</p> <p>The following characteristics have been considered for the sensor choice</p> <ul> <li>High 65 dBA SNR with a \u221226 dB FS Sensitivity</li> <li>Low Sensitivity Tolerance \u00b11 dB</li> <li>Wide Frequency Response from 50Hz to 20kHz</li> <li>High Acoustic Overload Point 116 dB SPL</li> <li>Low Power</li> </ul> <p>Info</p> <p>Check the Noise sensor implementation full documentation and the performance evaluation in the ISCAPE 7.8 Deliverable (section 6.1)</p> <p>Sensor integration</p> <p></p>"},{"location":"Components/sensors/performance/#relative-humidity-and-air-temperature-sensor","title":"Relative Humidity and Air Temperature Sensor","text":"<p>Version</p> <p>This sensor is supported from V2.0 onwards</p> <p>Relative Humidity and Air Temperature Sensor are provided by a SENSIRION SHT313 module.</p> <p>Sensor upgrade</p> <p>Preliminary tests during the project shown a absolute calibration issues affecting the previously selected sensor, the SENSIRION SHT31. Those we updated the sensor to the newest SHT 31 with a PTFE layer for protection obtaining better results.</p> <p>The following characteristics have been considered for the sensor choice</p> <ul> <li>Calibrated, linearized sensor signals in digital, I2C format straight to the MCU where data is provided in degrees Celsius and Relative Humidity.</li> <li>Wide measurement range with high resolution. The relative humidity range of 0-100% RH with a 0.03% resolution and a repeatability of 0.1%, together with a temperature operating range from -40 to +125\u00b0C with a temperature resolution of 0.01 \u00baC and a repeatability of 0.1%.</li> <li>No need for calibration and long-term stability.</li> <li>Low power consumption</li> <li>Commonly found in many commercial weather stations as the Davis Vantage Pro.</li> </ul> <p>Sensor integration</p> <p></p>"},{"location":"Components/sensors/performance/#ambient-light-sensor","title":"Ambient Light Sensor","text":"<p>Version</p> <p>This sensor is supported from V1.5 onwards</p> <p>The Ambient Light Sensors is based around the ROHM BH1721FVC4 which uses an LDR10 combined with an ADC and the corresponding circuit that allows communicating with the device with the I2C protocol.</p> <p>The following characteristics have been considered for the sensor choice:</p> <ul> <li>No need of external ADC or linearization circuits uses the well-known I2C protocol</li> <li>Measures ambient light data in a wide range from 1lx to 65528 lx a repeatability of 15% and a resolution of 8 lx.</li> <li>Possibility to adjust by an I2C command the kind of light that it should measure (visible or infrared).</li> <li>Low power consumption.</li> <li>50Hz/60Hz (electric network frequency) light rejection. Filtering the interference of most artificial light sources.</li> </ul> <p>Sensor integration</p> <p></p>"},{"location":"Components/sensors/performance/#barometric-pressure","title":"Barometric Pressure","text":"<p>Version</p> <p>This sensor is supported from V2.0 onwards</p> <p>The Barometric Pressure sensor is based around the NXP MPL3115A25 is a compact, piezoresistive, absolute pressure sensor with an I2C digital interface.</p> <p>The following characteristics have been considered for the sensor choice:</p> <ul> <li>Wide operating range of 20 kPa to 110 kPa.</li> <li>Temperature compensated utilizing an on-chip temperature sensor.</li> <li>No need for an external ADC or linearization circuits. The pressure and temperature data is fed into an internal high-resolution ADC to provide fully compensated and digitized outputs for pressure in Pascals and temperature in \u00b0C using the well-known I2C protocol</li> <li>Barometric pressure is also processed by the MCU as height above mean sea level (AMSL) helping to determine the location of the device.</li> <li>Low power consumption.</li> </ul> <p>Sensor integration</p> <p></p>"},{"location":"Components/sensors/performance/#pm-sensor","title":"PM Sensor","text":"<p>Version</p> <p>This sensor is supported from V2.0 onwards</p> <p>An external connector on the board supports the connection of a Plantower PMS 5003 or PMS 70037. The device is a digital particle optical counter sensor that uses the laser scattering principle to obtain the number of suspended particles in the air. The sensor can be fully enabled or disabled in software to save energy when not in use.</p> <p>The following characteristics have been considered for the sensor choice (see more in sensor considerations):</p> <ul> <li>Provides PM1, PM 2.5 and PM10 measurements in ug/m\u00b3</li> <li>Minimal distinguishable particle diameter of 0.3 um</li> <li>No need for external ADC or linearization circuits. The sensor includes an internal MCU capable of dealing with all the light emitting and sensing processing. All the communication is done using the I2C protocol. A dedicated driver has been designed for this.</li> <li>Ultra Low Cost when compared to other commercial solutions with similar performance</li> <li>Low Power</li> </ul> <p>Sensor integration</p> <p></p>"},{"location":"Components/sensors/performance/#co2-ndir-sensor","title":"CO2 NDIR Sensor","text":"<p>Version</p> <p>This sensor is supported from V2.1 onwards</p> <p>Done with a CO2 NDIR sensor from Sensirion's SCD308. The sensor also features a Sensition SHT31 for T/H measurements and can be connected to the I2C bus via the auxiliary grove port.</p> <ul> <li>CO2 measurement range: 0 - 40'000 ppm</li> <li>Accuracy: \u00b1 (30 ppm + 3% MV) - (25 \u00b0C, 400 - 10'000 ppm)</li> <li>Repeatability: 10ppm</li> <li>Temperature stability: 2.5 ppm / \u00b0C (0-50 \u00b0C)</li> <li>Response time (t63): 20s</li> </ul> <p>Calibration</p> <p>Make sure to check the sensor calibration guide for this sensor.</p>"},{"location":"Components/sensors/performance/#electrochemical-sensors","title":"Electrochemical sensors","text":"<p>Version</p> <p>This sensor is supported from V2.1 onwards</p> <p>We currently support electrochemical sensors from Alphasense Ltd. with a digital interface Analog Sensor Board that can operate at 3.3V or 5V. The basic data postprocessing that is specified in Alphasense Application Note 803_04 is implemented as a default processing for these sensors and that we can trigger automatically.</p> <p>Other sensors can be used, such as SPEC Sensors, with the same hardware (note that these sensors operate at 3.3V). The process is now been worked on in this thread in our forum and will be integrated in the basic data postprocessing as with Alphasense sensors to be triggered automatically.</p> <p>The sensors that are currently supported are:</p> <ul> <li> <p>Alphasense Sensors: CO, NO2, NO, OX, SO2, H2S, both in A or B-Series. These sensors are affected differently by temperature and humidity (some of them are by both, some of them are not). It is important to consider cross-sensitivity of the sensors in this case, for instance:</p> <ul> <li>OX sensor is affected by NO2 and O3</li> <li>SO2 is affected by SO2 and O3</li> </ul> </li> <li> <p>SPEC Sensors - WIP: CO, NO2, SO2, O3, H2S</p> </li> </ul>"},{"location":"Components/sensors/performance/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p> <ol> <li> <p>SGX MICS 4514 Technical Datasheet</p> <p>https://sgx.cdistore.com/datasheets/sgx/0278_Datasheet%20MiCS-4514%20rev%2017.pdf \u21a9</p> </li> <li> <p>INVENSENSE 43432 Technical Datasheet</p> <p>https://www.invensense.com/wp-content/uploads/2015/02/ICS-43432-data-sheet-v1.3.pdf \u21a9</p> </li> <li> <p>SENSIRION SHT31 Technical Datasheet</p> <p>https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/2_Humidity_Sensors/Datasheets/Sensirion_Humidity_Sensors_SHT3x_Datasheet_digital.pdf \u21a9</p> </li> <li> <p>ROHM BH1730 Technical Datasheet</p> <p>http://rohmfs.rohm.com/en/products/databook/datasheet/ic/sensor/light/bh1721fvc-e.pdf \u21a9</p> </li> <li> <p>NXP MPL3115A2 Technical Datasheet</p> <p>http://www.nxp.com/docs/en/data-sheet/MPL3115A2.pdf \u21a9</p> </li> <li> <p>MAXIM 30105 Technical Datasheet</p> <p>https://datasheets.maximintegrated.com/en/ds/MAX30105.pdf \u21a9</p> </li> <li> <p>PLANTOWER PMS5003 Technical Datasheet </p> <p>Also in https://aqicn.org/air/view/sensor/spec/pms5003.pdf \u21a9</p> </li> <li> <p>Sensirion SCD30 Technical Datasheet </p> <p>https://files.seeedstudio.com/wiki/Grove-CO2-Temperature-Humidity-Sensor-SCD30/res/Sensirion_CO2_Sensors_SCD30_Datasheet.pdf \u21a9</p> </li> </ol>"},{"location":"Components/sensors/air/CCS811/","title":"eCO2 and TVOC sensor","text":"<p>The AMS CCS811 is a Metal Oxide Sensor with I2C connectivity which is capable of measuring a volatile organic compounds (VOCs for short). This sensor was introduced in the SCK2.1, in replacement of the SGX MICS4514 from previous designs. As mentioned in other parts of the documentation, this decission was mainly due to the lower power consumption of the CCS811 and the easy implementation of reading processing provided by the manufacturer.</p> <p>Does it measure CO2?</p> <p>No. Despite the name, the sensor does not measure CO2. See below for a detailed description of the sensor measurements.</p>"},{"location":"Components/sensors/air/CCS811/#measurements","title":"Measurements","text":"<p>eCO2 and eTVOC are two related measurements. The first stands for equivalent CO2, and it's an indication of the concentration of CO2 that would cause the same level of radiative forcing as a given type and concentration of greenhouse gas. The eCO2 measurement is therefore a derived measurement from the reactions all these substances in the air with the metal oxide substrate in the sensor. eCO2 bottomline starts at 400ppm (current background CO2, sadly) and can reach several thousands.</p> <p>On the other hand, eTVOC stands for equivalent total volatile organic compounds and is a measurement of the total amount of any emitted gases coming from toxins and chemicals. They come from a wide range of everyday items including paints and varnishes, wax and cosmetics, cleaning and hobby products, and even cooking. When you have an enclosed space like a home or office, these emitted gases accumulate and pollute our fresh air.</p>"},{"location":"Components/sensors/air/CCS811/#global-warming-potential","title":"Global Warming Potential","text":"<p>To understand the eCO2 readings, we need to know what is the Global Warming Potential (GWP for short). GWP is an estimate of how much a given greenhouse gas contributes to Earth\u2019s radiative forcing. </p> <p>We know that CO2 is one of the major contributors to global warming, but there are others (and that are much worse). For example: CO2 has a value of 1 GWP, whereas methane has a GWP of 72 over 20 years, but a lower GWP of 25 over 100 years. This is because it is very potent in the short-term but then breaks down to CO2 and water in the atmosphere, meaning that the longer the period you consider it over, the more similar its effect is to that of CO2 alone. This means that 1ppm of CH4 is much more worrying for the global warming of the planet than 1ppm CO2 in the short term, because it can produce a higher increment of the atmosphere temperature. All this is at the same time interesting and worrying, because many products used for painting, solvents, varnish, refrigeration, and more contain pollutants with high GWP. A very interesting article can be found here.</p>"},{"location":"Components/sensors/air/CCS811/#working-principle","title":"Working principle","text":"<p>As any metal oxide sensor, the CCS811 measures the resistance of a sensitive layer, exposed to ambient air. This layer is heated up with a heater element (a resistance) up to several hundred \u00baC, and some oxidation reactions take place on it. The characteristics of the sensitive element vary from sensor to sensor, and with time, depending as well on the exposure to different chemical components and ambient conditions. For this reason an individual sensor charactersition is very tricky, and relative measurements are used, using an internal processing that monitors the baseline resistance of the sensor (i.e., the resistance of the sensitive layer when exposed to clean air).</p> <p>The sensor generally targets pollutants that can get oxidised in the sensor substrate. This oxidation process modifies the resistance of the sensor, and the more oxidation reactions we have the lower the resistance is. The concept of baseline resistance in this sense can be confusing, but basically can be explained as: the higher resistance, the cleaner the environment.</p> <p>Temperature and humidity are used internally to compensate the readings, as the sensor compares it\u2019s actual resistance with the clean air one (baseline), and inputs the ambient conditions in the correction.</p>"},{"location":"Components/sensors/air/CCS811/#sensor-considerations","title":"Sensor considerations","text":"<p>Like any sensor, the CCS811 has some limitations. As mentioned above, the sensitive layer will decrease it's resistance when in presence of VOCs, but other pollutants can have the opposite effect on it. For instance, Ozone (O3) will increase the sensor's resistance, and it could be seen as clean air by the sensor. This could explain why in some outdoor environments (generally with traffic and high levels of sun radiation), the sensor can present an unstable behaviour.</p> <p>Additionally, humidity is known to affect the sensor resistance. The internal humidity correction can limit this effect up to a certain extent, but a perfect correction is not possible.</p> <p>We also recommend setting the sensor in a stable environment, in which temperature and relative humidity changes are not abrupt. When moving the sensor to another location, beware that any high resistance could be seen as the new baseline resistance, and this value might not apply to the previous environment, should you put the sensor back into it's original location.</p> <p>Resetting the baseline resistance</p> <p>The sensor keeps track of the baseline resistance even after a factory reset. Currently, there is no method to reset the baseline resistance in the firmware, but it will soonly be introduced. When changing locations, a baseline resistance reset should be performed.</p> <p>Finally, although the sensor is considered to be an indoor sensor, it can be placed outdoor, but keeping in mind, that the environment will be very different and that the sensor might behave in unexpected ways.</p> <p>Sources</p> <p>Have a read to the Datasheet or some other ANs here</p>"},{"location":"Components/sensors/air/CCS811/#early-life-burn-in","title":"Early-Life (Burn-In)","text":"<p>The CCS811 performance in terms of resistance levels and sensitivities will change during early life. The change in resistance is greatest over the first 48 hours of operation, although this process can last up to 5 days. CCS811 controls the burn-in period allowing eCO2 and eTVOC readings to be used from first power-on after 60 minutes of operation.</p>"},{"location":"Components/sensors/air/CCS811/#conditioning-period-run-in","title":"Conditioning Period (Run-In)","text":"<p>After early-life (Burn-In) the conditioning or run-in period is the time required to achieve good sensor stability before measuring VOCs after long idle period. The sensor will need to run for 20 minutes, before accurate readings are generated.</p>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/","title":"Electrochemical Sensors","text":""},{"location":"Components/sensors/air/Electrochemical%20Sensors/#working-principle","title":"Working principle","text":"<p>The electrochemical cells used are toxic gas sensors from Alphasense Ltd. that operate in an amperometric mode. That is, they generate a current that is linearly proportional to the fractional volume of the toxic gas in the environment:</p> <p></p> <p>Image Source: Alphasense Ltd.</p> <p>These electrochemical sensors are comprised of four electrodes:</p> <ul> <li>Working electrode</li> <li>Auxiliary electrode</li> <li>Counter electrode</li> <li>Reference electrode</li> </ul> <p>The working electrode is where the oxidation (CO, H2S, NO, SO2) or reduction (NO2, Cl2) of the toxic gas to be measured takes place. This electrode is exposed to the outside air and  directly exposed to all gases in the air including the gas to be measured. This electrode may as well be poisoned if it is exposed to certain gases that either adsorb onto the catalyst (such as acetylene onto CO sensors), or react, creating by-products which inhibit the catalyst (NO2 or aromatics onto H2S sensors).</p> <p>The auxiliary electrode is an electrode of the same characteristics to those of the working electrode, but it is buried inside an electrolite and, hence, it is not in contact with the target gas. Since it is isolated from external conditions that could affect the working electrode, it serves as a reference to the measurements provided by the latter.</p> <p>The counter electrode balances the reaction of the working electrode \u2013 if the working electrode oxidises the gas, then the counter electrode must reduce some other molecule to generate an equivalent current, in the opposite sense. For example, where carbon monoxide will be oxidised on the working electrode, oxygen will be reduced on the counter electrode.</p> <p>The reference electrode anchors the working electrode potential to ensure that it is always working in the right conditions. It is important that the reference electrode has a stable potential, keeping the working electrode at the right electrochemical potential to maintain a constant sensitivity, good linearity and minimum sensitivity to interfering gases.</p> <p>Therefore, while the sensor response is exposed to the target gas, it creates a current flowing from the working to the counter electrode or viceversa (depending on the oxidative or reductive nature of the target gas). This current has been found to be nicely responsive to target gas and therefore subject to characterisation and calibration.</p>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/#reduction-vs-oxidation-electrochemical-sensor","title":"Reduction vs Oxidation Electrochemical Sensor","text":"<p>As mentioned above, the counter electrode is meant to balance the reaction of the working electrode. This determines the current direction within the board: whether it goes from the working electrode to the counter electrode or viceversa.</p> <ul> <li> <p>Oxidation sensors, such as CO, provoke a positive current out of the working electrode and the larger the amount of CO present, the larger (positive) is this current.</p> </li> <li> <p>Reduction sensors, such as NO2, provoke a negative current, i.e: going into the sensor and the larger the amount of NO2 present, the larger (negative) is this current</p> </li> </ul>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/#usage-and-considerations","title":"Usage and considerations","text":"<p>Alphasense Ltd. provides the calibration data in laboratory conditions for each of the electrochemical cells used. This data can be used to calculate pollutant concentration and to correct for known effects by temperature deviations. </p> <p>More on this</p> <p>Alphasense Ltd. provides very useful application notes for the sensor usage.</p> <p>Pollutant calculation based on calibration data in laboratory conditions, can be insightful enough for certain applications, but it might not suffice for some conditions in which the sensors are exposed to other pollutants or in harsh environments. For this reason, two different approaches build on top of the laboratory calibration data:</p> <ul> <li>Usage of more advanced physical models as detailed in 1</li> <li>Usage of site-specific calibration models with short-term deployments in co-location with reference measurement equipment and generalised calibration models derived from the junction of these 4.</li> </ul>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/#stabilisation","title":"Stabilisation","text":"<p>The electrochemical sensors need stabilisation time under the testing conditions they will be at. It is important to set and power the sensors with sufficient time (1-2 days) on the test environment for them to adapt. The newer the sensor, the more stabilisation time it requires. For this deployment, you will be receiving brand new sensors.</p> <p>Humidity and temperature extremes will require of further sensor adaptation, in order to dry out or absorb the necessary humidity for their proper functioning.</p> <p>Danger</p> <p>Do not extract/attach the sensor capsule from the base board while powered, this could irreversibly damage the sensor.</p>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/#open-questions","title":"Open questions","text":"<p>These methods, however, are still open to discussion and more research is necessary to address all use cases. For this reason, the use of these sensors in the Smart Citizen Station is tailored to each use and adapted to the calibration needs of the deployment. </p> <p>Characterisation techniques based on manufacturer data and physical models (i.e. classical linear regression using sensor sensitivity, span and zero) require a big development effort in order to characterise the sensor behaviour that, in the case of low-cost sensors, is affected by a wide variety of external factors such as temperature, humidity and pollutant cross-sensitivity, each of which imply a larger characterisation effort and that can\u2019t be fully represented in a controlled setting. On the other hand, statistical models are able to generate models that describe the sensor behaviour in a mathematical way, but they need to be properly adjusted with large amounts of test data, preferably in the actual deployment site. This approach can be applied per sensor, or to a batch of sensors, assuming that the inter-sensor variation is low or that they can be normalised.</p> <p>In the case of deploying the sensors in different locations, the conditions of these sites should be sufficiently similar to those when the model was generated, since many models won\u2019t be able to extrapolate well, or account for effects they have not seen (i.e. temperature gradients, specific pollutants, etc). How much is \u200bsufficiently similar\u200b, depends on the type of model and it is not easy to determine and, since this is not often assessed easily, researchers suggest (5, 6) that a co-location prior to and post data acquisition with reference sensors should be carried out. In any case, the development of these models highly depends on the amount and quality of the data obtained from both: sensor data and reference data. In the case of reference data 6 have pointed out that reference stations can deviate up to 15% from the actual pollutant concentration, but this has not been taken into account in this study.</p> <p>Since co-location possibilities could be limited, two options are compared for the calibration of these sensors: a specific on-site calibration with sensor co-location, aiming to calibrate the sensors with the data from that period; and a general model approach, in which all the co-location tests from the different sensors deployed are input into a statistical model that aims to describe the global behaviour. Whether these methods are able to generalise or not, it's yet to be answered, and it's probably to be defined for each use case in particular.</p>"},{"location":"Components/sensors/air/Electrochemical%20Sensors/#results","title":"Results","text":"<p>A whole section of the electrochemical sensors validation is available in the iSCAPE D7.8 report on Sensor monitoring experiences and technological innovations 4.</p> <ol> <li> <p>The use of electrochemical sensors for monitoring urban air quality in low-cost, high-density networks - M.I. Mead, O.A.M. Popoola, G.B. Stewart, P. Landshoff, M. Calleja, M. Hayesb, J.J. Baldovi, M.W. McLeod, T.F. Hodgson, J. Dicks, A. Lewis J. Cohen, R. Baron, J.R. Saffell, R.L. Jones \u21a9</p> </li> <li> <p>Development of a baseline-temperature correction methodology for electrochemical sensors and its implications for long-term stability - Olalekan A.M. Popoola*, Gregor B. Stewart, Mohammed I. Mead, Roderic L. Jones \u21a9</p> </li> <li> <p>Modelling atmospheric composition in urban street canyons - Vivien Bright, William Bloss and Xiaoming Cai \u21a9</p> </li> <li> <p>ISCAPE D7.8 Sensor monitoring experiences and technological innovations]\u00a0\u21a9\u21a9</p> </li> <li> <p>Kizel et al - Node-to-node field calibration of wireless distributed air pollution sensor network. In: Environmental pollution (2017) \u21a9</p> </li> <li> <p>Du\u0161an et al - In search of an optimal in-field calibration method of low-cost gas sensors for ambient air pollutants: comparison of linear, multilinear and artificial neural network approaches. In: Atmospheric Environment (2018) \u21a9\u21a9</p> </li> </ol>"},{"location":"Components/sensors/air/Metal%20Oxide/","title":"Metal Oxide sensors","text":"<p>The Smart Citizen Kit has been using metal oxide sensors for air quality metrics for a long time, and we thought that it would be interesting to dedicate a section for them!</p> <p>Learn More</p> <p>Check this link for more information about the specifics of the eCO2 - TVOC sensor</p> <p>Looking for the CO/NO2 MOs?</p> <p>Check the Legacy Hardware Section!</p>"},{"location":"Components/sensors/air/Metal%20Oxide/#a-word-about-metal-oxide-sensors","title":"A word about Metal Oxide Sensors","text":"<p>Metal Oxide Sensors measure the resistance (RS) of a sensitive layer after heating it up with a heating element (normally another resistor). However, this reading cannot be considered as an absolute measurement of the target pollutant concentration, since the resistance varies from sensor to sensor, and it's affected by several conditions, such as temperature, humidity and other non-target pollutant affectations. To mitigate this problem, the output of the sensor is normalized using the baseline resistance (RA): RS is divided by RA. This baseline resistance is the resistance that the sensor sees in clean air, and the cleaner the air is, the higher the resistance is.</p> <p>Unfortunately, since RA varies with the deployment conditions, RA cannot be determined by a one-time calibration; and in the case of the AMS CCS811 included in the SCK V2.1, is maintained on-the-fly in software. This process is known as baseline correction. </p> <p>Previous versions of the SCK (V1.5, V2.0 and others) included the SGX MICS4514, which was meant to measure CO and NO2, and a lot of effort was put in V2.0 to improve the driver for the sensor, aiming to reduce power consumption and improve sensor readings. Unfortunately, this didn't match our expectations in terms of data quality and power consumption, and since individual sensor calibration is not feasible in our case (as some scientific publications have suggested), we decided to focus efforts in simpler, more robust and understandable set of sensors.</p> <p>That being said, the SCK V2.1 includes the AMS CCS811 for Air Quality indicative measurements for indoor air quality in the Urban Sensor Board, and the PMS5003 for outdoor PM exposure. More complex outdoor set-ups will be also possible, for instance using the Analog Sensor Board.</p>"},{"location":"Components/sensors/air/Metal%20Oxide/#what-to-expect-from-metal-oxide-sensors","title":"What to expect from Metal Oxide Sensors","text":"<p>As said above, this type of sensors is not meant for fine pollution monitoring, but is more oriented for air quality indications and trends detection. Our approach is to use them for indicative measurements, and progressively tend towards a more reliable, fine and robust system, once the technology is capable of providing so. </p> <p>While deploying them, since the air quality is expected to vary in a typical environment, the minimum time over which a baseline correction is applied is 24 hours. This means that the sensor output will change with time, until the baseline is roughly stable. Since the sensor monitors the baseline resistance periodically, if a cleaner air is found, the new baseline resistance is used to calculate the sensor readings (although this is only done for  future readings). This also means that the SCK should not be interrupted with an ad hoc power cut since this could erase the baseline resistance and the sensor could always yield wrong readings since it never sees clean air.</p>"},{"location":"Components/sensors/air/Noise/","title":"Noise readings","text":"<p>The new Urban Sensor Board SCK 2.0 (and onwards) comes with a digital MEMs I2S microphone. There is a wide range of possibilities in the market, and our pick was the INVENSENSE (now TDK) ICS43432: a tiny digital MEMs microphone with I2S output. There is an extensive documentation at TDK's website coming from the former and we would recommend to review the nicely put documents for those interested in the topic.</p> <p></p> <p>Image credit: Invensense ICS43432</p>"},{"location":"Components/sensors/air/Noise/#hardware","title":"Hardware","text":"<p>The MEMs microphone comes with a transducer element which converts the sound pressure into electric signals. The sound pressure reaches the transducer through a hole drilled in the package and the transducer's signal is sent to an ADC which provides with a signal which can be pulse density modulated (PDM) or in I2S format. Since the ADC is already in the microphone, we have an all-digital audio capture path to the processor and it\u2019s less likely to pick up interferences from other RF, such as the WiFi, for example. The I2S has the advantage of a decimated output, and since the SAMD21 has an I2S port, this allows us to connect it directly to the microcontroller with no CODEC needed to decode the audio data. Additionally, there is a bandpass filter, which eliminates DC and low frequency components (i.e. at fs = 48kHz, the filter has -3dB corner at 3,7Hz) and high frequencies at 0,5\u00b7fs (-3dB cutoff). Both specifications are important to consider when analysing the data and discarding unusable frequencies. The microphone acoustic response has to be considered as well, with subsequent equalisation in the data treatment in order.</p> <p></p> <p>Image credit: ICS43432 Datasheet - TDK Invensense</p>"},{"location":"Components/sensors/air/Noise/#i2s-protocol","title":"I2S Protocol","text":"<p>The I2S protocol (Inter-IC-Sound) is a serial bus interface which consists of: a bit clock line or Serial Clock (SCK), a word clock line or Word Select (WS) and a multiplexed Serial Data line (SD). The SD is transmitted in two\u2019s complement with MSB first, with a 24-bit word length in the microphone we picked. The WS is used to indicate which channel is being transmitted (left or right). In the case of the ICS43432, there is an additional pin which corresponds with the L/R, allowing to use the left or right channel to output the signal and the use of stereo configurations. When set to left, the data follows WS\u2019s falling edge and when set to right, the WS\u2019s rising edge. For the SAMD21 processor, there is a well developed I2S library that will take control of this configuration. </p> <p></p> <p>Image credit: I2S bus specification - Philips Semiconductors</p> <p>The SD line of the I2S protocol is quite delicate at high frequencies and it is largely affected by noise in the path the line follows. If you want to try this at home (for example with an Arduino Zero and an I2S microphone like this one, it is important not to use cables in this line and to connect the output pin directly to the board, to avoid having interfaces throughout the SD line. One interesting way to see this is that every time the line sees a medium change, part of it will be reflected and part will be transmitted, just like any other wave. This means that introducing a cable for the line will provoke at least three medium changes and a potential signal quality loss much higher than a direct connection. Apart from this point, the I2S connection is pretty straight forward and it is reasonably easy to retrieve data from the line and start playing around with some FFT analysis.</p>"},{"location":"Components/sensors/air/Noise/#manufacturer-specifications","title":"Manufacturer specifications","text":"Parameter Value EIN (dB) - Equivalent input noise 29 Acoustic Dynamic Range (dB) 87 AOP - Acoustic overload point (dB) 116 Full Scale digital (dB SPL) 120 BIT length (-) 24 Sensitivity at 94 dBSPL 1kHz (dBFS) -26"},{"location":"Components/sensors/air/Noise/#evaluation","title":"Evaluation","text":"<p>The sensor is calibrated in an anechoic chamber with a reference microphone to obtain sensor characteristics. The ICS43432 has a clear non-linear response, which is specified in it's datasheet and is characterised in an anechoic chamber:</p> <p></p> <p>Image credit: Invensense ICS43432</p>"},{"location":"Components/sensors/air/Noise/#test-setup","title":"Test setup","text":"<p>SCK side</p> <ul> <li>1 x microphone installed in Arduino Zero (alternating Invensense and Knowles), at h = 1,2m</li> </ul> <p>Instrumentation side</p> <ul> <li>1 x Speaker at 4m distance from the microphone at h = 1,2m 1 x Microphone</li> <li>1 x Class I sonometer for double point test</li> </ul>"},{"location":"Components/sensors/air/Noise/#noise-floor","title":"Noise floor","text":"<p>The noise floor of the microphone in this test setup is of 35,5 dB / 30,1 dBA</p>"},{"location":"Components/sensors/air/Noise/#spectrum-response","title":"Spectrum response","text":"<p>The results for this characterisation, for different SPLs are shown below:</p> <p></p> <p>The microphone's spectrum response is not dependent on the SPL, but only on the frequency. The above response is corrected in the Smart Citizen Kit on real time. A double point validation is performed on both microphones, from the SCK1.5 and the SCK2.0 (onwards), yielding the following results (the results below do not show any equalisation):</p> <p></p> <p>Finally, if comparing these with the thresholds, in dBA scale IEC 61672-1, without accounting for the previous equalisation:</p> <p></p> <p>Which yields a very good linearity off-the-shelf over the common urban frequency range (below 2000Hz).</p>"},{"location":"Components/sensors/air/Noise/#sensor-considerations","title":"Sensor Considerations","text":"<p>There are some known limitations that need to be taken into account when performing noise measurements with the SCK:</p> <ol> <li>The microphone is not isolated in any way from humidity, dust or particles. These can affect the readings and provoke clipping in the readings (absurdly high readings).</li> <li>Up to version 0.9.7 of the firmware, there was a problem in the equalisation tables that provoked low frequencies to be amplified.</li> <li>The fact that the microphone is surface mounted on a PCB can make that certain frequencies resonate on the board and get amplified.</li> </ol>"},{"location":"Components/sensors/air/Noise/#noise-measurement-basic-knowledge","title":"Noise measurement basic knowledge","text":"<p>Real-world sound pressure levels (SPL) travelling around in the air are not fully perceived by our ears. </p> <p></p> <p>Image credit: Human hearing - DSP Guide</p> <p>There are several studies and models of what we actually perceive which yield several types of the so called weighting functions. Some of them have been standarised for the purpose of SPL measurement, finding different types like A-weighting (the most common one), B-weighting, D (both in disuse) and others. In the frequency domain, they look like this:</p> <p></p> <p>Image credit: A-weighting - Wikipedia</p> <p>Even if the are high sound pressure levels floating around in the air, we might not hear them just because of the frequency they are at. Normally humans can hear from something around 20Hz to 20kHz, although most adults might not hear anything in out-of-laboratory conditions above 15kHz. Some animals though, can perceive a great range of frequencies, and for example mouses can hear up to 80kHz.</p> <p>Because of all this, the very first thing we would like to do is to be able to perform weighting on the samples we measure. The I2S microphone is interesting in order to understand sources of urban noise pollution since it provides us with a raw SPL buffer we can play with. As well, we can obtain dBA levels (SPL with a-weighting correction) by processing this buffer in several ways and calculate the RMS level of the resulting signal.</p>"},{"location":"Components/sensors/air/Noise/#signal-processing","title":"Signal processing","text":"<p>This is the whole signal treatment process we use for the I2S microphone ICS43432. We will have a look at windowing and its use in future sections, as well as its implementation in the SAMD21 Cortex M0+ for our firmware.</p> <ol> <li>Signal acquisition</li> <li>Windowing</li> <li>FFT</li> <li>Spectrum Normalisation</li> <li>Equalisation</li> <li>A-weighting</li> <li>RMS calculation</li> </ol> <p>Calculations</p> <p>A note with the calculations on the microphone can be found here</p> <p>About sampling periods</p> <p>A note with the sampling periods on the microphone can be found here</p> <p>For the purists</p> <p>Being mathematical purist, there is yet another possibility for this procedure using convolution in time domain, which is covered below, although not implemented.</p>"},{"location":"Components/sensors/air/Noise/#rms-and-fft-algorithm-simplified","title":"RMS and FFT algorithm simplified","text":"<p>In the previous section we introduced the concept of weighting and our interest on calculating the sound pressure level in different scales. Normally, SPL is expressed in RMS levels, or root mean square. This is nothing more than a modified arithmetic average, where each term of the expression is added in its square form. We then take the square root of all the average:</p>  x = {\\sqrt{x_1^2+x_2^2+...+x_N^2 \\over N}}  <p>The interesting thing about the RMS level, is that it expresses an average signal level throughout the signal, and it actually relates to the peak level of sinusoid wave by \u221a2. Therefore, it is a very interesting way to express average levels for signals and for that reason, it's the common standard used.</p> <p></p> <p>Image credit: Sine wave parameters- Wikipedia</p> <p>Now that we know how to calculate the RMS level of our signal, let's go into something more interesting: how do we actually perform the weighting? Well, if you recall the previous section, when we talked about hearing, we were talking about the different hearing capabilities in terms of frequencies (in humans, mouses, beluga whales... ). Therefore, something interesting to know about our signal is its frequency content,  so that we are able to perform the weighting. For this purpose, we have the FFT algorithm.</p> <p>FFT stands for Fast Fourier Transform, and it's an algorithm capable of performing a Fourier Transform in a simplified and efficient way (that's where the fast comes in). What it does in a detailed mathematical way is something quite complicated with the details; but being practical, it is basically a convertion between the signal in time domain and its frequency domain components. Interestingly, this process is reversible and the other way around it is called IFFT (I for Inverse).</p> <p></p> <p>Image credit: Smart Citizen</p> <p>In the example above, things in the time domain get a bit messy, but in the frequency domain we can clearly see the composition of two sine waves of the same amplitude of roughly 40Hz and 120Hz. The FFT algorithm hence helps us digest the information contained in a signal in a more visually understandable way.</p> <p>For this introduction, let's move on to what we actually want to do: the much anticipated weighting. At this point, our task is fairly easy: we just have to multiply both: our signal in the frequency domain with the weighting function and that's it! If we have a look at the figure below, in the time and frequency domain, the signals look like this:</p> <p></p> <p>Image credit: Smart Citizen</p> <p>This example shows how our ears are only capable of perceiving the signal in red, but the actual sound components are in blue -- being much higher in the amplitude spectrum. If you want to get into the thick of it, here you have the actual implementation in Matlab/Octave of the A-weighting function that we'll use in the SCK V2.0.</p>"},{"location":"Components/sensors/air/Noise/#signal-windowing","title":"Signal windowing","text":"<p>In this section we are going to describe how we have to pre process our signals in order to obtain the results in the manner we are expecting. These are very important steps in our processing chain, since the FFT algorithms -or convolution FIR Filters- won't be able to cope with our system's limitations. These limitations might not be obvious at the beginning, but you really don't want to ignore them while designing your system, since they'll invalidate many of your measurements.</p> <p>The very first of these limitations, is the fact that our microphone is, in fact, taking discrete samples of the ambient noise surrounding it. This means that, from the very beginning, we are missing some pieces of information and we will never be able to process them. For the purpose of our analysis, we don't need to sample continuosly and this situation is easily bypassed. </p> <p></p> <p>Image credit: NUTAQ - Signal processing</p> <p>Discrete sampling has two main consequences for us: the first one is that we are taking samples once every 1/f_s1/f_s, where f_sf_s is the sampling frequency. Normal audio systems sample at 44,1kHz, but this number might vary depending on the application. If you remember this chart, you might be wondering why we have to sample at such a high frequency. </p> <p></p> <p>Image credit: Signal acquisition - Adinstruments</p> <p>Nyquist sampling criterion states that at a minimum, we have to sample at double the maximum frequency we want to analyse. Since humans hearing has a limited frequency range that goes up to 20kHz in some cases, it is reasonable to use something around 40kHz. With this, the Nyquist criterion solves the so called aliasing problem, in which several sinusoid signals could fit the same sampling pattern if the number of samples is too low:</p> <p></p> <p>Image credit: Wikipedia - Aliasing</p> <p>The second of the discrete sampling limitation comes from the amount of samples we are able to handle at a time. Normally, this is due to memory limitations in the RAM. Nevertheless, it is not useful to handle buffers that are too long, since at some point, the increase of buffer length does not provide any additional information. Buffer length requirements in our case come from the minimum frequency we want to sample, which is around 20Hz. Doing some quick math, we need 0,05s worth of sample buffer, which at 44,1kHz is roughly 2200 samples. This is equally too many samples, considering that each could be allocated as a <code>uint8_t</code>, taking up to 16kB just for the raw buffer!</p> <p>This is where signal windowing kicks in. Imagine that we have a very-low-frequency sinusoid and that we are not able to sample completely the whole sine wave, due to buffer limitations. By definition, our system is assuming that the discrete samples we measure are constantly being repeated in the environment, one after the other:</p> <p></p> <p>Image credit: Smart Citizen</p> <p>When we take the FFT of this signal, we see undesired frequencies that make our frequency spectrum invalid. This is called spectral leakage and it's mitigated by the use of windows (math funcions, not the OS). These windows operate by smoothing the edges of our measurement and preventing the jumps in the signal helping the FFT algorithm to properly analyse the signals.</p> <p></p> <p>Image credit: Smart Citizen</p> <p>With the use of signal windowing, more specifically with the use of the hamming window, we are then able to reduce the amount of samples needed to roughly 1000 samples. Now we are down to 50% of the memory allocation needed without windowing. You can see the effect on the RMS relative errors in the image below, where the trend of the Hann (another common window) and the Hamming treated buffers, with respect to the frequency tends to stabilise much more quickly than the raw buffers.</p> <p></p> <p>Image credit: Smart Citizen</p> <p>There is a wide range of functions to use and the decision depends on your application. For audio applications, the most common ones are the Hann, Hamming, and Blackmann. We chose the Hamming because it's trend is to stabilise a bit more quickly than the rest, although the differencies are minimal. For reference, there is a very interesting description of all these phenomena in this article, where you'll find a more mathematical approach.</p>"},{"location":"Components/sensors/air/Noise/#signal-equalisation","title":"Signal Equalisation","text":"<p>The equalisation process basically tries to correct the microphone response and make it linear. This is because the microphone responds by amplifying some frequencies more than other and we compensate this. To do so, we performed tests in an anechoic chamber and we extracted [this equalisation table](https://github.com/fablabbcn/smartcitizen-kit-21/blob/master/sam/src/SckSoundTables.h#L18-L21. This table matches roughly the response of the microphone, but also some other resonances from the urban board.</p> <p></p> <p>Info</p> <p>This multiplicative factor goes very much in line with the ICS43432 datasheet, although with additional noise components.</p>"},{"location":"Components/sensors/air/Noise/#extra-ball-filtering-and-convolution","title":"Extra ball: Filtering and convolution","text":"<p>What if we don't like the FFT algorithm and we only want to obtain a dBA or dBC results? There is a fairly simple solution to this problem, and it's called filtering.</p> <p>Filtering is a very common technique in signal acquisition that eliminates some frequency components of the raw signal. Examples of filters you very likely have heard of are low-pass, high-pass  and band-pass filters. These only let pass the low, high or a defined interval range of frequencies, mostly cancelling out the rest. In the frequency domain, they basicly multiply the spectrum of our signal with its filter spectrum. Exactly what we have done with the weighting.</p> <p></p> <p>Image credit: Norwegian Creations</p> <p>First, it is important to get a glimpse of the math behind the filters and why they do their magic. And for this, the most important thing we need to know is called convolution.</p> <p></p> <p>Image credit: River Trail</p> <p>For the purpose of audio analysis, let's consider we have an input vector, a filter kernel and an output vector. Our input vector can be the raw audio signal we have captured, being the output signal the result of the convolution operation. The filter kernel is the characteristic of the filter and will be, for this example, a one dimension array. What the convolution operation is going to do, in a very very very simplified way, is to sweep through the input sample and multiply each component with it's corresponding filter kernel component, then sum the results and put them in the corresponding output sample. If we put some math notation and call x[n] to the input vector, h[n] to the filter kernel and y[n] to the output vector, it all ends up looking like this:</p> <p></p> <p>Image credit: DSP Guide</p> <p>Now, the most interesting thing of all this theory is that convolution and multiplication are equivalent operations when we jump from the time to the frequency domain. This means that multiplication in time domain equals to convolution in frequency domain, and more importantly for us, convolution in the time domain, equals to multiplication in the frequency domain. To sum up, the relationship between both domains would look like:</p> <p></p> <p>Image credit: SmartCitizen</p> <p>Therefore, what we could do is to define a custom filter function and apply it via convolution to our input buffer. This is basically a FIR filter, where FIR stands for Finite Impulse Response. There is another type of filters called IIR, where IIR stands for Infinite impulse response. The difference between them is that FIR uses convolution and IIR uses recursion. The concept of recursion is very simple and it's nothing else than a simplification of the convolution, given that in the convolution algorithm, there are many recursive operations that we repeat over an over and we can implement into a smarter algorithm. Normally, IIR filters are more efficient in terms of speed and memory, but we need to specify a series of coefficients, and it's tricky, if not impossible, to create a custom filter response.</p> <p></p> <p>Image credit: DSP Guide</p> <p>So finally! How can we avoid using the FFT algorithm to extract the desired frequency content of a signal and recreate the signal without it? Sounds complex, but now we know that  we can use a FIR filter, with a custom frequency response and apply it via convolution to our input buffer. As simple as that. The custom frequency response, with the proper math, can be optained by applying the IFFT algorithm to the desired frequency response (for example, the A-weighting function). You can have a look to this example if you want to create a custom filter function in octave, with A or C weighting and implement it to a FIR filter in C++.</p> <p></p> <p>Image credit: SmartCitizen</p> <p>Also, if you are really into it, you can read more about convolution and other DSP topics, we would recommended to go through this fantastic guide.</p>"},{"location":"Components/sensors/air/Noise/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Components/sensors/air/PM%20Sensors/","title":"PM Sensors","text":""},{"location":"Components/sensors/air/PM%20Sensors/#working-principle","title":"Working principle","text":"<p>The PM sensors available in the Smart Citizen Kit (one sensor per Kit) and the Smart Citizen Station (two sensors per Station), are the Plantower PMS5003 sensor. The PMS5003 is a nephelometer, and this type of measures suspended particulates by employing a light beam and a light detector set to one side (often 90\u00b0) of the source beam. Particle density is then a function of the light reflected into the detector and the particle mass is a calculation derived from this density, assuming certain properties of the particles, such as shape, color and reflectivity, among others. </p> <p></p> <p>What the sensor does, is to analyse the readings from the sensing element and count how many particles are there, for different particles sizes, or bins. This means that the sensor will group, for instance, the particles that have a diameter between 1um and 2.5um in one bucket, and count them. Once it has the particle number calculated for all the buckets, it estimates the Particle Mass for PM1 (particles with a diameter below 1um), PM2.5 (particles with a diameter below 2.5um) and PM10 (particles with a diameter below 10um). For estimating this, it makes quite a few assumptions (the internal calculations are unknown to us), such as:</p> <ul> <li>Particle shape (normally a sphere, but with some shape factors)</li> <li>Particle color, and hence reflectivity index</li> <li>Particle composition, and hence density</li> </ul> <p>The performance of the sensor</p> <p>We have been part of a study in which we characterised a few low cost sensors. You can check it in here</p>"},{"location":"Components/sensors/air/PM%20Sensors/#sensor-considerations","title":"Sensor considerations","text":"<p>Sources</p> <p>Have a read to the Technical Datasheet </p> <p>These sensors are used in some other projects, such as Purple Air and have been evaluated in laboratory by the Finnish Meteorological Institute - FMI and in outdoor conditions the South Coast AQMD (Air Quality Management District), USA. The study by the FMI did not yield good results for this sensor (specially in PM10), but given the cost we still think is a good citizen awareness sensor and that can be used for certain studies. The AQMD study shows better results for PM10 and PM2.5 with high correlation results with respect to reference equipment (R2 &gt; 0.9 in most cases), although we are not aware of actual testing conditions, or the reference equipment calibration. Other authors also show good results and recommend the usage of these sensors, although in some measurement conditions (like specific types of particles) they perform better, which makes sense given the assumptions mentioned above (read the academic article here). Similar sensors are used in the Luftdaten project (with a SDS011 in this case).</p> <p>Relative humidity affects this type of sensor, since particles can absorb water and grow in size, hence modifying the fractions and the calculated mass. Additionally, particle's chemistry can affect these assumed properties, and these assumptions may not be usable in every type of environment. However, a relative humidity correction is being tested, correcting size distribution based on particle higroscopicity.</p> <p>Dusty environments</p> <p>The sensor might get clogged in a very dusty environment (like a workshop) and might need some periodic cleaning. It is safe to use a vaccum cleaner to do so, but be careful not to damage the light sensor, the laser emitter or the fan during the process.</p>"},{"location":"Components/sensors/air/PM%20Sensors/#sensor-operation","title":"Sensor operation","text":"<p>The sensor is operated in a one-shot mode: turning on for 15s the sensor, everytime a reading is needed. This is done this way in order to save battery. </p> <p>About one-shot mode</p> <p>An study of this was carried out to validate the measurements and can be found here</p> <p>From the long term deployment point of view, the one-shot mode has not been found to have any effect of this in the performance of the sensor, other than normal accumulation of dust in the inner channels of the PMS. This has been seen in continuous mode as well, and it\u2019s probably more due to the construction of the sensor itself.</p> <p>Working in pairs</p> <p>In the Smart Citizen Station, the particle sensors measurements are delivered as averages of the two sensors with periodic validity checks. Please make sure the sensor has reliable energy supply if you will use these sensors permanently.</p>"},{"location":"Components/sensors/air/PM%20Sensors/#powering-the-sensor","title":"Powering the sensor","text":"<p>Make sure that you power the Smart Citizen Kit with a good enough USB cable and with an adaptor that can provide at least 1A. We have found some issues when powering the sensor with a thin cable, or from a weak power source, like a screen.</p>"},{"location":"Components/sensors/air/SGX%20MICS/","title":"About CO-NO2 Metal Oxide Sensors","text":"<p>The SGX Mics is a Metal Oxide Resistive sensor capable of reacting to different substances in the atmosphere. In a simplified way, it is comprised of two main elements:</p> <ul> <li>A SnO2 substrate that acts as a sensor element</li> <li>A heater element to keep the substrate in an optimal working area</li> </ul> <p>The SnO2 is a chemically sensitive metal oxide which has interactions with molecules to be detected in the target gas. The reactions that can occur on SnO2 surface are adsorption and catalytic reactions, which basically mean that the gas molecules can be adsorbed onto the surface or can catalyse reactions (trigger or enhance them). They take place at the so called active sites or grain boundaries, which are areas where the grains that constitute the sensor resistance are in contact with the air (e.g. with metallic contacts). Hence, metal oxide substrate is basically a collection of sites at which different molecules can be absorbed and therefore interact in various manners with the species present in the atmosphere: either through catalytic reaction, surface reaction, grain boundary reaction (among others). 2.</p> <p>The sensor element is typically heated to a few hundred degrees (\u00baC) using a small resistive heater. The regions within the sensor can be described as in Peterson et al. 1: the surface, which interacts with the gas, the bulk, which is unaffected by it, and the particle boundary, which lies in between these two. The particle boundary is situated at a distance from any material exposed to the atmosphere into the sensor that chemical electrostatic effects can propagate (the so called Debye length), and this is related to the material\u2019s physical properties. At high temperatures, oxygen atoms bond onto the boundary, extracting electrons in the process from the semiconductor\u2019s surface region. The oxygen either then directly reacts with ambient gases, or these gases also bond onto the sensor, which causes more charge carriers to be withdrawn or injected into the surface region. All these effects change the sensor resistance and it is measured accordingly in 1:</p> <p>In the case of the SGX 4514, the detection of the pollution gases is achieved by measuring the sensing resistance of both sensors. In a generic way, we could characterise the sensor resistance as follows:</p> <ul> <li>RED sensor resistance decreases in the presence of CO and hydrocarbons. </li> <li>OX sensor resistance increases in the presence of NO2.</li> </ul> <p>Finally, the chemical reactions within the resistive element are directly related to temperature and follow an Arrhenius equation type of behaviour. Each sensor's type has a different optimal operation temperature, which is translated into different heating powers for the heater element. Depending on the heating power and transition speeds, different reactions can be facilitated and this can lead to positive effects such as sensor clean up or battery compsuption savings, for example, when heated up in a pulsed profile. On the other hand, it can facilitate sensor poisoning or ageing, which highlights the need of proper sensor characterisation.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#sensor-calibration","title":"Sensor Calibration","text":"<p>The SGX4514 is a low cost sensor originally ment to detect instances or trends of target gas in the atmosphere 45. The applications intended for these sensors are \u2018event sensing\u2018 applications and the level of accuracy required is not necessarily within regulatory standards. Furthermore, these sensors should not be used with safety related issues.</p> <p>However, despite the low cost nature of these sensors, they have been subject of a great deal of research 123 and have been reported to give considerably good results in field applications. Before delving into the details of sensor calibration, we will try to understand what these sensors are and how they should be handled. Some important definitions are:</p> <ul> <li>Sensor baseline resistance: is the resistance that the sensor exhibits when it's not powered</li> <li>Sensor sensitivity: is the resistance variation with variations in the target gas</li> <li>Sensor cross-sensitivity: is the resistance variation with variations of gases other than the target gas</li> <li>Sensor poisoning: an irreversible resistance variation provoked by the reaction of gases other than the target gas</li> </ul> <p> Source: Peterson et al. 1</p> <p>Peterson et al. 1 describes the various types of interactions between atmospheric gases and a MOS sensor surface. In the image above, the leftmost region describes the unpowered behaviour, or base resistance. The three other regions of the diagram describe different processes that actually occur simultaneously to varying degrees. The sensor\u2019s output is the resistance across the whole of the sensor material, which forms a resistor network with contributions from both the bulk and surface regions. The model described in 1 also explains the wide variation in base resistance between individual sensors of the same type, as the random nature of the surface geometry means an equally random network of resistances. This diagram is a two-dimensional representation of a three-dimensional material; in an actual sensor, the sensitive region is spread into the surface with a distance dependent on the grain size and arrangement resulting from the sintering.</p> <p>Each sensor will then have a different resistance in air and how much this baseline resistance changes with the concentration of the target gas will also differ (what we defined above as sensitivity). Therefore to convert from resistance readings to concentration it is necessary to derive a calibration curve for each sensor. This will require measuring the resistances in air and at a number of gas concentrations over the desired range. It is important that the concentrations are in a background of air as Oxygen is needed for the sensor to work correctly. As stated in 2, the sensor\u2019s response is only partially a function of the amount of gas to which the surface is exposed. Instead, the sensor will have a baseline resistance that is related to the bulk and particle boundary resistance. Because of the random geometry of the granular sensor surface, the baseline resistance will vary between individual sensors.</p> <p>The change in resistance with the change in gas concentration is generally not a linear response. The response can be measured and fitted to a polynomial relationship, with interactions from other metrics such as temperature, humidity and other gases. It has been proved that air flow around the sensor yields better sensor reactivity, and that the usage of PTFE filters also helps reducing cross-sensitivity and sensor poisoning. An important practical consideration with any in situ air quality sensor design is ensuring adequate flow of sampling air through the device. Stale air inside a casing will produce unrepresentative results, and even sensors mounted outside a casing might not get a properly-mixed sample.</p> <p> Source: Peterson et al. 1</p> <p>Although the deployment of multiple different sensors can compensate for the cross-sensitivity issues in calibration, it cannot eliminate it. MOS sensors can thus be used only in situations where any interfering species can either be measured by other means, or they must be calibrated regularly and used in locations where the background varies in concentration slowly compared with the target gases. As well, the sensor drift over time is an important issue that requires sensor recalibration over time.</p> <p>There are two major factors in the longevity of a sensor\u2019s calibration. The first is the natural degradation of the heater element, which becomes hotter over prolonged use and causes the sensor\u2019s response profile to vary. The second is the effect of slowly-varying interfering gases, which over the course of months shifts the sensor\u2019s baseline. The first problem may have an engineering solution, but the second will involve taking the results of the tests in an artificial atmosphere, identifying the most critical species and either measuring or possibly modelling their likely concentrations during deployments.</p> <p>An analytical approach to counteracting this drift might be \"merging calibrations\", where a sensor is calibrated at the start and end of a four-month campaign, and the coefficients gradually change from one end of the experiment run to the other. </p> <p>Having all this in mind, the sensor calibration we follow is comprised of the following steps:</p> <ul> <li>Sensor behaviour characterisation under different temperature profiles</li> <li>Sensor baseline and sensitivity characterisation in controlled conditions</li> <li>Sensor deployment with reference measurements collocation and model calibration</li> </ul> <p>The use of deployment campaigns is of utmost importance in order to develop sensor models that are reality proof. With the possibility of collecting the data with the SmartCitizen Platform and the data treatment provided by the Sensor Calibration Framework, we are able to iterate over the different sensor calibration possibilities, ranging from Ordinary Linear Regression or more advanced techniques such as ML models such as LSTMs networks.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#field-results","title":"Field results","text":"<p>In this section, we will detail some of the MOS related results obtained during the sensor validation campaigns detailed below:</p> <ul> <li>University of Bologna: data collected from 23/January to 13/February. The measured pollutants with reference equipments were CO, NO2, NO, NOx and O3. Two prototype Smart Citizen Stations were deployed in two different sites, with two Smart Citizen Kits.</li> <li>University College Dublin: data collected from 27/March to 17/April. The measured pollutants with reference equipments were NO, NO2 and NOX. One prototype Smart Citizen Station was deployed with two Smart Citizen Kits</li> </ul> <p>For both results shown below, we used an LSTM with 200 epochs training and the following structure:</p> <pre><code>from keras.models import Sequential\nfrom keras.layers import Dense, Activation, LSTM, Dropout\n\nmodel = Sequential()\nlayers = [50, 100, 1]\nmodel.add(LSTM(layers[0], return_sequences=True, input_shape=(train_X.shape[1], train_X.shape[2])))\nmodel.add(Dropout(0.2))\nmodel.add(LSTM(layers[1], return_sequences=False))\nmodel.add(Dropout(0.2))\nmodel.add(Dense(output_dim=layers[2]))\nmodel.add(Activation(\"linear\"))\nmodel.compile(loss='mse', optimizer='rmsprop')\n</code></pre>"},{"location":"Components/sensors/air/SGX%20MICS/#carbon-monoxide","title":"Carbon Monoxide","text":"<p>The CO model included the following features: CO_{R}^{-1}, CO_R^{-2}CO_R^{-2}, TempTemp and Temperature^2Temperature^2. The results can be seen below:</p> <p></p>"},{"location":"Components/sensors/air/SGX%20MICS/#nitrogen-dioxide","title":"Nitrogen Dioxide","text":"<p>The NO2 model included the following features: NO~2~_{R}NO~2~_{R}, NO~2~_R^{-2}NO~2~_R^{-2}, Light, TempTemp and Temperature^2Temperature^2. The results can be seen below:</p> <p></p> <p>Warning</p> <p>This test campaign contains a short amount of data to be used as a training dataset for a LSTM algorithm. Therefore, this is just to considered as an use case example and further tests and data should be carried out to train broader models.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#metal-oxide-sensors-implementation","title":"Metal Oxide Sensors Implementation","text":""},{"location":"Components/sensors/air/SGX%20MICS/#heating-stage","title":"Heating stage","text":"<p>The solution present at Urban Sensor Board V2.0 for MICS-4514 sensor's heaters excitation, pretends to make it compatible with a 3.3V global voltage source.</p> <p></p> <p></p> <p>The manufacturer reccomend the following circuit topology, with a global supply voltage of 5V. In the datasheet are collected the electrical nominal conditions for that resistors, in order to operate safely with the heater, without damaging it.</p> <p>Besides that, several other possible conditions could also damage early the heater resistors, like the fact of consider a pure PWM signal, with source 5V and subsequent dutty cycle, as excitation. Even if the frequency is relatively high (100kHz), the resistors are forced to operate briefly with 5V, and this accelerates the destruction of this part of the MICS sensor.</p> <p>So its is possible to provide the nominal voltages for heater resistors from a 3.3V source, if we replace the auxiliar resistors (from recomended topology) with corresponding values, to preserve the total power dissipated and current at same normal operating conditions.</p> <p>Even more, we can upgrade the function of the auxiliar resistors adding a capacitor to form a passive RC filter. In the DC or continuous operation, the capacitor is fully charged and the current is limited by the auxiliar resistor. In AC or pulsed operation, the capacitor can be selected to remove this AC component, and feed the heater resistor with a nearly constant voltage or at least with small variations (&lt;1%).</p> <p>The source for the PWM signal must be buffered, because the resistive load of the system demands currents avobe the SAMD21 can supply. For this purpose, the solution selected is to use a digital hex-inverter buffer, which can drive up to 32mA with each output pin, wich we can paralelize to operate under propper safety factor for the buffer.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#simulations","title":"Simulations","text":"<p>The first simulations and given values leads to the selection of the RC components values if we set a PWM frequency around 40 kHz.</p> <p></p> <p></p> <p></p> <p>To evaluate the R part of the filter, is needed to take into account the output resistance of the hex-inverter buffer.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#prototypes","title":"Prototypes","text":"<p>We build the circuit into a protoboard, with several IC HEX-INV manufacturers, based on the following schematic:</p> <p></p> <p></p> <p>The measures are sumarized in the following table, in which we compare four pre-selected devices, which can fit in our application for size an price considerations.</p> <p></p> <p>Four cases with paralellized inverters, for each device were performed: pasive load 70R test with DC input, and three tests with 10R+Rheater load at DC input, 60% dutty cycle and 30% dutty cycle. The 74LCX04FT(AE) was selected because it has the lowest LOW output level (0.45V,0.22V), which is considered here as the quality (or close to ideal) of the square wave input source.</p>"},{"location":"Components/sensors/air/SGX%20MICS/#final-implementation","title":"Final implementation","text":"<p>The solution implemented in the PCB, has a constant auxilar R (10R+Rout_buff), and constant C (47uF), and also operates at consatant frequency, then, the output power regulation is based on the PWM's dutty cycle. The following circuit represent the implemented schematic.</p> <p></p>"},{"location":"Components/sensors/air/SGX%20MICS/#operation","title":"Operation","text":"<p>First of all, is needed to know the real implemented Rheater of each sensor (which may vary among devices and time), and can be estimated by measuring the V_heater_* at 100% dutty cycle, then:</p> <p></p> <p>Where Rint_buff can be aproximated with 4 Ohm resistor.</p> <p>The desired_reference_voltage is function of the desired_power_Rheater and dutty cycle. If we set 80mW we can use the value of the Rheater to obtain desired_reference_voltage through tis formula:</p> <p></p> <p>(Take into account this resistor has a drift over time, therefore is recomended to take periodic measurements of the value of Rheater itself, and check the output power reachability).</p> <p>With selected parameters, after 2ms of PWM operation, the RC reaches the permanent, and then is recomended to take measurements of V_HEATER_. The loop can be closed to determine the dutty cycle as function of the difference (desired_reference_voltage \u2013 V_HEATER_ (averaged)).</p> <p>Is recomended to average several samples to remove the AC part of the signal. The measured DC signal has a noise of \u00b120mV peak to peak (with triangular distribution).</p> <p>The sign of the PWM signal is inverted due to the action of the inverter, then, a desired x% dutty is obtained as 100%-x%.</p> <p></p> <p>As initial PWM aproximation to begin to converge close to the regulated dutty cycle can be obtained through this simplification:</p> <p></p> <p></p>"},{"location":"Components/sensors/air/SGX%20MICS/#references","title":"References","text":"<ol> <li> <p>Practical Use of Metal Oxide Semiconductor Gas Sensors for Measuring Nitrogen Dioxide and Ozone in Urban Environments \u21a9\u21a9\u21a9\u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>Modelling Of Water Adsorption On SnO2 Surface \u21a9\u21a9\u21a9</p> </li> <li> <p>MICS-4514 Datasheet \u21a9</p> </li> <li> <p>Frequently-Asked-Questions-for-MiCS-Gas-Sensors \u21a9</p> </li> <li> <p>SGX Metal Oxide Gas Sensors - How to use and how they perform \u21a9</p> </li> <li> <p>Sensors 2017, 17, 1653 \u21a9</p> </li> </ol>"},{"location":"Components/sensors/soil/Soil%20Moisture%20Sensors/","title":"Soil Moisture Sensor","text":"<p>The Chirp Sensor is a low cost moisture and temperature sensor developed by WeMakeThings: a hackers and engineers collective based in Vilnius, Lithuania. Their hardware and software are fully open-source, and it can be easily integrated but also replicated and customized for new projects. </p> <p></p> <p>The sensor uses capacitive sensing to measure soil's moisture. A 1MHz square wave is output from the chip through a resistor into a big pad that, together with the surrounding ground plane, it forms a parasitic capacitor. The resistor and the capacitor create a low pass filter which cut-off frequency changes with changing capacitance. The soil around the sensor acts as an electrolyte whose dielectric constant changes depending on the amount of moisture in it, so the capacitance of our makeshift capacitor changes too. The filtered square wave is then fed into a peak detector formed of out a diode and a capacitor. An ADC measures this voltage in the microcontroller. The sensor also includes a temperature sensor with a calculated absolute measurement accuracy around 2%.</p> <p>There are different versions of the Chirp sensor, and for this application we chose the Chirp I2C sensor. The sensor was integrated on to the SCK's firmware, and it is automatically recognized by the board once it is plugged into the SCK using the Aux sensor connector. A Grove 4 pin Female Jumper to Grove will need to be used with the sensor to connect it to the SCK. The original Chirp sensors come coated with PRF202 - a moisture resistant varnish for electronics, but it is not enough for actual deployment. For such, one must add additional protection to the whole sensor. We suggest polyester or epoxy resin. However, you must note that sensitivity of the sensor will decrease depending on how thick the layer you are going to apply and might need to be recalibrated. We also recommend covering the electronics with heat shrink to fully waterproof the sensor. Some versions already include a pre-ruggedized sensor, which is a recommended solution for a faster use.</p> <p></p>"},{"location":"Components/sensors/soil/Soil%20Moisture%20Sensors/#sensor-validation","title":"Sensor validation","text":"<p>Three Chirp sensors were compared to the Parrot Flower Power (now discontinued). The Flower Power can measure several metrics, such as light, temperature, fertilizer and soil moisture. In this test, we compared the soil moisture readings for three Flower Parrot sensors, compared to three Chirp sensors. Both sensors show a good behaviour and the values can be correlated with good R2 scores. The approach for this low-cost sensors, in general, should be more qualitative than quantitative (analyse the trends rather than the absolute values), since their values appear to differ between sensors, even when normalised. In the particular case of the Chirp sensor, the sensor seems to be fairly normalised with simply a two calibration values (water and air) as a first approach.</p> <p></p>"},{"location":"Components/sensors/soil/Tensiometer/","title":"Tensiometer","text":"<p>WIP</p> <p>This version is a WIP but is not fully functional with the SCK 2.1. It is shown here as a showcase of the project's capabilities. Have a look at the forum or drop us an email to discuss this. Check the source files.</p> <p>Soil Moisture data as the one provided by the Chirp Moisture Sensor is interesting for research, but when it comes to crops irrigation management, we usually like to know the soil water tension (SWT). That is because Soil Moisture in water is not directly related to the water plants roots might be able to extract because it is deeply affected by the soil composition. Even soil irrigation can be inferred from soil moisture when the soil type is known we think a soil tensiometer. Also when it is a simple solution, it is a useful tool for crops management.</p> <p></p> <p>The design is entirely open source and it is deeply inspired by the work of Reinier Van der Lee from the Vinduino project, using an already calibrated commercial probe like the Watermark 200SS9. The sensor itself is straightforward and it consists of two stainless steel screws that work as electrodes cast inside a piece of plaster and covered by a plastic mesh to prevent erosion. As water is added more electrons can pass between the electrodes of the probe reducing the amount of resistance between them. By using this range of values, you can determine the amount of water that exists in your soil. To avoid interferences and degradation of the electrodes the design only applies voltage for a very short time and uses alternating electric polarities. For the sensor to work, we need a minimal circuit that uses two resistors and two diodes. The resistors work together with the electrodes to build a voltage divider. We can calculate the resistance value between the two electrodes by knowing the value of the resistors and the voltage. However to be able to alternate the electric current we need to duplicate the circuit and add two diodes. In total, we need 4 Pins to be connected to a microcontroller like the Arduino or the Smart Citizen Kit.</p>"},{"location":"Data/Data%20Analysis/","title":"Sensor Analysis Framework","text":"<p>When dealing with sensor data, specially with low cost sensors, a great part of the effort needs to be dedicated to data analysis. After a careful data collection, this stage of our experiments is fundamental to extract meaningful conclusions and prepare reports from them. For this reason, we have developed a data analysis framework that we call the Sensor Analysis Framework. In this section, we will detail how this framework is built, how to install it, and make most use of it.</p> <p></p>"},{"location":"Data/Data%20Analysis/#we-care-for-open-science","title":"We care for open science","text":"<p>The framework is written in Python, and can be easily installed on any computer with simple <code>pip install scdata</code>. It is intended to provide an state-of-the art data analysis environment, adapted for the uses within the Smart Citizen Project, but that can be easily expanded for other use cases. The ultimate purpose of the framework is to allow for reproducible research by providing a set of tools that can be replicable, and expandable among researchers and users alike, contributing to FAIR data principles. </p> <p>By SangyaPundir - Own work, CC BY-SA 4.0</p> <p>Raw and processed data</p> <p>All the raw sensor data from the devices is sent to the Platform and processed outside of the sensors. Raw data is never deleted, and the postprocessing of it can be traced back to it's origin by using the sensor blueprint information. This way, we guarantee openness and accesibility of the data for research purposes.</p> <p>Check this guide to learn more about how we postprocess the data of the sensors and how to make it your own way.</p> <p>The framework integrates with the Smart Citizen API and helps with the analysis of large amounts of data in an efficient way. It also integrates functionality to generate reports in html or pdf format, and to publish datasets and documents to Zenodo.</p> <p>More familiar with R?</p> <p>R users won't be left stranded. RPY2 provides functionality to send data from python to R quite easily.</p> <p>Check the source code</p>"},{"location":"Data/Data%20Analysis/#how-we-use-it","title":"How we use it","text":"<p>The main purpose of the framework is to make our lives easier when dealing with various sources of data. Let's see different use cases:</p> <p>Get sensor data and visualise it</p> <p>This is probably the most common use case: exploring data in a visual way. The framework allows downloading data from the Smart Citizen API or other sources, as well as to load local csv files. Then, different data explorations options are readily available, and not limited to them due to the great visualisation tools in python. Finally, you can generate html, or pdf reports for sharing the results.</p> <p></p> <p>Examples</p> <p>Check the examples in the Github Repository</p> <p>Organise your data</p> <p>Handling a lot of different sensors can be at times difficult to organise and have traceability. For this, we created the concept of test, which groups a set of devices, potentially from various sources. This is convenient since metadata can be addeed to the test instance describing, for instance, what was done, the calibration data for the device, necessary preprocessing for the data, etc. This test can be later loaded in a separate analysis session, modified or expanded, keeping all the data findable.</p> <p></p> <p>Some example metadata that can be stored would be:</p> <ul> <li>Test Location, date and author</li> <li>Kit type and reference</li> <li>Sensor calibration data or reference</li> <li>Availability of reference equipment measurement and type</li> </ul> <p>Check the guide</p> <p>Check the guide on how to organise sensor data</p> <p>Clean sensor data</p> <p>Sensor data never comes clean and tidy in the real world. For this reason, data can be cleaned with simple, and not that simple algorithms for later processing. Several functions are already implemented (filtering with convolution, Kalman filters, anomaly detection, ...), and more can be implemented in the source files.</p> <p></p> <p>Model sensor data</p> <p>Low cost sensor data needs calibration, with more or less complex regression algorithms. This can be done at times with a simple linear regression, but it is not the only case. Sensors generally present non-linearities, and linear models might not be the bests at handling the data robustly. For this, a set of models ir rightly implemented, using the power of common statistics and machine learning frameworks such as sci-kit learn, tensorflow, keras, and stats models.</p> <p></p> <p>Guidelines on sensor development</p> <p>Check our guidelines on sensor deployment to see why this is important in some cases.</p> <p>Batch analysis</p> <p>Automatisation of all this tools can be very handy at times, since we want to spend less time programming analysis tools than actually doing analysis. Tasks can be programmed in batch to be processed automatically by the framework in an autonomous way. For instance, some interesting use cases of this could be:</p> <ul> <li>Downloading data from many devices, do something (clean it) and export it to .csv</li> <li>Downloading data and generate plots, extract metrics and generate reports for many devices</li> <li>Testing calibration models with different hyperparameters, modeling approaches and datasets</li> </ul> <p></p> <p>Share data</p> <p>One important aspect of our research is to share the data so that others can work on it, and build on top of our results, validate the conclusions or simply disseminate the work done. For this, integration with zenodo is provided to share datasets and reports:</p> <p></p> <p>Have a look at the features within the framework: </p> <ul> <li>Tools to retrieve data from the Smart Citizen's API or to load them from local sources (in csv format, compatible with the SCK SD card data)</li> <li>A data handling framework based on the well known Pandas package</li> <li>An exploratory data analysis tools to study sensor behaviour and correlations with different types of plots</li> <li>A sensor model calibration toolset with classical statistical methods such as linear regression, ARIMA, SARIMA-X, as well as more modern Machine Learning techniques with the use of LSTM networks, RF (Random Forest), SVR (Support Vector Regression) models for sequential data prediction and forecasting</li> <li>Methods to statistically validate and study the performance of these models, export and store them</li> <li>As a bonus, an interface to convert the python objects into the statistical analysis language R</li> </ul> <p>Info</p> <p>Check the guide on how to set it up here</p>"},{"location":"Data/Data%20Analysis/#source-files","title":"Source files","text":"<p>Download</p> <p>Check the source code</p>"},{"location":"Data/Low%20Cost%20Sensors%20Calibration/","title":"Low Cost Sensors Calibration","text":"<p>Low cost sensor calibration and assessment poses a great challenge for data quality objectives. We follow this sensor calibration procedure, which can be split into three stages:</p> <p></p> <ol> <li> <p>Behaviour assesment: in laboratory conditions, serving as base testing for assessing general sensor behaviour.</p> </li> <li> <p>Characterisation: also in laboratory conditions, assess generic sensor parameters as sensitivity, zero and span.</p> </li> <li> <p>Modelisation with real world deployment: including other variables such as environmental factors and sensor cross-sensitivity.</p> </li> </ol> <p>Each of these stages apply differently depending on the type of sensor. For instance the electrochemical sensors present in the Station are already characterised by the manufacturer, while the old SGX MICS4514 Metal Oxyde Sensors in the Urban Board of the Smart Citizen Kit are not. The different characteristics of these sensors make different calibration approaches to be carried out.</p> <p>Base calibration parameters need to be determined in controlled conditions. In this stage, the aim would be to find parameters such as:</p> <p></p> <ul> <li>Sensor sensitivity: the sensor response per each ppm of target pollutant in nominal conditions</li> <li>Zero: the sensor reading in zero air (pure air at 25degC).</li> <li>Sensor response (t90)</li> <li>Sensor range: maximum and minimum readings for the sensor</li> </ul> <p>Finally, after this initial calibration assessment, it is critical to gather as much data as possible from long term sensor deployments. These deployments should aim to cover the widest range of sensor exposure conditions, in order to generate robust models. While dealing with low cost sensors this stage is very important, as it is detailed in the sections below.</p> <p>These sensor deployments serve for two main purposes: to generate quantitative classification methods that can classify the air quality in predefined ranges (i.e. 'poor', 'fair', good'); and to generate predictive qualitative models for more accurate values. Either of them need large amounts of data if the models are aimed to be representative. Additionally, by the mere nature of the data and the sensors themselves, these models would need to be:</p> <ul> <li>Robusts to noise</li> <li>Capable of learning non-linear relationships</li> <li>Handle multivariate inputs</li> <li>Capable of learning temporal dependence</li> </ul> <p>These needs make machine learning methods great canditates for modeling the data. These methods are implemented in the Sensor Analysis Framework, as well as other more traditional linear methods. The combination of these algorithms with large amounts of data gathered during, for instance, the iScape project, offers a great opportunity to demonstrate the use of low cost sensors for air quality monitoring.</p>"},{"location":"Data/Low%20Cost%20Sensors%20Calibration/#smart-citizen-kits","title":"Smart Citizen Kits","text":"<p>Due to their construction, low-cost metal oxyde sensors suffer from high levels of spread in their baseline resistance and sensitivity. As well, these sensors are generally reactive to other pollutants in the atmosphere, with a low selectivity of the actual target pollutant and drifts in their behaviour can be seen after some weeks of exposure. As well, metal oxyde sensors show short and long term drifts in their calibrations. </p> <p></p> <p>Ideally, a sensor characterisation in laboratory conditions is needed to assess sensitiviy, baseline resistances sensor-to-sensor spread, aiming to obtain normalising factors for each sensor or group of sensors. Even if possible, the variability of the sensor behaviour during the deployment stage, makes the individual characterisation and calibration of the Metal Oxyde sensors unrealistic. For this reason, indicative measurements are to be expected from this type of low cost sensors. More information about the sensors present in the urban board of the SCK can be found in this section.</p>"},{"location":"Data/Low%20Cost%20Sensors%20Calibration/#smart-citizen-stations","title":"Smart Citizen Stations","text":"<p>Electrochemical sensors </p> <p>These sensors can achieve significant accuracy, but they require a particular data post-processing that combines the measurement at the sensor electrodes with the sensor characterisation on the factory as well as other environmental parameters as air temperature and relative humidity (i.e. absolute humidity). Luckily the manufacturer of these sensors, Alphasense, provides us with that reference data. However, the complexity of the operations performed can not be done inside the sensing device as it uses advanced operations as well as historical data from the same device. For that reason, the data needs to be post processed using the Sensors Analysis Framework. The algorithm is in a beta stage and later it will be applied automatically on the data once it arrives at the platform. More details can be found in the Electrochemical sensor baseline methodology Section.</p> <p></p> <p>This process doesn't require any on-site reference data but requires the data to be processed using the manufacturer calibration reference per sensor as well as other environmental values as temperature and humidity.</p> <p>PM sensor</p> <p>The selected PM sensor is internally characterised by the manufacturer and, it's readings are currently being evaluated. Preliminarily, the measurements can be as well improved when reference data is available, as some have noted that the PM sensors can be affected by relative humidity. </p> <p>Plantower PMS 5003</p> <p>Read more on the Plantower PMS 5003 implementation on the PM Sensor Board.</p>"},{"location":"Data/Sensor%20Platform/","title":"Sensor Platform","text":"<p>The platform is a front and backend solution for ingesting, storing and interacting with public data with a particular focus on crowd sensing applications.</p> <p></p> <p>We believe building modular and reusable software and using existing platforms is critical towards optimizing the research and development effort.</p> <p></p> <p>Are all systems operational?</p> <p>Check the smartcitizen.me instance status in real time in the uptimerobot.com dashboard.</p> <p>Check the guides</p> <p>We prepared a series of guides to help you on the most common features you will use</p> <ul> <li>Onboarding Sensors</li> <li>Uploading SD Card Data</li> <li>Downloading data</li> </ul> <p>Want to learn more?</p> <p>Check the developers ready API Documentation</p>"},{"location":"Data/Sensor%20Platform/#software-components","title":"Software components","text":"<ul> <li> <p>Smart Citizen Website: It aims to provide a visual website where the project environmental sensors can be accessed in near real time to facilitate the exploration of data with other contextual data (maps, keywords) and processed reports. This is especially important towards citizens engaging at each local site having a sense of ownership over a technology intervention has been associated with sustained community engagement (Balestrini et al. 2014). The main instance its available at smartcitizen.me/kits. You can explore and contribute to the source. This is free software available under GNU Affero General Public License (AGPL).</p> </li> <li> <p>Smart Citizen API: The platform provides a REST interface for all the functionalities available on the Website. That allows applications to be developed on easily on top having access to all the features to create complex and rich tools. The main instance its available at api.smartcitizen.me. You can explore and contribute to the source. One examples of this tools is the Sensors Analysis Framework or the iSCAPE Virtual Living Lab, both developed during the iSCAPE project) This is free software available under GNU Affero General Public License (AGPL).</p> </li> <li> <p>Onboarding app: It aims to facilitate the process of sensor setup to ensure that users, irrespective of technical expertise, can install the sensors. It guides the user through the process of the setup using simple language and a friendly graphic language. It is built as a separate tool from the core Smart Citizen Webpage in order it can be customized for each deployment. It exchange data with the core platform using the Smart Citizen API. The main instance its available at start.smartcitizen.me. There are also customized instances for specific projects such us onboarding.iscape.smartcitizen.me or start.decode.smartcitizen.me. You can explore and contribute to the source. This is free software available under a MIT License.</p> </li> </ul>"},{"location":"Data/Sensor%20Platform/#source-files","title":"Source files","text":"<p>Check the source code</p>"},{"location":"Data/Smart%20Citizen%20API/","title":"Smart Citizen API","text":"<p>The cloud-based data engine supporting: data ingestion, aggregation and retrieving. It is entirely independent of any web front-end exposing all the functionalities over a clear REST API. That allows applications to be developed on easily on top having access to all the features to create complex and rich tools. The main instance its available at api.smartcitizen.me. You can explore and contribute to the source. One examples of this tools is the Sensors Analysis Framework or the iSCAPE Virtual Living Lab, both developed during the iSCAPE project) This is free software available under GNU Affero General Public License (AGPL).</p> <p>TL;DR</p> <p>Check the developers ready API Documentation</p>"},{"location":"Data/Smart%20Citizen%20API/#data-ingestion-flow","title":"Data Ingestion Flow","text":"<p>The Platform supports multiple sensor types and even data coming from other platforms. On the following section, we describe all the features supported when it comes to sending data to the platform.</p>"},{"location":"Data/Smart%20Citizen%20API/#ingestion-protocols","title":"Ingestion protocols","text":"<p>Two protocols are supported for data to be sent to the platform: MQTT and HTTP</p> <ul> <li>MQTT is the one used by constrained devices as the Citizen Sensors and the Living Lab Stations. It allows the devices to post data to the platform after they are registered. It also allows them to receive configuration options (i.e. sensors reading interval) and report errors (i.e. sensors are malfunctioning).</li> <li>HTTP is aimed at applications publishing data to the platform (i.e. an existing sensors platform that also wants to make all the data available to the platform). This API gives access to all the platform functionalities as it is part of the core Smart Citizen API. Over this API we are not just limited to publish data but to register new devices or even users.</li> </ul> <p>oth protocols support transport encryption with TLS to ensure secure communication between the client and the server over the Internet.</p>"},{"location":"Data/Smart%20Citizen%20API/#authorisation-and-authentication","title":"Authorisation and authentication","text":"<p>Knowing who posts what is a serious problem when it comes to hundreds of sensor data being published per minute. Constrained hardware devices using the MQTT API use a unique device token given to the device every time is registered on the platform. The token authenticates the devices against the platform, and it can be expired at any time to prevent a device to keep publishing. Instead, the HTTP API supports authentication using an OAuth2 or a private token. Both mechanisms work at a user level allowing a single process to manage all the devices created by a user.</p>"},{"location":"Data/Smart%20Citizen%20API/#kits-blueprints","title":"Kits blueprints","text":"<p>Each device sensors configuration needs to be previously registered on the platform to ensure each datapoint published is associated with the required metadata. This information is called a Kit blueprint. The minimal blueprint includes all the necessary data that a user might provide to create a Kit. It is composed of Components, and those can reuse existing Sensors and Measurements. Sensors are the hardware or software components that record the data. Measurements are descriptions of what the sensors are recording.</p>"},{"location":"Data/Smart%20Citizen%20API/#data-storage","title":"Data Storage","text":"<p>Once the steps above are completed data is stored in a database cluster performing asynchronous masterless replication to ensure data backup and availability. Each datapoint is stored with the following items:</p> <ul> <li>Component: A reference to the component type that generated the datapoint.</li> <li>Device: A reference to the device that generated the datapoint.</li> <li>Raw Data: The datapoint as received to the platform</li> <li>Processed Data: The datapoint after applying post processing, when implemented.</li> <li>Timestamp: The time the datapoint was generated. Once stored historical data available via the Smart Citizen API. All the other services, as the Smart Citizen Webpage, access the data from there. The API also exposes a method where data is processed to a CSV file and email to the user. That allows loading the data offline to any software capable of dealing with CSV files (i.e. Microsoft Excel, MATLAB, etc.)</li> </ul>"},{"location":"Guides/","title":"A modular tool for citizen action","text":"<p>The guides in this section are aimed at creating a set of tools and resources around the SCK. This allows communities to develop their own sensing frameworks and strategies for participatory sensing. Find here guides that will help with making the best use of the Smart Citizen Kit, from a step-by-step guide on how to set up your kit to more advanced features like data analysis or using the SCK's shell.</p> <p></p>"},{"location":"Guides/#how-to-get-around-in-the-guides","title":"How to get around in the guides?","text":"<p>The guides here are meant to help you with many aspects regarding the sensors and getting specific step-by-step information. Since there are a lot of different guides, here there is a small summary for each type of device:</p> <p>What are the differences between the sensor units?</p> <p>The hardware, being designed in a modular way, allows for a lot of customisation. We call Smart Citizen Kit  to the different variants of devices that have a Data Board, an Urban Board and a PMS5003 Particulate matter sensor. Adding any additional sensor to the Smart Citizen Kit, with or without Urban Board, is what we call a Smart Citizen Station. The Stations amount of sensors could range from 1 to virtually any number. There are some Stations that are meant for air quality measurements, and some that take water measurements. Some of them have only one additional CO2 sensor, and some Stations have up to 16 analog measurements in parallel. Check the guides compilation below to make sure you follow the different steps for the configuration of your particular unit.</p>"},{"location":"Guides/#smart-citizen-kit","title":"Smart Citizen Kit","text":"<ul> <li> If you haven't started yet to collect data, check the onboarding sensors guide</li> <li> If you are about to place the sensor outdoors, check the deploying Smart Citizen Kit guide</li> <li> Check the updating the firmware guide to get the latest version of the firmware in the SCK</li> <li> Moving location? Check the updating the WiFi guide</li> <li> More advanced features? Check the using the Shell guide</li> </ul>"},{"location":"Guides/#smart-citizen-air-quality-stations","title":"Smart Citizen Air Quality Stations","text":"<ul> <li> If you haven't started yet to collect data, check the onboarding sensors guide, and make sure you select the correct blueprint as explained in the advanced kit selection guide. In the Stations that measure chemical composition with electrochemical sensors (i.e. CO, NO2, NO, SO2, O3, etc.), you will also need to follow the handling calibration information guide</li> <li> To place the sensors outdoors, follow the deploying Smart Citizen Station guide</li> <li> Similar to the SCK, check the updating the firmware, updating the WiFi and using the Shell guides for keeping your sensor up to date</li> <li> If you are working with the data: check how to access to the data.</li> <li> If your Station has a CO2 sensor, check the Calibration of CO2 sensors guide</li> <li> If you have small Stations (only with the Urban board, the PMS5003, and with CO2, or two small A-series Alphasense Electrochemical sensors), check the assembly of the stations guide</li> </ul> <p>Note that if your unit has electrochemical sensors, data needs to be postprocessed outside of the units (in the platform). By following the handling calibration information guide, you are set with the default processing. However, if you want to perform custom algorithms in an automated way, follow the Data processing guide to set it up</p>"},{"location":"Guides/#smart-citizen-water-stations","title":"Smart Citizen Water Stations","text":"<ul> <li> If you haven't started yet to collect data, check the Onboarding sensors</li> <li> If you are setting up your own unit from scratch, follow the Smart Citizen Water Station Setup Guide</li> <li> Similar to the SCK, check the updating the firmware, updating the WiFi and using the Shell guides for keeping your sensor up to date</li> <li> For information on the water probes calibration, go to the Calibrating water sensors guide</li> </ul>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/","title":"Sensirion SCD30 CO2 sensor","text":"<p>This guide will show the calibration process and particularities for using the Sensirion SCD30 CO2 sensor with the Smart Citizen Kit.</p>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#manufacturer-information","title":"Manufacturer information","text":"<p>Sensirion provides a lot of information in their applications note website for the SCD30 CO2. The datasheet can be found here.</p>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#setup","title":"Setup","text":"<p>For onboarding SCK2.1 with CO2</p> <p>If you are onboarding a SCK2.1 with NDIR CO2 sensor (SCD30 or similar), make sure you select this blueprint: <code>#35 SCK 2.1 CO2</code> in the advanced kit selection page.</p> <p>If you are using the SEEED Studio breakout, the sensor can be directly connected to the Auxiliary connector on the data board, using a 4-wire grove cable. </p> <p></p> <p>Sensor can operate in two modes for finding it's reference value. For both of these modes have customizable reading intervals that affect power consumption and response time. Finally, a temperature correction can be applied for electronics temperature build-up.</p> <p>All the commands below are accessed by:</p> <pre><code>SCD30 CO2:\nOptions:\ninterval [2-1000 (seconds)]\nautocal [on/off]\ncalfactor [400-2000 (ppm)]\ncaltemp [newTemp/off]\npressure\n</code></pre> <p>The procedure for setting up the sensor goes as follows (more information in Low power mode AN):</p> <p></p>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#reading-interval","title":"Reading interval","text":"<p>The SCD30 can have different internal reading intervals, independent from the SCK's interval. A larger reading interval will reduce power consumption, but it will increase response time. By default, the reading interval is 2s. A good reading interval for reducing substantially power consumption is 15s. Below there is a table derived from the manufacturer's application notes that can guide in the reading interval setup process:</p> Interval (s) Consumption (mA) Response time (t63 - s) 2 19 20 15 6.5 72 30 6.5 145 <p>More information can be found in the low power mode application note.</p> <p>To control this, and set it up to 15s:</p> <pre><code>control scd30 interval 15\n</code></pre> <p>To check the current interval:</p> <pre><code>control scd30 interval\n</code></pre>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#calibration","title":"Calibration","text":"<p>The SCD30 can work in two main modes: ASC (automatic self-calibration) or FRC (forced re-calibration). They are both described in the Field calibration for SCD30 AN. Both modes shift the sensor baseline, only that FRC requires an external value, while ASC will adapt over time looking for \"clean air\" readings.</p> <p> Image source: Sensirion</p> <p>Drift</p> <p>A typical SDC30 sensor drift per year is 50ppm and 80ppm maximal.</p> <p>Additionally, there is a possibility to calibrate the temperature readings with an external sensor for correcting the SCD30 internal temperature corrections.</p>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#asc","title":"ASC","text":"<p>In SC, the SCD30 sensor by default is set in ASC mode. In this mode, the sensor looks for a clean environment over a 1-3 weeks period of time, for at least 1h of clean air per day. </p> <p>Manufacturer information</p> <p>ASC assumes that the lowest CO2 concentration the SCD30 is exposed to corresponds to 400 ppm. The sensor estimates the most likely reading corresponding to this background level and identifies this as 400ppm. Using this reference value, the very same manipulation is triggered when applying FRC with the reference value of 400 ppm. Generating a reference value not corresponding to 400 ppm induces an erroneous update of the calibration and reduces sensor accuracy. To prevent a faulty self-calibration, ASC employs an internal self-consistency check: the algorithm will store the seven most recent concentration minima in volatile memory. Recalibration by the ASC algorithm will only be triggered when those seven successive minima of measured CO2 concentration are within \u00b1 50 ppm. Also, minima need to be separated by at least 18 hours. If the seven successive minima span a range larger than \u00b1 50 ppm, the ASC will not update the calibration. The buffer storing the minima has a depth of seven measurements, the most recent found minima will always replace the oldest minima (first-in first-out). </p> <p>Some additional considerations:</p> <ul> <li>Do not unplug the sensors during the first week period of ASC</li> <li>Place it in a place where you know there is going to be a clean air composition during that period. Indoor environments is not always the best for this purpose</li> <li>Do not trust the initial values, as the self-calibration algorithm might have not found proper values yet</li> <li>The intention of ASC is manly to correct sensor drift due to aging</li> <li>There is no way for us to know wether the self-calibration process has satisfactory values. The only indication of the process being satisfactory or not is that there is a \"step\" in the readings when ASC kicks in (see insights)</li> </ul> <p>To turn it on:</p> <pre><code>control scd30 autocal on\n</code></pre> <p>Or off:</p> <pre><code>control scd30 autocal off\n</code></pre>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#frc","title":"FRC","text":"<p>To activate FRC mode, we need to provide an external CO2 concentration in ppm. FRC calibration takes place inmediately, and it can be do multiple times at aribtrary intervals. Before applying it, run the sensor for at least 2 minutes in the desired environment.</p> <p>Unstable environments</p> <p>Take into account the response time of the sensor (with 2s it's t63=20s). If the environment in which you are taking readings it's too unstable, do not apply the FRC.</p> <p>First, make sure both reference and SCD30 sensors are stable:</p> <pre><code>monitor scd30 co2\n</code></pre> <p>To stop the monitor, just press <code>Enter</code>.</p> <p>Secondly, feed the external reading into the sensor. The value needs to be between 400ppm and 2000ppm. For instance, for a value of 450ppm:</p> <pre><code>SCK &gt; control scd30 calfactor 450\nSCD30 CO2: calfactor 450\nForced Recalibration Factor: 450\n</code></pre> <p>After applying this value, ASC will be disabled automatically and readings will be inmediately corrected to the new value.</p> <p>Resetting the sensor</p> <p>Take into account that if you ask for the <code>calfactor</code> after setting it up:</p> <pre><code>SCK &gt; control scd30 calfactor\nSCD30 CO2: calfactor\nForced Recalibration Factor: 450\n</code></pre> <p>However, if you reset the sensor, it will return <code>400ppm</code>. The FRC will remain active with the set value, but it will only visible through the <code>autocal</code> check: </p> <pre><code>SCK &gt; control scd30 calfactor\nSCD30 CO2: calfactor\nForced Recalibration Factor: 400\nSCK &gt; control scd30 autocal\nSCD30 CO2: autocal\nAuto Self Calibration: off\n</code></pre>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#temperature-correction","title":"Temperature correction","text":"<p>An external temperature sensor can also be used to compensate the self-heating of the SCD30 board. A temperature correction can be supplied with the <code>caltemp</code> command.</p> <p>First, read the temperature from the SCD30, to verify it's lower than the reference sensor.</p> <pre><code>read scd30 temp\n</code></pre> <p>If it is, then feed the external temperature value (for instance, 15 \u00baC):</p> <pre><code>control scd30 caltemp 15\n</code></pre> <p>After this, the sensor will stabilise and converge to the new temperature correction reading after a while.</p> <p>To turn off the temperature compensation:</p> <pre><code>control scd30 caltemp off\n</code></pre>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#insights","title":"Insights","text":"<p>Here are some insights:</p> <ul> <li>It is recommended to use FRC after assembly with reference data</li> <li>ASC can be used instead of performing FRC after assembly but leaves the user of the device with sensor outputs that might be out of specification for a prolonged time</li> <li>FRC after assembly corrects deviations caused by mechanical stress during handling and assembly. ASC will then take care of sensor drift due to aging. Only exception, applications where ASC conditions can\u2019t be met</li> </ul> <p>Here is how to identify ASC has kicked in:</p> <p></p> <p>Mechanical stress</p> <p>Mechanical stress can lead to output deviations. Make sure to check the assembly guidelines.</p>"},{"location":"Guides/calibration/SCD30%20CO2%20sensor/#calibration-process","title":"Calibration process","text":"<p>Normally, we perform tests of sensors of larger units (we do not have reference sensor data). This allows us to have significantly large sensor data and be able to correct sensor deviations better. In this circumstances, the process is as follows:</p> <ul> <li>Place sensors in well ventilated environment for at least 2 weeks and ASC enabled</li> <li>Identify sensors with ASC performed and valid</li> <li>Identify sensor baselines of all sensors</li> <li>Determine most likely sensor value of the population in sensor baseline readings. Use a normal distribution of the sensors after performing ASC</li> <li>Feed an offset to all the sensors, ASC corrected and not, by introducing a real value via FRC</li> <li>Test if new spread is valid with respect to sensor accuracy (\u00b1 30 ppm)</li> <li>Enable ASC for it to automatically correct drift</li> <li>Mark sensor as calibrated</li> </ul> <p>For those cases in which there is not a significant amount of sensors to evaluate, or a refencence unit, ASC is recommended, by leaving the sensor in a very well ventilated area (i.e. outdoors). However, there is a risk for the sensor to never achieve the conditions for ASC to work. In this case, the recommendation is to post-process the data and extract a baseline, considering this baseline is 400ppm.</p>"},{"location":"Guides/calibration/Soil%20moisture%20sensors/","title":"Soil Moisture Sensor Calibration","text":"<p>The soil moisture sensor can be used for schedule irrigations (i.e. determine when to water the plants); or for calculating soil water deficit to work out how much water to apply. Depending on the application, the sensor would need to be calibrated in with different procedures, but as a general guideline, we need to normalise its readings. Without this process, the raw sensor readings will be meaningless to the user and only some trends could be analysed. This section is a digest of some of these procedures, and more information is given in the notes below.</p> <p>More references</p> <ul> <li>Capacitance probe calibration</li> <li>The importance of soil moisture sensor calibration</li> </ul> <p>In case of irrigation scheduling, it is generally sufficient to simply match the raw readings from each sensor at both 0% (held in air) and 100% water levels (submerged in water). This is, of course, an approximation and will need some further analysis from the user to determine when to irrigate. When a more accurate measurement is required, the sensor needs to be calibrated with the actual soil where it's going to be deployed, since different types of soil will have different capacities. A valid approach is to prepare different samples of the soil with different levels of saturation, and adapt the sensor readings for it.</p> <p></p> <p>Image Source: Edaphic Scientific</p>"},{"location":"Guides/calibration/Soil%20moisture%20sensors/#calibration","title":"Calibration","text":"<p>If we are not aiming to get a full-fledged sensor reading, we will only need to measure the sensor in dry air and fully submerged in water. For that, we will use:</p> <ul> <li>A laptop with a serial interface. For instance, the Arduino IDE</li> <li>Our sensor</li> <li>A cup filled up with water and a napkin</li> </ul> <p>The sensor can be calibrated using the shell interface. The process is as follows:</p> <ol> <li> <p>Connect your kit to a computer and open the terminal for the SCK. If you use the Arduino IDE, go to Tools &gt; Serial Monitor and select <code>115200 baud</code> at the bottom right corner </p> </li> <li> <p>If you use the IDE type <code>sensor</code> on the top and click <code>Send</code></p> </li> <li>Check if the output has something like <code>Soil Moisture Raw (60 sec)</code> after <code>Enabled</code></li> <li>If it's <code>Enabled</code>, dry the sensor and type in: <code>read soil moisture raw</code>. Repeat this command 5-10 times until you get an stable output (repeat command with arrow up)</li> <li>Put the sensor in a cup of water (until the line). Then read the value again <code>read soil moisture raw</code> several times.</li> <li>Once you have both values, type in: <code>control moisture cal XXX YYY</code> where XXX and YYY are the dry and wet values that you just measured</li> <li>Check that the reading is OK by: <code>read soil moisture percent</code>. You should receive an answer in rh%</li> <li>Now you should see the data online (if in network mode):</li> </ol> <p></p> <p>Find out more</p> <p>Check the project source code files.</p>"},{"location":"Guides/calibration/Water%20sensors/","title":"Water Sensors Calibration","text":""},{"location":"Guides/calibration/Water%20sensors/#calibration-on-the-smart-citizen-kit","title":"Calibration on the Smart Citizen Kit","text":"<p>The Smart Citizen firmware has built-in support for the calibration of the sensors. In order to calibrate the sensors you will need to use the SCK Shell.</p> <p>To enable the sensors you just need to plug you board to the Smart Citizen kit aux port and reboot the Smart Citizen Kit and the sensors will be handled by the board.</p> <p>Warning</p> <p>When calibrating don't use the normal <code>read sensor</code> command, this command applies temperature/salinity compensation, calibration should be done without any compensation. Instead you should use <code>control sensorName com r</code> and that will return the raw metrics that sensor can provide. On the documentation of each sensor calibration procedure we describe the format of this metrics.</p> <p>Danger</p> <p>After finishing the calibration process restart your SCK to start from a clean state.</p>"},{"location":"Guides/calibration/Water%20sensors/#atlas-ph","title":"Atlas PH","text":"<p>You need to perform a 3-point calibration with the calibration solutions. The solutions vary their pH with temperature, so make sure to check the temperature prior. The pH value at current temperature can be found on the reference table on the calibration solution bottle. If the current temperature is not on it, use the closest value or use the calculator here.</p> <p>Datasheet</p> <p>Here you can find the datasheet:</p> <ul> <li>Calibration theory on page 11</li> <li>Commands on page 52</li> </ul> <p>Example commands</p> <pre><code>control ph com r\ncontrol ph com cal,[mid,low,high],value\ncontrol ph com cal,clear\ncontrol ph com cal,?\n</code></pre>"},{"location":"Guides/calibration/Water%20sensors/#3-point-calibration","title":"3-point calibration","text":"<p>This is the order of the calibration: </p> <ol> <li>mid point</li> <li>low point</li> <li>high point</li> </ol> <p>Warning</p> <p>Always calibrate the mid point first because it calibration erase all the previous calibration done.</p> <p>Danger</p> <p>Always clean the probe with distilled water between each calibration</p>"},{"location":"Guides/calibration/Water%20sensors/#mid-point-calibration","title":"Mid point calibration","text":"<ul> <li>Put the sensor in the pH 7 calibration solution. </li> </ul> <ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control ph com r\n6.48\ncontrol ph com r\n6.45\n...\n</code></pre> </li> <li> <p>Issue the midpoint calibration command:</p> <pre><code>control atlas ph com cal,mid,[value of pH at current temperature]\n</code></pre> </li> </ul> <p>Example at 30\u00b0C</p> <pre><code>control atlas ph com cal,mid,6.99 \n</code></pre> <p>After this command if you take a pH reading the result should be 7.00 (or very close to it)</p>"},{"location":"Guides/calibration/Water%20sensors/#low-point-calibration","title":"Low Point Calibration","text":"<ul> <li> <p>Repeat the procedure with the Low point 4.00 solution (the red one). First, read the sensor multiple times until the reading is stable:</p> <pre><code>control ph com r\n3.98\ncontrol ph com r\n3.98\n...\n</code></pre> </li> <li> <p>Issue the midpoint calibration command:</p> <pre><code>control atlas ph com cal,low,[value of pH at current temperature]\n</code></pre> </li> </ul> <p>Example at 30\u00b0C</p> <pre><code>control atlas ph com cal,low,4.01\n</code></pre>"},{"location":"Guides/calibration/Water%20sensors/#high-point-calibration","title":"High Point Calibration","text":"<ul> <li> <p>The same step with High point 10.00 calibration solution (blue). First, read the sensor multiple times until the reading is stable:</p> <pre><code>control ph com r\n9.84\ncontrol ph com r\n9.84\n...\n</code></pre> </li> <li> <p>Issue the midpoint calibration command:</p> <pre><code>control atlas ph com cal,high,[value of pH at current temperature]\n</code></pre> </li> </ul> <p>Example at 30\u00b0C</p> <pre><code>control atlas ph com cal,high,9.96\n</code></pre> <p>Extra notes</p> <p>The command <code>control com cal,?</code> can be used to check the calibration status as explained on datasheet page 52. The answers can be:</p> <ul> <li><code>?CAL,0</code> \u2192 No calibration done</li> <li><code>?CAL,1</code> \u2192 One point calibration done</li> <li><code>?CAL,2</code> \u2192 Two point calibration done</li> <li><code>?CAL,3</code> \u2192 Three point calibration done</li> </ul> <p>(not tested) If your calibration solutions are not 4, 7 and 10, you can still use them and replace <code>[value of pH at current temperature]</code> by your values.</p>"},{"location":"Guides/calibration/Water%20sensors/#atlas-ec","title":"Atlas EC","text":"<p>You need to perform a 3 step calibration with a dry point and a 2-point calibration with the calibration solutions.</p> <p>Datasheet</p> <p>Here you can find the datasheet:</p> <ul> <li>Calibration info on page 12</li> <li>Calibration commands on page 55</li> </ul> <p>Example commands</p> <pre><code>control conductivity com r\ncontrol conductivity com K,[probeType]\ncontrol conductivity com K,?\ncontrol conductivity com cal,[dry,clear,84]\ncontrol conductivity com cal,low,1413\ncontrol conductivity com cal,high,12,880\ncontrol conductivity com cal,?\n</code></pre>"},{"location":"Guides/calibration/Water%20sensors/#2-point-calibration","title":"2-point calibration","text":"<p>This is the order of the calibration: </p> <ol> <li>set probe type</li> <li>dry point</li> <li>two-point calibration</li> </ol>"},{"location":"Guides/calibration/Water%20sensors/#set-probe-type","title":"Set probe type","text":"<p>Depending on which probe you have (check drawing for reference) you should set the probe type to K 0.1, 1.0 or 10 (new drivers have K1.0 as default):</p> <p></p> <p>To set the correct probe type:</p> <pre><code>control conductivity com K,1.0\n</code></pre> <p>and check which type is set:</p> <pre><code>control conductivity com K,?\n?K,1.0\n</code></pre> <p>About the sensor</p> <p>The Electrical Conductivity sensor provides four different metrics:</p> <ul> <li>Electrical Conductivity \u2192 EC</li> <li>Total Dissolved Solids \u2192 TDS</li> <li>Salinity \u2192 S</li> <li>Specific Gravity \u2192 SG</li> </ul> <p>The data is presented in order and comma separated EC,TDS,S,SG, for instance 0.00,0,0.00,1.000</p> <p>Readings are 0?</p> <p>It is normal that if the probe type has been changed (for instance, you are using a K10 probe), that the readings are 0 after setting the probe type.</p>"},{"location":"Guides/calibration/Water%20sensors/#dry-calibration","title":"Dry calibration","text":"<p>Follow the steps below with the dry sensor before introducing it to the calibration solutions. You need to do this step even if the readings in dry state are 0.</p> <ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control conductivity com r\n0.00,0,0.00,1.000\ncontrol conductivity com r\n0.00,0,0.00,1.000\n...\n</code></pre> </li> <li> <p>Issue the dry calibration command:</p> <pre><code>control conductivity com cal,dry\n</code></pre> </li> </ul>"},{"location":"Guides/calibration/Water%20sensors/#low-point-calibration_1","title":"Low point calibration","text":"<p>You can check the recommended calibration solutions for each probe on the Probetypes drawing (for instance, for K1.0 probe, 12,880uS and 80,000uS are recomended)</p> <p></p> <ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control conductivity com r\n13470,7278,7.76,1.0\ncontrol conductivity com r\n13230,7144,7.61,1.0\n...\n</code></pre> </li> <li> <p>Issue the low point calibration command. The value to input is the one of the calibration solution, for example 128800:</p> <pre><code>control conductivity com cal,low,12880\n</code></pre> </li> </ul> <p>After this command readings will not change.</p>"},{"location":"Guides/calibration/Water%20sensors/#high-point-calibration_1","title":"High point calibration","text":"<p>Repeat this steps with high point calibration solution and when the readings stabilize issue the command. Again, remember that the value to input here is the one from the calibration solution, for instance 80000:</p> <pre><code>control conductivity com cal,high,80000\n</code></pre> <p>After this steps the two point calibration is complete and the readings will change.</p>"},{"location":"Guides/calibration/Water%20sensors/#atlas-do","title":"Atlas DO","text":"<p>You have two options for this calibration:</p> <ol> <li>Single point calibration (dry point)</li> <li>2-point calibration (dry point and 0 mg/l point) - only if you need accurate readings below 1mg/l</li> </ol> <p>Make sure you have followed the probe reconditioning before proceeding with this calibration.</p> <p>Datasheet</p> <p>Here you can find the datasheet:</p> <ul> <li>Calibration info on page 9</li> <li>Calibration commands on page 52</li> </ul> <p>Example commands (you can put <code>control ox</code>, <code>control oxygen</code> or <code>control dissolved oxygen</code> - however! do not put <code>control dissolved</code> as  it will use TDS)</p> <pre><code>control ox com r\ncontrol ox com cal\ncontrol ox com cal,0\ncontrol ox com cal,clear\ncontrol ox com cal,?\n</code></pre> <p>Pressure compensation</p> <p>If the sensor is going to be used at more than 10 meters deep into the water Pressure compensation should be set with:</p> <pre><code>control ox com P,kPaValue\n</code></pre> <p>More information on datasheet, page 57</p>"},{"location":"Guides/calibration/Water%20sensors/#option-1-single-point-calibration","title":"OPTION 1: Single point calibration","text":"<p>First calibrate, compensate later</p> <p>Temperature, salinity and pressure compensation values have no effect on calibration.</p> <ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control ox com r\n13.95,50%\ncontrol ox com r\n13.76,49%\n...\n</code></pre> </li> <li> <p>Issue the calibration command, after this the readings will change. In this case, there is no need to add any value after <code>cal</code>. The sensor will take the current reading as the dry point.</p> <pre><code>control ox com cal\n</code></pre> </li> </ul> <p>Be careful</p> <p>If at any point of the calibration process you see akward readings (for instance, that using a 0mg/l solution for dissolved oxygen you see weirdly high values), it is better to start over. For this, proceed with:</p> <pre><code>control ox com cal,clear\n</code></pre> <p>And start from the beginning.</p>"},{"location":"Guides/calibration/Water%20sensors/#option-2-2-point-calibration","title":"OPTION 2: 2-point calibration","text":"<p>Two point calibration is recommended if you require accurate readings below 1.0 mg/l. After completing the single point calibration procedure put the probe in the calibration solution.</p> <p></p> <ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control ox com r\n13.95,50%\ncontrol ox com r\n13.76,49%\n...\n</code></pre> </li> <li> <p>Issue the calibration command. In this case, you have to input the value of the calibration solution too, for example 0:</p> <pre><code>control ox com cal,0\n</code></pre> </li> </ul> <p>Reset your SCK and you are ready.</p> <p>Ready to go?</p> <p>If you want to send the data to the platform, you will need to  Advanced Kit Selection. At the moment the closest Kit Blueprint will be <code>#22 BioPV Kit</code> or <code>#31 SCK 2.1 Sea Water</code> in case you are using a SCK2.1 with GPS. You can request in the forum for a custom blueprint with the specific sensors you are using. </p>"},{"location":"Guides/calibration/Water%20sensors/#atlas-orp","title":"Atlas ORP","text":"<p>You only need to perform a single point calibration. You can use any calibrated solution, as long as it's within your sensor range. Atlas uses a 225mV calibration.</p> <p>Datasheet</p> <p>Here you can find the datasheet:</p> <ul> <li>Calibration info on page 12</li> <li>Calibration commands on page 49</li> </ul> <p>Example commands</p> <pre><code>control orp com r\ncontrol orp com cal\ncontrol orp com cal,[value]\ncontrol orp com cal,clear\ncontrol orp com cal,?\n</code></pre>"},{"location":"Guides/calibration/Water%20sensors/#single-point-calibration","title":"Single point calibration","text":"<ul> <li> <p>Read the sensor multiple times until the reading is stable:</p> <pre><code>control orp com r\n225\ncontrol orp com r\n224\n...\n</code></pre> </li> <li> <p>Issue calibration command</p> <pre><code>control orp com cal,[value of ORP]\n</code></pre> </li> </ul> <p>Example at 25\u00b0C</p> <pre><code>control orp com cal,225\n</code></pre>"},{"location":"Guides/calibration/Water%20sensors/#atlas-pt1001000-temperature","title":"Atlas PT100/1000 Temperature","text":"<p>You only need to perform a single point calibration. This process is only necessary if you change the probe cable or the first time you use the sensor.</p> <p>Datasheet</p> <p>Here you can find the datasheet:</p> <ul> <li>Calibration info on page 12</li> <li>Calibration commands on page 53</li> </ul> <p>Example commands (you can put <code>control ox</code>, <code>control oxygen</code> or <code>control dissolved oxygen</code> - however! do not put <code>control dissolved</code> as  it will use TDS)</p> <pre><code>control atlas temp com r\ncontrol atlas temp com cal\ncontrol atlas temp com cal,[value]\ncontrol atlas temp com cal,clear\ncontrol atlas temp com cal,?\n</code></pre> <p>Warning</p> <p>This is needed because the temperature probe is a resistive sensor \u2013 more cable \u2192 more resistance!</p> <p>Reference</p> <p>You will need another temperature probe or something of known temperature (like boiling water) that is already calibrated for this. Make sure both are stable before issuing calibration commands!</p>"},{"location":"Guides/calibration/Water%20sensors/#single-point-calibration_1","title":"Single point calibration","text":"<ul> <li> <p>Read the reference probe multiple times until the reading is stable. Write down the value:</p> <pre><code>control atlas temp com r\n22.5\ncontrol atlas temp com r\n22.4\n...\n</code></pre> </li> <li> <p>Read the target probe multiple times until the reading is stable:</p> <pre><code>control atlas temp com r\n29.5\ncontrol atlas temp com r\n29.4\n...\n</code></pre> </li> <li> <p>Issue calibration command:</p> <pre><code>control atlas temp com cal,[value of temperature from reference probe or temperature]\n</code></pre> </li> </ul>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/","title":"Analyse your data in batch","text":"<p>Sometimes we have a lot of devices to process, and the interfaces for analysis in smartcitizen.me or in the <code>jupyter notebook</code> might not be the most efficient way to do it. For this reason, we have developed a functionality to process the data in batches, defining the tasks to perform in a <code>json</code> descriptor file.</p> <p>The descriptor file can be placed in the <code>src/tasks</code> directory (or any, actually). An example of how to run it is shown in <code>examples/batch_analysis.ipynb</code>:</p> <pre><code># Load the object\nfrom src.models.batch import batch_analysis\",\ntasks_file = '../tasks/batch.json'\",\nbatch_session = batch_analysis(tasks_file, verbose = True)\n\n# Run the analysis\nbatch_session.run()\n</code></pre>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#functionality","title":"Functionality","text":"<p>These tasks are intended to automatise data analysis tasks as the following:</p> <ul> <li>Load, process and export processed data</li> <li>Generate models and apply them, extracting metrics and comparing if they extrapolate to different set of sensors in different datasets, without having to run extra code</li> <li>Make plots for different metrics in an automatic way, and export their renders</li> </ul>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#workflow","title":"Workflow","text":""},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#json-task-description","title":"Json task description","text":"<p>The descriptor file loaded is a <code>json</code> containing keys for each task to be run. Several tasks can be included and will be run consecutively:</p> <pre><code>{\n    \"TASK_1\":{...},\n    \"TASK_2\":{...},\n    \"TASK_3\":{...}\n}\n</code></pre> <p>Each of the <code>tasks</code> contains different fields, depending on what the process is.</p>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#define-data","title":"Define data","text":"<p>In case no model needs to be calculated, the data can be specified directly in the task:</p> <pre><code>{\n    \"TASK_1\":{\n        \"data\":{\n            \"datasets\": {\n                \"TEST_1\": [\"DEVICE_11\",\"DEVICE_12\"],\n                \"TEST_2\": [\"DEVICE_21\", \"DEVICE_22\", \"DEVICE_23\"],\n                ...\n                        },\n            \"data_options\": {\"avoid_processed\": true,\n                            \"frequency\": \"1Min\",\n                            \"clean_na\": true,\n                            \"use_cache\": true,\n                            \"clean_na_method\": \"drop\",\n                            \"min_date\": null,\n                            \"max_date\": null,\n                            \"export_data\": null,\n                            \"rename_export_data\": false}\n                    }\n}\n</code></pre> <p>If a model is to be calculated, the data is defined within the model key as seen below. </p>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#data-loading-options","title":"Data loading options","text":"<ul> <li><code>frequency</code>: frequency at which load the data (as defined in <code>pandas</code> here)</li> <li><code>clean_na</code>: clean or not NaN</li> <li><code>clean_na_method</code>: <code>drop</code> or <code>fill</code> with back-forward filling</li> <li><code>use_cache</code>: whether or not to use file chaching for the analysis. This adds a <code>cached</code> folder in the corresponding <code>test</code> directory, which allows faster download from the <code>API</code>. It is implemented so that the only data to be downloaded is the one that is not cached</li> <li><code>min_date</code>, <code>max_date</code>: for limitting the amount of data to be loaded</li> <li><code>export_data</code>: if the processed data (after pre-processing and modeling) has to be exported. It will be saved in the corresponding <code>test</code> folder, under <code>processed</code>. Options are:<ul> <li><code>None</code>: don't export anything</li> <li><code>All</code>: all channels in the <code>pandas dataframe</code></li> <li><code>Only Generic</code>: Export only channels that are under the <code>data/interim/sensorNamesExport.json</code></li> <li><code>Only Processed</code>: Export only channels that are tagged as <code>processed</code> under the <code>data/interim/sensorNamesExport.json</code></li> </ul> </li> <li><code>rename_export_data</code>: Rename the exported channels for better readability using the file <code>data/interim/sensorNamesExport.json</code></li> </ul> <p>None?</p> <p>In <code>json</code>, we specify the <code>python</code> <code>None</code> as <code>null</code>.</p> <p>Want to save time?</p> <p>Enable <code>use_cache</code> and we will save some time by checking if the data we have downloaded previously from the API can be used. This also applies for pre-processing functions.</p>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#model","title":"Model","text":"<p>Recommended to just get in touch<p>This can be overwhelming at first. Just get in touch</p> </p> <p>In the <code>model</code> sub-task, currently three possibilities are implemented:</p> <ul> <li>Linear methods: <code>OLS</code> or <code>RLM</code> regression</li> <li>Random Forest (<code>RF</code>) or Support Vector Regressor <code>SVR</code></li> <li>XGBoost</li> </ul> <p>In the case of having a <code>model</code> task, the <code>data</code> defined above is ignored, and only the one under <code>model: {\"data\":{}}</code> is used. </p> <p>One model per task</p> <p>It is better to generate only one model per task, since the memory used by the models can be very large.</p> <p>An example is shown below:</p> <pre><code>\"model\": {\n        \"model_name\": \"Random_Forest_100\",\n        \"model_type\": \"RF\",\n        \"model_target\": \"ALPHASENSE\",\n                    \"data\": {\"train\": {\"TEST_1\": {\"devices\": [\"DEVICE_1\"],\n                                                 \"reference_device\":\"REF_DEVICE_1\"}},\n                            \"test\": {\"TEST_1\": {\"devices\": [\"DEVICE_1\", \"DEVICE_2\"],\n                                                 \"reference_device\":\"REF_DEVICE_2\"},\n                                     \"TEST_2\": {\"devices\": [\"DEVICE_3\"],\n                                                \"reference_device\": \"REF_DEVICE_3\"},\n                                     \"TEST_3\": {\"devices\": [\"DEVICE_4\"],\n                                                \"reference_device\": \"REF_DEVICE_4\"},\n                                     \"TEST_2\": {\"devices\": [\"DEVICE_5\"],\n                                                \"reference_device\": \"REF_DEVICE_5\"}},\n                \"features\": {\"REF\": \"NO2_REF\",\n                            \"A\":  \"GB_2W\",\n                            \"B\": \"GB_2A\",\n                            \"C\": \"HUM\"\n                            }\n                \"data_options\": {\"export_data\": \"All\",\n                            \"rename_export_data\": false,\n                            \"target_raster\": 1Min\",\n                            \"clean_na\": true,\n                            \"clean_na_method\": \"fill\",\n                            \"min_date\": null,\n                            \"max_date\": null,\n                            \"use_cache\": true}\n                },\n        \"hyperparameters\": {\"ratio_train\": 0.75,\n                            \"n_estimators\": 100,\n                            \"shuffle_split\": true\n                            },\n        \"model_options\": {\"session_active_model\": false,\n                    \"export_model\": false,\n                    \"export_model_file\": false,\n                    \"extract_metrics\": true,\n                    \"save_plots\": false,\n                    \"show_plots\": false\n                    }\n        },\n</code></pre> <ul> <li><code>model_name</code>: model name to be saved</li> <li><code>model_type</code>: 'RF', 'SVR', 'LSTM' or 'OLS'</li> <li><code>model_target</code>: if the model is to be stored under a specific category of models under the <code>models/</code> folder</li> <li><code>data</code>: dict containing the data to use for training, and features description. Under <code>train</code>, we define which of the tests and devices is to be used for the model definition, with the format <code>{\"TEST\": \"devices\": [\"DEVICE\"], \"reference_device\": \"REF_DEVICE_1\"}</code>. Under <code>test</code>, we define a series of <code>test</code> in which we'll evaluate the model extracted from the <code>train</code> dataset:<ul> <li><code>devices</code>: list of devices to use</li> <li><code>reference_device</code>: <code>device</code> that contains the reference data</li> </ul> </li> </ul> <p>Info<p>Multiple training datasets are possible as well, by combining them.</p> </p> <p>Additionally:     + <code>features</code>: dict of <code>devices</code> tagged as <code>REF</code>, <code>A</code>, <code>B</code>, <code>C</code>... to define the features of the model, being <code>REF</code> the reference channel in the <code>reference_device</code> - <code>hyperparameters</code>: dict containing different hyperparameters, depending on the type of model:     + For all:         *  <code>ratio_train</code>: generic, train-test split ratio     +  OLS:         *  <code>formula_expresion</code>: stats models formula type, accepting <code>numpy</code> expressions This formula has to reference the features described under the <code>data</code> section. Example: <code>REF ~ A * B + np.log(C/2)</code>     + Random Forest:         * <code>n_estimators</code>: only for <code>RF</code>. number of forests to use         * <code>shuffle_split</code>: only for <code>RF</code>. whether or not use shuffle split     + LSTM:         * <code>n_lags</code>: number of lags to account in the LSTM input         * <code>epochs</code>: number of epochs (100 or more recommended)         * <code>batch_size</code>: batch size (72 recommended)                     * <code>verbose</code>: verbose output during training         * <code>loss</code>: loss function ('mse' or others)         * <code>optimizer</code>: optimizer to use (<code>adam</code> or others)         * <code>layers</code>: specific layer structure. Example below:</p> <pre><code>    ```\n    \"layers\": [{\"type\": \"lstm\",\n                \"neurons\": 100,\n                \"return_seq\": true\n            },\n            {\n                \"type\": \"dropout\",\n                \"rate\": 0.05\n            },\n            {\n                \"type\": \"lstm\",\n                \"neurons\": 100,\n                \"return_seq\": true\n            },\n            {\n                \"type\": \"lstm\",\n                \"neurons\": 50,\n                \"return_seq\": false\n            },\n            {\n                \"type\": \"dropout\",\n                \"rate\": 0.05\n            },\n            {\n                \"type\": \"dense\",\n                \"neurons\": 1,\n                \"activation\": \"linear\"\n            }\n        ]},\n    ```\n</code></pre> <ul> <li><code>model_options</code>: different options for the model calculated<ul> <li><code>session_active_model</code>: keep the model active after the task is completed</li> <li><code>export_model</code>: export the model (parameters, hyperparameters, weights) to the <code>model/model_type</code> folder after the task is completed</li> <li><code>export_model_file</code>: export the model file (not recommended for <code>RF</code>) fo the same folder as above</li> <li><code>export_metrics</code>: export metrics for the model or not</li> <li><code>save_plots</code>: save model plots or not</li> <li><code>show_plots</code>: show model plots or not</li> </ul> </li> </ul>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#plots","title":"Plots","text":"<p>The plot sub-task accepts two different libraries: <code>matplotlib</code> and <code>plotly</code>. The first one generates static images, that we can export for nice quality graphs, while <code>plotly</code> is more meant for exploratory analysis.</p> <p>Many plots? No problem</p> <p>In the case of the models, we only wanted one model per task, but it's not the case in the plots.</p> <pre><code>\"plot\": {\n    \"2\": {\"plot_type\": \"timeseries\",\n        \"plotting_library\": \"matplotlib\",\n        \"data\": {\"test\": \"TEST_1\",\n                \"traces\": {\"1\": {\"device\": \"5262\",\n                                \"channel\" : \"EXT_PM_10\",\n                                \"subplot\": 1},\n                            \"2\": {\"device\": \"5262\",\n                                \"channel\" : \"EXT_PM_25\",\n                                \"subplot\": 2}}},\n        \"options\": {\"show_plot\": false,\n                    \"separate_device_plots\": false,\n                    \"target_raster\": \"10Min\",\n                    \"max_date\": null,\n                    \"min_date\": null,\n                    \"export_path\": \"/Users/mac/Desktop\",\n                    \"file_name\": \"plot_pm\"},\n        \"formatting\": {\"xlabel\": \"Date (-)\",\n                        \"ylabel\": {\"1\": \"Temp degC\",\n                                    \"2\": \"Hum (%rh)\"},\n                        \"yrange\": {\"1\": [0, 40], \n                                    \"2\": [0, 100]},\n                        \"title\": \"PM\",\n                        \"sharex\":true,\n                        \"grid\": true,\n                        \"height\": 10,\n                        \"width\": 12}\n    },\n</code></pre>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#general-description","title":"General description","text":"<p>This description is suitable for timeseries plots. Check below for other types:</p> <p></p> <ul> <li><code>plot_type</code>: the plot type to be used. Currently we support <code>timeseries</code>, <code>violin</code>, <code>scatter_matrix</code>, <code>correlation_plot</code>, <code>heatmap</code>, <code>barplot</code>, <code>coherence_plot</code></li> <li><code>plotting_library</code>: <code>matplotlib</code> or <code>plotly</code></li> <li><code>data</code>: the data to represent. This data has to be loaded previously. This is only to define the plot:<ul> <li><code>test</code>: each plot can only represent data from a single <code>test</code></li> <li><code>traces</code>: numbered entries to specify the <code>device</code>, <code>channel</code> and, if applicable, the subplot (only for timeseries)</li> </ul> </li> </ul> <p>Same plot for many devices?</p> <p>Set \"<code>device</code>: 'all'\" and  <code>\"separate_device_plots\": true</code>, and we will make separate plots for each device.</p> <ul> <li><code>options</code>: <ul> <li><code>show_plot</code>: whether or not to show the plot. Not recommended for large amounts</li> <li><code>separate_device_plots</code>: <code>true</code> in case we want a single plot for each device in <code>traces: devices</code>. <code>false</code> in case we want to merge all the devices in a single plot (for comparison purposes). Applicable for timeseries</li> <li><code>target_raster</code>: the frequency of the data to plot. Reduces processing time</li> <li><code>min_date</code>, <code>max_date</code>: if not <code>null</code>, they crop the data with those dates</li> <li><code>export_path</code>: where to put the plot. If <code>null</code>, we won't export anything</li> <li><code>file_name</code>: how to name the plot. We will append the trace name in case <code>separate_device_plots</code> is set to <code>true</code></li> </ul> </li> <li><code>formatting</code>: <ul> <li><code>xlabel</code>: Name to tag the x axis of the plot</li> <li><code>ylabel</code>: Name to tag the y axis(es) of the plot. It can be more than one value in a <code>json</code> style</li> <li><code>yrange</code>: Range fro the y axis(es). Same as above</li> <li><code>title</code>: plot title</li> <li><code>grid</code>: to show the grid or not</li> <li><code>height</code>, <code>width</code>: plot height and width</li> </ul> </li> </ul>"},{"location":"Guides/data/Analyse%20your%20data%20in%20batch/#plots-specifics","title":"Plots specifics","text":"<p>Heatmap</p> <p></p> <pre><code>\"1\" : {\"plot_type\": \"heatmap\",\n        \"plotting_library\": \"matplotlib\",\n        \"data\": {\"test\": \"TEST_1\",\n                \"traces\": {\"1\": {\"device\": \"all\",\n                                \"channel\" : \"NOISE_A\",\n                                \"subplot\": 1}}},\n        \"options\": {\"show_plot\": false,\n                    \"separate_device_plots\": true,\n                    \"target_raster\": \"10Min\",\n                    \"min_date\": null,\n                    \"max_date\": \"2019-01-03\",\n                    \"relative\": false,\n                    \"export_path\": \"/Users/macoscar/Desktop\",\n                    \"file_name\": \"heatmap_noise\"},\n        \"formatting\": {\"title\": \"Magnificent plot\",\n               \"grid\": true,\n               \"height\": 10,\n               \"width\": 15,\n               \"frequency_hours\": 6}\n        }\n</code></pre> <p>Note that in this case it only makes sense to put one trace. If we define <code>\"device\": \"all\"</code>, then <code>\"separate_device_plots\": true</code></p> <ul> <li><code>plotting_library</code>: recommended library is <code>matplotlib</code> (although we actually use seaborn)</li> <li><code>formatting</code>:<ul> <li><code>frequency_hours</code>: to choose between 1, 2, ..., 6, 12, 24. Resamples the data to make it fit in bins of that size to create the heatmap</li> </ul> </li> </ul> <p>Correlation plot</p> <p></p> <pre><code>\"1\" : {\"plot_type\": \"correlation_plot\",\n       \"plotting_library\": \"matplotlib\",\n       \"data\": {\"test\": \"TEST_1\",\n                       \"traces\": {\"1\": {\"device\": \"5261\",\n                                       \"channel\" : \"NOISE_A\",\n                                       \"subplot\": 1},\n                                 \"2\": {\"device\": \"5262\",\n                                      \"channel\": \"TEMP\",\n                                      \"subplot\": 1}}},\n       \"options\": {\"show_plot\": True,\n                   \"separate_device_plots\": false,\n                   \"export_path\": \"/Users/macoscar/Desktop\", \n                   \"file_name\": \"plot_corr\",\n                   \"target_raster\": '10Min',\n                   \"min_date\": None,\n                   \"max_date\": None},\n       \"formatting\": {\"jpkind\": 'scatter',\n                      \"title\": \"Magnificent plot\",\n                      \"xrange\": [0, 100],\n                      \"yrange\": [0, 40],\n                      \"grid\": True,\n                      \"height\": 10,\n                      \"width\": 15}\n       }\n</code></pre> <p>Note that in this case it only makes sense to put two traces, in the same subplot.</p> <ul> <li><code>formatting</code>: <ul> <li><code>jpkind</code>: type as defined in sns.jointplot documentation, to choose from { \u201cscatter\u201d | \u201creg\u201d | \u201cresid\u201d | \u201ckde\u201d | \u201chex\u201d </li> </ul> </li> </ul> <p>Scatter plot matrix</p> <p>The big brother of the <code>correlation plot</code>:</p> <p></p> <pre><code>\"1\" : {\"plot_type\": \"scatter_matrix\",\n        \"plotting_library\": \"matplotlib\",\n        \"data\": {\"test\": \"TEST_1\",\n                        \"traces\": {\"1\": {\"device\": \"5262\",\n                                        \"channel\" : \"GB_2W\",\n                                        \"subplot\": 1},\n                                  \"2\": {\"device\": \"5262\",\n                                       \"channel\": \"TEMP\",\n                                       \"subplot\": 1},\n                                  \"3\": {\"device\": \"5262\",\n                                       \"channel\": \"HUM\",\n                                       \"subplot\": 1}}},\n        \"options\": {\"show_plot\": True,\n                    \"separate_device_plots\": False,\n                    \"export_path\": \"/Users/macoscar/Desktop\", \n                    \"file_name\": \"plot_scatter\",\n                    \"target_raster\": '10Min',\n                    \"min_date\": None,\n                    \"max_date\": None},\n        \"formatting\": {\"title\": \"Magnificent plot\",\n                       \"grid\": True,\n                       \"height\": 4,\n                       \"width\": 4}\n        }\n</code></pre> <p>Coherence plot</p> <p></p> <p>This plot it's used to plot the coherence between x and y. Coherence is the normalized cross spectral density. More info here:</p> <pre><code>\"1\" : {\"plot_type\": \"coherence_plot\",\n        \"plotting_library\": \"matplotlib\",\n        \"data\": {\"test\": \"TEST_1\",\n                        \"traces\": {\"1\": {\"device\": \"5262\",\n                                        \"channel\" : \"GB_2W\",\n                                        \"subplot\": 1},\n                                  \"2\": {\"device\": \"5262\",\n                                       \"channel\": \"TEMP\",\n                                       \"subplot\": 1}}},\n        \"options\": {\"show_plot\": True,\n                    \"separate_device_plots\": False,\n                    \"export_path\": \"/Users/macoscar/Desktop\", \n                    \"file_name\": \"plot_coherence\",\n                    \"target_raster\": '10Min',\n                    \"min_date\": None,\n                    \"max_date\": None},\n        \"formatting\": {\"title\": \"Magnificent plot\",\n                       \"grid\": True,\n                       \"height\": 10,\n                       \"width\": 15}\n        }\n</code></pre> <p>Violin plot</p> <p></p> <p>This plot shows the signal distribution. </p> <pre><code>\"1\" : {\"plot_type\": \"violin\",\n        \"plotting_library\": \"matplotlib\",\n        \"data\": {\"test\": \"TEST_1\",\n                        \"traces\": {\"1\": {\"device\": \"5262\",\n                                          \"channel\" : \"DALLAS_TEMP\",\n                                        \"subplot\": 1},\n                                    \"2\": {\"device\": \"5262\",\n                                           \"channel\" : \"HUM\",\n                                           \"subplot\": 1},\n                                     \"3\": {\"device\": \"5262\",\n                                           \"channel\" : \"TEMP\",\n                                           \"subplot\": 1},\n                                     \"4\": {\"device\": \"5262\",\n                                           \"channel\" : \"GB_2W\",\n                                           \"subplot\": 1},\n                                     \"5\": {\"device\": \"5262\",\n                                           \"channel\" : \"GB_2A\",\n                                           \"subplot\": 1},\n                                     \"6\": {\"device\": \"5262\",\n                                           \"channel\" : \"GB_3W\",\n                                           \"subplot\": 1}}},\n        \"options\": {\"show_plot\": True,\n                    \"separate_device_plots\": False,\n                    \"export_path\": \"/Users/macoscar/Desktop\", \n                    \"file_name\": \"plot_violin\",\n                    \"target_raster\": '10Min',\n                    \"min_date\": None,\n                    \"max_date\": '2019-01-03',\n                    \"relative\": False,\n                    \"ylabel\": {1: \"External temperature\",\n                               2: \"Humidity (%RH)\",\n                               3: \"Temperature (degC)\",\n                               4: \"Wir\",\n                               5: \"Wor\",\n                               6: \"Wur\"},\n                    \"yrange\": {1: [0, 90],\n                               2: [300, 2000],\n                               3: [0, 60],\n                               4: [0, 60],\n                               5: [0,60],\n                               6: [0,60]},\n                   },\n        \"formatting\": {\"title\": \"Magnificent plot\",\n                       \"grid\": True,\n                       \"height\": 10,\n                       \"width\": 15}\n        }\n</code></pre>"},{"location":"Guides/data/Creating%20Interfaces/","title":"Creating Interfaces","text":""},{"location":"Guides/data/Creating%20Interfaces/#custom-dashboards-and-notifications","title":"Custom dashboards and notifications","text":"<p>When working on deployments that involve multiple devices a community might face the need to create their own page where the sensors\u2019 data is updated on real time. Also, it is sometimes useful to trigger notifications on different services.</p> <p>This can help to look at data from different spots simultaneously and also to create a sense of community among the devices\u2019 owners. This feature can be easily built using Freeboards or Node-RED, both online free visual tool that supports the creation of dashboards. Additionally, [Node-RED] can be used to create notifications on common services such as Twitter or Telegram.</p>"},{"location":"Guides/data/Creating%20Interfaces/#node-red","title":"Node RED","text":"<p>Node-RED is an open-source visual tool that enabled the wiring of hardware devices, APIs and online services. The tool can be easily installed on any local computer or it can be used directly on the Smart Citizen infrastructure. </p> <p>Examples</p> <p>You can find the following examples in the toolkit repository:</p> <ul> <li>Trigger notifications</li> <li>Device dashboard</li> </ul>"},{"location":"Guides/data/Creating%20Interfaces/#freeboard","title":"Freeboard","text":"<p>WIP</p> <p>This is a work in progress. You can find a demo here</p>"},{"location":"Guides/data/Creating%20Interfaces/#talk-to-the-world","title":"Talk to the world","text":"<p>Due to their unobtrusive nature, sensor technologies like Smart Citizen may easily blend in the background of users\u2019 attention. To bring the sensed data back to the surface and support sensemaking and awareness processes, it is possible to use the SCKs\u2019 data to trigger actions on the physical environment.</p> <p>A Raspberry Pi is probably the best tool to do so, since it can also be a suitable tool to engage people with coding, creating new internet of things (IoT) and physical computing applications.</p> <p></p>"},{"location":"Guides/data/Creating%20Interfaces/#blink-example","title":"Blink example","text":"<p>This example presents a small Python script that can turn two lights based on the real-time temperature data from a remote sensor on the Smart Citizen platform.</p> <p>We will implement a simple logic: When temperature on the remote sensor reaches 25 degrees then turn the first light on. When temperature is below 25 degrees turn the first light off and then turn the other light on. We will use the Raspberry Pi GPIOs (General Purpose Input Outputs)_ to connect to LED\u2019s that represent the status of our sensor.</p> <p>Step-by-step</p> <p>We will need to wire the two LED\u2019s following the schematic below:</p> <p></p> <p>Once we have the Raspberry Pi running and connected to the internet we will need to save the Python script below on the desktop:</p> <pre><code># Smart Citizen Examples for the Raspberry Pi\n#\n# http://smartcitizen.me\n#\n# Trigger 2 LEDs depending on the temperature\n# For more information on the LEDs connection check: https://learn.sparkfun.com/tutorials/raspberry-gpio\n# For more information on the SmartCitizen API check: http://developer.smartcitizen.me\n#\nimport RPi.GPIO as GPIO\nimport json, requests, time\nGPIO.setup(18, GPIO.OUT)\nGPIO.setup(23, GPIO.OUT)\nwhile True:\nr = requests.get(\u2018https://api.smartcitizen.me/v0/devices/3292\u2019)\ndata = json.loads(r.text)\nfor sensor in data[\u2018data\u2019][\u2018sensors\u2019]:\nif sensor[\u2018description\u2019] == \u2018Temperature\u2019: #CO, NO2...\nprint sensor[\u2018value\u2019]\nif sensor[\u2018value\u2019] &gt; 25:\nprint \u2018LED ON\u2019\nGPIO.output(18, GPIO.HIGH)\nGPIO.output(23, GPIO.LOW)\nelse:\nprint \u2018LED OFF\u2019\nGPIO.output(18, GPIO.LOW)\nGPIO.output(23, GPIO.HIGH)\ntime.sleep(15) #Update every 15 seconds\n</code></pre> <p>Finally, open the Terminal app and run:</p> <pre><code>pi@raspberrypi ~ $ cd Desktop\npi@raspberrypi Desktop $ sudo python smartcitizen-led.py\n</code></pre>"},{"location":"Guides/data/Creating%20Interfaces/#the-sensor-box","title":"The sensor box","text":"<p>The Sensor Box is display installation aimed at engaging citizens to discuss about data on the public space. The installation was built by the Making Sense Barcelona community champions to talk about noise problems affecting neighbours around the Pla\u00e7a del Sol area in Barcelona. However the installation was built from the ground up to be replicable ad easy to built in oder Fab Labs worldwide. This aims at creating a tool communities can built to engage citizens to discuss about issues by using the data provided by the Smart Citizen Kit.</p> <p></p> <p>The device comprises a wooden box equipped with a Smart Citizen Kit to which was a 5 meter long LED strip has been attached. Participants can press a button on the box to trigger the noise sensor. The original installation was battery powered but it can also be plugged to simplify the design and cost.</p> <p>Step-by-step</p> <p>Visit the public displays repository and download the directory.</p> <p>The <code>/built</code> folder contains the files for building the installation: NoiseBox.blend the whole installation design in blender, CableClip.stl and Hinge.stl 3D printed parts for the cable clips and hinges used, Acrylic.dxf the acrylic cover lasercut file and noiseBoxSchematic.fzz the wiring diagram for the installation.</p> <p>The <code>/code</code> folder contains the Arduino files to drive the installation. The Arduino sketch reads sensor data from an SCK 1.5 over the I2C bus when a user presses the button display the result on a WS2811 addressable LED strip. This code was originally created to display reading from the noise sensor in dB but it can quickly be changed to support any other sensor. It runs on an Arduino UNO but any compatible board can be used.</p> <p></p> <p>Check out the Making Sense D2.3 Smart Citizen Toolkit report and Making Sense D.24 Smart Citizen Toolkit report updates for more examples!</p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/","title":"Model your sensor data","text":"<p>In this section, we will detail how to develop models for our sensors. We will try two different approaches for model calibration:</p> <ul> <li>Ordinary Least Squares (OLS): based on the statsmodels package, the model is able to ingest an expression referring to the kit's available data and perform OLS regression over the defined training and test data</li> <li>Machine Learning (LSTM): based on the keras package using tensorflow in the backend. This framework can be used to train larger collections of data, among others:<ul> <li>Robust to noise</li> <li>Learn non-linear relationships</li> <li>Aware of temporal dependence</li> </ul> </li> </ul> <p>Load some data first</p> <p>We will need to load the data first, for this, check the guides to organise the data and to load it</p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#ordinary-least-squares-example","title":"Ordinary Least Squares example","text":"<p>Let's delve first into an OLS example. </p> <p>Info<p>You can follow this example using this notebook</p> </p> <pre><code>from src.models.model import model_wrapper\n\n# Input model description\nmodel_description_ols = {\"model_name\": \"OLS_UCD\",\n                    \"model_type\": \"OLS\",\n                    \"model_target\": \"ALPHASENSE\",\n                    \"data\": {\"train\": {\"2019-03_EXT_UCD_URBAN_BACKGROUND_API\": {\"devices\": [\"5262\"],\n                                                                               \"reference_device\": \"CITY_COUNCIL\"}},\n                            \"test\": {\"2019-03_EXT_UCD_URBAN_BACKGROUND_API\": {\"devices\": [\"5565\"],\n                                                                               \"reference_device\": \"CITY_COUNCIL\"}},\n                            \"features\":  {\"REF\": \"NO2_CONV\",\n                                            \"A\": \"GB_2W\",\n                                            \"B\": \"GB_2A\",\n                                            \"C\": \"HUM\"},\n                            \"data_options\": {\"frequency\": '1Min',\n                                            \"clean_na\": True,\n                                            \"clean_na_method\": \"drop\",\n                                            \"min_date\": None,\n                                            \"frequency\": \"1Min\",\n                                            \"max_date\": '2019-01-15'},\n                            },\n                    \"hyperparameters\": {\"ratio_train\": 0.75},\n                    \"model_options\": {\"session_active_model\": True,\n                                \"show_plots\": True,\n                                \"export_model\": False,\n                                \"export_model_file\": False,\n                                \"extract_metrics\": True}\n                    }\n</code></pre> <p>More info</p> <p>Check the guide on batch analysis for a definition of each parameter.</p> <p>We have to keep at least the key <code>REF</code> within the <code>\"features\"</code>, but the rest can be renamed at will. We can also input whichever <code>formula_expression</code> for the model regression in the following format:</p> <pre><code>\"expression\" : 'REF ~ A + np.log(B)'\n</code></pre> <p>Which converts to:</p>  REF = A + log(B)  <p>We can also define the ratio between the train and test dataset and the minimum dates to use within the datasets (globally):</p> <pre><code>min_date = '2018-08-31 00:00:00'\nmax_date = '2018-09-06 00:00:00'\n\n# Important that this is a float, don't forget the .\n\"hyperparameters\": {\"ratio_train\": 0.75} \n</code></pre> <p>If we run this cell, we will perform model calibration, with the following output:</p> <pre><code>                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                    REF   R-squared:                       0.676\nModel:                            OLS   Adj. R-squared:                  0.673\nMethod:                 Least Squares   F-statistic:                     197.5\nDate:                Thu, 06 Sep 2018   Prob (F-statistic):          1.87e-135\nTime:                        12:25:17   Log-Likelihood:                 1142.9\nNo. Observations:                 575   AIC:                            -2272.\nDf Residuals:                     568   BIC:                            -2241.\nDf Model:                           6                                         \nCovariance Type:            nonrobust                                         \n==================================================================================\n                     coef    std err          t      P&gt;|t|      [0.025      0.975]\n----------------------------------------------------------------------------------\nIntercept         -3.7042      0.406     -9.133      0.000      -4.501      -2.908\nA                  0.0011      0.000      2.953      0.003       0.000       0.002\nnp.log(B) -3.863e-05   7.03e-06     -5.496      0.000   -5.24e-05   -2.48e-05\n\n==============================================================================\nOmnibus:                        7.316   Durbin-Watson:                   0.026\nProb(Omnibus):                  0.026   Jarque-Bera (JB):               10.245\nSkew:                          -0.076   Prob(JB):                      0.00596\nKurtosis:                       3.636   Cond. No.                     4.29e+05\n==============================================================================\n\nWarnings:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n[2] The condition number is large, 4.29e+05. This might indicate that there are\nstrong multicollinearity or other numerical problems.\n</code></pre> <p>This output brings a lot of information. First, we find what the dependent variable is, in our case always <code>'REF'</code>. The type of model used and some general information is shown below that.</p> <p>More statistically important information is found in the rest of the output. Some key data:</p> <ul> <li>R-squared and adjusted R-squared: this is our classic correlation coefficient or R2. The adjusted one aims to correct the model overfitting by the inclusion of too many variables, and for that introduces a penalty on the number of variables included</li> <li>Below, we can find a summary of the model coefficients applied to all the variables and the P&gt;|t| term, which indicates the significance of the term introduced in the model</li> <li>Model quality diagnostics are also indicated. Kurtosis and skewness are metrics for determining the distribution of the residuals. They indicate how the residuals of the model resemble a normal distribution. Below, we will review more on diagnosis plots. The Jarque Bera test indicates if the residuals are normally distributed (the null hypothesis is a joint hypothesis of the skewness being zero and the excess kurtosis being zero), and a value of zero indicates that the data is normally distributed. If the Jarque Bera test is valid (in the case above it isn't), the Durbin Watson is applicable in order to check for autocorrelation of the residuals (meaning that the residuals of our model are related among themselves and that we haven't captured some characteristics of our data with the tested model).</li> </ul> <p>Finally, there is a warning at the bottom indicating that the condition number is large. It suggests we might have multicollinearity problems in our model, which means that some of the independent variables might be correlated among themselves and that they are probably not necessary.</p> <p>Our function also depicts the results in a graphical way for us to see the model itself. It will show the training and test datasets (as <code>Reference Train</code> and <code>Reference Test</code> respectively), and the prediction results. The mean and absolute confidence intervals for 95% confidence are also shown:</p> <p></p> <p>Now we can look at some other model quality plots. If we run the cell below, we will obtain an adaptation of the summary plots from R:</p> <pre><code>from linear_regression_utils import modelRplots\n%matplotlib inline\n\nmodelRplots(model, dataTrain, dataTest)\n</code></pre> <p>Let's review the output step by step:</p> <ul> <li>Residual vs Fitted and Scale Location plot: these plots represents the model heteroscedasticity , which is a representation of the residuals versus the fitted values. This plot is helpful to check if the errors are distributed homogeneously and that we are not penalising high, low, or other values. There is also a red line which represents the average trend of this distribution which, we want it to be horizontal. For more information visit here and here. Clearly, in this model we are missing something:</li> </ul> <p></p> <ul> <li> <p>Normal QQ: the qq-plot is a representation of the kurtosis and skewness of the residuals distribution. If the data were well described by a normal distribution, the values should be about the same, i.e.: on the diagonal (red line). For example, in our case the model presents a deviation on both tails, indicating skewness. In general, a simple rubric to interpret a qq-plot is that if a given tail twists off counterclockwise from the reference line, there is more data in that tail of your distribution than in a theoretical normal, and if a tail twists off clockwise there is less data in that tail of your distribution than in a theoretical normal. In other words:</p> <ul> <li>if both tails twist counterclockwise we have heavy tails (leptokurtosis),</li> <li>if both tails twist clockwise, we have light tails (platykurtosis),</li> <li>if the right tail twists counterclockwise and the left tail twists clockwise, we have right skew</li> <li>if the left tail twists counterclockwise and the right tail twists clockwise, we have left skew</li> </ul> </li> </ul> <p></p> <ul> <li> <p>Residuals vs Leverage: this plot is probably the most complex of them all. It shows how much leverage one single point has on the whole regression. It can be interpreted as how the average line that passes through all the data (that we are calculating with the OLS) can be modified by 'far' points in the distribution, for example, outliers. This leverage can be seen as how much a single point is able to pull down or up the average line. One way to think about whether or not the results are driven by a given data point is to calculate how far the predicted values for your data would move if your model were fit without the data point in question. This calculated total distance is called Cook's distance. We can have four cases (more information from source, here)</p> <ul> <li>everything is fine (the best)</li> <li>high-leverage, but low-standardized residual point</li> <li>low-leverage, but high-standardized residual point</li> <li>high-leverage, high-standardized residual point (the worst)</li> </ul> </li> </ul> <p></p> <p>In this case, we see that our model has some points with higher leverage but low residuals (probably not too bad) and that the higher residuals are found with low leverage, which means that our model is safe to outliers. If we run this function without the filtering, some outliers will be present and the plot turns into:</p> <p></p> <p>Finally, we can export our model and generate some metrics to evaluate the results.</p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#machine-learning-example","title":"Machine learning example","text":"<p>Machine learning algorithms promise a better representation of the sensor's data, being able to learn robust non-linear models and sequential dependencies. For that reason, we have implemented toolset based on keras with Tensorflow backend, in order to train sequential models 3.</p> <pre><code>model_description_rf = {\"model_name\": \"RF_UCD\",\n                    \"model_type\": \"RF\",\n                    \"model_target\": \"ALPHASENSE\",\n                    \"data\": {\"train\": {\"2019-03_EXT_UCD_URBAN_BACKGROUND_API\": {\"devices\": [\"5262\"],\n                                                                               \"reference_device\": \"CITY_COUNCIL\"}},\n                            \"test\": {\"2019-03_EXT_UCD_URBAN_BACKGROUND_API\": {\"devices\": [\"5565\"],\n                                                                               \"reference_device\": \"CITY_COUNCIL\"}},\n                            \"features\":  {\"REF\": \"NO2_CONV\",\n                                            \"A\": \"GB_2W\",\n                                            \"B\": \"GB_2A\",\n                                            \"C\": \"HUM\"},\n                            \"data_options\": {\"target_raster\": '1Min',\n                                            \"clean_na\": True,\n                                            \"clean_na_method\": \"drop\",\n                                            \"min_date\": None,\n                                            \"frequency\": \"1Min\",\n                                            \"max_date\": '2019-01-15'},\n                            },\n                    \"hyperparameters\": {\"ratio_train\": 0.75, \n                                        \"min_samples_leaf\": 2,\n                                        \"max_features\": None,\n                                       \"n_estimators\": 100,\n                                        \"shuffle_split\": True},\n                    \"model_options\": {\"session_active_model\": True,\n                                \"show_plots\": True,\n                                \"export_model\": False,\n                                \"export_model_file\": False,\n                                \"extract_metrics\": True}\n                    }\n</code></pre> <p>Output:</p> <pre><code>Using TensorFlow backend.\n...\nBeginning Model RF_UCD\nModel type RF\nPreparing dataframe model for test 2019-03_EXT_UCD_URBAN_BACKGROUND_API\nData combined successfully\nCreating models session in recordings\nDataframe model generated successfully\nTraining Model RF_UCD...\nTraining done\nVariable: HUM_5262 Importance: 0.4\nVariable: GB_2W_5262 Importance: 0.31\nVariable: GB_2A_5262 Importance: 0.3\nCalculating Metrics...\nMetrics Summary:\nMetric                  Train   Test \navg_ref                 16.648  15.861\navg_est                 16.666  16.000\nsig_ref                 11.438  10.584\nsig_est                 9.493   9.404\nbias                    0.019   0.139\nnormalised_bias         0.002   0.013\nsigma_norm              0.830   0.888\nsign_sigma              -1.000  -1.000\nrsquared                0.799   0.879\nRMSD                    5.124   3.677\nRMSD_norm_unb           0.453   0.351\nNo specifics for RF type\nPreparing devices from prediction\nChannel 5262_RF_UCD prediction finished\n</code></pre> <p>This will also output some nice plots for visually checking our model performance:</p> <p></p> <p>And some extras about variable importance:</p> <p></p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#model-comparison","title":"Model comparison","text":"<p>Here is a visual comparison of both models:</p> <p></p> <p>It is very difficult though, to know which one is performing better. Let's then evaluate and compare our models. In order to evaluate it's metrics, we will be using the following principles12:</p> <p>Info</p> <p>In all of the expressions below, the letter m indicates the model field, r indicates the reference field. Overbar is average and \\sigma\\sigma is the standard deviation.</p> <p>Linear correlation Coefficient A measure of the agreement between two signals:</p>  R = {{1 \\over N} \\sum_{i=0}^n (m_n - \\overline m)( r_n - \\overline r ) \\over \\sigma_m \\sigma_r}   R = {{1 \\over N} \\sum_{i=0}^n (m_n - \\overline m)( r_n - \\overline r ) \\over \\sigma_m \\sigma_r}  <p>The correlation coefficient is bounded by the range -1 \\le R \\le 1-1 \\le R \\le 1. However, it is difficult to discern information about the differences in amplitude between two signals from R alone.</p> <p>Normalized standard deviation A measure of the differences in amplitude between two signals:</p>  \\sigma * = {\\sigma_m \\over \\sigma_r}   \\sigma * = {\\sigma_m \\over \\sigma_r}  <p>unbiased Root-Mean-Square Difference A measure of how close the modelled points fall to teach other:</p>  RMSD' = \\Bigl( {1 \\over N} \\sum_{n=1}^N [(m_n - \\overline m)-(r_n - \\overline r)]^2  \\Bigr)^{0.5}   RMSD' = \\Bigl( {1 \\over N} \\sum_{n=1}^N [(m_n - \\overline m)-(r_n - \\overline r)]^2  \\Bigr)^{0.5}  <p>Potential Bias Difference between the means of two fields: $$ B = \\overline m - \\overline r $$ Total RMSD A measure of the average magnitude of difference: $$ RMSD = \\Bigl( {1 \\over N} \\sum_{n=1}^N (m_n - r_n)^2  \\Bigr)^{0.5} $$</p> <p>In other words, the unbiased RMSD (RMSD') is equal to the total RMSD if there is no bias between the model and the reference fields (i.e. B = 0). The relationship between both reads:</p>  RMSD^2 = B^2 + RMSD'^2   RMSD^2 = B^2 + RMSD'^2  <p>In contrast, the unbiased RMSD may be conceptualized as an overall measure of the agreement between the aplitude (\\sigma\\sigma) and phase (\\phi\\phi) of two temporal patterns. For this reason, the correlation coefficient (RR), normalised standard deviation (\\sigma*\\sigma*), and unbiased RMSD are all referred to as patern statistics, related to one another by:</p>  RMSD'^2 = \\sigma_r^2 + \\sigma_m^2 - 2\\sigma_r\\sigma_mR   RMSD'^2 = \\sigma_r^2 + \\sigma_m^2 - 2\\sigma_r\\sigma_mR  <p>Normalized and unbiased RMSD If we recast in standard deviation normalized units (indicated by the asterisk) it becomes:</p>  RMSD'^* = \\sqrt { 1 + \\sigma*^2 - 2\\sigma*R}   RMSD'^* = \\sqrt { 1 + \\sigma*^2 - 2\\sigma*R}  <p>NB: the minimum of this function occurrs when \\sigma* = R\\sigma* = R.</p> <p>Normalized bias Gives information about the mean difference but normalized by the \\sigma*\\sigma* $$ B* = {\\overline m - \\overline r \\over \\sigma_r} $$</p> <p>Target diagrams The target diagram is a plot that provides summary information about the pattern statistics as well as the bias thus yielding an overview of their respective contributions to the total RMSD. In a simple Cartesian coordinate system, the unbiased RMSD may serve as the X-axis and the bias may serve as the Y-axis. The distance between the origin and the model versus observation statistics (any point, s, within the X,Y Cartesian space) is then equal to the total RMSD. If all is normalized by the \\sigma_r\\sigma_r, the distance from the origin is again the standard deviation normalized total RMSD:1</p>  RMSD^{*2} = B^{*2}+RMSD^{*'2}   RMSD^{*2} = B^{*2}+RMSD^{*'2}  <p>The resulting target diagram then provides information about:</p> <ul> <li>whether the \\sigma_m\\sigma_m is larger or smaller thann the \\sigma_r\\sigma_r</li> <li>whether there is a positive or negative bias</li> </ul> <p></p> <p>Image Source: Jolliff et al. 1</p> <p>Any point greater than RMSD*=1 is to be considered a poor performer since it doesn't offer improvement over the time series average.</p> <p>Interestingly, the target diagram has no information about the correlation coefficient R, but some can be inferred, knowing that all the points within the RMSD* &lt;1 are positively correlated (R&gt;0), although, in 1 it is shown that a circle marker with radius M_{R1}M_{R1}, means that all the points between that marker and the origin have a R coefficient larger than R1, where:</p>  M_{R1} = min(RMSD*') = \\sqrt {1+R1^2-2R1^2}   M_{R1} = min(RMSD*') = \\sqrt {1+R1^2-2R1^2}"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#results","title":"Results","text":"<p>Let's now compare both models with the target diagram:</p> <pre><code>from src.visualization.visualization import targetDiagram\n%matplotlib inline\nmodels = dict()\n\ngroup = 0\nfor model in [ols_model, rf_model]:\n    for dataset in ['train', 'validation']:\n        if dataset in model.metrics.keys(): \n            models[model.name + '_' + dataset] = model.metrics[dataset]\n            models[model.name + '_' + dataset]['group'] = group\n\ntargetDiagram(models, True, 'seaborn-talk')\n</code></pre> <p>Output:</p> <p></p> <p>Here, every point that falls inside the yellow circle, will have an R2 over 0.7, and so will be the red and green for R2 over 0.5 and 0.9 respectively. We see that only one of our models performs well in that sense, which is the training dataset of the OLS. However, this dataset performs pretty badly in the test dataset, being the LSTM options much better. This target diagram offers information about how the hyperparameters affect our networks. For instance, increasing the training epochs from 100 to 200 does not affect greatly on model performance, but the effect of filtering the data beforehand to reduce the noise shows a much better model performance in both, training and test dataframe.</p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#export-the-models","title":"Export the models","text":"<p>Let's now assume that we are happy with our models. We can now export them:</p> <pre><code>ols_model.export('directory')\nrf_model.export('directory')\n</code></pre> <p>Output:</p> <pre><code>Saving metrics\nSaving hyperparameters\nSaving features\nModel included in summary\n</code></pre> <p>And in our directory:</p> <pre><code>\u279c  models ls -l\nRF_UCD_features.sav\nRF_UCD_hyperparameters.sav\nRF_UCD_metrics.sav\n</code></pre> <p>Save the model file</p> <p>If you want to save the model file into the disk, change the option <code>\"export_model\": False,</code> to <code>True</code>! Be careful though, it can take quite a lot of space. If you just want to keep the model to test in the current session, it is best to just use <code>\"session_active_model\": True,</code>.</p>"},{"location":"Guides/data/Creating%20Models%20for%20Sensors%20Calibration/#references","title":"References","text":"<ol> <li> <p>Engineering statistics handbook \u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>Summary diagrams for coupled hydrodynamic-ecosystem model skill assessment (Jolliff et al.) \u21a9</p> </li> <li> <p>Machine learning mastery \u21a9</p> </li> </ol>"},{"location":"Guides/data/Custom%20data%20processing/","title":"Custom data processing","text":"<p>Some units require performing data processing after readings are collected, and we provide default algorithms for all the data we collect. Iin the default scenario, for those sensors that need it (i.e. electrochemical sensors), raw data is processed outside of the units in a periodic way by <code>scdata</code>. However, you might need to perform custom data processing algorithms on your data. You can do so by simply accessing the data on our API, and then working with it offline, or you can set up an automatic data processing workflow. To summarise, there are two ways to have a custom data processing:</p> <ol> <li>Set up a development environment and following the example on data processing</li> <li>Follow the guide below for automatic processing</li> </ol> <p>Too confusing?</p> <p>Contact us and or open a topic in the forum and we will try to help!</p>"},{"location":"Guides/data/Custom%20data%20processing/#automatic-data-processing","title":"Automatic data processing","text":"<p>Data is processed in a recurrent manner whenever there is <code>postprocessing</code> field in the device data tree. You can check it by visiting <code>https://api.smartcitizen.me/v0/devices/&lt;device-id&gt;</code> where <code>&lt;device-id&gt;</code> is the number that follows in the url <code>https://smartcitizen.me/kits/XXXXXX</code>.</p> <p>How to do it?</p> <p>Visit these instructions to make sure your <code>postprocessing</code> is safely stored.</p> <p>The <code>postprocessing</code> field is composed of several subfields being the most important  one for the automatic data processing the <code>hardware_url</code>.</p> <p>The <code>hardware_url</code> should point to a valid json file that contains the necessary information for the data processing. This json file is customisable, but should contain at least the fields defined in the calibration guide. In order to customize how our data is processed, we will need to modify the <code>blueprint_url</code> and, if we have specific calibration needs, the <code>versions</code> field. Once these changes are done, this hardware json should go in the hardware folder or any other place that can host it.</p> <p>The <code>blueprint_url</code> should point to a json that defines which postprocessing you want to apply for each channel, which functions and parameters it has, and how the new channels are called (don't worry, there are a lot of examples in the blueprints folder). In order for your data to be processed automatically, you will need to provide that blueprint to <code>scdata</code>. For this, you can host it somewhere, or you can simply make a pull request to the scdata github repository, having the new json in the <code>blueprints</code> folder. Finally, you will then need to modify <code>hardware</code> json and update the blueprint field of your kit, with the new <code>blueprint_url</code>. See below to understand how this blueprint works and how to write custom fuctions.</p> <p>In case your kit has specific calibration data needs, you will also need to modify the <code>versions</code> field. This field is a list which contains the history of the kit in terms of calibration (calibrations can change with time):</p> <pre><code>    {\n      \"ids\": {\n        \"AS_48_32\": \"132070362\",\n        \"AS_49_10\": \"212070552\",\n        \"PT_49_23\": \"12-000445\"\n      },\n      \"from\": \"2021-01-21\",\n      \"to\": null\n    }\n</code></pre> <p>Each of the <code>ids</code> field make reference to specific calibration ids for each timespan, where the <code>from</code> and <code>to</code> fields are the dates during which those ids where valid. This method ensures allows to change sensors with time, and also considers that normally sensors that have specific calibrations use a serial number or similar to identify them.</p> <p>In the <code>ids</code> field, the keys (<code>AS_48_32</code>, <code>AS_49_10</code>, ... in the example above), define the type of sensor id (<code>AS</code> is an Alphasense sensor, <code>PT</code> is a PT100 temperature probe) and potentially other useful identifiers, such ADC addresses and channels (i.e. <code>AS_48_32</code> defines an Alphasense sensor connected to the ADC in address 0x48 and channel 3 for the working electrode and channel 2 for the auxiliary electrode). Other sensor types would need to defined and we can support in the implementation process. Finally, the actual sensor id, and the calibration data associated with it, is stored in another json, this time in the calibrations folder. Similarly to the blueprints above, a simple pull request would work.</p>"},{"location":"Guides/data/Custom%20data%20processing/#defining-custom-functions","title":"Defining custom functions","text":"<p>If you want to define custom processing functions, make a Pull Request to the repository of scdata to integrate your functions. Otherwise, you can make a fork and install the package in <code>editable mode</code>. You can then add the functions in the device processing folder of your own. We are available at support@smartcitizen.me for more support.</p>"},{"location":"Guides/data/Handling%20calibration%20data/","title":"Handling calibration data","text":"<p>This guide will help you manage the calibration data for your units. Some sensors perform the data processing on the sensor itself, but other sensor types need more advanced computation that cannot be done in the Smart Citizen Data Board. The table below summarises when you will need to store this calibration data on our platform for it to be processed automatically:</p> Sensor type Processing data Calibration data Basic environmental metrics (T, H, P, Light) On the sensor None Noise On the sensor None tVOC, eCO2 On the sensor None Particulate Matter On the sensor None CO2 On the sensor None Air Quality electrochemical sensors On the platform Based on the hardware ID (see below) Water Quality sensors On the sensor None"},{"location":"Guides/data/Handling%20calibration%20data/#how-to-store-calibration-data","title":"How to store calibration data","text":"<p>Warning</p> <p>Only do this once you have finished setting up your kit. Remember that this process is only needed in case your sensors require calibration (air quality sensors such as CO, NOx, SO2, H2S, OX, and sometimes CO2). This is not necessary for water sensors. If you are using water sensors, follow this guide.</p> <p>The calibration data for is managed by a unique <code>hardware ID</code>, and should be visible on the device itself (on a yellow sticker, normally on the form of SCAS21000X) as seen below:</p> <p></p> <p>Danger</p> <p>This <code>hardware ID</code> is not the same as the <code>kit ID</code>. The <code>kit ID</code> is the number you have after the smartcitizen.me/kits/ url where you see the data of your kit. The <code>hardware ID</code> is the one in the sticker. The hardware ID is meant to never change, while the <code>kit ID</code> can change as you can register your kit many times!</p> <p>The easiest way to store this ID is to visit your kit and click on the EDIT button:</p> <p></p> <p>Then, in <code>hardware URL</code> field, introduce the number in the yellow sticker. Save your work and you are done!</p> <p></p>"},{"location":"Guides/data/Handling%20calibration%20data/#advanced-setup","title":"Advanced setup","text":"<p>Warning</p> <p>Only follow these steps if you are working on the data post-processing of the sensors, or you know what all this means!</p> <p>The above mentioned <code>hardware ID</code> serves to identify the hardware calibration data, alongside with the processing description we want for that device. All this information can be saved in the platform's device using the <code>postprocessing</code> field of the device.</p> <p>The <code>hardware url</code> field in the kit edit page can contain a simple <code>id</code> as shown above or an URL pointing to a valid <code>json</code>:</p> <p></p> <p>This url should point to a valid json, and as long as it follows the instructions defined here, it will be picked up for data postprocessing. A simpler way, is that it can simply be one of the <code>HARDWARE-ID</code> from the list of jsons available in <code>https://raw.githubusercontent.com/fablabbcn/smartcitizen-data/master/hardware/&lt;HARDWARE-ID&gt;.json</code>. The default hardware definitions are in the scdata github repository and can be found per <code>ID.json</code>. You can just take the corresponding ID and click in the <code>raw</code> button to get the url needed. If you are using this method, and an url from github, this field should look something like: <code>https://raw.githubusercontent.com/fablabbcn/smartcitizen-data/master/hardware/SCAS21001.json</code>.</p> <p>With either method, url or <code>HARDWARE-ID</code>, the json file needs to follow the instructions below to successfully be a valid postprocessing:</p> <pre><code>{\n  \"blueprint_url\": \"https://raw.githubusercontent.com/fablabbcn/smartcitizen-data/master/blueprints/sck_21.json\",\n  \"description\": \"Smart Citizen Kit 2.1 With PMS5003\",\n  \"versions\": [],\n  \"forwarding\": \"nilu\"\n}\n</code></pre> <ul> <li><code>blueprint_url</code>: this field defines the post-processing to be done in the form of a <code>device-blueprint</code>. It virtually can load a valid json from any url, as long as it follows the instructions defined here and here. If you want to use the base processing select it from the blueprints folder, only selecting the <code>raw</code> json as mentioned above. If you have doubts, please, contact us to make sure everything will run smoothly. Finally, other blueprints can be added as defined in this guide</li> <li><code>description</code>: brief description of the hardware</li> <li> <p><code>versions</code>: list containing hardware versions (in case sensors where replaced, but kept in the same physical unit).     <pre><code>  \"versions\": [\n    {\n      \"ids\": {\n        \"AS_48_01\": \"162581715\",\n        \"AS_48_23\": \"202365014\",\n        \"AS_4A_01\": \"164200218\",\n        \"AS_4A_23\": \"204440527\"\n      },\n      \"from\": \"2020-11-30\",\n      \"to\": null\n    }\n  ]\n</code></pre></p> <p>In the versions information, data is stored based on the IDs of the sensors and a naming convention to understand were they are connected to or what they are. It is easier to understand the naming convention with an example:</p> <ul> <li><code>AS_48_01</code>: Alphasense Electrochemical sensor, connected to the ADC with address <code>48</code>, with the Working Electrode connected to the channel 0 of the ADC, and the Auxiliary Electrode connected to the channel 1 of the ADC. The logic is explained below:<ul> <li><code>AS</code> refers to Alphasense. This implies that the rest of the name is going to be on the format <code>X_YZ</code></li> <li><code>48</code> refers to the ADC (analog to digital converter) I2C address. Since we only store the raw data values from the ADC, we use the ADC I2C address to refer to the needed channels</li> <li><code>01</code> are the two channels from the ADC in question that are used for measuring the WE and AE from the Alphasense sensor</li> </ul> </li> </ul> </li> <li> <p><code>forwarding</code>: if this device needs to be forwarded to another data platform. Current supported platforms are specified in the connectors folder</p> </li> </ul>"},{"location":"Guides/data/Handling%20calibration%20data/#alternative-method","title":"Alternative method","text":"<p>Alternatively, in order to post this data, you can follow to other methods:</p> <ul> <li>either send us the kit ID and it's corresponding hardware ID, and we will do this for you</li> <li>or, if you are familiar with <code>http requests</code> you can <code>post</code> this data as such:</li> </ul> <pre><code>curl 'https://api.smartcitizen.me/v0/devices/&lt;DEVICE-ID&gt;' -X PATCH -H 'Authorization: Bearer &lt;BEARER-FROM-YOUR-USER-PROFILE&gt;' -H 'Content-Type: application/json;charset=UTF-8' --data-binary '{\"postprocessing_attributes\": {\"blueprint_url\": \"https://raw.githubusercontent.com/fablabbcn/smartcitizen-data/master/blueprints/&lt;BLUEPRINT_ID&gt;.json\", \"hardware_url\": \"https://raw.githubusercontent.com/fablabbcn/smartcitizen-data/master/hardware/&lt;HARDWARE_ID&gt;.json\"}}' --compressed\n</code></pre> <p>You can get your authorization token on your user profile page in the OAuth section. Make sure to change the following fields in the command above:</p> <ul> <li><code>&lt;DEVICE-ID&gt;</code></li> <li><code>&lt;BEARER-FROM-YOUR-USER-PROFILE&gt;</code></li> <li><code>&lt;HARDWARE_ID&gt;</code>, for instance <code>SCAS210002</code></li> <li><code>&lt;BLUEPRINT_ID&gt;</code>, for instance <code>sc_21_station_module</code> for Smart Citizen Stations</li> </ul> <p>Check it out</p> <p>Once this process is done, you should be able to check that the <code>postprocessing</code> is safely stored in the Platform by visiting: <code>https://api.smartcitizen.me/v0/devices/&lt;DEVICE-ID&gt;/</code>. After this, we will take care of processing the data in a periodic way.</p>"},{"location":"Guides/data/Install%20the%20framework/","title":"How to install the framework","text":"<p>The following data analysis framework is a set of tools built on Python 3.7 to help you analyse your data. It can be used with Jupyter Notebooks or Jupyter Lab, although it is not mandatory.</p>"},{"location":"Guides/data/Install%20the%20framework/#before-getting-started","title":"Before getting started","text":"<p>The framework runs in python 3.6 or more. Download and install python following this guide if you don't already have it.</p>"},{"location":"Guides/data/Install%20the%20framework/#installation","title":"Installation","text":"<p>Open your favourite shell on the directory you have your project. (<code>cmd.exe</code> on windows)</p> <pre><code>pip install scdata\n</code></pre> <p>You can now check if it all works by:</p> <pre><code>python\n&gt;&gt;&gt; import scdata as sc\n&gt;&gt;&gt; ...\n</code></pre>"},{"location":"Guides/data/Install%20the%20framework/#development-instructions-advanced","title":"Development instructions (advanced)","text":"<p><code>clone</code> the repository in a directory you like:</p> <pre><code>git clone https://github.com/fablabbcn/smartcitizen-data.git\n...\ncd smartcitizen-data\n</code></pre> <p>Want to stay up-to-date?</p> <p>The framework is being constantly updated and the only version that will always be up-to-date is in the master branch of the github repository. We do not recommend to simply download the repository but to clone it with <code>git</code>. If you want to learn more about <code>git</code> and why it can help you in your projects, check here</p> <p>To install it, you can simply run the command below. You can use a virtual environment if you like as well.</p> <pre><code>python setup.py install\n</code></pre>"},{"location":"Guides/data/Make%20reports%20of%20your%20data/","title":"Make reports of your data","text":"<p>Tools are provided to generate test or analysis reports, with a custom template. These are generated with the <code>jupyter nbconvert</code> using the preprocessor and tools in the <code>notebooks</code> and <code>template</code> folder. To generate a report, follow the steps:</p> <ol> <li> <p>Tag the cells in your notebook. You can use the Jupyter Lab Celltags extension. Don't tag the cells you want to hide, and tag the ones you want to show with <code>show_only_output</code>. This can be changed and add more tags, but we keep it this way for simplicity</p> </li> <li> <p>Go to the notebooks folder:</p> </li> </ol> <pre><code>cd notebooks\n</code></pre> <ol> <li>Type the command:</li> </ol> <pre><code>jupyter nbconvert --config sc_nbconvert_config.py notebook.ipynb --sc_Preprocessor.expression=\"show_only_output\" --to html --TemplateExporter.template_file=./templates/full_sc --output-dir=../reports --output=OUTPUT_NAME\n</code></pre> <p>Where:</p> <ul> <li><code>sc_nbconvert_config.py</code> is the config</li> <li><code>notebook.ipynb</code> is the notebook you want</li> <li><code>\"show_only_output\"</code> is a boolean expression that is evaluated for each of the cells. If true, the cell is shown</li> <li><code>./templates/full_sc</code> is the default template we have created</li> <li><code>../reports</code> is the directory where we will put the <code>html</code> report</li> <li><code>OUTPUT_NAME</code> is the name for the export</li> </ul> <p>This generates an html export containing only the mkdown or code cell outputs, without any code. Examples can be found in the source code repository.</p> <p>Don't like the template?</p> <p>You can modify these templates in the templates folder</p> <p>And here is the result!</p> <p></p>"},{"location":"Guides/data/Orange%20Data%20Widgets/","title":"Guide of MECODA Smartcitizen widgets","text":"<p>Requisites: * Having installed orange and the add-ons. Here you can check the instructions * Internet connection</p> <p>The mecoda-orange add-on includes 2 widgets</p> <p> * Smart Citizen Search. This widget looks for the kits in the Smart Citizen kits. Here you select the kit which data you're going to work with</p> <p></p> <ul> <li>Smart Citizen Data. This widget gets the data from that widget</li> </ul>"},{"location":"Guides/data/Orange%20Data%20Widgets/#smart-citizen-search","title":"Smart Citizen Search","text":"<p>Smart Citizen Search is a widget that gets information about kits, but not the data gathered by those kits. This the menu of the Smart Citizen Search:</p> <p></p> <p>The info panel is going to get updated with data fetched from the Smart Citizen back end. If you don't press \"Search devices\" is not going to fetch anything. </p> <p>Info</p> <p>If you press Search devices while there is no filter it's going to retrieve all the devices in the database, which is not necessaraly a bad thing because you can filter/find yours after that. </p> <p>The Search filters are going to apply some filters in case that you want to find one specific Kit</p> <ul> <li>City states the city that you are looking for. Remember to spell it with the first letter in upper case and with the local denomination. </li> <li>Tags looks for tags separated with commas with the logical operator \"OR\". That means that if you look for indoor, online the widget is going to get all the kits that at least one of their tags are either indoor or online</li> <li>User name the user that it is linked to. </li> <li>Kit-ID refers to the type of kit that is your smart citizen kit.  </li> </ul> <p>Success</p> <p>SCK stands for \"Smart Citizen Kit\"</p> <p>And lastly if you know the Device ID (unique to your specific kit) you can find the kit that you need. You can find the ID of your kit in the last part of the URL of your kit. For example this kit from this URL https://smartcitizen.me/kits/15618 has the Device ID of 15618.</p> <p>Info</p> <p>Alternatively you can use this search to find the deviceID in a table and then lock the ID of the kit that you need information about</p> <p>The Search devices button makes the request to the database so it's important to press it. </p> <p>In the bottom part also you can see how many devices have you retrieved from your query. </p>"},{"location":"Guides/data/Orange%20Data%20Widgets/#smart-citizen-data","title":"Smart Citizen Data","text":"<p>The widget Smart Citizen Data from the data of one (and just one per widget) it will retrieve the data that one device has gathered. </p> <p>It requires to be connected as an input one Smart Citizen device. </p> <p>This is the menu of Smart Citizen Data:</p> <p></p> <ul> <li> <p>The info panel is going to get updated with the data that is connected to. If it's not connected it will be empty. It will show you also when you press Get data how many rows has it retrieved. </p> </li> <li> <p>The Get data a specific fequency is the panel where we state the data frequency that we want to get. Rollup is the amount and the Rollup units is the time units that you can choose from.</p> </li> </ul> <p></p> <p>Success</p> <p>The options are y for years, M for months, w for weeks, d for days, h for hours, m for minutes, s for seconds and ms for milliseconds</p> <p>Warning</p> <p>This frequency is mandatory to be filled for the widget to work. </p> <ul> <li>The Filter by Date (YYYY-MM-DD) is a panel where you can select a subset of all the dates in format YYYY-MM-DD (Year-month-day). From initial date 00:00 up to end date 00:00 (so the end date is not taken in a complete loop) </li> </ul> <p>Info</p> <p>If this field is empty, the widget retrieves all the data on the record.</p> <ul> <li>The checkbox resample data if checked fills the missing data from the rollup so you will have al the lines from the rollup even if it doesn't exist with empty cells. If it's unchecked is only going to get the data that is available.</li> </ul> <p>Example without resampling in a datatable: (rollout of 30 minutes)</p> <p></p> <p>Same example with resampling in a datatable: (rollout of 30 minutes)</p> <p></p>"},{"location":"Guides/data/Organise%20your%20data/","title":"Organise your data","text":"<p>Step by step</p> <p>Go through the installation guide first before jumping into this guide.</p> <p>When you first run <code>scdata</code>, it will create a <code>scdata</code> folder in your <code>~/.cache</code> directory containing the following structure:</p> <ul> <li><code>export</code>: we will export processed data or images here</li> <li><code>interim</code>: we will place files used internally for the framework, such as sensor calibration data</li> <li><code>processed</code>: the most important folder of our data directory. This will contain a hierarchy with the different tests after loading into our database. The tests in this folder will have an unified format to easily navigate them. It's the folder we will load our data from, once we have created a test.</li> <li><code>raw</code>: raw sdcard data can be placed here. It will feed our pre-processing script below</li> <li><code>reports</code>: reports will be generated here. Have a look at the guide</li> <li><code>tasks</code>: tasks will be loaded from here (WIP)</li> <li><code>uploads</code>: directory to put information when uploading data to zenodo</li> </ul> <p>Configure this</p> <p>An additional <code>scdata</code> folder with a <code>config.yaml</code> file is created in your <code>~/.config</code> directory.    Visit the readme in the github repository for more information about configuring this.</p>"},{"location":"Guides/data/Organise%20your%20data/#data-structure","title":"Data structure","text":"<p>Two main ways to access and organise the data:</p> <ul> <li>device: single device holding information from different sources. Learn how to use it in the examples</li> <li>test: intended for experimentation with the data and posterior reproducibility. See below.</li> </ul>"},{"location":"Guides/data/Organise%20your%20data/#test","title":"Test","text":"<p>The concept is very simple. A test is a collection of devices (SCKs or not), that have a common purpose. They can be located in the same spot (co-location) or not, and the main idea is that we centralise the data in a common instance for easy analysis.</p> <p>Tests have dates, authors, can have comments (for us to remember what we did), a report attached and can be in different conditions (outdoor, indoor)... We will put all this metadata in a <code>yaml</code> file to help use look for the tests later on. </p> <p>Tests can also have different sources. They could be csv files, xls files or data from the Smart Citizen API. For the local files, we will first pre-process them with the scripts in the <code>data/scripts</code> folder and then place them in the <code>data/raw</code> folder, in csv format. We use this format because it's a common usable format and, although it is not the most efficient way of archiving the data, it can be easily explored by other common applications.</p>"},{"location":"Guides/data/Organise%20your%20data/#pre-process-the-sd-card-data","title":"Pre-process the sd card data","text":"<p>Direct upload also available</p> <p>You can directly upload SD card data following the example here</p> <p>In order to make our files usable, we will need to have them in a format like <code>YY-MM-DD.CSV</code>. However, if the kit has been reset, we can find some files like: <code>YY-MM-DD.01</code>, <code>YY-MM-DD.02</code> and they should be something like <code>YY-MM-DD_01.CSV</code>, <code>YY-MM-DD_02.CSV</code>...</p> <p>Pro-tip</p> <p>We can rename them manually, but if we have many of them, we can use this one-liner (works in oh-my-zsh):</p> <pre><code>autoload -Uz zmv\nzmv '(*).(0*)' '$1_$2.CSV'\n</code></pre> <p>We can now concatenate all the sd card data from a device with the <code>concat_script.py</code> in the scripts folder.</p> <p>We can access the script's help by typing in the terminal:</p> <pre><code>python concat_script.py -h\nusage: concat_script.py [-h] [--output OUTPUT] [--index INDEX] [--keep]\n                        [--ignore IGNORE] [--directory DIRECTORY]\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --output OUTPUT, -o OUTPUT\n                        Output file name, including extension\n  --index INDEX, -i INDEX\n                        Final name of time index\n  --keep, -k            Keep full CSV header\n  --ignore IGNORE, -ig IGNORE\n                        Ignore files in concatenation\n  --directory DIRECTORY, -d DIRECTORY\n                        Directory for csv files to concatenate\n</code></pre> <p>Create a directory (<code>FILES</code>) and put the sd card data of one device in it. Then, run the script with:</p> <pre><code>python concat_script.py -k -d FILES\nUsing files in /Users/macoscar/Documents/04_Projects/02_FabLab/01_SmartCitizen/01_Repositories/DataAnalysis/smartcitizen-iscape-data/data/scripts/FILES\nFiles to concat:\n18-11-08.CSV\n18-11-09.CSV\n18-11-13.CSV\n18-11-14.CSV\n18-11-15.CSV\n18-11-16.CSV\n18-11-17.CSV\n18-11-18.CSV\nUpdating header\nSaving file to: Log_Concat.csv\n</code></pre> <p>And if we now navigate to the <code>FILES</code> directory:</p> <pre><code>ls\n18-11-08.CSV   18-11-13.CSV   18-11-15.CSV   18-11-17.CSV   Log_Concat.csv\n18-11-09.CSV   18-11-14.CSV   18-11-16.CSV   18-11-18.CSV\n</code></pre> <p>We can find our concatenated file!</p>"},{"location":"Guides/data/Organise%20your%20data/#create-a-test","title":"Create a test","text":"<p>Once we have all our concatenated files, we can proceed to create our test. For this, you can launch <code>jupyter lab</code> and open the examples notebooks. In it, we can follow the instructions in the notebook by filling up the input data. </p> <p>A note about the timestamps</p> <p>To synchronise our tests, we will always need to specify the location. This means that all our tests will be in 'UTC'.</p> <p>There's a lot more to it</p> <p>Check the examples in the repository to:</p> <ul> <li>Plot data</li> <li>Process</li> <li>Calibrate sensors</li> <li>Upload it to zenodo</li> </ul>"},{"location":"Guides/data/Upload%20data%20to%20zenodo/","title":"Upload data to Zenodo","text":"<p>Uploading results to Zenodo is also possible using the data analysis framework.</p> <p></p> <p>Once you have your data organised in a test, you can upload it directly to Zenodo and share it with others. An example of this is provided in the example notebook.</p>"},{"location":"Guides/data/Upload%20data%20to%20zenodo/#set-it-up","title":"Set it up","text":"<p>For this to work, we need to have a token in an environment variable called <code>ZENODO_TOKEN</code>. Once you have it, open up a terminal and add it to your environment like:</p> <pre><code>export ZENODO_TOKEN=fake-zenodo-token\n</code></pre> <p>In the same terminal, check it's there:</p> <pre><code>echo $ZENODO_TOKEN\nfake-zenodo-token\n</code></pre> <p>Then launch <code>jupyter-lab</code> or start using your python scripts.</p> <p>Alternatively, you can store a <code>.env</code> file in a place of your liking with your token:</p> <pre><code>ZENODO_TOKEN='yourtokenhere'\n</code></pre> <p>And then load it like:</p> <pre><code>export $(grep -v '^#' .env | xargs -0)\n</code></pre>"},{"location":"Guides/data/Upload%20data%20to%20zenodo/#prepare-the-data","title":"Prepare the data","text":"<p>Next, you can define a <code>upload.yaml</code> file to describe the upload (see one example here:</p> <pre><code>example_upload_1.json: \n  title: 'Example Data 1'\n  description: 'This field accepts &lt;strong&gt;HTML&lt;/strong&gt;'\n  upload_type: 'dataset'\n  keywords: ['Low-Cost Sensors', 'Air Quality', 'Citizen Science']\n  creators: [{'name': 'Author 1', 'affiliation': 'Affiliation 1', 'orcid': '0000-0000-0000-0001'}, \n            {'name': 'Author 2', 'affiliation': 'Affiliation 2', 'orcid': '0000-0000-0000-0002'}] \n  tests: ['TEST_1', 'TEST_2']\n  access_right: 'open'\n  options: \n    include_processed_data: false\n    include_footer_doi: true\n  communities: [{ \"identifier\": \"community_in_zenodo\"}]\n  grants: [{\"id\": \"GRANT_ID\"}]\n  report: ['report.pdf']\nexample_upload_2.json: \n  title: 'Example Data 2'\n  description: 'This field accepts &lt;strong&gt;HTML&lt;/strong&gt;'\n  upload_type: 'dataset'\n  keywords: ['Low-Cost Sensors', 'Air Quality', 'Citizen Science']\n  creators: [{'name': 'Author 1', 'affiliation': 'Affiliation 1', 'orcid': '0000-0000-0000-0001'}, \n            {'name': 'Author 2', 'affiliation': 'Affiliation 2', 'orcid': '0000-0000-0000-0002'}] \n  tests: ['TEST_3', 'TEST_4']\n  access_right: 'open'\n  options: \n    include_processed_data: false\n    include_footer_doi: false\n  communities: [{ \"identifier\": \"community_in_zenodo\"}]\n  grants: [{\"id\": \"GRANT_ID\"}]\n  report: ['report_2.pdf']\n</code></pre> <p>Info</p> <p>All the keys below are linked to the zenodo documentation</p> <p>Different uploads can be defined by each main key: <code>example_upload_1.json</code> and <code>example_upload_2.json</code>. Each of them contains the following information (all of them can be later modified or added in the web interface in zenodo.org)</p> <p>Metadata for Zenodo</p> <ul> <li><code>title</code>: Name for the dataset</li> <li><code>description</code>: dataset description (mandatory). This field accepts HTML</li> <li><code>upload_type</code>: 'dataset' (mandatory - always, for now)</li> <li><code>keywords</code>: list of keywords, such as <code>['Low-Cost Sensors', 'Air Quality', 'Citizen Science']</code></li> <li><code>creators</code>: dictionary containing the authors. Can contain the name, the affiliation and an orcid</li> <li><code>access_right</code>: 'open' (other options in the zenodo documentation)</li> <li><code>communities</code>: id for the zenodo data community</li> <li><code>grants</code>: grant id</li> </ul> <p>Upload</p> <ul> <li><code>tests</code>: <code>['TEST_1', 'TEST_2']</code></li> <li><code>options</code>: <ul> <li><code>include_processed_data</code>: true or false. Whether or not to include the processed data from the processed folder in the test directory</li> <li><code>include_footer_doi</code>: true. If there is a report attached, add a nice footer to it with the DOI</li> </ul> </li> <li><code>report</code>: list of reports to attach. Must be also in the <code>data/uploads</code> folder</li> </ul> <p>To upload the datasets, we can use the zenodo sandbox and a dry_run, to check everything is running well. Then, make these defaults to <code>False</code> to actually upload it:</p> <pre><code># You can use the sandbox.zenodo.org for tests, as well as a dry_run. When you are happy with your upload, set these variables to False\n# Then go to uploads in the zenodo section and publish whenever you are ready\ndata.upload_to_zenodo('example_zenodo_upload', sandbox = False, dry_run = True)\n</code></pre> <p>Warning</p> <p>Note that a <code>.json</code> file will be created in the data/uploads folder containing the metadata necessary for the upload (as liked by zenodo API). You can securely delete this file once you are done. Note that, in case <code>include_footer_doi=true</code>, the actual pdf to upload will be <code>report_doi.pdf</code></p> <p>Finally, to actually deploy the dataset, you need to visit the deposit section and aprove it manually.</p> <p>Info</p> <p>Get the iSCAPE datasets from Zenodo here:</p> <ul> <li>https://zenodo.org/record/3570700</li> <li>https://zenodo.org/record/3570680</li> <li>https://zenodo.org/record/3570688</li> </ul>"},{"location":"Guides/deployments/Almabike%20sensors/","title":"Almabike Sensors User Manual","text":"<p>Welcome to the Almabike Project User Manual. This page includes all necessary information to get started with the sensor kit.</p> <p>In addition, further information and graphic material is available in the Annexes of this manual.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#hardware","title":"Hardware","text":""},{"location":"Guides/deployments/Almabike%20sensors/#pack","title":"Pack","text":"<p>The delivered sensor pack is comprised of these components:</p> <ul> <li>Smart Citizen Kit (SCK)</li> <li>GPS and antenna</li> <li>USB charger and cable</li> <li>Customized enclosure</li> </ul> <p>The SCK and GPS are assembled with a 3D-printed Clip:</p> <p></p> <p>The enclosure is made out of a modified saddle bag. Find more details in enclosure:</p> <p></p> <p>Licenses</p> <p>All the software used in this (product/prototype/design), unless otherwise stated, is released under GNU GPL v3.0. Likewise, the hardware design files for the Smart Citizen Kit are released under CERN OHL v1.2. Please refer to the corresponding license for details regarding permissions, limitations, and conditions of use. This paragraph only applies to this section and the enclosure customization, and not to the rest of components such as the GPS or antenna.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#sensors","title":"Sensors","text":"<p>The sensors are based on the Smart Citizen Kit, with the following components.</p> <p></p> <p>Measurements</p> Measurement Units Sensor Air temperature \u00baC Sensirion SHT-31 Relative Humidity % REL Sensirion SHT-31 Noise level dBA Invensense ICS-434342 Ambient light Lux Rohm BH1721FVC Barometric pressure Pa NXP MPL3115A26 Equivalent Carbon Dioxide ppm AMS CCS811 Volatile Organic Compounds ppb AMS CCS811 Particulate Matter PM 1 / 2.5 / 10 \u00b5g/m3 Planttower PMS 5003"},{"location":"Guides/deployments/Almabike%20sensors/#gps","title":"GPS","text":"<p>The selected NEO-M8U GPS Breakout from Sparkfun is a high quality GPS board. The NEO-M8U takes advantage of u-blox's Untethered Dead Reckoning (UDR) technology. The NEO-M8U module is a 72-channel u-blox M8 engine GNSS receiver, meaning it can receive signals from the GPS, GLONASS, Galileo, and BeiDou constellations with ~2.5 meter accuracy. The module supports concurrent reception of three GNSS systems. The combination of GNSS and integrated 3D sensor measurements on the NEO-M8U provide accurate, real-time positioning rates of up to 30Hz.</p> <p>Compared to other GPS modules, this breakout maximizes position accuracy in dense cities or covered areas. Even under poor signal conditions, continuous positioning is provided in urban environments and is also available during complete signal loss (e.g. short tunnels and parking garages). Lock time is further reduced with on-board rechargeable battery; there is a backup power enabling the GPS to get a hot lock within seconds.</p> <p>The SparkFun NEO-M8U GPS Breakout1 is also equipped with an on-board rechargeable battery that provides power to the RTC on the NEO-M8U. This reduces the time-to-first fix from a cold start (~26s) to a hot start (~1.5s). The battery will maintain RTC and GNSS orbit data without being connected to power for plenty of time.</p> <p></p> <p>The GPS uses a ceramic patch antenna2 with the following features:</p> <p></p> <p>The U.FL antenna connector does not need to be unplugged from the board, specially never when the board is being powered in order to avoid damaging the circuitry:</p> <p></p> <p>GPS and Antenna images by Sparkfun (License CC BY 2.0) and edited by Smart Citizen.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#enclosure","title":"Enclosure","text":"<p>The enclosure is made out of a modified generic Saddle Bag from Vaude - (Vaude Race Light L). </p> <p></p> <p>Enclosure images by Vaude</p> <p>The enclosure was specifically chosen because:</p> <ul> <li>It is a widely available enclosure by a well stablished bike equipment manufacturer</li> <li>Size and materials</li> <li>Low weight and flexible outter fitting for low vibrations and transmissibility</li> </ul> <p>The sensors are internally suspended by a polypropilene folding and the air intakes are made out of PLA in a 3D printer.</p> <p></p> <p>Measurement principle</p> <p>The sensors are enclosed in the saddle bag in order to avoid dirt and water spills. The measurement method in the enclosure ensures there is: 1. sufficient air flow parallel to the sensor's surface, 2. a limited gas speed across the sensors and minimum gas residence time to ensure sensitivity. The placement of the sensors was tested and compared with different options. Results are shown in the Test section. The images below show the measurement principle and a functional diagram for the sensor\u2019s enclosure. </p> <p></p> <p></p> <p>Please, ensure both intakes and exhaust are not covered and that air can flow freely between both.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#power-management","title":"Power management","text":"<p>WIP </p> <p>This will be improved with new Firmware Features. Current battery duration is 1 day with 2-3 short bicycle trips of 30' each. This will improve with upcoming firmware updates.</p> <p>The SCK comes with a 2000mAh LiPo battery to provide autonomy while measuring in the city. The battery is meant to be a complete power option for short-term measurements (approximatively 1-2 days). The battery duration is dependent on which sensors are enabled or disabled, and the amount of time the dynamic measurement interval is active.</p> <p>You will note that the kit turns itself off while operating on battery. Actually, this is what we call <code>sleep-mode</code>, an operation mode implemented to reduce consumption while on battery operation.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#battery-charging","title":"Battery charging","text":"<p>The SCK has a micro USB port and can be charged like any Smartphone or Tablet using a dedicated adapter or a computer USB port. A cable is provided and does not need to be disconnected from the device. The cable can be stored in the saddle\u2019s bag back compartment.</p> <p></p>"},{"location":"Guides/deployments/Almabike%20sensors/#user-feedback","title":"User feedback","text":"<p>The LED serves as an indication of the battery status. If the LED is flashing orange   it indicates that the battery must be charged. The battery takes about 4 hours to fully charge. When the battery is fully charged, the LED will change from orange to green  .</p> <p>Remember that in addition to these colors you will have the state color of the kit: configuration, network and sd.</p> <p>More details</p> <p>Find more details about power management under the data board section of the documentation</p>"},{"location":"Guides/deployments/Almabike%20sensors/#data-acquisition","title":"Data Acquisition","text":"<p>Data can be recorded offline or published online to the Smart Citizen Platform. The SCK owner needs to configure how the data is going to be stored in the Setup process, either in the SD card or via network connectivity (WiFi) to the platform. </p> <p>When the SCK is configured in sdcard mode, it will store the data at the requested interval* in the SD card.</p> <p>In the case of network connectivity, in normal conditions, the device will send data over to the Smart Citizen Platform via WiFi (WPA2 Personal or WEP). Additionally, when configured to send data over WiFi, if there is a SD card present, it will also store the data in it as a backup. Finally, in the special case of mobile sensors, where network connectivity is not always present, the data can be recorded offline on its internal dedicated flash memory of 8MB and later publish this over WiFi connectivity. Data is published using MQTT messages to the Smart Citizen Platform. NTP is used for syncing the built-in RTC.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#recording-interval","title":"Recording interval","text":"<p>In order to understand the reading and publication intervals, it is important to describe how the structure of the measurements is done:</p> <ol> <li>Overall reading interval: base period for the SCK to take a measurement</li> <li>Individual sensor reading interval: period for each sensor to take a measurement. It is defined as N times the Overall reading interval</li> <li>Publication interval: time for the SCK to publish to the Smart Citizen Platform, independent of the reading interval.</li> </ol> <p>Each of the sensors can be configured independently, with a reading interval N times the overall reading interval. For the Almabike project, all the sensors are read every 60s if the sensors are static. When a GPS movement is detected, the reading interval goes down to 5s.</p> <p></p> <p>In the case of the Almabike project, the sensors store data internally in the Flash memory during the bicycle trips and publish it in batch when the configured WiFi network is visible. Data is also stored in the SD card for later use in CSV file format.</p> <p></p>"},{"location":"Guides/deployments/Almabike%20sensors/#data","title":"Data","text":""},{"location":"Guides/deployments/Almabike%20sensors/#accessing-the-data","title":"Accessing the data","text":"<p>Data from the sensors can be accessed in four ways:</p> <ul> <li>Using the SD card. Follow this guide to understand the data formats</li> <li>Downloading data from Smart Citizen Platform, following this guide</li> <li>Using the API calls, with information here</li> <li>Using Python to interact directly with the API. There is a python package available here and an example on how to do so here</li> </ul>"},{"location":"Guides/deployments/Almabike%20sensors/#data-formats","title":"Data formats","text":"<p>Data from the sensors is timestamped in ISO8601 format with the following metrics:</p> Metric Units Description BATT % Device battery status CCS811_ECO2 ppm Equivalent CO2 CCS811_VOCS ppb total Volatile Organics Compounds GPS_ALT m GPS Altitude GPS_DIL n/a GPS Horizontal Dilution of Position GPS_FIX_QUALITY n/a GPS Fix Quality GPS_LAT \u00ba GPS Latitude GPS_LONG \u00ba GPS Longitude GPS_SAT_N n/a GPS Number Tracked Satellites GPS_SPEED m/s GPS Horizontal Speed HUM % RH Urban board humidity LIGHT lux Urban board ambient light NOISE_A dBA Noise measurement in A scale PM_1 ug/m3 PM 1 measurement from PMS5003 PM_25 ug/m3 PM 2.5 measurement from PMS5003 PM_10 ug/m3 PM 10 measurement from PMS5003 PRESS kPa Atmospheric pressure TEMP degC Urban board temperature <p>Notes about data:</p> <ul> <li>Non valid data is shown in CSV as <code>null</code></li> <li>There is no correction in the data</li> <li>The minimum refresh interval for the PM sensor is 1s (it won't change faster than that)</li> </ul>"},{"location":"Guides/deployments/Almabike%20sensors/#getting-started","title":"Getting started","text":"<p>The sensor comes mounted and almost ready to be used.</p> <p>The first step is to connect the battery. The kit will light in red (configuration mode) and we will be able to configure it by following the instructions at start.smartcitizen.me.</p> <p></p> <p>After the configuration process, data will be available on the SmartCitizen platform. You can explore the data there or download it using the <code>CSV Download</code> option (guide here)</p> <p></p> <p>Make sure data is recorded</p> <p>For the Almabike project, it is important to follow the steps below in order to select the correct kit blueprint while registering the sensor:</p> <ol> <li> <p>Click the \ud83d\udee0\ufe0f icon in the bottom right corner</p> <p></p> </li> <li> <p>Choose the blueprint of the device you want to setup, in this case: <code>#32 SCK 2.1 GPS</code></p> <p></p> </li> <li> <p>Click save and continue the process as usually</p> <p></p> </li> </ol> <p>Due to privacy concerns, all geolocated data for the Almabike project will remain private unless the user choses to release it. When you set up your user profile, please, contact \"support@smartcitizen.me\" to request your if your user can be upgraded from <code>citizen</code> to <code>researcher</code>.</p> <p>This will allow to visit any of your devices and select the option \"Make private\" under the \"Open Data\" settings:</p> <p></p>"},{"location":"Guides/deployments/Almabike%20sensors/#before-going-on-a-trip","title":"Before going on a trip","text":"<p>Before starting to pedal, make sure that this checklist is all fine:</p> <ol> <li>The kit is either in SD card or network mode</li> <li>The kit has enough battery (check the status of the LED)</li> <li>The GPS is being powered. The GPS might take some time to retrieve a valid location. This can be assessed by checking that the GPS Blue LED is blinking. If you want to make sure the complete trip is recorded, make sure the GPS can receive a clear view of the sky</li> <li>The kit is well placed inside the enclosure and the cable does not obstruct the exhaust</li> </ol> <p></p> <p>What is the GPS fix?</p> <p>The GPS fix is the term used for describing whether or not the GPS has successfully received a valid location</p>"},{"location":"Guides/deployments/Almabike%20sensors/#known-issues","title":"Known issues","text":"<p>Below, there is a list of known issues with the <code>0.9.8</code> version of the Firmware. These will be fixed soon.</p> <ol> <li> <p>Currently, the SCK does not report errors permanently and only during 10s. This is shown as a fast led blinking (). </p> </li> <li> <p>Under certain conditions, the dynamic interval is not instantly recovered after a quick stop, and it might take 1' to restart</p> </li> <li> <p>Under certain sky visibility conditions, the GPS does not report a valid fix. It is normally fixed with a clear sky view. For this, follow the instructions in Before going on a trip</p> </li> </ol> <p>Updating the firmware</p> <p>Once there is a firmware release with these updates, refer to this guide for instructions on how to update it in your kit</p>"},{"location":"Guides/deployments/Almabike%20sensors/#additional-graphic-material","title":"Additional graphic material","text":""},{"location":"Guides/deployments/Almabike%20sensors/#test-results","title":"Test results","text":"<p>The purpose of these tests is to assess the best solution for measuring particulate matter and environmental conditions with two different enclosures and hence exposure methods. The tests performed are:</p> <ul> <li>Indoor particulate tests</li> <li>Outdoor dynamic vs. static comparison</li> <li>Outdoor dynamic comparison</li> </ul>"},{"location":"Guides/deployments/Almabike%20sensors/#indoor-particulate-tests","title":"Indoor particulate tests","text":"<p>These tests were conducted indoor using a Marlin Smoke Machine in order to assess the difference between each enclosure.</p> <p>Free air comparison</p> <p>An initial comparison between both sensors in open air is done in order to assess the difference between each sensor measuring in open air with smoke injection up to 4000ug/m3. In the figure, two distinct phases need to be highlighted:</p> <p></p> <p></p> <p>In the figure, two distinct phases need to be highlighted: injection (when there is smoke being injected in the room), and dispersion, when the injected smoke is being dispersed with a fan. </p> <p>Both sensors correlate well in the injection phase and dispersion phases, but they do have an offset in the dispersion phase that is not identified, and that could be simply due to the sensor's position, although they are less than 10cm apart. This maximum offset is 700-1000ug/m3 in an evironment of very large particle concentration numbers 3000ug/m3.</p> <p>Temperature and humidity offsets in this case are found to be less than 0.5degC in temperature and negligible for relative humidity.</p> <p>Enclosure comparisons</p> <p>The purpose of this comparison is to determine which measurement principle of the following is the best:</p> <ul> <li>Directly exposing the sensors to the air flow by the bicycle's movement</li> <li>Expose them inside a \"chamber\" in which air flow is contained and briefly slowed down</li> </ul> <p></p> <p>The following graph shows the comparison of both enclosures mounted on the bike, and a rider on the bike.</p> <p></p> <p>The comparison shows that the direct sensor exposure (ORTLIEB in the graph) is not as sensitive to particulate in the air as the chamber exposure is (VAUDE in the graph). This offset is not justified by the offset seen in dispersion phase in the free air test as it is also reduced in the injection phase. On the other hand, the chamber exposure shows a longer tail in the dispersion phase, as the particles can remain in the chamber and not be fully evacuated, although reactivity to larger quantities remains as seen in the graph below.</p> <p>It also shows that the VAUDE enclosure evacuates better heat generated by the electronics, as the temperature offset between both enclosures is reduced. As seen in the following tests, the offset of each enclosure with respect to real temperature is between 1 to 3degC and it could be compensated by software a posteriori, but it can't be avoided as the sensors are confined in the enclosure. This factor is not critical for the exposure assessment and decision, as the material of the enclosure differ, and it's less traspirant in the ORTLIEB option.</p> <p>Chamber vs. Reference test</p> <p>The comparison of the best-so-far enclosure is shown below, with respect to the reference sensor in free air. This comparison shows how the enclosure effectively slows down the air flow charged with particles, and still correlates properly with the free air sensor in the injection phase, although not in the dispersion phase. This indicates that the accumulation and evacuation process of the particles within the chamber is not fully controlled in this enclosure. Nevertheless, the levels of particles in this setup are not comparable to any actual particulate levels found in actual urban environments.</p> <p></p> <p>The offset in temperature and humidity is of approximatively 3degC at the end of the test, and follows a normal heat up curve with logarithmic trend, equally for humidity with 7%rh.</p> <p>Direct exposure vs. Reference test</p> <p>The direct exposure vs reference comparison shows an inferior sensitivity, already seen in the enclosure comparison, of the direct exposure option versus the actual concentration. The measurements also show less reactivity in some instances, smoothing out some peaks in particle concentrations. Temperature trace shows an offset of 3degC at the end of the test, similarly to that of the other enclosure, with an humidity difference of 4-5%rh.</p> <p></p>"},{"location":"Guides/deployments/Almabike%20sensors/#outdoor-tests","title":"Outdoor tests","text":"<p>These tests are aimed at comparing outdoor measurements with sensor trips. These measurements use the same sensor as the ones mounted on the bicycle. A script is used to post-process the data based on location and derive a comparison between both measurements.</p> <p>Comparison bike front vs. bike back</p> <p>This comparison shows the difference between the different metrics when measuring gas using the same enclosure in the front (black) and in the back (green):</p> <p></p> <p>After a short stabilisation period, this test shows that PM2.5 measurements are equally correlated between both positions. In the case of the temperature sensor, a difference of up to 2\u00baC was seen (higher in the saddle\u2019s position), with better sensitivity in the case of the front-sensor, due to a lower confinement and larger surface area:</p> <p></p> <p>Due to project guidelines, the saddle position of the sensor is considered sufficient for the purpose of monitoring air quality. However, it\u2019s worth mentioning that this sensor location requires attention for the sensors to never be covered by the rider\u2019s clothing. Furthermore, the front position shows a better response for the sensor temperature representativity and sensitivity as seen above, with a potential better GPS fix quality. This latter issue is compensated with the usage of an active patch antenna with higher gain.</p> <p>Further tests are currently being conducted in order to assess the performance of the sensors when compared to static ones.</p>"},{"location":"Guides/deployments/Almabike%20sensors/#references","title":"References","text":"<ol> <li> <p>GPS NEO-M8U Specification: https://cdn.sparkfun.com/assets/6/d/7/c/6/NEO-M8U_DataSheet__UBX-15015679_.pdf \u21a9</p> </li> <li> <p>Ceramic Patch Antenna Specification: https://www.molex.com/pdm_docs/as/2066400001-AS.pdf \u21a9</p> </li> </ol>"},{"location":"Guides/deployments/Deploying%20SCK/","title":"Deploying the Smart Citizen Kit","text":"<p>The Smart Citizen Kit can be used in both, indoor or outdoor setups. This page gives guidelines on how to install in either situation.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20SCK/#indoor-installation","title":"Indoor installation","text":"<p>In indoor conditions, the Kit can be installed using this 3D printed clip.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20SCK/#how-to-install-the-kit","title":"How to install the kit","text":"<p>Make sure you read the information about each type of sensor before installation:</p> <ul> <li>eCO2 and tVOCs sensor</li> <li>Noise</li> <li>PM sensor</li> </ul>"},{"location":"Guides/deployments/Deploying%20SCK/#general-tips","title":"General tips","text":"<ul> <li>Keep the sensors powered if they are going to be mounted in a fixed point</li> <li>Avoid areas with moist accumulation when possible</li> <li>Avoid temperature and humidity transients, specially for the eCO2/tVOC sensor</li> <li>Avoid covering the sensors, specially the PM sensor</li> <li>Avoid covering the microphone and particles to go in the microphone port</li> <li>Avoid direct flow towards the sensors. If exposed under flow conditions, have the flow go parallel to the sensors' surface</li> </ul>"},{"location":"Guides/deployments/Deploying%20SCK/#outdoor-installation","title":"Outdoor installation","text":"<p>For outdoor installation, an enclosure is recommended in order to avoid moisture to damage the sensors and electronics. The Enclosures Repository contains various types (3D printed, milled, DIY) from us and contributions from users that customise their own! Feel free to download the models and tweak them, and if happy, share them back via pull request to the repository.</p> <p></p> <p>The general tips from above also apply, as well as:</p> <ul> <li>Avoid exhausts from air conditioning units, kitchens and others</li> <li>Protect the sensors from moisture either using filtering foam or nail polish to cover the sensor pads (see here)</li> <li>Avoid temperature transients, specially due to sun radiation</li> </ul>"},{"location":"Guides/deployments/Deploying%20SCK/#powering-the-sensor","title":"Powering the sensor","text":"<p>The SCK can be powered through:</p> <ul> <li>LiPo 3.7V Battery: default 2000mAh - large 6000mAh</li> <li>Mains power, through an USB adaptor (not recommended) or a custom power supply in this enclosure</li> <li>Solar panel: we use the Solar Panel 6W 6V from Voltaic Systems with the MPTT DF Robot DFR0559 and an additional LiPo Battery, all in this enclosure</li> </ul> <p>Using the power supply</p> <p>If you are using the Smart Citizen Power Supply, have a look at this guide for safety instructions.</p>"},{"location":"Guides/deployments/Deploying%20SCK/#connectivity","title":"Connectivity","text":"<p>The sensors can log data in sd card or remote post data to the Smart Citizen Platform. In the case of remote logging and outdoor deployments, a connectivity unit can be used with a SIM Card data plan. These units are enclosed in a waterproof box and can be powered from 230VAC 3m cable (or more), deploying a network to which several SCKs can be connected in an outdoor deployment. </p> <p>You can check the BOM and installation/building here and you can email us at info@smartcitizen for more information.</p> <p></p> <p>Got one?</p> <p>Check this installation guide to get started</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/","title":"Deploying the Smart Citizen Station","text":"<p>This guide will summarise how to install the Smart Citizen Station and set it all up for successful readings.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#hardware","title":"Hardware","text":"<p>The Stations should come assembled and ready to use. It consists of various parts:</p> <ul> <li>Enclosure and mounting system</li> <li>Sensors module</li> <li>Power supply</li> </ul> <p></p> <p>This is how the smaller version looks like:</p> <p></p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#physical-measurements","title":"Physical measurements","text":"<p>The big Station measurements are shown in the image below:</p> <p></p> <ul> <li>Dimensions with cover (length, height, depth) (approx.):  340mm x 160mm x 230 mm </li> <li>Dimensions without cover (length, height, depth) (approx): 260mm x 120mm x 180mm</li> </ul> <p>The small Station measurements are shown in the image below:</p> <p></p> <ul> <li>Dimensions with cover (length, height, depth) (approx.):  232mm x 92mm x 145 mm </li> <li>Dimensions without cover (length, height, depth) (approx): 150mm x 105 x 45 mm</li> </ul>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#enclosure-and-mounting-system","title":"Enclosure and mounting system","text":"<p>The enclosure and mounting system is very similar for both units:</p> <p></p> <p>The enclosure holds the sensors in place and protects them against weather. A rain and sun radiation cover for protection made out of white sandwich panel or dibond. This element carries out the structural support of the station and protects the unit against rain, wind or heat.</p> <p></p> <p>The sensors module which contains the electronics and sensors, is attached to the cover and can be removed without having to uninstall the rain cover.</p> <p>Finally, The power supply, is a separated from the module, so that intervention in the sensors' area can be performed safely with a tangible desconection of the mains power.</p> <p>Flexible attachment</p> <p>This mounting is thought to work on a lampost, fence or wall. We recommend a somewhat flexible join (i.e. zip-ties) in case of windy locations</p> <p>Power supply details</p> <p>Refer to the Power supply section and the guide on it's installation for more details.</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#sensors-module","title":"Sensors module","text":"<p>The sensors module is the area where all the action takes place. This is the bottom view:</p> <p></p> <p>An this is the inside one (will change  with further development):</p> <p></p> <p>The small Station looks like this:</p> <p></p> <p>The Station is powered through it's USB input. It can be reset by either:</p> <ul> <li>disconnecting the power to the mains</li> <li>introducing a thin screw driver or pen through the RESET button hole indicated above</li> </ul> <p>Power USB</p> <p>We do not recommend to use any other cable than the supplied one in outdoor conditions.</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#power-supply","title":"Power supply","text":"<p>The Smart Citizen Station uses the Smart Citizen Power Supply for power. The input of the station is the connector shown in the image below.</p> <p></p> <p>Inside the station, power is distributed accross the different units. Data and power goes through the input, in order to connect to the Data Board and be able to use the Shell. All voltage levels inside the station are below 5V.</p> <p>Using the power supply</p> <p>For more information about how to handle the Smart Citizen Power Supply, have a look at this guide for safety instructions.</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#installation","title":"Installation","text":"<p>Follow the steps below for making sure everything is working fine before setting it up in an outdoor spot. </p> <ol> <li> <p>First, power the unit with the USB provided. The unit can be powered with a normal USB charger first for configuration, or with a laptop as well. If you have a laptop at hand it's going to be handy for step 3.</p> </li> <li> <p>The indicator LED should turn on. It will first be GREEN, WHITE (may take a while) and then RED or BLUE, depending on the configuration of the Station. You can see more information on the LED status here</p> </li> <li> <p>If you have a laptop available, it is recommended to check with the Shell and request the sensors:</p> <pre><code>sensor\n</code></pre> <p>After this, a list of all the enabled sensors should appear. You can configure the recording interval as well, in case you need less or more data. If all is working fine, you can now proceed to installation of the unit in an outdoor spot. </p> <p>This is a list of all the possible sensors in the Station (seen from the hardware side), the actual sensor list will depend on your version:</p> <pre><code>Temperature\nHumidity\nBattery\nLight\nNoise dBA\nBarometric pressure\nVOC Gas CCS811\neCO2 Gas CCS811\nPM board Dallas Temperature\nADS1x15 ADC 0x48 Ch0\nADS1x15 ADC 0x48 Ch1\nADS1x15 ADC 0x48 Ch2\nADS1x15 ADC 0x48 Ch3\nADS1x15 ADC 0x49 Ch0\nADS1x15 ADC 0x49 Ch1\nADS1x15 ADC 0x49 Ch2\nADS1x15 ADC 0x49 Ch3\nADS1x15 ADC 0x4A Ch0\nADS1x15 ADC 0x4A Ch1\nADS1x15 ADC 0x4A Ch2\nADS1x15 ADC 0x4A Ch3\nADS1x15 ADC 0x4B Ch0\nADS1x15 ADC 0x4B Ch1\nADS1x15 ADC 0x4B Ch2\nADS1x15 ADC 0x4B Ch3\nExt PM_A 1.0\nExt PM_A 2.5\nExt PM_A 10.0\nExt PM_B 1.0\nExt PM_B 2.5\nExt PM_B 10.0\n</code></pre> </li> </ol> <p>Check the meaning of the sensor channels</p> <p>This a complete list of sensors. Have a look at it to get a full description and location of each of them.</p> <p>This is an example of the sensor list in a normal 4-electrochemical sensors Station (with some additional comments for clarity):</p> <pre><code>```\n-----------------------\nSensors in Urban Board\n-----------------------\nTemperature\nHumidity\nBattery\nLight\nNoise dBA\nBarometric pressure\nVOC Gas CCS811\neCO2 Gas CCS811\n-----------------------\nSensors in Auxliary Bus\n-----------------------   \n# External temperature sensor\nPM board Dallas Temperature \n# Electrochemical sensors voltages\nADS1x15 ADC 0x48 Ch0\nADS1x15 ADC 0x48 Ch1\nADS1x15 ADC 0x48 Ch2\nADS1x15 ADC 0x48 Ch3\nADS1x15 ADC 0x4A Ch0\nADS1x15 ADC 0x4A Ch1\nADS1x15 ADC 0x4A Ch2\nADS1x15 ADC 0x4A Ch3\n# Particulate matter sensors\nExt PM_A 1.0\nExt PM_A 2.5\nExt PM_A 10.0\nExt PM_B 1.0\nExt PM_B 2.5\nExt PM_B 10.0\n```\n</code></pre> <p>Sensor readings</p> <p>Sensor readings for the Electrochemical sensors are sent in <code>raw</code> and later on processed. Each electrochemical sensor has two outputs read by one of the ADCs so, for 4 electrochemical sensors, we need at least 8 channels.</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#physical-installation","title":"Physical installation","text":"<p>The enclosure can be installed using the mounting holes seen below. There is sufficient space to pass zip ties. If you want to use drills, we recommend at least 6mm screws (or 8mm) and to dissasemble the plastic cover from the sandwich pannel for safer installation.</p> <p></p> <p>Below are some general guidelines for the installation of the device:</p> <ul> <li>Avoid areas with moist accumulation when possible</li> <li>Avoid temperature and humidity transients</li> <li>Avoid covering the sensors in front of the sensors, specially the PM sensor</li> <li>Avoid covering the microphone and particles to go in the microphone port</li> <li>Avoid direct flow towards the sensors. If exposed under flow conditions, have the flow go parallel to the sensors' surface</li> <li>Despite the umbrella cover, sun radiation and transients are better to be avoided</li> <li>A good height for installing the sensors is somewhere between 2-3m, but it all depends on the case study and available support structures.</li> </ul>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#configuration","title":"Configuration","text":"<p>The process to register the Smart Citizen Station and send data to the platform is the same as the one from the Smart Citizen Kit (start.smartcitizen.me):</p> <p></p> <p>Only, make sure to select the appropiate Kit (<code>#33 Smart Citizen Station 2.1 rev3</code>) in the Advanced Selection field:</p> <p></p> <p>Advanced tip</p> <p>If you are familiar with Shell commands, or you use Arduino IDE to interact with the Station, you can use this Shell Guide, and connect to the device. Then write down the configuration that you get when typing <code>config</code>:</p> <pre><code>SCK &gt; config\nMode: network\nPublish interval: 180\nReading interval: 60\nWifi credentials: WIFI-SSID - WIFIPASS\nToken: 123456\nMac address:  XX:XX:XX:XX:XX\n</code></pre> <p>Also, if you are using the phone, you can turn the unit to SETUP mode again, using the ON-OFF button (the indication LED should shine in RED) and from there connect to the Station and get it's information:</p> <p></p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#handling-calibration-data","title":"Handling calibration data","text":"<p>Some components of the Station have individual calibrations such as the Alphasense Electrochemical Sensors. For this reason, it's necessary to store the physical ID (hardware ID) of the Station alonside to the virtual device in the Smart Citizen Platform. The harwdware ID should normally be in a sticker to the enclosure both inside and outside and looks like this:</p> <pre><code>SCAS2100XX\n</code></pre> <p>This number is important to relate to the actual calibration values of the sensors, stored in the data repository. In order to postprocess the data and calculate pollutants, make sure that the <code>Hardware ID</code> is safely stored in the platform's device, by posting this data to <code>postprocessing_info</code> field of the device. You can follow these instructions to store the <code>postprocessing_info</code> of your device.</p> <p>All the data is sent in raw to the Smart Citizen Platform and it's then processed outside of the sensors themselves. Both raw, and processed data are kept on the platform and can be accessed at any time. Data can be published to other APIs or to Zenodo as well, in case of research projects that seek contribution to Open Science Datasets.</p> <p>More on the processing of the data</p> <p>Check this guide to learn more about how to postprocess the data of the sensors your own way.</p>"},{"location":"Guides/deployments/Deploying%20Smart%20Citizen%20Station/#troubleshooting","title":"Troubleshooting","text":"<p>The first step in case anything goes wrong, is to reset the unit by pressing the RESET button. If this doesn't work, make sure that your problem is not already listed in the FAQs, and if not, contact us for more support.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/","title":"Deployment iSCAPE Station V1","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#components","title":"Components","text":"<p>The Station is a modular system based on different sensor board that connected to a central datalogger.</p> <p></p> <p>Smart Citizen Stations Components Setup</p> <p></p> <p></p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#sensors","title":"Sensors","text":"Measurement Units Sensor Component Air Temperature \u00baC Sensirion SHT-31 Urban Sensor Board Relative Humidity % REL Sensirion SHT-31 Urban Sensor Board Noise Level dBA Invensense ICS-434342 Urban Sensor Board Ambient Light Lux Rohm BH1721FVC Urban Sensor Board Barometric pressure and AMSL Pa and Meters NXP MPL3115A26 Urban Sensor Board Carbon Monoxide ppm Alphasense CO-B4 Gas Sensor Pro Board Nitrogen Dioxide ppb Alphasense NO2-B43F Gas Sensor Pro Board Ozone ppb Alphasense OX-B431 Gas Sensor Pro Board Gases Board Temperature \u00baC Sensirion SHT-31 Gas Sensor Pro Board Gases Board Rel. Humidity % REL Sensirion SHT-31 Gas Sensor Pro Board PM 1 \u00b5g/m3 Plantower PMS5003 Dual System PM Sensors Board PM 2.5 \u00b5g/m3 Plantower PMS5003 Dual System PM Sensors Board PM 10 \u00b5g/m3 Plantower PMS5003 Dual System PM Sensors Board"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#the-pack","title":"The Pack","text":"<ul> <li> <p>iSCAPE Living Lab Station</p> <ul> <li>Urban Board 2.0</li> <li>Data Board 2.0</li> <li>PM Board 2.0 + 2 PM sensors</li> <li>Gas Pro Board 2.0 with 3 EC sensors</li> <li>6Ah Battery</li> </ul> </li> <li> <p>Accessories</p> <ul> <li>MicroSD card 512MB</li> <li>USB Charger</li> <li>MicroSD to SD card adapter</li> <li>USB Power Supply</li> <li>2m 3 Wire 220V cable</li> <li>Mounting brackets and screws</li> <li>Mounting tools (1x Wrench + 2 Allen Keys)</li> </ul> </li> </ul>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#instructions","title":"Instructions","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#before-setup","title":"Before setup","text":"<p>Before configuring the Station setup make sure the LED is red. If not, press the button multiple times until the LED turns red.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#on-boarding","title":"On boarding","text":"<p>To start the installation simply visit the setup website stations.iscape.smartcitizen.me.</p> <p></p> <p>Warning</p> <p> We will need you to send us the following information once you are done with the setup: the device ID, which appears in the URL of your device https://smartcitizen.me/kits/XXXX and the physical station ID that corresponds to that device ID, which can be found in a sticker underneath.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#get-data-from-the-sd-card","title":"Get data from the SD card","text":"<p>You will need to access the Kit in order to get the SD card. For this, first unscrew the two white layers at the top of the station with the keys provided in the Pack:</p> <p></p> <p>Then turn off your Kit by pressing the button for 5 seconds and remove the micro SD card. You can plug the card on your computer using a Micro SD card reader.</p> <p></p> <p>Warning</p> <p>Handle the SD card with care! It might drop inside the station</p> <p>You will find inside a <code>YYYY-MM-DD.CSV</code> with all the data. You can follow the Manual CSV data upload guide to manually upload the data to the platform.</p> <p>Power it back on!</p> <p>Once you are done uploading the data and you want to keep on logging, put the SD card back in with the Kit OFF and press the button. It will come back to life!</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#outdoor-installation","title":"Outdoor installation","text":"<p>Use the perforated steel tape and the M6 provided to mount the Station on any street light or pole. The Pack also includes the required wrench:</p> <p></p> <p>Also, a temperature probe needs to be extracted from the bottom of the station:</p> <p></p> <p>And it should look like this:</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#umbrella-cover-installation","title":"Umbrella cover installation","text":"<p>Due to some issues with the waterproofness of the Living Lab Station, we have developed a solution to protect it from the rain. This solution is shown in the pictures below, and it's meant to solve these problems for the current version of the LLS. The newer version of the LLS has a simpler setup, already including such cover to protect it from the rain or sun radiation.</p> <p></p> <p>Beware of collisions</p> <p>As you can see, the cover is a rugged piece and it's only meant for the current version of the station. Please, be careful and do not fit it in places where people could bump into it.</p> <p>This is what you get in the package (except the wrench):</p> <p></p> <p>Step by step</p> <ul> <li> <p>If you have the 3D printed cover on the Smart Citizen Kit, it's time to remove it. </p> </li> <li> <p>There is no need to remove the two top white layers (in the pictures we did it without them)</p> <p></p> </li> <li> <p>Insert the threads in the already mounted t-slots. The distance between them is ~50mm</p> <p></p> <p></p> <p></p> </li> <li> <p>Insert the 4x flat spacer in the threads</p> <p></p> </li> <li> <p>Place the cover on the station</p> <p></p> <p></p> </li> <li> <p>Place the serrated spacers, with the serrated side on the outer part (they help to hold the station in place)</p> <p></p> </li> <li> <p>Place the perforated steel stripe in one of the sides. Don't tight it too much, so that you have room to place it in the pole</p> <p></p> <p></p> </li> <li> <p>Put the station in it's final location, and tighten it with the perforated steel stripes. Play with both sides, so that the stripes are tight on the pole</p> <p></p> <p></p> </li> <li> <p>You are done!</p> </li> </ul>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#power-supply","title":"Power supply","text":"<p>The Station can be directly powered at 220-240V AC (Max. consumption with the AC supply is 5W). It can also be powered via USB, with a normal phone charger (5V and 750mA max). However, there is a bit to do in order to change it. Let's see how!</p> <p></p> <p>Batteries</p> <p>The Living Lab Station has a higher consumption, mostly due to the fans on the two PM sensors.</p> <p>That means the internal battery last just for 20h, and it is only aimed at providing backup power.</p> <p>For example, we can connect the station on the street light electric line, so the Station gets charged during the night when the lights are on.</p> <p>Solar Panel</p> <p>Unfortunately, we are having some problems with the PV Solar Panel system to power the Station independently. The system is currently under tests, and it will be available in the next few months.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#changing-power-supplies","title":"Changing power supplies","text":"<p>Before we start, some tools that will be helpful during the process:</p> <p></p> <p>Danger</p> <p>Unplug the station before starting this process from any type of external supply</p> <p>Step by step</p> <ul> <li> <p>Remove the two covers using the allen keys as explained on the setup instructions.</p> <p></p> </li> <li> <p>Remove the layer which contains the kit. The kit is attached to the layers below, as seen in the image</p> <p></p> </li> <li> <p>Unplug the different connectors in the kit: I2C, battery and USB</p> <p></p> </li> <li> <p>You can use nose pliers for the USB and the battery</p> <p></p> <p></p> </li> <li> <p>Time to get to the power layer, this time, two blue layers will come off</p> <p></p> </li> <li> <p>Unscrew the cover for the power area</p> <p></p> </li> <li> <p>Make sure there is no energy left in the power supply by checking that there is no LED on in it. Then, remove the cables from the power supply and the white brackets</p> <p></p> <p></p> </li> <li> <p>Extract the cable from the base's cable gland</p> <p></p> </li> <li> <p>Cover the cable gland again and remove the square cable gland on the other side</p> <p></p> </li> <li> <p>Exchange the rubber in the cable gland with the one provided with a hole</p> <p></p> <p></p> <p></p> </li> <li> <p>Put the cable in and fix the gland in place. Leave sufficient overhead in the cable to be able to connect it to the kit</p> <p></p> <p></p> </li> <li> <p>Put the power cover back on</p> <p></p> </li> <li> <p>Put the kit's layer back on and pass the cables through</p> <p></p> </li> <li> <p>Connect everything in this order: first, the I2C connector, second, the battery, third, the USB</p> <p></p> </li> <li> <p>Put the kit's layer on again. Verify that the o-ring fit's in properly. Close everything and put both layers back on on</p> <p></p> <p></p> </li> <li> <p>Now, you can use the USB power supply or the battery pack!</p> <p></p> <p></p> </li> </ul>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#dimensions","title":"Dimensions","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#troubleshooting","title":"Troubleshooting","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#the-station-does-not-respond","title":"The station does not respond","text":"<p>If the station does not respond or does not work properly you can do two things:</p> <p>Reboot your Station</p> <p>You can fully reboot your Station by pressing the reset button located under the sensors board as seen on the picture. That will not delete any configuration, it will simply restart your device. Press the <code>RESET</code> button for a second. The light will go off and on and the device will start again.</p> <p></p> <p>You can also perform a reboot by disconnecting the battery and the USB cable so that the station is restarted. In this way we will not lose any data and configuration except the time in case of being in SD mode.</p> <p></p> <p>Factory reset your Station</p> <p>You can fully reset the Station to the default settings so you can register again your device. Press the main button for 15 seconds.</p> <p></p> <p>After 5 seconds the light will go off and will go on again after 15 seconds. Then you can release the button and your device will be fully resetted as a brand new Station.</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#the-led-does-not-turn-on-and-the-station-does-not-work","title":"The LED does not turn on and the station does not work","text":"<p>First of all, push the station button. Maybe it's simply off.</p> <p>If this does not work, surely the station has been left without battery. You will have to charge it using the USB charger. Any other mobile charger will also work.</p> <p>We will know that it is charging when the LED emits  orange pulses and once the battery is charged it will emit green  &lt;/ span&gt;"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V1/#the-station-does-not-store-the-data-on-the-sd-card","title":"The station does not store the data on the SD card.","text":"<p>Some SD cards may have problems over time. We can try formatting it but in case it does not work any micro SD card we buy at any mobile or computer store it will work. The size is not important and any micro SD or micro SDHC 512MB card up to 32GB will work.</p> <p></p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/","title":"Deployment iSCAPE Station V2","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#components","title":"Components","text":""},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#sensors","title":"Sensors","text":"<p>The sensors of the iSCAPE Living Lab Station V2.0 are the same as the ones in the iSCAPE Station V1.0.</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#the-pack","title":"The Pack","text":"<ul> <li> <p>Smart Citizen Station</p> <ul> <li>Urban Board 2.1</li> <li>Data Board 2.1</li> <li>PM Board 2.0 + 2 PM sensors</li> <li>Gas Pro Board 2.0 with 3 EC sensors</li> <li>6Ah Battery</li> </ul> </li> <li> <p>Accessories</p> <ul> <li>MicroSD card 512MB</li> <li>USB Charger</li> <li>MicroSD to SD card adapter</li> <li>Smart Citizen Power Supply (Traco P.S. 230AC in - DC5V out)</li> <li>2m 3-Wire 220V cable</li> <li>Mounting brackets</li> <li>Mounting tools (1 x Allen Key)</li> <li>Enclosure</li> <li>Mounting bracket</li> <li>Thermoconformed Umbrella </li> </ul> </li> </ul>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#instructions","title":"Instructions","text":"<p>To start the installation simply visit the setup website stations.iscape.smartcitizen.me.</p> <p>Warning</p> <p>We keep track internally of all sensor deployments and it is very important not to swap the internal components between Station to avoid mismatchs on the calibration data.</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#outdoor-installation","title":"Outdoor installation","text":"<p>WIP</p> <p>This section is WIP</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#power","title":"Power","text":"<p>The iSCAPE Station has a battery life of 12 hours as is intended as a backup solution only. That's why a power supply needs to be installed as decribed below. When we no longer want to publish or save more data for a few days we can turn off the kit. To do this, press the button for 5 seconds.</p> <p>If the colors of the LED appear orange   indicates that the battery must be charged.</p> <p>The battery takes about 4 hours to fully charge. When the battery is fully charged, change the orange to green  .</p> <p>Remember that in addition to the colors you will have the state color of the kit: configuration, network and sd.</p>"},{"location":"Guides/deployments/Deploying%20iSCAPE%20Station%20V2/#power-supply","title":"Power supply","text":"<p>The Station can be directly powered at 220V AC (max consumption 5W).</p> <p>Working on batteries</p> <p>The Smart Citizen Station has a higher consumption than the kit, mostly due to the fans on the two PM sensors. That means the internal battery last just for 20h, and it is only aimed at providing backup power.</p>"},{"location":"Guides/deployments/Installing%20Connectivity%20Units/","title":"Installing the Connectivity Units","text":""},{"location":"Guides/deployments/Installing%20Connectivity%20Units/#the-pack","title":"The pack","text":"<p>An IP65 box containing a 4G WiFi Access point with two external dipole antennas. Additionally:</p> <p></p> <ul> <li>Mounting fittings</li> <li>SIM card adaptor</li> <li>Ethernet cable</li> <li>User manual</li> </ul> <p>How much data is needed</p> <p>At the maximum data rates (Smart Citizen Station with all sensors - 35 metrics) we estimate 300bytes per payload (approx. without accounting for protocol overhead). It would be then safe to say that, per month and device, at maximum we need around 15MB. This means that with a data plan for 200MB/month you could have around 13 devices! </p> <p>Step by step</p> <ul> <li>Open the box with the safety key provided. You should see this inside</li> </ul> <p></p> <ul> <li>Before powering the unit, place the SD card in the slot. You can use the adaptor if needed</li> </ul> <p></p> <ul> <li>Take the stickers out for the antennas holes and pass them through, leaving the washers as seen below:</li> </ul> <p> </p> <ul> <li>Power on the unit, and then press the power button in the back. The SSID and the Password for the deployed network should be visible on the AP. Enjoy!</li> </ul> <p>Reconfigure the AP</p> <p>Follow the instructions in the quick installation guide provided to reconfigure the SSID and Password.</p>"},{"location":"Guides/deployments/Installing%20solar%20panel/","title":"Installing solar panel","text":"<p>This guide walks through the process for installing a Solar Panel with the Smart Citizen Kit.</p> <p>This guide is a work-in-progress</p>"},{"location":"Guides/deployments/Installing%20solar%20panel/#components","title":"Components","text":"<p>Our default solar panel proposal is a Voltaic Systems 6W 6V Solar Panel. The solar panel is totally water proof, and we recommend using extension cable and open leads cabling for connecting it to our MPTT proposal, the MPTT DF Robot DFR0559. We also recommend using the solar panel bracket for attachment to walls or lampposts.</p> Item Source Information 6W 6V Solar Panel Voltaic Systems Link Xxtension cable Voltaic Systems Link Open leads cabling Voltaic Systems Link Mounting bracket Voltaic Systems Link MPTT DF Robot DFR0559 Link Battery DF Robot DFR0559 Link"},{"location":"Guides/deployments/Installing%20solar%20panel/#installation","title":"Installation","text":""},{"location":"Guides/deployments/Installing%20solar%20panel/#physical-installation","title":"Physical installation","text":"<p>Use the bracket to install the panel according to the panel orientation below. The SCK can be up to 3m away from the solar panel. This example image shows how the panel should look once in place:</p> <p> Image credit: Voltaic Systems</p>"},{"location":"Guides/deployments/Installing%20solar%20panel/#panel-orientation","title":"Panel orientation","text":"<p>It is important to orient the solar panel properly to get the maximum amount of sunlight in the proper angle.</p> <p>Reference</p> <p>This is a nice calculator for your location.</p> <p>Solar panels should always face true south in the Northern Hemisphere and North in the Southern Hemisphere. The orientation of the solar panel with respect to the horizontal plane should be at a degree equal to your latitude plus 15 degrees in winter, or minus 15 degrees in summer (roughly). A bit more advanced tweaking, could achieve better efficiency for fixed solar panels. Since the winter season has the least sun, you want to make the most of it. In this case, the tilt should be designed so that the panel points directly at the sun at noon. To calculate, multiply your latitude by 0.9, and add 30 degrees.</p> <p>The 6W 6V solar panel that we suggest using, is calculated for having enough amount of insolation during winter in Spain's latitude, considering the amount of hours/day there is sun in winter. A larger solar panel can be used for higher latitudes (or further south), with less hours/day of insolation.</p>"},{"location":"Guides/deployments/OLED%20display/","title":"OLED Display","text":"<p>Supported screens are 128x128 and use the SH1107 controller, we have tested the code with displays labeled as v2.0 and v2.1. If the screen is connected to the AUX grove connector on the SCK it will be autodetected on boot:</p> <p></p> <p></p>"},{"location":"Guides/deployments/OLED%20display/#info-bar","title":"Info bar","text":"<p>From left to right on the info bar we will find:</p> <p> </p> <p>Mode: The Operation mode in which our kit is now (SETUP, WIFI, SD or SHELL). No icon, just text on this one. Wi-Fi: This icon will appear when the kit is connected to the internet. SD card: Present when an SD card is inserted and writable. Time synced: Shown when the SCK internal clock has been synced. External power: Shown when the USB cable that provides power to the kit is connected. Battery states: Charging, full (75%-100%), half (25%-75%), empty (&lt;25%). The battery level is also shown as a percentage. When the battery is disconnected, no icon or percentage are shown.</p>"},{"location":"Guides/deployments/OLED%20display/#setup-screen","title":"Setup screen","text":"<p>When the SCK is in setup mode, it will display the name of the Wi-Fi Access point network and some simple instructions.</p> <p></p>"},{"location":"Guides/deployments/OLED%20display/#readings-display","title":"Readings display","text":"<p>Enabled sensors will be shown by default in a three-second loop (except the battery, that's already on the info bar). </p> <p></p> <p>Using the command shell, you can manually add/remove sensors from the display loop with the command <code>sensor sensorName -oled</code> that will toggle the state of the selected sensor.</p> <p><pre><code>SCK &gt; sensor temperature -oled\nTemperature will not show on oled display\n</code></pre> And check which sensors are displayed with the command <code>sensor</code>.</p> <pre><code>SCK &gt; sensor\n...\nTemperature (60 sec)\nHumidity (60 sec) - oled\nLight (60 sec) - oled\nNoise dBA (60 sec) - oled\n...\n</code></pre>"},{"location":"Guides/deployments/OLED%20display/#error-bar","title":"Error bar","text":"<p>Errors related to SD card, time sync, Wi-Fi, missing configuration or general network errors are shown in a pop-up at the bottom of the screen.</p> <p></p>"},{"location":"Guides/deployments/OLED%20display/#monitor-plot","title":"Monitor plot","text":"<p>You can plot one sensor in real time directly to the OLED screen, to use this feature you need to issue the command <code>monitor -oled sensorName</code> via the command shell. During the execution, the kit will stop all other tasks and try to send readings as fast as it can. Update speed depends on which sensor you are plotting.</p> <pre><code>SCK &gt; monitor -oled light\n</code></pre> <p></p>"},{"location":"Guides/deployments/OLED%20display/#debug-log-view","title":"Debug log view","text":"<p>Debug output to OLED screen is supported, it has to be enabled via the command shell. You can toggle debug output with the command <code>debug -oled</code>. Everything that is normally printed on the shell will also be redirected to the OLED screen with a very small font!!</p> <pre><code>SCK &gt; debug -oled\nOled display debug: true\n</code></pre> <p></p>"},{"location":"Guides/deployments/OLED%20display/#known-issues","title":"Known issues","text":"<ul> <li>All this development has been done with a short (~5 cm) grove cable, when testing longer cables we have seen instabilities that prevent the display refresh or even hang the SCK kit. More tests with bus speed and related issues are needed.</li> <li>Using this display simultaneously with other external sensors on the auxiliary I2C bus may cause instabilities.</li> </ul>"},{"location":"Guides/deployments/Using%20the%20power%20supply/","title":"Using the custom power supply","text":"<p>The power supply is very simple to operate. If you have purchased one, normally, everything should be connected and ready to go. In some cases, the AC cable (left screw connector) is not connected, and it can be simply connected through the cable gland into the terminals. No ground is required.</p> <p></p> <p>When connecting the plug to the wall socket, the red LED should turn on indicating 5V output. The input is protected with a 1A Fuse and the pack should be enclosed in a waterproof enclosure as detailed here.</p> <p>The indication LED shows the Power Supply is active. It is also a warning in case you have unplugged it but there is still some charge in it (it might take some seconds to fade out):</p> <p></p> <p>More information regarding the power input is shown below and available in the datasheet:</p> <ul> <li>Input range: 100V-240VAC 50-60Hz, max 0.25A input, 1A Fused, or 277VAC 0.125A, also 50-60Hz</li> <li>Output range: 5V DC, max 2.0A</li> </ul>"},{"location":"Guides/deployments/Water%20sensors/","title":"Water sensors","text":""},{"location":"Guides/deployments/Water%20sensors/#getting-around-the-box","title":"Getting around the box","text":"<p>Here is a first overview of the box:</p> <p></p>"},{"location":"Guides/deployments/Water%20sensors/#setup","title":"Setup","text":"<p>Only if you bought them separately</p> <p>This guide describes the setup procedure of the Atlas Scientific probes in case you bought them separately. If you have a Water Station, you don't need to do this.</p>"},{"location":"Guides/deployments/Water%20sensors/#manually-switching-circuits-to-i2c-mode","title":"Manually switching circuits to I2C mode","text":"<p>If the drivers are new normally they come configured in UART mode so we need to change them to I2C mode.</p> <ol> <li>Remove circuit from Tentacle shield.</li> <li>Put the circuit into a breadboard.</li> <li>For PH, DO, ORP and EC: Short the <code>PGND</code> pin to the <code>TX</code> pin using a jumper wire.</li> <li>For RTD (temperature): Short the <code>PRB</code> pin to the <code>TX</code> pin using a jumper wire.</li> <li>Power the device (connecting <code>GND</code> and <code>VCC</code>)</li> <li>Wait for LED to change from green to blue (UART\u2192I2C) or from blue to green (I2C\u2192&gt;UART).</li> <li>Remove the jumper wire from the <code>PGND</code> (or <code>PRB</code> respectively) pin to the <code>TX</code> pin (Do this before removing power!).</li> <li>Remove power (<code>VCC</code>).</li> <li>Apply power (<code>VCC</code>).</li> <li>The device is now in the new mode (repeat all steps to switch back to previous mode).</li> </ol> <p>Official documentation</p> <p>Atlas Doc</p>"},{"location":"Guides/deployments/Water%20sensors/#connection-to-smartcitizen-kit","title":"Connection to Smartcitizen Kit","text":"<p>After connecting the Tentacle 3 to the SCK power your kit and if youre connected to the shell the autodetecition message should look similar to this (depending on the connected drivers and probes):</p> <pre><code>Urban board detected\nEnable Atlas Temperature\nEnable Atlas PH\nEnable Atlas Conductivity\nEnable Atlas Specific gravity\n...\n</code></pre> <p>Sensor calibration</p> <p>Make sure to follow our sensor calibration guide for the water sensors.</p>"},{"location":"Guides/deployments/Water%20sensors/#preparing-the-probes","title":"Preparing the probes","text":"<p>Atlas Scientific has great documents on how to use their probes, and maintain them (all the images below are theirs). Many other probes by other manufacturers will have the same issues, as they are based on the similar working principles. Below we compile some guidelines specific to the sensors. Make sure you also follow the instructions on how to calibrate them.</p>"},{"location":"Guides/deployments/Water%20sensors/#all-probes","title":"All probes","text":"<p>Most of the probes will generate potassium chloride (KCl) crystals that are fully harmless. Make sure you clean them with distilled water before use.</p> <p></p> <p>Once you are done using them, the probes that have a protective electrolyte solution (pH and ORP) will need to be put back in.</p>"},{"location":"Guides/deployments/Water%20sensors/#dissolved-oxygen","title":"Dissolved Oxygen","text":"<p>The dissolved oxygen probe needs to be actively maintained. The datasheet has a good information on how to maintain and clean the probe. Here is a small brief:</p> <ul> <li>When you open the probe the first time, make sure you only open the rubber cap, and not any sensor component such as the membrane cap</li> </ul> <p></p> <ul> <li>The sensor has an electrolyte solution inside to support the chemical reaction in the electrodes. This solution depletes over time, as the sensor is used and it will generate a solid residue that needs to be cleaned periodically (roughly every 6 months for the Mini DO probe, but better to check)</li> </ul> <p></p> <p></p> <ul> <li>You can recondition the sensor with a small file and remove all Zinc Oxyde. Make sure that the probe membrane is cleaned with a very soft brush both inside and outside. The membrane can be replaced if damaged. Make sure it is in good conditions because it will otherwise leak the electrolyte solution and the sensor will work erratically.</li> </ul> <p></p> <p></p> <p>First time use? Do it</p> <p>Even it the sensor is brand new, we recommend you follow this process to avoid issues.</p>"},{"location":"Guides/deployments/Water%20sensors/#ph-and-orp","title":"pH and ORP","text":"<p>No particular consideration for these probes, other than they are very delicate:</p> <p></p> <p>Storage solution</p> <p>Both probes need storage solution in a small soaker bottle to prevent it from drying out.</p> <p>If the probe is not being used you need to put the soaker bottle back on.</p>"},{"location":"Guides/deployments/Water%20sensors/#maintenance","title":"Maintenance","text":"<p>Make sure that the sensors are cleaned frequently, specially if deployed on the field. In some cases, sensors will be affected by biofouling and they will need more or less often cleanup - in some cases weekly!</p> <p>Public Domain, Link</p>"},{"location":"Guides/enclosures/Assembling%20Smart%20Citizen%20Stations/","title":"Assembling Smart Citizen Stations","text":"<p>This guide will explain how to assemble the small Smart Citizen Stations. The unit is designed to be manufactured in a Fab Lab, and it has a series of 3D printed components, as well as a rain cover made out of composite material (commercially known as dibond).</p> <p></p>"},{"location":"Guides/enclosures/Assembling%20Smart%20Citizen%20Stations/#passing-the-cable-through","title":"Passing the cable through","text":"<p>Even if it's very simple process, the USB cables we use to power the sensor come in different shapes and sizes. This makes it a bit difficult to seal the enclosure, and the cables are often are pulled and can damage the sensor. To avoid this, make sure you place this small cable gland in the enclosure.</p> <p>Step-by-step</p> <ul> <li> <p>Prep the white base by dissassembling it from the blue cover</p> </li> <li> <p>Pass the USB Cable through</p> </li> </ul> <p></p> <ul> <li>Connect the USB cable to help you out</li> </ul> <p></p> <ul> <li>Put in the first half of the cable gland. It fits tightly</li> </ul> <p></p> <ul> <li>Finish it up with the other half</li> </ul> <p></p> <ul> <li>Make sure the amount of cable inside the unit is not too long, not too short!</li> </ul>"},{"location":"Guides/enclosures/Assembling%20Smart%20Citizen%20Stations/#assembling-the-rain-cover","title":"Assembling the rain cover","text":"<p>Step-by-step</p> <ul> <li> <p>Setup the workspace with what you need:</p> <ul> <li>White base containing with sensors (with 6x M3x10 PH Inox screws)</li> <li>Blue cover</li> <li>Umbrella cover</li> <li>4x M3x10 HEX Inox screws</li> <li>2x screw drivers</li> </ul> </li> </ul> <p></p> <ul> <li> <p>Disconnect the plug from the power supply in case you connected it earlier</p> </li> <li> <p>If the blue cover and white sensor base is assembled, open it up using the philips screw driver</p> </li> <li> <p>Introduce the HEX screws in the holes of the blue cover</p> </li> </ul> <p></p> <ul> <li>Attach the blue cover to the umbrella in the 4 corners and attach it with the screws in place</li> </ul> <p></p> <p></p> <ul> <li>Pass the USB cable through the hole and put the small cable gland to fit it in place</li> </ul> <p></p> <ul> <li> <p>Turn on the device by pressing the ON/OFF button</p> </li> <li> <p>And finally close it with the 6 screws in the white base</p> </li> </ul> <p></p> <ul> <li>Note: if you forgot to turn it on, you can always use the reset button</li> </ul> <p></p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/","title":"Making your own enclosures","text":"<p>This page compiles instructions on how to make your own enclosures. We normally use digital fabrication techniques that can be found in a Fablab such a 3D printing, laser cut or CNC machines. Have a look at the best option for your possibilities. We also encourage you to modify any of them and contribute it back to the community in the enclosures repository.</p> <p>Where to print/cut?</p> <p>Have a look at Hubs or look for a Fablab near you!</p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#cnc-enclosure","title":"CNC Enclosure","text":"<p>This enclosure is made out of a mix of HDPE, acrylic and 3D printed compontents. All the design files can be find in various formats in the enclosures repository.</p> <p></p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#3d-printing-parts","title":"3D printing parts","text":"<p>Clip</p> <p></p> <p>The SCK and the PMS5003 are held together by a 3D printed clip. No support is needed for this part. The clip is attached to the base with screws.</p> <p></p> <p>There are two versions of the clip:</p> <ul> <li>One for big batteries that uses an o-ring to hold the battery in place. You can also use a rubber band, but it won't last long under the sun - clip_big_batt.stl</li> <li>One for smaller batteries that uses the PMS5003 cable to hold the battery (valid for default battery of 2000mAh) - clip_wo_oring.stl</li> </ul> <p>Cable gland</p> <p>There is a small cable gland (part 1 and 2)that fits into the HDPE blue base to hold the cable in place. It's split into two, so that the USB head can go through.</p> <p>Foam cover</p> <p>An additional foam cover has been included for high humidity environments. The print settings in SliC3r need to be adapted with:</p> <ul> <li>0.2mm layer height</li> <li>Detect thin walls</li> </ul>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#cnced-parts","title":"CNC'ed parts","text":"<p>CNC milling of 15mm HDPE sheets for the base (we make it in blue), and 10mm for the top (we make it in white).</p> <p>Base</p> <p>The base is made out of a ouble sided milling on blue HDPE. The holes are for self-tightening screws (such as these ones). The bottom side has a channel for avoid water dripping into the sensors and break the flow. It also has small machined slots for easier disassembly:</p> <p></p> <p>An additional cap is added to cover the hole in case no cable is needed.</p> <p>Top cover</p> <p>The top cover is a single sided milling in white HDPE. The part has a stepped milling for letting heat out, without letting water in.</p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#sheet-metal","title":"Sheet metal","text":"<p>This plate is meant for attaching the whole system to a wall or pole, as well as supporting the installation of an external power supply in an IP65 box. The sheet is 1mm stainless steel with laser cutting and bent in two edges 90\u00ba.</p> <p></p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#3d-printed-enclosures","title":"3D printed Enclosure(s)","text":"<p>This enclosure is meant to be fully 3D printed in PLA in a normal desktop 3D printed machine. </p> <p>This design is not aiming to be the best design in the world, but one that anyone can make and modify such as our contributors.</p> <p></p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#printing-settings","title":"Printing settings","text":"<p>We have tested the 3D printed components with both PLA or ABS. Good results are achieved with a normal 0.4mm nozzle and 0.2 layer height. No raft or brim are needed.</p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#components","title":"Components","text":"<p>Clip</p> <p>The SCK and the PMS5003 are held together by a 3D printed clip. No support is needed for this part. </p> <p>Base and top covers</p> <p>Base and cover parts at different sizes too or transparent. Support is not needed for these part. A gasket can be added to the joint with adhesive foam. You can increase the top's thickness if you need better isolation, or use the foam provided with the SCK's box as an insulator. Also, tin foil is quite a good reflective material and helps with sun radiation.</p>"},{"location":"Guides/enclosures/Making%20your%20own%20enclosures/#a-very-diy-enclosure","title":"A very DIY enclosure","text":"<p>Warning</p> <p>Keep in mind that casing is designed for short outdoor deployments. If you want a case for long exhibitions abroad, we will soon have a much more rugged enclosure ready! Also, feel free to explore all our enclosures repository for this and other versions of our hardware.</p> <p>Step by step</p> <p>First, you will need the two 3D printed clips. You can download the STL file and print them easily on any RepRap or similar FDM printer. If you don't know how to find a 3D printer, you can look for your nearest Fab Lab or use 3D Hubs.</p> <p></p> <p>1.Use scissors to cut an empty plastic bottle at about 12 cm from the top</p> <p></p> <p>2.Use the rubber band to fix it using the bottle cap</p> <p></p> <p>3.Place the Kit inside and use the rubber band to hold it</p> <p></p> <p>4.You have now a simple enclosure to use your Kit outdoors for short measurement periods!</p> <p></p> <p></p>"},{"location":"Guides/firmware/Debug%20the%20firmware/","title":"Debug the firmware","text":""},{"location":"Guides/firmware/Debug%20the%20firmware/#introduction","title":"Introduction","text":"<p>Sometimes (many times actually), our code won't do what we want it to do and we need to take a look at what it's doing. By using a debugger we will be able to see what is going on inside another program while it executes or even crashes. This is fairly straight forward when you code for a modern day computer, since most IDEs have a proper interface integrated for it. However, debugging a chip like the SAMD21 can sometimes be tricky and here is where it's interesting to use a debugging kit.</p> <p></p> <p>To keep it simple: our final target is to be able to interact with the SAMD21 (or the chip) while it's executing the program and tell it to pause the execution, give us the value of some variables and then continue. We will release a fairly extensive report with documentation on this process, but for those interested in reading an overview on how to debug, this post can be a short introduction.</p> <p>So, here we go! The first item we need is the Open On-Chip Debugger (OpenOCD) which provides debugging with the assistance of a debug adapter. This adapter is a small hardware module which helps provide the right kind of electrical signaling to the target being debugged. These are required since the debug host, on which OpenOCD runs (i.e. your computer, a Raspberry PI...) won\u2019t usually have native support for such signaling, or the connector needed to hook up to the target.</p> <p></p> <p>These adapters are sometimes packaged as discrete dongles, which may generically be called hardware interface dongles (and are quite expensive). Some development boards also integrate them directly, which may let the development board connect directly to the debug host over USB (and sometimes also to power it over USB, like the Arduino Genuino Zero). In the case of the Smart Smart Citizen Kit, we have a SWD Adapter that supports Serial Wire Debug signaling to communicate with the ARM core. In our approach, using a complete open toolchain, OpenOCD is be running on a Raspberry Pi, and communicating with the SCK's SWD through the GPIO pins of the Pi.</p> <p>Finally, to be able to actually see what is going on inside our firmware while it executes, we need something that is able to read and understand the machine code and hand it over to a human understandable interface. This is where GDB kicks in and helps us by:</p> <ul> <li>Starting our program, specifying anything that might affect its behavior.</li> <li>Make our program stop on specified conditions.</li> <li>Examine what has happened when our program has stopped.</li> <li>Change things in our program, so we can experiment with correcting the effects of one bug and go on to learn about another.</li> </ul> <p>GDB and OpenOCD will be running in a Raspberry Pi hooked up to the SWD interface of the SCK, and we will see what's going on in them from our computer's terminal via SSH. Fairly simple, right? Now, we can make some changes to our code, make GDB flash it to the SCK and keep debugging in a completely open toolchain!</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#debugger-setup-using-a-raspberry-pi","title":"Debugger setup using a Raspberry Pi","text":"<ul> <li> <p>First download and copy Raspbian Lite to your SDcard, here are the installation docs.</p> </li> <li> <p>Add wifi configuration</p> <p>Create a file name <code>wpa_supplicant.conf</code> on the <code>/boot</code> partition of the SD card, the content of this file should looks like this:</p> <p><pre><code>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\nupdate_config=1\n\nnetwork={\n    ssid=\"wifi_ssid\"\n    psk=\"wifi_password\"\n}\n</code></pre> Replacing wifi_ssid and wifi_password with your actual wifi network     information. The wpa_supplicant.conf file will be copied to /etc/wpa_supplicant/ directory automatically once the Raspberry Pi is booted up.</p> </li> <li> <p>Enable SSH server.</p> <p>SSH access is disabled as default for security reasons. To enable the SSH server when Raspberry Pi is booted up for the first time: create a file called <code>ssh</code> with no file extension and no contents, and copy it to the <code>/boot</code> partition on the SD card.</p> </li> <li> <p>Find your raspberry on the network</p> </li> </ul> <p>In order to find a raspberry pi over the network we can use commands like these:</p> <p>Linux</p> <pre><code>MY_IP_RANGE=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}') &amp;&amp; nmap -sn $MY_IP_RANGE &amp;&amp; IP=$(arp -na | grep b8:27:eb | grep -Eo '[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}') &amp;&amp; ssh $IP;\n</code></pre> <p>Mac </p> <pre><code>MY_RANGE=$(ip addr | grep \"UP\" -A3 | grep '192' -A0 | awk '{print $2}') &amp;&amp; nmap -sn $MY_RANGE &amp;&amp; arp -na | grep b8:27:eb\n</code></pre> <ul> <li> <p>SSH login without password:</p> <ul> <li>If you have never generated a RSA key: <code>ssh-keygen</code> without passphrase</li> <li>Copy the key to the Raspberry: <code>ssh-copy-id -i ~/.ssh/id_rsa.pub raspi-address</code></li> </ul> <p>Once booted, it will connect to the network. The command above (<code>MY_IP...</code>) finds it and logs into it via SSH.</p> </li> </ul> <p>Once you are logged to your raspberry pi and connected to the internet, do a system upgrade: <pre><code>sudo apt-get install rpi-update\nsudo rpi-update\nsudo apt-get update &amp;&amp; sudo apt-get dist-upgrade\n</code></pre> Install some dependencies:</p> <pre><code>sudo apt-get install git autoconf libtool make pkg-config libusb-1.0-0 libusb-1.0-0-dev telnet sshfs\n</code></pre>"},{"location":"Guides/firmware/Debug%20the%20firmware/#openocd-installation","title":"Openocd installation","text":"<ul> <li>Clone openocd repository and compile:</li> </ul> <pre><code>git clone git://git.code.sf.net/p/openocd/code openocd-code\ncd openocd-code\n./bootstrap\n./configure --enable-sysfsgpio --enable-bcm2835gpio\nmake\nsudo make install\n</code></pre> <p>The list of interfaces that openOCD can use is under: /usr/local/share/openocd/scripts/interface.</p> <p>In order to use the SWD connector that the SCK features, by using Bit Banging, we connect it directly to the Raspberry Pi GPIOs:</p> <p></p> <p></p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#running-openocd-on-the-raspberry-pi","title":"Running OpenOCD on the raspberry pi","text":"<p>Once you are logged into the raspberry Pi you need a openOCD config file to start (ej. sck.cfg) with this content:</p> <pre><code>source [find interface/raspberrypi2-native.cfg]\ntransport select swd\n\nset CHIPNAME at91samd21g18\nsource [find target/at91samdXX.cfg]\n\nadapter_nsrst_delay 100\nadapter_nsrst_assert_width 100\n\ninit\ntargets\nreset halt\n</code></pre> <p>You can store this file in OpenOCD scripts dir so it will auto find it</p> <pre><code>sudo mv sck.cfg /usr/local/share/openocd/scripts/\n</code></pre> <p>and then run the OpenOCD server with:</p> <pre><code>sudo openocd -f sck.cfg\n</code></pre> <p>Then you can connect to OpenOCD, if you want to connect from an external computer, replace <code>127.0.0.1</code> with your Raspberry Pi IP address. <pre><code>telnet 127.0.0.1 4444\n</code></pre></p> <p>Example</p> <p>On a arduino zero go to the directory where the *.cfg is and: <pre><code>openocd -f arduino_zero.cfg\nOpen On-Chip Debugger 0.10.0\nLicensed under GNU GPL v2\nFor bug reports, read\n    http://openocd.org/doc/doxygen/bugs.html\nInfo : auto-selecting first available session transport \"swd\". To override use 'transport select &lt;transport&gt;'.\nnone separate\nadapter speed: 400 kHz\ncortex_m reset_config sysresetreq\nInfo : CMSIS-DAP: SWD  Supported\nInfo : CMSIS-DAP: Interface Initialised (SWD)\nInfo : CMSIS-DAP: FW Version = 02.01.0157\nInfo : SWCLK/TCK = 1 SWDIO/TMS = 1 TDI = 1 TDO = 1 nTRST = 0 nRESET = 1\nInfo : CMSIS-DAP: Interface ready\nInfo : clock speed 400 kHz\nInfo : SWD DPIDR 0x0bc11477\nInfo : at91samd21g18.cpu: hardware has 4 breakpoints, 2 watchpoints\n</code></pre></p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#using-openocd-remotely-from-other-computer","title":"Using OpenOCD remotely from other computer","text":"<p>We need to give the OpenOCD server access to your project files that are remotely stored. To do this you can mount your working directory remotely on the Raspberry Pi via SSH:</p> <p><pre><code>ssh pi@raspi_address\npi$ mkdir working_dir\npi$ sshfs user@computer_address:working_path working_dir\npi$ cd working_dir\npi$ sudo openocd -f sck.cfg\n</code></pre> Then you can connect to OpenOCD from your computer with: <pre><code>telnet raspi_address 4444\n</code></pre></p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#uploading-arduino-original-bootloader","title":"Uploading Arduino original bootloader","text":"<ul> <li> <p>Get the bootloader file here and build it.</p> </li> <li> <p>Connect to OpenOCD server and run: <pre><code>reset halt\nat91samd bootloader 0\nat91samd chip-erase\nprogram samd21_sam_ba.bin verify\nat91samd bootloader 8192\nreset run\n</code></pre> If you don't see any error youre done!</p> </li> </ul>"},{"location":"Guides/firmware/Debug%20the%20firmware/#uploading-sck-firmware","title":"Uploading SCK Firmware","text":"<ul> <li>Install platformio, download and build SCK firmware</li> <li>Connect to OpenOCD server and run:</li> </ul> <pre><code>reset halt\nflash write_image firmware.bin 8192\nverify_image firmware.bin 8192\nreset run\nreset run\n</code></pre>"},{"location":"Guides/firmware/Debug%20the%20firmware/#gdb","title":"GDB","text":""},{"location":"Guides/firmware/Debug%20the%20firmware/#general-description","title":"General description","text":"<p>The purpose of a debugger such as GDB is to allow you to see what is going on \u201cinside\u201d another program while it executes\u2014or what another program was doing at the moment it crashed.</p> <p>GDB can do four main kinds of things (plus other things in support of these) to help you catch bugs in the act: * Start your program, specifying anything that might affect its behavior. * Make your program stop on specified conditions. * Examine what has happened, when your program has stopped. * Change things in your program, so you can experiment with correcting the effects of one bug and go on to learn about another.</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#debugging-session-with-raspberry-pi-as-the-openocd-server","title":"Debugging session with Raspberry Pi as the OpenOCD server","text":"<p>Once your raspberry pi is setup with above instructions you can just do:</p> <pre><code>ssh pi@RaspberryAddress sudo openocd -f sck.cfg &amp;\ncd /platformio_project/path\narm-none-eabi-gdb ./pioenvs/zeroUSB/firmware.elf\n(gdb) target remote RaspberryAddress:3333\n(gdb) monitor reset run\n</code></pre> <p>If you are using platformio, you need to modify the compiling option to avoid optimisation with -0g message to the compiler. In case you are not using platformio, activate verbose compiling output at Arduino IDE and find your compiled .elf directory.</p> <pre><code>[env:zeroUSB]\nplatform = atmelsam\nboard = zeroUSB\nframework = arduino\nbuild_flags = -Og\n</code></pre> <p>Now we are all set and ready to go. The debugger is waiting for instructions on the execution, which we detail below.</p> <p>Info</p> <p>Quick handy instructions inside GDB environment 1. (gdb) appears in every line and you don't have to type it each time 2. In case you need to exit GDB, just type in <code>quit</code>, but remember always killing the process before, should you have a target running <pre><code>(gdb) kill\n(gdb) quit\n</code></pre> 3. <code>RET</code> repeats the previous command</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#gdb-commands","title":"GDB commands","text":"<p>All commands in gdb during debugging are detailed in the GDB guide, chapter GDB commands in detail (continue and stepping)</p> <p>An extract of some useful commands are detailed below:</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#continuing-and-stepping","title":"Continuing and stepping","text":"<p><code>continue [ignore-count]</code></p> <ul> <li>Resumes program execution until next breakpoint. <code>[ignore-count]</code> argument allows to specify a further number of times to ingore a breakpoint. <pre><code>(gdb) continue\nContinuing.\n\nBreakpoint 1, tick () at src/HOLA.cpp:9\n9   void tick() {\n</code></pre></li> </ul> <p><code>step count</code></p> <ul> <li>Continues running your program until control reaches a different source line, only availabe for source lines and functions compiled with debugging information. <code>count</code> is optional and states the number of steps to be performed before stopping, if no breakpoint arrives earlier.</li> </ul> <p><code>next [count]</code></p> <ul> <li>Continue to the next source line without going into functions. It has the same functionality as step, but it stays in the same stack frame. <code>count</code> works as in <code>step count</code>. As well, it understands jumps calls as in the end of <code>for</code> loops and return to the beginning of the loop.</li> </ul> <p>Info</p> <p><code>set step-mode on/off</code> sets the behaviour of <code>(gdb)</code> when stepping into a function with no debugging information. In the case of <code>step-mode on</code>, it inspects the first line of code of the function, whereas on <code>step-mode off</code> it skips the function completely.</p> <p><code>finish</code></p> <ul> <li>Continue running until just after function in the selected stack frame returns.</li> </ul> <p><code>until</code></p> <ul> <li>Has the same behaviour as <code>step</code>, but it ignores the jumps between lines due to loops (for, whiles, etc), continuing to the next source code with incremental line number.</li> </ul>"},{"location":"Guides/firmware/Debug%20the%20firmware/#breakpoints","title":"Breakpoints","text":"<p><code>info breakpoints</code></p> <ul> <li> <p>Retrieve information about breakpoints <pre><code>(gdb) info breakpoints\nNum     Type           Disp Enb\nress    What\n1       breakpoint     keep y   0x00002140 in tick() at src/HOLA.cpp:9\n    breakpoint already hit 15 times\n</code></pre> <code>break</code></p> </li> <li> <p>Set a breakpoint in a specific function <pre><code>(gdb) break loop\n</code></pre></p> </li> <li>Set a breakpoint in a specific line (344) <pre><code>(gdb) break main.cpp:344\n</code></pre></li> </ul> <p>Info</p> <p>Use the tbreak command instead of break if you want to stop the program once, and then remove the breakpoint. More breakpoint condition options can be found here you can find </p> <p><code>watchpoint</code></p> <ul> <li>Set a watchpoint watchpoint to only stop once a variable has a certain value. <pre><code>(gdb) watch timer\n</code></pre></li> </ul> <p>Info</p> <p>Type in <code>info watchpoints</code> to get information about watchpoints.</p> <p><code>commands</code></p> <ul> <li>Set a list of actions related to the breakpoint:</li> </ul> <pre><code>break main.cpp:50\ncommands\nsilent\nprintf \"count is %d\\n\",count\ncont\nend\n</code></pre> <p><code>delete</code></p> <ul> <li>Delete a breakpoint <pre><code>(gdb) delete 1\n(gdb) info breakpoints\nNo breakpoints or watchpoints.\n</code></pre></li> </ul>"},{"location":"Guides/firmware/Debug%20the%20firmware/#printing-setting-variables-and-more","title":"Printing / setting variables and more","text":"<p><code>loop</code></p> <ul> <li>Read what is around a certain function</li> </ul> <p><pre><code>(gdb) l loop\n25    //while (!Serial) {\n26      //; // wait for serial port to connect. Needed for native USB port only\n27    //}\n28  }\n29\n30  void loop() {\n31    // put your main code here, to run repeatedly:\n32    Serial.println(\"HOLA\");\n33    tick();\n34    Serial.println(millis());\n</code></pre> <code>print</code></p> <ul> <li>Retrieve value of a specific variable</li> </ul> <p><pre><code>(gdb) print timer\n$12 = 2\n</code></pre> <code>set</code></p> <ul> <li>Set variable to a certain value</li> </ul> <pre><code>(gdb) set timer = 0\n</code></pre>"},{"location":"Guides/firmware/Debug%20the%20firmware/#target-commands-load","title":"Target commands (load)","text":"<p><code>load filename offset</code></p> <ul> <li><code>Load</code> it is meant to make filename (an executable) available for debugging on the remote system\u2014by downloading it. <code>load</code> also records the filename symbol table in GDB, like the add-symbol-file command. The file is loaded at whatever address is specified in the executable, also into flash memory.</li> </ul>"},{"location":"Guides/firmware/Debug%20the%20firmware/#making-changes-in-the-code","title":"Making changes in the code","text":"<p>Anytime we make a change in the code, we don't need to reload the debugging session. We can easily do so by:</p> <ol> <li> <p>Compile the code:     a. Define Shell build in Sublime Text and configure a build sytem with:</p> <pre><code>\"shell_cmd\": \"cd .. &amp;&amp; pio run\"\n</code></pre> <p>Then, everytime you hit Ctrl+B (Cmd+B) and you use your custom build system, it will automatically use this option.</p> <p>b. Or hit <code>pio run</code> in another terminal located in your project root directory</p> </li> <li> <p>In gdb, <code>load</code> file. This will reload the file defined at the beginning of your debugging session and upload it to the target</p> </li> </ol> <pre><code>(gdb) load\nLoading section .text, size 0x2e50 lma 0x2000\nLoading section .ramfunc, size 0x60 lma 0x4e50\nLoading section .data, size 0x110 lma 0x4eb0\nStart address 0x2910, load size 12224\nTransfer rate: 3 KB/sec, 4074 bytes/write.\n</code></pre> <ol> <li>Keep debugging</li> </ol>"},{"location":"Guides/firmware/Debug%20the%20firmware/#gdb-console","title":"GDB Console","text":""},{"location":"Guides/firmware/Debug%20the%20firmware/#tui","title":"TUI","text":"<p>GDB has a console GUI option available with the command line option --tui In the upper frame you can see the code that's being executed.</p> <p></p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#gdb-init-file","title":"GDB init file","text":"<p>From this example dashboard we can generate a custom .gdbinit file for the SCK which will be placed in the HOME directory... (ON GOING)</p> <p>Info</p> <p>Would be interesting to generate a custom option for production validation and one for internal debugging purposes</p> <p>For references about where to locate the .gdbinit and more custom behaviour for gdb in general see here.</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#gdb-from-sublime-text","title":"GDB from Sublime Text","text":"<p>Setup Platformio project with sublime Text Setup sublimeGDB</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#reference","title":"Reference","text":""},{"location":"Guides/firmware/Debug%20the%20firmware/#general-gdb-references-and-examples","title":"General GDB references and examples","text":"<p>Debugging with GDB - Book</p> <p>Debugging example from GDB and OpenOCD</p> <p>Arduino zero example</p>"},{"location":"Guides/firmware/Debug%20the%20firmware/#additional-notes-from-platformio-configuration","title":"Additional notes from Platformio configuration","text":"<ol> <li>How to set other DEBUG FLAGS</li> <li>About project configuration with Platformio init</li> <li>Check here for building an *.ini file with custom build target for debugging and production.</li> </ol>"},{"location":"Guides/firmware/Edit%20the%20Firmware/","title":"Edit the Firmware","text":"<p>The data board of your Smart Citizen Kit is has two two microcontrollers:</p> <p></p> <p>The main one is an Atmel SAMD21, this chip is in charge of all the normal tasks like reading the sensors, saving data, interacting with the user, etc. For this chip we need two software components the bootloader and the main firmware.</p> <p>For communications the SCK has an ESP8266 microcontroler with Wifi capabilities, this chip receives instructions from the SAMD21 via serial port and takes care of publishing the collected data through the network and takes care of serving the web pages for the setup mode configuration server.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#prerequisites","title":"Prerequisites","text":""},{"location":"Guides/firmware/Edit%20the%20Firmware/#getting-the-firmware","title":"Getting the firmware","text":"<p>The Smart Citizen Kit Firmware is on our repository on github so you will need git software installed.</p> <p>Danger</p> <p>Do not install anything until reading completely this guide. Specially for <code>Windows</code> users, it can be particularly painful and we don't guarantee everything is going to work. Drop us an email at support if you need help.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#building-the-firmware","title":"Building the firmware","text":"<p>To build the SmartCitizen Kit firmware you need a computer with platformio installed. You don't need the full IDE installation (Atom or VSCode). You can follow these instructions to install only the console version. See below if you don't have python yet (or you don't know it's ok).</p> <p>Advanced</p> <p>For bootloader upload you also need OpenOCD somewhere in your PATH (more advanced).</p> <p>Windows users</p> <p>If you have Windows, the CLI version is available via <code>PowerShell</code>. An environment variable (PATH) needs to be set to give access to <code>pio.exe</code>. It's given in the Platformio instructions.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#installing-python","title":"Installing Python","text":"<p>Platformio is written in <code>python</code>, and this guide makes use of a lot of <code>python</code> scripts. You need to have at least <code>python=3.6</code>installed. If not, follow this guide. This guide will asume you use either <code>python</code>, <code>python3</code> for running scripts, or <code>pip</code> and <code>pip3</code> for installing things, we will just detail instructions run by <code>python</code> and packages installed by <code>pip</code>, but you should know what it's installed on your computer.</p> <p>Windows users</p> <p>We recommend:</p> <ol> <li>Using PowerShell (with admin rights). If you don't have it installed you can follow these instructions</li> <li>Installing Chocolatey and then proceeding with:</li> </ol> <pre><code>choco install python\n</code></pre> <p>Read very carefully the output of the installation.</p> <ul> <li>You can check if you have python installed:</li> </ul> <pre><code>&gt; which python\n/usr/bin/python\n</code></pre> <p>Windows</p> <p>To do this in <code>Windows</code>, you can check the output of <code>python --version</code></p> <ul> <li>Install <code>pip</code> if you don't have it (check <code>pip</code> before):</li> </ul> <pre><code>&gt; curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py\n&gt; python get-pip.py\n</code></pre>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#installing-requirements","title":"Installing requirements","text":"<p>You can use this requirements file to install everything you need to compile the firmware. Alternatively you can follow the steps below or if you want to control each version:</p> <ul> <li>Install <code>pyserial</code>:</li> </ul> <pre><code>&gt; pip install pyserial==3.5\n</code></pre> <ul> <li>Install <code>requests</code>:</li> </ul> <pre><code>&gt; pip install requests==2.26.0\n</code></pre> <ul> <li>Install <code>platformio</code>:</li> </ul> <pre><code>&gt; pip install platformio==5.1.1\n</code></pre> <p>Versions</p> <p>Versions for these packages are tested to work on OSX and Linux. If you can't find the same version for your platform, try to install something similar to the one provided in order to ensure everything works fine</p> <p>Once this is running, you can do either of the ones below. We will use the generic one throughout the guide:</p> Windows/linux/macOS <pre><code>&gt; cd smartcitizen-kit-21\n&gt; python make.py -h\n</code></pre> linux/macOS <pre><code>&gt; cd smartcitizen-kit-21\n&gt; ./make.py -h\n</code></pre>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#getting-the-firmware_1","title":"Getting the firmware","text":"<p>To get the firmware just run:</p> <pre><code>&gt; git clone --recursive https://github.com/fablabbcn/smartcitizen-kit-21\n</code></pre> <p>The bootloader and tools repositories are submodules of the main firmware so you must do a <code>--recursive</code> clone to get them.</p> <p>Info</p> <p>If you download the code manually (with the clone or download button on github) you will not get the bootloader and tools submodules code. To be able to compile the firmware you need to download the tools submodule and place it in the proper folder.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#getting-latest-changes","title":"Getting latest changes","text":"<p>If you want to update firmware, you can do so since the repository is connected with our Github repository via <code>git</code>. You can do so by:</p> <pre><code>cd smartcitizen-kit-21\ngit pull\n...\ncd tools\ngit pull origin master\n...\n</code></pre> <p>Or simply:</p> <pre><code>cd smartcitizen-kit-21\ngit pull --recurse-submodules\n...\n</code></pre>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#samd21-bootloader","title":"SAMD21 bootloader","text":"<p>Make sure you need to do this</p> <p>This instructions only are needed if your kit doesn't have the bootloader already flashed. If you don't know what you are doing here, skip to the flashing section.</p> <p>If your kit doesn't have the bootloader already flashed (all the kits that we ship come with it) you will need an ATMEL-ICE programmer. This process can also be done with a Raspberry Pi computer and the proper connector and cables, in this guide you will find information on how to do this.</p> <p></p> <p>Connect the Atmel-ICE programmer to the 10 pin SWD connector and to your computer. Power the SCK via USB, you can use any USB charger or even your computer.</p> <p>Open a terminal, go to the folder where you cloned the firmware repository and run:</p> <pre><code>&gt; cd smartcitizen-kit-21\n&gt; ./make.py boot\n</code></pre> <p>You will see a lot of output when compiling, the led on the SCK should breath in green and you should see an output similar to this:</p> <p></p> <p>You are ready for the next step, just remember to disconnect the Atmel-ICE programmer and connect the SCK to your computer with a USB cable.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#samd21-firmware","title":"SAMD21 firmware","text":"<p>The bootloader we just flashed allows a very simple way of uploading the SCK firmware based on the UF2 format, when you double-click the reset button of your kit it will expose a MSD interface to your computer and a new drive will popup where you can just drag the compiled firmware file (converted to UF2 format).</p> <p></p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#build-script","title":"Build script","text":"<pre><code>&gt; python make.py\n\nYou need to specify at least one action!!!\n\nUSAGE:\n\nbuild.py [options] action[s] target[s] -p port -f\n\noptions: -v: verbose -k: keep configuration\nactions: boot (only for sam), build, flash\ntargets: sam, esp [-p port [-f]]\n-p port [-f]: specify a port instead of scanning\n-f: option ignores serial device description (must contain Smartcitizen otherwise)\n</code></pre> <p>You can use the same script used to flash the bootloader (<code>make.py</code>) that will do everything for you: compile the firmware, convert the binary to UF2 format and upload it to the kit:</p> <pre><code>&gt; python make.py build flash sam -v\n</code></pre> <p>You can make each action separate:</p> Build SAMD21 <pre><code>&gt; python make.py build sam -v\n</code></pre> Flash SAMD21 <pre><code>&gt; python make.py flash sam -v\n</code></pre> Both <pre><code>&gt; python make.py build flash sam -v\n</code></pre> <p>SCK not found</p> <p>In some platforms, the SCK doesn't show up as \"Smartcitizen\" in the USB Device Description. This might make the script to fail and not detect it. This can be bypassed by specifying the port in which the SCK is connected. To find out which port it is, check here. Then, run the command below, where  is to be replaced: <pre><code>&gt; python make.py flash sam -p &lt;PORT&gt; -v\n</code></pre> <p>If this is your first time building the software, <code>platformio</code> will take a while installing all the needed dependencies, be patient. If there are no errors you should see an output similar to this:</p> <pre><code>&gt; python make.py build flash sam\n[0] Smartcitizen Kit S/N: 6E9FE7335150364852202020FF180E30\nBuilding SAM firmware... OK\nFlashing SAM firmware... OK\n</code></pre> <p>A copy of the compiled software in UF2 format called <code>SAM_firmware.uf2</code> will remain in the bin folder. You can use this file to reflash your kit without compiling it again. </p> <p>Info</p> <p>If you have any problem you can enable verbose output by calling build.py script with the <code>-v</code> flag. There is a known issue that causes first compilation to fail, if this happens please just try again.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#manual-process","title":"Manual process","text":"<p>If you want to install the firmware manually (or you had some problem with the build script) just follow this steps:</p> <pre><code>&gt; cd sam\n&gt; pio run\n</code></pre> <p>After a lot of compilation messages you should see an output similar to this:</p> <pre><code>Indexing .pio/build/sck2/libFrameworkArduino.a\nLinking .pio/build/sck2/firmware.elf\nChecking size .pio/build/sck2/firmware.elf\nBuilding .pio/build/sck2/firmware.bin\nAdvanced Memory Usage is available via \"PlatformIO Home &gt; Project Inspect\"\nRAM:   [=======   ]  73.3% (used 24004 bytes from 32768 bytes)\nFlash: [========  ]  80.7% (used 211548 bytes from 262144 bytes)\n====================== [SUCCESS] Took 43.41 seconds ======================\n</code></pre> <p>then to convert the binary firmware to UF2 format do:</p> <pre><code>&gt; cd ..\n&gt; ./tools/uf2conv.py -o SAM_firmware.uf2 sam/.pio/build/sck2/firmware.bin\n</code></pre> <p>And you should see something like this:</p> <pre><code>Converting to uf2, output size: 423424, start address: 0x2000\nWrote 423424 bytes to SAM_firmware.uf2.\n</code></pre> <p>Now double-click the reset button of your kit open your favorite file browser and drag the file you just created to the SCK-2.0 drive. The kit will reset and run the new firmware.</p> <p></p> <p>Info</p> <p>Keep in mind that if your computer is not configured to automount new drives you will need to mount your sck manually (as any other USB drive).</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#esp8266-firmware","title":"ESP8266 firmware","text":"<p>Just like the other parts of the process this is also covered by our <code>make.py</code> script. So you can just do:</p> Build ESP <pre><code>&gt; python make.py build esp -v\n</code></pre> Flash ESP <pre><code>&gt; python make.py flash esp -v\n</code></pre> Both <pre><code>&gt; python make.py build flash esp -v\n</code></pre> <p>As before, if this is the first time you do it, it will take a while on downloading dependecies and building the firmware.</p> <p>In this case the upload process is different, since the ESP8266 chip is not connected to the USB interface the data must be uploadded through the SAMD21 chip. Our upload script takes care of searching for a SCK on the USB bus, sending a command to the kit so it put's himself in what we call bridge mode (white led) and uploading the firmware. This is the expected output:</p> <pre><code>&gt; python make.py build flash esp\n[0] Smartcitizen Kit S/N: 6E9FE7335150364852202020FF180E30\nBuilding ESP firmware... OK\nFlashing ESP firmware... OK\n</code></pre> <p>Warning</p> <p>Sometimes the ESP8266 and the uploader software don't get synced and the upload fails. Normally if you try again it will work. After first try you don't need to rebuild, you can just do <code>python make.py flash esp</code>.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#manual-update","title":"Manual update","text":"<p>You can perform a manual update if you only want or can have a small <code>python</code>installation. Another option is possible if you have <code>platformio</code> and you want to use <code>esptool</code> binaries.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#using-esptoolpy","title":"Using esptool.py","text":""},{"location":"Guides/firmware/Edit%20the%20Firmware/#preparation","title":"Preparation","text":"<ul> <li>Get <code>esptool.py</code>:</li> </ul> <pre><code>&gt; wget https://raw.githubusercontent.com/fablabbcn/smartcitizen-tools/master/esptool.py\n</code></pre> <ul> <li>Get the latest firmware from https://github.com/fablabbcn/smartcitizen-kit-21/releases or ask us at support</li> </ul>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#flashing","title":"Flashing","text":"<ul> <li> <p>Get your usb-port id (check here):</p> </li> <li> <p>Put the SAM in bridge mode (replace <code>&lt;PORT&gt;</code> with the portname from above).</p> </li> </ul> <pre><code>&gt; echo 'esp -flash 115200' &gt; &lt;PORT&gt;\n</code></pre> <p>echo not working?</p> <p>You can do the same in the Arduino IDE, using the <code>Serial Monitor</code> and writing <code>esp -flash 115200</code>. Remember to close the <code>Serial Monitor</code> window after it.</p> <p>Now you should see the SCK's LED in WHITE.</p> <ul> <li>Flash the esp using <code>esptool.py</code> from before. Make sure the <code>ESP_firmware.bin</code> is also there (replace <code>&lt;PORT&gt;</code>):</li> </ul> <pre><code>&gt; python esptool.py --port &lt;PORT&gt; --baud 115200 write_flash 0x000000 ESP_firmware.bin\n</code></pre>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#using-esptool-binaries","title":"Using esptool binaries","text":"<p>Locate esptool binaries:</p> <pre><code>&gt; cd smartcitizen-kit-21/sam\n&gt; pio run -t envdump | grep PROJECT_PACKAGES_DIR\n...\n</code></pre> <p>Find <code>PROJECT_PACKAGES_DIR</code> in the output and navigate to (replace <code>&lt;PROJECT_PACKAGES_DIR&gt;</code>):</p> <pre><code>&gt; cd &lt;PROJECT_PACKAGES_DIR&gt;/tool-esptool\n&gt; ls\n...\n</code></pre> <p>There you should find a binary file for <code>esptool</code>. Now you should be able to run (replace <code>&lt;PROJECT_PACKAGES_DIR&gt;</code> and <code>&lt;PORT&gt;</code>):</p> <pre><code>&gt; cd smartcitizen-kit-21\n&gt; echo 'esp -flash 115200' &gt; &lt;PORT&gt;\n&gt; &lt;PROJECT_PACKAGES_DIR&gt;/tool-esptool/esptool -cp &lt;PORT&gt; -cb 115200 -ca 0x000000 -cf bin/ESP_firmware.bin\n</code></pre> <p>Remember you can put the SAMD21 in bridge mode (white LED) by using Arduino IDE, sending <code>esp -flash 115200</code> using the <code>Serial Monitor</code> and then closing the <code>Serial Monitor</code> window.</p>"},{"location":"Guides/firmware/Edit%20the%20Firmware/#finding-the-port","title":"Finding the port","text":"<ul> <li> <p>For Windows, open the device manager and find the SCK in <code>Ports (COM &amp; LPT)</code>. Use that port (normally <code>COM...</code>).</p> </li> <li> <p>For macOS and linux, normally <code>/dev/*</code>:</p> </li> </ul> macOS <pre><code>&gt; ls /dev/* | grep usb\n</code></pre> linux <pre><code>&gt; ls /dev/* | grep tty\n</code></pre>"},{"location":"Guides/firmware/Update%20the%20firmware/","title":"Update the firmware","text":"<p>When new features are developed or bugs are fixed we will release new versions of the SCK firmware.</p>"},{"location":"Guides/firmware/Update%20the%20firmware/#make-a-back-up-of-your-info","title":"Make a back-up of your info","text":"<p>Info</p> <p>If you already configured your kit on the smartcitizen platform you will need the token that the platform gave you during the onboarding process, to recover it from your kit:</p> <ol> <li>Click your kit button until the kit is in setup mode, the led should be red.</li> <li> <p>Connect to the kit with your mobile device as you did during the onboarding process.</p> </li> <li> <p>Write down the token of your kit.</p> </li> </ol> <p></p> <p>After updating the firmware follow this same steps to input the token and wifi credentials, after this your kit will be publishing on the same registered device than before.</p> <p>A note about versions</p> <p> The guide below applies to both, SCK 2.0 and SCK2.1.</p>"},{"location":"Guides/firmware/Update%20the%20firmware/#updating-the-sam-firmware","title":"Updating the SAM firmware","text":"<p>The SAMD21 (SAM for short) chip manages the main part of the firmware. This firmware is frequently updated with latest improvements in the official firmware repository. Check the releases pages for more info.</p> <p>Updating your kit is very simple</p> <ul> <li> <p>Connect your kit with a micro USB cable to your computer</p> </li> <li> <p>Double click the reset button of your SCK, the SCK led should turn green and a new drive called SCK-20 should appear on your computer file browser</p> </li> </ul> <p></p> <ul> <li>Inside the SCK-20 drive you should see some files, double click the INDEX.HTM file and our  github releases page will open in your browser  Download the new firmware called SAM_firmware_XXX.uf2 and save it to your computer</li> </ul> <p></p> <p>Tip</p> <p>You can backup your current firmware version just saving the file called CURRENT.UF2.</p> <ul> <li>Simply drag the firmware file you downloaded over the SCK-20 drive, your kit led will blink in green and after some seconds it will reset and start with the new version.</li> </ul> <p></p> <p>Where is the reset?</p> <p>In other enclosures, the reset button is \"exposed\" outside of the enclosure:</p> <ul> <li>In a big station:</li> </ul> <p></p> <ul> <li>Or a small station (similar 3D printed versions will also have a small hole):</li> </ul> <p></p> <ul> <li>Or a water station:</li> </ul> <p></p>"},{"location":"Guides/firmware/Update%20the%20firmware/#updating-the-esp-firmware","title":"Updating the ESP firmware","text":"<p>The ESP8266 (ESP for short) chip sometimes also needs upgrade to match the latest version of the SAM firmware. The ESP chip manages all the communications of the SCK with the outer world. The firmware can be found here.</p> <p>Example</p> <ul> <li> <p>If your WiFi module needs a firmware update when you connect to your kit to setup the network you will see a screen that will ask for the new file. You can find it in our github releases page, look for the file called <code>ESP_firmware_XXX.bin</code>. If you don't see it, check in a previous release (some releases don't include Wi-Fi firmware)</p> </li> <li> <p>This file needs to be downloaded to the same device (phone or laptop) that is connecting to the SmartCitizen[...] network. If you are using your phone, you will need to download it there</p> </li> <li> <p>Once you have it, you can select the file in the screen below. If it doesn't appear, check the section to force ESP upload below</p> </li> </ul> <p> </p> <ul> <li>After the update you just did, you can configure your kit as a new device following the onboarding process or use your previous token as explained before</li> </ul>"},{"location":"Guides/firmware/Update%20the%20firmware/#force-esp-upload","title":"Force ESP upload","text":"<p>If you want to force the ESP to upload, please, follow the steps below.</p> <p>Force ESP upload</p> <p>If you already have the latest version but for some reason you still want to upload the firmware, you can force by clicking the info button (top right) on the setup screen that you find when conected to your kit in setup mode:</p> <p></p> <p>And activate the Force allow firmware update:</p> <p></p> <p>So you will be asked for the firmware file:</p> <p></p> <p>Doesn't work?</p> <p>Sometimes in the phone the firmware selection screen will not pop up. You can always try to do the developer-way with check this guide here</p>"},{"location":"Guides/firmware/Update%20the%20firmware/#using-command-line-tools","title":"Using command-line tools","text":"<p>The steps below are a summary of the steps you will need to update the firmware in case you are handling a lot of sensosr. The process builds on top the tools used in the edit the firmware, but simplified as we do not want to compile the firmware (since we are not changing it):</p> <ol> <li> <p>Install python as per the instructions here</p> </li> <li> <p>Install python requirements</p> </li> <li> <p>Install git following these instructions . Check that you need to install it first by simply typing <code>git</code> in your terminal. If the output is not <code>command not found</code>, skip to step 4</p> </li> <li> <p>In your terminal, navigate to a folder in which you want to download the firmware in. Then, get the firmware following the instructions here</p> </li> <li> <p>Navigate to the firmware folder, plug the sensor to your computer and run the command below.</p> <p>This will upload the SAM firmware: <pre><code>python make.py flash sam -v\n</code></pre></p> <p>This will also upload the ESP firmware: <pre><code>python make.py flash esp -v\n</code></pre></p> <p>You can upload both at the same time by: <pre><code>python make.py flash sam esp -v\n</code></pre></p> </li> </ol>"},{"location":"Guides/getting%20started/Dealing%20with%20sensitive%20sensor%20readings/","title":"Dealing with sensitive sensor readings","text":"<p>WIP</p>"},{"location":"Guides/getting%20started/Debugging%20your%20sensors/","title":"Debugging your sensors","text":"<p>This guide will try to summarize the basic steps to debug your kits whenever there's any problem. Let's be clear, there is no unique reason or point of failure for the kits to fail, and very likely, if you use them extensively, something will happen, either after 1 month, 1 year, or 5 years. It is key to know how to debug them:</p> <ol> <li>Reset the kit using the hardware reset button. This is either here:</li> </ol> <p></p> <p>or here:</p> <p></p> <p>or here (similar 3D printed versions will also have a small hole):</p> <p></p> <p>or here:</p> <p></p> <ol> <li> <p>If this doesn't solve the problem, you might want to connect to the kits using the Shell. </p> </li> <li> <p>The next steps would depend on what the actual problem of your kits is. The most common problems are:</p> <ul> <li>Sensor or hardware issues</li> <li>Connectivity or configuration issues</li> </ul> </li> </ol> <p>Basic steps</p> <ol> <li>Reset the kit</li> <li>Follow this guide</li> <li>Check the FAQs</li> <li>Check the forum</li> <li>Ask support with a nice explanation</li> </ol>"},{"location":"Guides/getting%20started/Debugging%20your%20sensors/#sensors-or-hardware-issues","title":"Sensors or hardware issues","text":"<p>As said above, there is no single point of failure for the kits.</p> <ol> <li>If the LED is working normally, but there is one or more sensosr that are not responding, connect the Shell and type:</li> </ol> <pre><code>version\n</code></pre> <p>Note this for later. If it's an old version of the firmware, it might help to directly upgrade.</p> <pre><code>sensor\n</code></pre> <p>This should show if all the sensors are being recognised. If one of them is missing from the list, you can try to check the <code>i2c</code> bus (where most of the sensors are connected):</p> <pre><code>i2c\n</code></pre> <p>If one of the sensors is not shown, it means that there is probably a hardware issue with the sensor itself and that the microcontroller is not recognising it. Now, it would be useful to look for corrosion signs around the sensors and maybe reflash the firmware in case there is a better detection of the sensors in a firmware update. Otherwise, it is likely that the hardware is no longer functioning and it needs replacement.</p> <ol> <li> <p>If the LED is static, very likely there is a problem with the detection or an electric problem with the sensors. For this, it is useful to start disconnecting each component to understand which component fails:</p> </li> <li> <p>Disconnect the power (USB and battery) and disconnect the PMS5003 sensor. Power on again and check</p> </li> <li>Disconnect the power (USB and battery) and disconnect the Urban Board. Power on again and check</li> </ol> <p>If this doesn't help, try to reflash the firmware, as there might be improvements. If it helps, also update and check if it improves. If the sensors heat up too much (it burns to touch), there might be an electric issue.</p>"},{"location":"Guides/getting%20started/Debugging%20your%20sensors/#connectivity-or-configuration-issues","title":"Connectivity or configuration issues","text":"<p>Normally, configuration or connectivity issues can be due to the following reasons: - Typo during the setup process - Old firmware</p> <ol> <li>If not using the Shell, make sure that the information provided for the network is correct by putting the SCK in SETUP mode (RED LED) and accessing the SmartCitizeXXXX network.</li> </ol> <p></p> <ol> <li>If using the Shell, you can check the recording configuration by typing:</li> </ol> <pre><code>config\n</code></pre> <p>If you see a problem with the configuration, you can fix each item or the whole thing by typing:</p> <pre><code>config -mode network -wifi \"SSID\" \"PASS\" -token token\n</code></pre> <p>Note that the <code>token</code> does not have quotes around it and that the <code>SSID</code> and <code>PASS</code> have straight quoutes.</p> <p>In case there is no problem with the configuration, there problem might get solved by a firmware update.</p>"},{"location":"Guides/getting%20started/Downloading%20the%20Data/","title":"Downloading the Data","text":"<p>Once you've added your SCK to the platform and it's capturing and sending data correctly, you can interact with the platform in several ways. Visualizing the data, downloading the data and interacting with the data through the API.</p>"},{"location":"Guides/getting%20started/Downloading%20the%20Data/#download-data","title":"Download Data","text":"<p>If you are interested in use the data captured by your sensors, you can download all the data for later use. To do this, go to your device page, at the bottom there is a button called DOWNLOAD DATA. You will receive an email with a link to download your data on CSV format in a minute or two.</p> <p></p> <p>And then:</p> <p></p>"},{"location":"Guides/getting%20started/Downloading%20the%20Data/#api","title":"API","text":"<p>The Smart Citizen API allows you to request back information from your devices and do incredible things with it.</p> <p>It is a REST API and it returns the information in JSON format. This means you can easily access the information from any language like Javascript, PHP, Processing.org, Python, and start doing things with it quickly.</p>"},{"location":"Guides/getting%20started/Downloading%20the%20Data/#using-scripts","title":"Using scripts","text":"<p>Python scripts are provided in the scdata python package repository for downloading devices data in a programatic way. Make sure to check the examples in the git repository.</p> <p>Code examples</p> <p>You can also find some examples on smartcitizen-toolkit respository</p>"},{"location":"Guides/getting%20started/Getting%20firmware%20information/","title":"Getting firmware information","text":"<p>There are two ways to get the firmware version:</p> <ol> <li>Using the shell</li> <li>Following the steps below:</li> </ol> <p>Getting firmware information</p> <ol> <li>Set your kit in setup mode by pressing the ON/OFF button </li> <li>Connect to the kit with your mobile device as you did during the installation process. You will need to search for a Wi-Fi network called <code>SmartCitizen[\u00b7\u00b7\u00b7]</code>. If you have multiple kits <code>[\u00b7\u00b7\u00b7]</code> is the unique identifier of your kit.</li> <li>Next, go to http://sck.me on your mobile device and click on the top right corner icon: </li> <li>Here you go! </li> </ol> <p>Obtain your firmware version remotely (advanced)</p> <p>If you are an advance user managing a big deployment of devices you can obtain remotely the version of all the Kits you have registered by looking at the <code>hardware_info</code> property of each of your devices using the platform API <code>/v0/devices/</code>. When your Kit is in Wi-Fi mode, it publishes the information daily.</p> <pre><code>\"hardware_info\": {\n    \"id\": \"DFD098A750515157382E3120FF101D12\",\n    \"mac\": \"B6:E6:2D:66:47:6D\",\n    \"time\": \"2020-04-14T03:00:24Z\",\n    \"esp_bd\": \"\",\n    \"hw_ver\": \"2.1\",\n    \"sam_bd\": \"2019-11-27T12:49:13Z\",\n    \"esp_ver\": \"\",\n    \"sam_ver\": \"0.9.6-4e90c77\"\n}\n</code></pre> <p>More info in the platform API documentation.</p>"},{"location":"Guides/getting%20started/Onboarding%20Sensors/","title":"Onboarding Sensors","text":"<p>The onboarding app guides you through the process of the setup using simple language and a friendly graphic language. It is built as a separate tool from the core Smart Citizen Webpage in order it can be customized for each deployment.</p> <p>Onboarding app</p> <p>Visit the onboarding app at start.smartcitizen.me. Before you start make sure you have:</p> <ul> <li>A computer to visit the onboarding app</li> <li>A smartphone (or tablet, or another computer) to connect to the kit and configure it</li> </ul> <p>The welcome page looks like this. For sensors different from the Smart Citizen Kit 2.1, please check the advanced kit selection:</p> <p></p> <p>You can then follow the steps by pressing on Let's go!. For experienced users, you can press Skip instructions and go to the Configuration page:</p> <p></p> <p>After this, make sure that the SCK is in Setup Mode (LED is red) and connect with your smartphone to the <code>SmartCitizen[...]</code> network.</p> <p></p> <p>In your phone, something like below should pop-up:</p> <p></p> <p>If nothing comes up</p> <p>In some cases, your phone will be disconected from the WiFi as it doesn't have access to the internet. Stay connected to it! If nothing pop-up in your phone, open your phone's web browser and navigate to sck.me</p> <p>After this, in case you want to configure your kit in Network mode, press Start. If you want to set it in Offline mode, press SD Card mode.</p> <p>If you go with Network mode, you should see the screen below. In your computer, you should click Next and see a 6 letter token to be input in your phone:</p> <p></p> <p>Depending on the mode selected (Wi-Fi or SD card), proceed with the steps and make sure the LED changes color: blue for Wi-Fi, purple for SD card. Once this is done, register your kit and add it to your user profile following the steps:</p> <p></p> <p>You can also mark it's location in the map (this doesn't need to be accurate, it's as accurate as you want it to be):</p> <p></p> <p>Location of the sensor</p> <p>The sensor location is only defined by the user in the registration process. It can be modified afterwards in the kit edit page. The Smart Citizen Kit does not retrieve location unless it has an onboard GPS. In this case, the GPS location never updates the location in the map.</p> <p>You can also add some tags to your sensor:</p> <p></p> <p>Finally, add the sensor to your user account (if you don't have one you can register now):</p> <p></p> <p>What is the email used for?</p> <p>The user account and email is only used for sensor data emails and sensor notifications (i.e. notification when the battery is almost empty). It is not used for commercial purposes at all, as stated in our policy</p> <p>You are done!</p> <p></p> <p>Visit the Kit on the platform. Wait one minute till it publishes data:</p> <p></p> <p>When the data is available, scroll down to make some basic explorations:</p> <p></p> <p>More on the data</p> <p>The platform allows you to check the data in a basic way, but if you want to have a deeper look you can:</p> <ul> <li>Download the data in CSV</li> <li>Get it from the API</li> <li>Use python to analyse it</li> </ul>"},{"location":"Guides/getting%20started/Onboarding%20Sensors/#advanced-kit-selection","title":"Advanced Kit Selection","text":"<p>The feature below is for users who want to know how to configure new or customized sensor devices:</p> <p>How to choose a custom kit</p> <ul> <li>Click the \ud83d\udee0\ufe0f icon in the bottom right corner</li> </ul> <p></p> <ul> <li>Choose the blueprint of the device you want to setup</li> </ul> <p></p> <ul> <li>Click save and continue the process as normal</li> </ul> <p></p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/","title":"Adding External Sensors","text":"<p>This page reflects examples on how to use and implement compatible third party sensors.</p> <p>What are third party sensors?</p> <p>By third party sensors, we mean sensors that have been developed by others, with no affiliation to the Smart Citizen Team.</p> <p>This page is a digest and updated version of the Making Sense D2.3 Smart Citizen Toolkit report and Making Sense D.24 Smart Citizen Toolkit report updates. Both these reports reflect information for the SCK 1.5, which is not a commercially available version of the kit. This guide is an update version for the SCK 2.1.</p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#use-of-already-supported-sensors","title":"Use of already supported sensors","text":"<p>The auxiliary port is designed to expand the sensor board by adding new sensors via the common I2C standard. However other protocols are supported, such as SPI or UART. The pins have the following default configuration:</p> PIN PORT Function 1 SCL I2C (by software: 1-WIRE or other) 2 SDA I2C (by software: 1-WIRE or other) 3 VCC Voltage 4 GND Ground <p>By connecting any of the supported sensors to the SCK, it will automatically be detected and data will be logged into the SD-card. You can check the output of the <code>sensor</code> command in the Serial output:</p> <pre><code>&gt; sensor\nEnabled\n----------\nTemperature (60 sec)\nHumidity (60 sec)\nExt Temperature (60 sec)\nExt Humidity (60 sec)\nBattery (60 sec)\nLight (60 sec)\nNoise dBA (60 sec)\nBarometric pressure (60 sec)\nPM 1.0 (60 sec)\nPM 2.5 (60 sec)\nPM 10.0 (60 sec)\n</code></pre>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#publishing-data-using-custom-devices","title":"Publishing data using custom devices","text":"<p>The Smart Citizen Platform supports data from any sensor that has a numerical digital output. The Smart Citizen API supports other devices to publish data to the platform by previously agreeing with the Smart Citizen terms and conditions.</p> <p>For each device type, a new device blueprint needs to be created. A device blueprint defines the sensors and the metrics that your devices will have. This will include the hardware details of your sensors and the kind of data that will be published to the platform. Custom calibration formulas to be applied to the data when processed in the platform can be also added.</p> <p>How to do it?</p> <p>Once a device blueprint is added to the platform, any user can create as many devices as needed and publish data to them following the standard Smart Citizen API. It is important to note that Device Blueprint currently cannot be created by users and should be requested by contacting support@smartcitizen.me.</p> <p>The minimal Device Blueprint includes all the necessary data that a user might provide in order to create a Kit. It is composed of Components and those can reuse existing Sensors and Measurements definitions. Sensors define the hardware or software component that records the data.  Measurements are descriptions of what sensors are recording. Blueprints can be shared across many devices or can be tailored per device in order to provide dedicated calibration formulas per individual sensor. This is achieved with the Components binding.</p> <p>The following example shows a basic Device Blueprint in JSON. This is the minimum of information that a blueprint needs:</p> <pre><code>{\n    \u201cname\u201d: \u201cThe Frog\u201d,\n    \u201cdescription\u201d: \u201cCustom Arduino Humidity Sensor\u201d,\n    \u201cslug\u201d: \u201cms:0,5\u201d,\n    \u201ccomponents\u201d: [{\n        \u201cmap\u201d: \u201chum\u201d,\n        \u201cequation\u201d: \u201c(125.0 / 65536.0 * x) + 7\u201d,\n        \u201csensor\u201d: {\n            \u201cname\u201d: \u201cHPP828E031\u201d,\n            \u201cdescription\u201d: \u201cHumidity\u201d,\n            \u201cunit\u201d: \u201c%\u201d,\n            \u201cmeasurement\u201d: {\n                \u201cname\u201d: \u201crelative humidity\u201d,\n                \u201cdescription\u201d: \u201cRelative humidity is a measure...\u201d\n            }\n        }\n    }]\n}\n</code></pre> <p>The following examples expand the previous Device Blueprint with the complete data model:</p> <pre><code>{\n    \u201cid\u201d: 10,\n    \u201cuuid\u201d: \u201c056e452d-41c4-436d-a640-2157a278037d\u201d,\n    \u201cslug\u201d: \u201cms:0,5\u201d,\n    \u201cname\u201d: \u201cThe Frog\u201d,\n    \u201cdescription\u201d: \u201cCustom Arduino Humidity Sensor\u201d,\n    \u201ccreated_at\u201d: \u201c2016-06-18T16:25:02Z\u201d,\n    \u201cupdated_at\u201d: \u201c2016-06-18T16:25:02Z\u201d,\n    \u201ccomponents\u201d: [{\n        \u201cid\u201d: 35,\n        \u201cuuid\u201d: \u201c22da9377-5151-4547-a71b-6fd8958e1330\u201d,\n        \u201cequation\u201d: \u201c(125.0 / 65536.0 * x) + 7\u201d,\n        \u201cmap\u201d: \u201chum\u201d,\n        \u201csensor\u201d: {\n            \u201cid\u201d: 13,\n            \u201cuuid\u201d: \u201c1c19ae8f-b995-460f-87a3-a9d0c140abfb\u201d,\n            \u201cparent_id\u201d: 19,\n            \u201cname\u201d: \u201cHPP828E031\u201d,\n            \u201cdescription\u201d: \u201cHumidity\u201d,\n            \u201cunit\u201d: \u201c%\u201d,\n            \u201ccreated_at\u201d: \u201c2015-02-02T18:24:30Z\u201d,\n            \u201cupdated_at\u201d: \u201c2015-07-05T19:54:54Z\u201d,\n            \u201cmeasurement\u201d: {\n                \u201cid\u201d: 2,\n                \u201cuuid\u201d: \u201c9cbbd396-5bd3-44be-adc0-7ffba778072d\u201d,\n                \u201cname\u201d: \u201crelative humidity\u201d,\n                \u201cdescription\u201d: \u201cRelative humidity is a measure of the amount of\n                moisture in the air relative to the total amount of moisture the    air    can    hold.  For instance,\n                if the relative humidity was 50%, then the air is only half         saturated   with  moisture.\u201d\n            }\n        }\n    }]\n}\n</code></pre> <p>Too much information?</p> <p>Drop an email to support@smartcitizen.me and we will try to help!</p> <p>Using SEEED Studio Grove bricks</p> <p>You can use off-the-shelf sensors from the extensive Grove open hardware sensor library, removing the need to build our own sensor add-ons from scratch. Foto seeed sensors </p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#implementing-other-sensors","title":"Implementing other sensors","text":"<p>This is a WIP</p> <p>This section is under heavy development. Thanks for your patience!</p> <p>Implementation of other sensors goes through the modification of the Firmware. This is an advanced user feature, and previous programming experience in C++ is necessary.</p> <p>The workflow we normally follow for this goes like:</p> <ol> <li> <p>Find out if there is an already existing library for the desired sensor. Good places to look at are Adafruit's repository, Sparkfun's repository or a global Github search</p> </li> <li> <p>Implement this library in the firmware. The library needs certain functions to be valid. (More info soon!)</p> </li> <li> <p>If the device needs to log the data on the platform, you can email us at support@smartcitizen.me with a request for a new device blueprint. However, it is easier to simply log the data in SD-card in this case, if the online recording is not fully mandatory.</p> </li> </ol> <p>Contribute it back to the community</p> <p>Make a pull request with your contribution back to the firmware so that other can use it!</p> <p>Additional sensors can be added to the Smart Citizen Kit as seen in the Supported Sensors page. The PM Board is one of the options, and a powerful auxiliary board that can connect to many things on the auxiliary bus of the Smart Citizen Kit. However, it's not the only way to attach sensors.</p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#example","title":"Example","text":"<p>The example below shows how to connect the PM board to different sensors:</p> <p></p> <p>Make sure that the Grove cables that will have the I2C connections are short (max 20-30cm). You can also use this grove hub and this grove to screw connector.</p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#configuration","title":"Configuration","text":"<p>To use a configuration with additional sensors (with or without PM Board), and in case you want to store the data on the platform, you will need to select the appropiate blueprint for it. When doing the onboarding process, make sure you select the proper blueprint in the advanced sensor selection. </p> <p>Important to know which sensor you have</p> <p>To distinguish the sensors you have plugged in onto your kit, make sure you know what sensor model they are. You can check these instructions to get around.</p> <p>Some examples are shown below:</p> <ul> <li>38 SCK 2.1 Soil and Air (SCK 2.1 - Soil Moisture, Soil Temperature and Air)</li> </ul> Sensor ID Name Units 10 Battery SCK (%) 10 Battery SCK (%) 55 SHT31 - Temperature (\u00baC) 56 SHT31 - Humidity (%) 58 MPL3115A2 - Barometric Pressure (kPa) 112 AMS CCS811 - eCO2 (ppm) 113 AMS CCS811 - TVOC (ppb) 14 BH1730FVC - Light (lux) 87 PMS5003 - PM2.5 (ug/m3) 88 PMS5003 - PM10 (ug/m3) 89 PMS5003 - PM1.0 (ug/m3) 53 ICS43432 - Noise (dBA) 51 AS EZO RTD (\u00baC) 50 Chirp Capacitive Soil Moisture (%) 96 DS18B20 (\u00b0C) 79 Ext SHT31 - Temperature (\u00b0C) 80 Ext SHT31 - Humidity (%) 45 AS EZO Electrical Conductivity (\u00b5S/cm) 43 AS EZO PH (-) <ul> <li>34 BioPV Kit 2.1 (SCK 2.1 - Urban Board + PM + Atlas + Soil Moisture + ADC ADS1115)</li> </ul> Sensor ID Name Units 10 Battery SCK (%) 14 BH1730FVC - Light (lux) 53 ICS43432 - Noise (dBA) 55 SHT31 - Temperature (\u00baC) 56 SHT31 - Humidity (%) 58 MPL3115A2 - Barometric Pressure (kPa) 87 PMS5003 - PM2.5 (ug/m3) 88 PMS5003 - PM10 (ug/m3) 89 PMS5003 - PM1.0 (ug/m3) 133 ADC_48_0 (V) 134 ADC_48_1 (V) 135 ADC_48_2 (V) 136 ADC_48_3 (V) 112 AMS CCS811 - eCO2 (ppm) 113 AMS CCS811 - TVOC (ppb) 50 Chirp Capacitive Soil Moisture (%) 51 AS EZO RTD (\u00baC) 43 AS EZO PH (-) 48 AS EZO Dissolved Oxygen (mg/L) <ul> <li>31 SCK 2.1 Sea Water (Smart Citizen Kit 2.1 with Sea Water Sensors)</li> </ul> Sensor ID Name Units 14 BH1730FVC - Light (lux) 53 ICS43432 - Noise (dBA) 55 SHT31 - Temperature (\u00baC) 56 SHT31 - Humidity (%) 58 MPL3115A2 - Barometric Pressure (kPa) 113 AMS CCS811 - TVOC (ppb) 10 Battery SCK (%) 112 AMS CCS811 - eCO2 (ppm) 51 AS EZO RTD (\u00baC) 45 AS EZO Electrical Conductivity (\u00b5S/cm) 122 AS EZO Total Dissolved Solids (ppm) 123 AS EZO Salinity (PSU(ppt)) 46 AS EZO  Specific Gravity (SG) 125 Latitude (deg.) 126 Longitude (deg.) 127 Altitude (meters) 128 Fix (fix code) 129 Horizontal Speed (m/s) 130 Satellite Number (number) 131 Horizontal Dilution ( ) 43 AS EZO PH (-) 48 AS EZO Dissolved Oxygen (mg/L) 49 AS EZO Oxygen Saturation (%) 42 DS18B20 (\u00b0C)"},{"location":"Guides/getting%20started/Third%20party%20sensors/#understanding-sensor-names","title":"Understanding sensor names","text":"<p>Using additional sensors, can be at times confusing, because we might end up in the same kit with several sensors that measure exactly the same metric (for instance, 5 different temperature sensors!). To be able to differentiate between them, use the actual model of the hardware. An example is shown below for different temperature sensors in the same device:</p> <ul> <li>This is an air temperature sensor (a Sensirion SHT31), which you can find in the Urban Board 2.1:</li> </ul> <p></p> <ul> <li>This is an external air temperature sensor (also a Sensirion SHT31), which is an external probe. You can differentiate it because is an external sensor:</li> </ul> <p></p> <ul> <li>This is an external temperature sensor (this time a MAXIM DS18B20), which is an external probe, and waterproof - not only meant for air measurements (but also water or soil):</li> </ul> <p></p> <ul> <li>This is also external temperature sensor (this time a Atlas EZO RTD - a PT1000 probe), which is an external probe, and waterproof - not only meant for air measurements (but also water or soil):</li> </ul> <p></p> <p>No graph?</p> <p>This time you didn't see a graph because there was no data being sent to that metric in the kit. Normally, this is not the normal behaviour, but sometimes, if you are using blueprints for more advanced configurations, you will see that not all the sensors possible are actually in the hardware!</p>"},{"location":"Guides/getting%20started/Third%20party%20sensors/#sensors-with-open-leads","title":"Sensors with open leads","text":"<p>If you are using sensors with open leads (not terminated cables), you can use this grove to screw connector. However, you need to know how to connect the cables to it:</p> <p>Examples</p> <p>If you are using a Catnip Chirp Soil Moisture sensor:</p> <p></p> <p>Or if you are using a DF-Robot Weather proof temperature sensor:</p> <p></p>"},{"location":"Guides/getting%20started/Updating%20the%20Wi-Fi/","title":"Updating the Wi-Fi","text":"<p>Info</p> <p>This guide will help you update your sensor Wi-Fi settings as well as other parameters, such as the device token</p> <p>Warning</p> <p> The kit supports Wi-Fi WEP, WPA/WPA2 and open networks that are common networks in domestic environments and small businesses.</p> <p> But, it does not support WPA/WPA2 Enterprise networks such as EDUROAM or networks with captive portals such as those found in Airports and Hotels</p> <ul> <li>Click your kit button until the kit is in setup mode, the LED should be red.  </li> </ul> <p></p> <ul> <li> <p>Connect to the kit with your mobile device as you did during the installation process. You will need to search for a Wi-Fi network called <code>SmartCitizen[\u00b7\u00b7\u00b7]</code>. If you have multiple kits <code>[\u00b7\u00b7\u00b7]</code> is the unique identifier of your kit.</p> </li> <li> <p>Once connected you should see the Setup App in your phone. If it doesn't show up automatically you can open http://192.168.1.1 on your phone browser. </p> </li> </ul> <p>Info</p> <p>The process also works on laptops, desktops and tablets, connected than can connect to the <code>SmartCitizen[\u00b7\u00b7\u00b7]</code> network.</p> <ul> <li>On the app choose start to move to the next page.</li> </ul> <p></p> <ul> <li>You will see your device key or token. Do not change it and choose next.</li> </ul> <p></p> <ul> <li>Set your new Wi-Fi settings on the next screen as you did during the installation process.</li> </ul> <p></p> <ul> <li>The LED will go blue and your kit should start to publish again using the new Wi-Fi. You can confirm it by visiting your device on smartcitizen.me/kits. You can repeat the process as many times as you want by going back to step 1.</li> </ul> <p>Info</p> <p>If your Kit is not publishing check the LED status chart to know more about it.</p>"},{"location":"Guides/getting%20started/Uploading%20SD%20Card%20Data/","title":"Uploading SD Card Data","text":"<p>Here some instructions on how to upload CSV files to Smartcitizen platform. First be sure to be logged and go to your profile.</p> <p>Weird files?</p> <p>Check what they mean here</p> <p>Step by step</p> <p>On your kits' list, click on the wheel and then on \"Upload CSV\".</p> <p></p> <p>Once on the upload page, you can add some files by clicking on the \"Load CSV files\" button.</p> <p></p> <p>Select some files as much as you like, to be them ready to upload. Then on the drop-down menu select the \"Upload\" option</p> <p></p> <p>Click on the \"Apply\" button to upload them</p> <p></p> <p>Congrats! You just uploaded your files CSV files on the Smartcitizen platform.</p> <p></p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/","title":"Using the Shell","text":"<p>The SCK (from V2.0 onwards) has an integrated command shell over USB to manage all the kits functionalities for advanced users. In this guide, we will cover how to access to this functionality in different platforms, and some examples.</p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#what-is-it","title":"What is it?","text":"<p>We could define the <code>shell</code> as a text-based interface to access almost any SCK functionality. In terms of hardware, it relies on the serial communication between the SCK and your computer, so any decent USB cable connected between them will do.</p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#how-to-access-it","title":"How to access it?","text":"<p>Software-wise, different platforms will have different interfaces. The easiest and most reliable for all of them would be through the Arduino IDE.</p> <p>Using the Arduino IDE</p> <ul> <li>Launch the Arduino IDE and select the port under <code>Tools &gt; Port &gt;</code>:</li> </ul> <p></p> <ul> <li> <p>Launch the <code>Serial Monitor</code> under <code>Tools &gt; Serial Monitor</code>. Make sure that the dropdowns in the bottom are set as in the image below (<code>Carriage return</code> and <code>115200 baud</code>)</p> </li> <li> <p>Type in <code>help</code> to get started.</p> </li> </ul> <p></p> <p>More advanced users would probably rather use a more rugged interface. In this case, you could use <code>screen</code> in your terminal of choice:</p> <pre><code>&gt; ls /dev/cu | grep usb\ncu.usbmodem1411\ntty.usbmodem1411\n&gt; screen /dev/cu.usmodem1411\nSCK &gt;\n...\n</code></pre> <p>If you already installed platformio to edit the firmware you can use it here, too</p> <pre><code>&gt; pio device monitor\nSCK &gt;\n...\n</code></pre> <p>Be patient!</p> <p>The port will take a little time to appear in your list of devices. Normally the LED of your SCK will be static white during that period.</p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#some-examples","title":"Some examples!","text":"<p>The <code>help</code> command outputs a quite intuitive explanation of all the commands:</p> <pre><code>SCK &gt; help\nreset:       Resets the SCK\nversion:     Shows versions and Hardware ID\nrcause:      Show last reset cause (debug)\noutlevel:    Shows/sets output level: outlevel [0:silent, 1:normal, 2:verbose]\nhelp:        Duhhhh!!\npinmux:      Shows SAMD pin mapping status\nflash:       Shows and manage flash memory state [no-param -&gt; info] [-format (be carefull)] [-dump sect-num (0-2040)] [-sector sect-num] [-recover sect-num/all net/sd]\nsensor:      Shows/sets sensor state or interval: sensor sensor-name [-enable or -disable] [-interval interval(seconds)] [-oled]\nread:        Reads sensor: read [sensorName]\ncontrol:     Control sensor: control [sensorName] [command]\nmonitor:     Continously read sensor: monitor [-sd] [-notime] [-noms] [-oled] [sensorName[,sensorNameN]]\nfree:        Shows the amount of free RAM memory\ni2c:         Search the I2C bus for devices\npower:       Controls/shows power config: power [-info (extra info)] [-batcap mAh] [-otg on/off] [-charge on/off] [-sleep min (0-disable)]\nconfig:      Shows/sets configuration: config [-defaults] [-mode sdcard/network] [-pubint seconds] [-readint seconds] [-wifi \"ssid\" [\"pass\"]] [-token token]\nesp:         Controls or shows info from ESP: esp [-on -off -sleep -wake -reboot -flash]\nnetinfo:     Shows network information\ntime:        Shows/sets date and time: time [epoch time] [-sync]\nhello:       Sends MQTT hello to platform\ndebug:       Toggle debug messages: debug [-sdcard] [-esp] [-oled] [-flash] [-telnet] [-speed]\nshell:       Shows or sets shell mode: shell [-on] [-off]\npublish:     Publish custom mqtt message: mqtt [\"topic\" \"message\"]\noffline:     Configure offline periods and WiFi retry interval: [-retryint seconds] [-period start-hour end-hour (UTC 0-23)]\nmqttsrv:     Configure mqtt server address and port: [-host serverName] [-port portNum]\nntpsrv:      Configure ntp server address and port: [-host serverName] [-port portNum]\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#shell-mode","title":"Shell Mode","text":"<p>The SCK outputs  a lot of information via serial. This can be sometimes confusing while typing commands. You can silent it a bit with this command:</p> <pre><code>SCK &gt; shell -on\nShell mode: on\n</code></pre> <p>This will turn your LED static yellow, and no output except responses to your commands will be given. </p> <p>Remember to turn it off after you are done experimenting!</p> <pre><code>SCK &gt; shell -off\nShell mode: off\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#set-the-recording-configuration","title":"Set the recording configuration","text":"<p>If you want to change your recording mode to, for instance, <code>sdcard</code> mode, you could do so by typing:</p> <pre><code>SCK &gt; config -mode sdcard\n</code></pre> <p>To set it up in <code>network</code> mode:</p> <pre><code>SCK &gt; config -mode network -wifi \"SSID\" \"PASSWORD\" -token 123456\n</code></pre> <p>Warning</p> <p>Note that the token is not between quotes since it's always 6 digits</p> <p>To modify your wifi:</p> <pre><code>SCK &gt; config -wifi \"NEWSSID\" \"NEWPASSWORD\"\n</code></pre> <p>You can check your current configuration by typing <code>config</code>:</p> <pre><code>SCK &gt; config\nMode: sdcard\nPublish interval: 60\nReading interval: 60\nWifi credentials: not configured\nToken: not configured\nMac address:  11:22:33:44:55:66\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#set-recording-and-publication-intervals","title":"Set recording and publication intervals","text":"<p>In order to understand the reading and publication intervals, it is important to describe how the structure of the measurements is done:</p> <ol> <li>Overall reading interval: base period for the SCK to take a measurement</li> <li>Individual sensor reading interval: period for each sensor to take a measurement. It is defined as N times the Overall reading interval</li> <li>Publication interval: time for the SCK to publish to the Smart Citizen Platform, independent of the reading interval.</li> </ol> <p>Each of the sensors can be configured independently, with a reading interval N times the overall reading interval. For instance, after the <code>SAM firmware V0.9.7</code>, all the sensors are read every 60s except the PMS5003, which is read every 5 minutes or 5 times the reading interval. </p> <p>In the case of the publication interval to the Smart Citizen Platform, the  default is 3 minutes.</p> <p>Battery calculator</p> <p>This configuration option is very interesting to be used for battery saving. Make sure you check the battery calculator</p> <p>All this can be configured using the shell interface. For instance, to set the publication interval to every 10 minutes, we could do:</p> <pre><code>config -pubint 600\n</code></pre> <p>Or to set the reading interval to every 3 minutes:</p> <pre><code>config -readint 180\n</code></pre> <p>Or both at 10 minutes:</p> <pre><code>config -pubint 600 -readint 600\n</code></pre> <p>If we want to configure one specific sensor, we can do so by typing the following, only remember, that it's rounded to the closest integer multiplier of the overall reading interval:</p> <pre><code>SCK &gt; sensor temp -interval 360\nThe sensor read interval is calculated as a multiple of general read interval (180)\nChanging interval of Temperature to 360\nSaved configuration on eeprom!!\n</code></pre> <p>For instance, if we try to do 1.5 times the reading interval of the temperature sensor, we will get:</p> <pre><code>SCK &gt; sensor temp -interval 240 \nThe sensor read interval is calculated as a multiple of general read interval (180)\nChanging interval of Temperature to 180\nSaved configuration on eeprom!!\n</code></pre> <p>Some limitations apply though:</p> <ol> <li>The minimum reading and publish interval is 5s</li> <li>The maximum reading interval is one hour</li> <li>The maximum publish interval is one hour</li> </ol> <p>For more customisation, please email or post on the forum.</p> <p>Default configuration</p> <p>At the moment there is no command to return to the default configuration. You should use: <pre><code>config -pubint 300 -readint 60\n...\nsensor pm -interval 300\n</code></pre></p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#get-version-data","title":"Get version data","text":"<p>Check your hardware and firmware version data with the command <code>version</code>:</p> <pre><code>SCK &gt; version\nHardware Version: 2.1\nSAM Hardware ID: 5934C4B550515157382E3120FF151210\nSAM version: 0.9.1-30e1776\nSAM build date: 2019-05-07T02:45:29Z\nESP MAC address: 86:0D:8E:A7:7F:CC\nESP version: not synced\nESP build date: not synced\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#listmodify-the-active-sensors","title":"List/modify the active sensors","text":"<p>By typing in <code>sensor</code>, a list of enabled and supported sensors is displayed:</p> <pre><code>SCK &gt; sensor\n\nDisabled\n----------\nPM board Dallas Temperature\n[...]\n\nEnabled\n----------\nTemperature (60 sec)\nHumidity (60 sec)\nBattery (60 sec)\nLight (60 sec)\nNoise dBA (60 sec)\nBarometric pressure (60 sec)\nVOC Gas CCS811 (60 sec)\neCO2 Gas CCS811 (60 sec)\nPM 1.0 (60 sec)\nPM 2.5 (60 sec)\nPM 10.0 (60 sec)\n</code></pre> <p>To disable one sensor, you can type in part of the sensor name:</p> <pre><code>SCK &gt; sensor Noise -disable\nDisabling Noise dBA\nSaved configuration on eeprom!!\n</code></pre> <p>To enable it, if it's present:</p> <pre><code>SCK &gt; sensor Noise -enable\nEnabling Noise dBA\nSaved configuration on eeprom!!\n</code></pre> <p>Only if available!</p> <p>If the sensor you are trying to connect is not recognised, the kit will complain:</p> <pre><code>SCK &gt; sensor atlas -enable\nFailed enabling Atlas Temperature\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#readmonitor-some-sensors","title":"Read/Monitor some sensors","text":"<p>If one sensor is enabled, you can <code>read</code> it (once) or <code>monitor</code> it (as fast as the SCK can):</p> <pre><code>SCK &gt; read Noise\nNoise dBA: 53.85 dBA\n</code></pre> <p>To monitor one sensor:</p> <pre><code>SCK &gt; monitor light\nTime    Miliseconds     Light\n2019-07-10T17:58:07Z    6       137\n2019-07-10T17:58:07Z    98      137\n2019-07-10T17:58:07Z    98      136\n2019-07-10T17:58:07Z    98      137\n2019-07-10T17:58:07Z    108     137\n2019-07-10T17:58:07Z    98      137\n2019-07-10T17:58:07Z    98      137\n2019-07-10T17:58:07Z    108     137\n2019-07-10T17:58:07Z    98      137\n2019-07-10T17:58:08Z    98      137\n2019-07-10T17:58:08Z    108     137\n2019-07-10T17:58:08Z    98      136\n...\n</code></pre> <p>Or all of them, with no arguments:</p> <pre><code>SCK &gt; monitor\nTime    Miliseconds     Battery Light   Temperature     Humidity        Noise dBA       Barometric pressure     VOC Gas CCS811  eCO2 Gas CCS811 PM 1.0  PM 2.5  PM 10.0\n2019-07-11T09:13:04Z    5       37      137     28.75   57.72   1.5    101.29  1.00    408.00  1.5    1.5    1.5\n2019-07-11T09:13:07Z    3195    37      138     28.78   57.65   1.5    101.30  1.00    408.00  1.5    1.5    1.5\n2019-07-11T09:13:08Z    694     37      136     28.77   57.62   1.5    101.29  1.00    408.00  1.5    1.5    1.5\n</code></pre> <p>If you don't need to output the <code>miliseconds</code> column (the time since last reading) or the <code>timestamp</code>, you can do so by:</p> <pre><code>SCK &gt; monitor -noms light\nTime    Light\n2019-07-10T17:58:58Z    136\n2019-07-10T17:58:58Z    136\n2019-07-10T17:58:58Z    137\n2019-07-10T17:58:58Z    137\n2019-07-10T17:58:59Z    136\n...\n</code></pre> <pre><code>SCK &gt; monitor -notime light\nMiliseconds     Light\n6       137\n98      137\n98      137\n99      137\n108     137\n...\n</code></pre> <p>Warning</p> <p>If your kit has no time configured (the LED should be flashing), the output would look like:</p> <pre><code>SCK &gt; monitor Noise\nTime    Miliseconds     Noise dBA\n0       1       52.83\n0       187     50.36\n0       187     52.05\n0       187     51.95\n0       187     48.28\n0       187     48.72\n0       187     50.81\n...\n</code></pre> <p>Something cool to do with the <code>monitor</code>, is to log the sensor output into a file for later analysis. For instance, in your terminal you could do:</p> <pre><code>&gt; echo \"monitor pm light\" &gt; /dev/cu.usbmodem1411 &amp;&amp; screen -L /dev/cu.usbmodem1411\n</code></pre> <p>Then, if we check the contents of the file (normally something like <code>screenlog.X</code>:</p> <pre><code>monitor light\nTime    Miliseconds     Light\n2019-07-11T09:10:05Z    6       141\n2019-07-11T09:10:05Z    98      141\n2019-07-11T09:10:05Z    99      141\n2019-07-11T09:10:05Z    98      141\n2019-07-11T09:10:05Z    108     141\n2019-07-11T09:10:05Z    98      141\n2019-07-11T09:10:05Z    98      141\n2019-07-11T09:10:05Z    98      141\n2019-07-11T09:10:06Z    98      141\n2019-07-11T09:10:06Z    98      141\n2019-07-11T09:10:06Z    108     141\n2019-07-11T09:10:06Z    98      141\n2019-07-11T09:10:06Z    98      141\n...\n</code></pre> <p>This can be useful in case you want to log data as fast as possible, with little delay between readings (~100ms).</p>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#changing-mqtt-or-ntp-servers","title":"Changing mqtt or ntp servers","text":"<p>If you want to send data to your own server, or there is a firewall in your network, you can use these two commands to change them:</p> <pre><code>mqttsrv:     Configure mqtt server address and port: [-host serverName] [-port portNum]\nntpsrv:      Configure ntp server address and port: [-host serverName] [-port portNum]\n</code></pre> <p>Check the <code>mqttsrv</code>:</p> <pre><code>SCK &gt; mqttsrv\nMqtt Host: mqtt.smartcitizen.me\nMqtt Port: 1883\n</code></pre> <p>Check the <code>ntpsrv</code>:</p> <pre><code>SCK &gt; ntpsrv\nNTP Host: ntp.smartcitizen.me\nNTP Port: 80\n</code></pre> <p>Change mqttsrv <code>host</code> and <code>port</code>:</p> <pre><code>SCK &gt; mqttsrv -host mqtt.greatcity.me -port 80\nMqtt Host: mqtt.greatcity.me\nMqtt Port: 80\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#accessing-the-flash-memory","title":"Accessing the flash memory","text":"<p>This is an advanced feature and helps to explore the data stored in the onboard flash memory for debugging purposes.</p> <p>Get a complete map of used sectors in the flash memory:</p> <pre><code>SCK &gt; flash\nScanning Flash memory (it can take a while!)\n\n0 &gt; |u38(_/_)|u36(_/_)|u34(_/_)|u35(_/_)|u35(_/_)|u34(_/_)|u34(_/_)|u35(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|\n32 &gt; |u37(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u36(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u37(_/_)|u36(_/_)|\n...\n</code></pre> <p>Format the flash (will take a long time):</p> <pre><code>flash -format\n</code></pre> <p>Check a sector (see what's inside):</p> <pre><code>SCK &gt; flash -sector 300\n\nSector 300 in address 1228800 is: Used\nSector 300 fully published to network: true\nSector 300 fully published to sd-card: true\nNet published groups: 37\nNet un-published groups: 0\nSd saved groups: 37\nSd not saved groups: 0\nTotal groups: 37\nFreespace: 53 bytes\nFirst group: 2021-07-08T09:04:19Z\nLast group:  2021-07-12T07:34:49Z\n</code></pre> <p>Recover a sector (send it to the platform or save in sdcard, or both - see <code>help</code> command):</p> <pre><code>flash -recover all net\n</code></pre>"},{"location":"Guides/getting%20started/Using%20the%20Shell/#advanced-but-cool-example","title":"Advanced (but cool) example!","text":"<p>Making most of the digital microphone</p> <ul> <li> <p>The digital microphone in your SCK uses an FFT algorithm to calculate the final sound pressure level (SPL) in different scales (A, C, Z). The FFT spectrum is also available for user analysis. Let's have a look!</p> </li> <li> <p>First, enable it with:</p> </li> </ul> <pre><code>SCK &gt; sensor fft -enable\nEnabling Noise FFT\n</code></pre> <ul> <li>Then, monitor and log it in a file with:</li> </ul> <pre><code>echo \"monitor fft\" &gt; /dev/cu.usbmodem1411 &amp;&amp; screen -L /dev/cu.usbmodem1411\n</code></pre> <ul> <li>In this file, we will have something like:</li> </ul> <pre><code>12\n15\n19\n20\n0\n...\n12\n23\n2019-07-11T09:30:01Z    5   null\n...\n</code></pre> <ul> <li> <p>The values between the dates are the actual FFT spectrum. We will now clean the lines with the dates and then plot the data. For this, we will use a <code>python</code> code to make things easier. You can download the code here.</p> </li> <li> <p>If we run this code in <code>python3</code> in the same folder where the screenlog from before is:</p> </li> </ul> <pre><code>&gt; python spectrum_example.py\n</code></pre> <p>We will have two outputs: a <code>csv</code> file with the spectrums in rows, and a png image that looks like this!</p> <p></p> <p>You can see that we were playing with a tone generator to make some high pitch noises at 10kHz and 20kHz. </p>"},{"location":"Guides/getting%20started/_Third%20party%20sensors/","title":"Third party sensors","text":"<p>This page reflects examples on how to use and implement compatible third party sensors.</p> <p>What are third party sensors?</p> <p>By third party sensors, we mean sensors that have been developed by others, with no affiliation to the Smart Citizen Team.</p> <p>This page is a digest and updated version of the Making Sense D2.3 Smart Citizen Toolkit report and Making Sense D.24 Smart Citizen Toolkit report updates. Both these reports reflect information for the SCK 1.5, which is not a commercially available version of the kit. This guide is an update version for the SCK 2.1.</p>"},{"location":"Guides/getting%20started/_Third%20party%20sensors/#use-of-already-supported-sensors","title":"Use of already supported sensors","text":"<p>The auxiliary port is designed to expand the sensor board by adding new sensors via the common I2C standard. However other protocols are supported, such as SPI or UART. The pins have the following default configuration:</p> PIN PORT Function 1 SCL I2C (by software: 1-WIRE or other) 2 SDA I2C (by software: 1-WIRE or other) 3 VCC Voltage 4 GND Ground <p>By connecting any of the supported sensors to the SCK, it will automatically be detected and data will be logged into the SD-card. You can check the output of the <code>sensor</code> command in the Serial output:</p> <pre><code>&gt; sensor\nEnabled\n----------\nTemperature (60 sec)\nHumidity (60 sec)\nExt Temperature (60 sec)\nExt Humidity (60 sec)\nBattery (60 sec)\nLight (60 sec)\nNoise dBA (60 sec)\nBarometric pressure (60 sec)\nPM 1.0 (60 sec)\nPM 2.5 (60 sec)\nPM 10.0 (60 sec)\n</code></pre>"},{"location":"Guides/getting%20started/_Third%20party%20sensors/#publishing-data-using-custom-devices","title":"Publishing data using custom devices","text":"<p>The Smart Citizen Platform supports data from any sensor that has a numerical digital output. The Smart Citizen API supports other devices to publish data to the platform by previously agreeing with the Smart Citizen terms and conditions.</p> <p>For each device type, a new device blueprint needs to be created. A device blueprint defines the sensors and the metrics that your devices will have. This will include the hardware details of your sensors and the kind of data that will be published to the platform. Custom calibration formulas to be applied to the data when processed in the platform can be also added.</p> <p>How to do it?</p> <p>Once a device blueprint is added to the platform, any user can create as many devices as needed and publish data to them following the standard Smart Citizen API. It is important to note that Device Blueprint currently cannot be created by users and should be requested by contacting support@smartcitizen.me.</p> <p>The minimal Device Blueprint includes all the necessary data that a user might provide in order to create a Kit. It is composed of Components and those can reuse existing Sensors and Measurements definitions. Sensors define the hardware or software component that records the data.  Measurements are descriptions of what sensors are recording. Blueprints can be shared across many devices or can be tailored per device in order to provide dedicated calibration formulas per individual sensor. This is achieved with the Components binding.</p> <p>The following example shows a basic Device Blueprint in JSON. This is the minimum of information that a blueprint needs:</p> <pre><code>{\n    \u201cname\u201d: \u201cThe Frog\u201d,\n    \u201cdescription\u201d: \u201cCustom Arduino Humidity Sensor\u201d,\n    \u201cslug\u201d: \u201cms:0,5\u201d,\n    \u201ccomponents\u201d: [{\n        \u201cmap\u201d: \u201chum\u201d,\n        \u201cequation\u201d: \u201c(125.0 / 65536.0 * x) + 7\u201d,\n        \u201csensor\u201d: {\n            \u201cname\u201d: \u201cHPP828E031\u201d,\n            \u201cdescription\u201d: \u201cHumidity\u201d,\n            \u201cunit\u201d: \u201c%\u201d,\n            \u201cmeasurement\u201d: {\n                \u201cname\u201d: \u201crelative humidity\u201d,\n                \u201cdescription\u201d: \u201cRelative humidity is a measure...\u201d\n            }\n        }\n    }]\n}\n</code></pre> <p>The following examples expand the previous Device Blueprint with the complete data model:</p> <pre><code>{\n    \u201cid\u201d: 10,\n    \u201cuuid\u201d: \u201c056e452d-41c4-436d-a640-2157a278037d\u201d,\n    \u201cslug\u201d: \u201cms:0,5\u201d,\n    \u201cname\u201d: \u201cThe Frog\u201d,\n    \u201cdescription\u201d: \u201cCustom Arduino Humidity Sensor\u201d,\n    \u201ccreated_at\u201d: \u201c2016-06-18T16:25:02Z\u201d,\n    \u201cupdated_at\u201d: \u201c2016-06-18T16:25:02Z\u201d,\n    \u201ccomponents\u201d: [{\n        \u201cid\u201d: 35,\n        \u201cuuid\u201d: \u201c22da9377-5151-4547-a71b-6fd8958e1330\u201d,\n        \u201cequation\u201d: \u201c(125.0 / 65536.0 * x) + 7\u201d,\n        \u201cmap\u201d: \u201chum\u201d,\n        \u201csensor\u201d: {\n            \u201cid\u201d: 13,\n            \u201cuuid\u201d: \u201c1c19ae8f-b995-460f-87a3-a9d0c140abfb\u201d,\n            \u201cparent_id\u201d: 19,\n            \u201cname\u201d: \u201cHPP828E031\u201d,\n            \u201cdescription\u201d: \u201cHumidity\u201d,\n            \u201cunit\u201d: \u201c%\u201d,\n            \u201ccreated_at\u201d: \u201c2015-02-02T18:24:30Z\u201d,\n            \u201cupdated_at\u201d: \u201c2015-07-05T19:54:54Z\u201d,\n            \u201cmeasurement\u201d: {\n                \u201cid\u201d: 2,\n                \u201cuuid\u201d: \u201c9cbbd396-5bd3-44be-adc0-7ffba778072d\u201d,\n                \u201cname\u201d: \u201crelative humidity\u201d,\n                \u201cdescription\u201d: \u201cRelative humidity is a measure of the amount of\n                moisture in the air relative to the total amount of moisture the    air    can    hold.  For instance,\n                if the relative humidity was 50%, then the air is only half         saturated   with  moisture.\u201d\n            }\n        }\n    }]\n}\n</code></pre> <p>Too much information?</p> <p>Drop an email to support@smartcitizen.me and we will try to help!</p> <p>Using SEEED Studio Grove bricks</p> <p>You can use off-the-shelf sensors from the extensive Grove open hardware sensor library, removing the need to build our own sensor add-ons from scratch. Foto seeed sensors </p>"},{"location":"Guides/getting%20started/_Third%20party%20sensors/#implementing-other-sensors","title":"Implementing other sensors","text":"<p>This is a WIP</p> <p>This section is under heavy development. Thanks for your patience!</p> <p>Implementation of other sensors goes through the modification of the Firmware. This is an advanced user feature, and previous programming experience in C++ is necessary.</p> <p>The workflow we normally follow for this goes like:</p> <ol> <li> <p>Find out if there is an already existing library for the desired sensor. Good places to look at are Adafruit's repository, Sparkfun's repository or a global Github search</p> </li> <li> <p>Implement this library in the firmware. The library needs certain functions to be valid. (More info soon!)</p> </li> <li> <p>If the device needs to log the data on the platform, you can email us at support@smartcitizen.me with a request for a new device blueprint. However, it is easier to simply log the data in SD-card in this case, if the online recording is not fully mandatory.</p> </li> </ol> <p>Contribute it back to the community</p> <p>Make a pull request with your contribution back to the firmware so that other can use it!</p>"},{"location":"Guides/replacements/Replacing%20PM%20Sensors/","title":"Replacing the PM Sensors","text":"<p>Follow these steps to replace the PM Sensors. This guide assumes you have HDPE enclosure.</p> <p>Step-by-step</p> <ul> <li>Open the enclosure</li> </ul> <p></p> <ul> <li>Remove power from the sensors (both, USB and battery)</li> </ul> <p></p> <p></p> <ul> <li>Extract the SCK and PM sensors by removing the screws</li> </ul> <p></p> <p></p> <ul> <li>Disconnect the 6-way cable from the PM sensor</li> </ul> <p></p> <p></p> <ul> <li>Extract the PM sensor and replace it with the new one</li> </ul> <p></p> <p></p> <ul> <li>Connect back the 6-way cable and put the sticker from the previous sensor on the PM sensor (this ID is related to the Data Board)</li> </ul> <p></p> <p></p> <ul> <li>Put everything back together. No need to update anything else in the SCK. You are good to go!</li> </ul>"},{"location":"Resources/","title":"Resources","text":"<p>The Smart Citizen project has had the chance to be part of fantastic projects throughout it's brief history. Ranging from public interventions in urban areas to the development of DIY sensors for agriculture, the team has carried out an enormous efforts to develop a technical platform that supports a wide range of communities on the creation of participatory sensing initiatives.</p> <p></p> <p>This section is a summary of these projects that might inspire you in future actions. They show the vast amount of possibilities offered by the Smart Citizen tools as key enablers of participatory sensing pilots and experiments.</p> <p></p> <p>By providing meaningful examples of novel appropriations and uses we seek to  inspire communities to conduct their own experiments and, hopefully, even their  own custom tools.</p> <p>Check our guides</p> <p>All these projects left us with a great amount of experience and knowledge that we have compiled in this documentation. Find out how to use them in our guides section:</p> <ul> <li>Create interfaces for your data</li> <li>Use of third party sensors and adding data from other platforms</li> </ul>"},{"location":"Resources/#education","title":"Education","text":"<ul> <li>DOIT Toolkit - Measuring our environment (EN)- Future Learning Unit at Fablab Barcelona</li> <li>DOIT Toolkit - Midiendo nuestro entorno (ES)- Future Learning Unit at Fablab Barcelona</li> <li>AULAMAR - T\u00e9cnicas de Muestreo de agua (ES)</li> </ul>"},{"location":"Resources/#external-links","title":"External links","text":"<p>This is a compilation of friend projects in education, or other that we admire in general.</p>"},{"location":"Resources/#cat","title":"CAT","text":"<p>Projecte Atenci\u00f3 Atenci\u00f3 Project - Citizen Science empowerment for students XTEC</p>"},{"location":"Resources/#eng","title":"ENG","text":"<ul> <li>Smart Citizen User Guide Bibliolab Science and Healthy City</li> <li>A Citizen's Guide To Understanding and Monitoring Lakes and Streams</li> </ul>"},{"location":"Resources/#development-notes","title":"Development notes","text":"<ul> <li>Noise sampling analysis</li> <li>Noise and DSP analysis</li> </ul>"},{"location":"Resources/#pms-sensor","title":"PMS Sensor","text":"<ul> <li>One shot PMS5003</li> <li>PM intervals</li> </ul>"},{"location":"Resources/#academic-publications","title":"Academic publications","text":"<p>Find below some of our own publications, or others' that have used the Smart Citizen hardware and software.</p> <ul> <li>Special Issue on Open tools for environmental monitoring: Hardware X - 2019</li> <li>A citizen science approach for enhancing public understanding of air pollution</li> <li>Citizen Sensing: A Toolkit</li> <li>Onboarding Communities to the IoT</li> <li>Laboratory  evaluation  of  particle  size-selectivity  of  optical  low-cost particulate matter sensors: study lead by the Finnish Meteorological Institute, as part of the iScape project</li> </ul>"},{"location":"Resources/#mentions-on-academic-publications","title":"Mentions on academic publications","text":"<ul> <li>The influence of the vegetation cycle on the mitigation of air pollution by a deciduous roadside hedge - Thor-Bj\u00f8rn Ottosen, Prashant Kumar: study lead by the University of Surrey, as part of the iScape project</li> <li>Evaluation of low-cost sensors for quantitative personal exposure monitoring - Sachit Mahajan, PrashantKumar: study lead by the University of Surrey, as part of the iScape project</li> <li>How to get the best from low-cost particulate matter sensors: guidelines and practical recommendations: study lead by the University of Bologna, published as part of the Special Issue for Sensors for Particulate Matter and Air pollution</li> </ul>"},{"location":"Resources/#presentations","title":"Presentations","text":"<ul> <li>GROW Workshop Material - Lisbon, Portugal 2019</li> </ul>"},{"location":"Resources/#webinars","title":"Webinars","text":"<pre><code>These webinars are currently ongoing!\n</code></pre> <ul> <li>MINKE Webinar Basics - Online, 2022</li> <li>MINKE Webinar Advanced - Online, 2022</li> <li>MINKE Webinar Water Metrics - Online, 2022</li> <li>MINKE Webinar Air Metrics - Online, 2022</li> <li>MINKE Webinar Data Analysis (1) - Online, 2022</li> <li>MINKE Webinar Data Analysis (2) - Online, 2022</li> </ul> <p>View the edited video capsules!</p> <p>You can view the edited capsules here!</p>"},{"location":"Resources/Citizen%20Sensing%20Toolkit/","title":"Citizen Sensing Toolkit","text":"<p>The Citizen Sensing Toolkit was produced as part of the Making Sense project, which draws on nine citizen sensing campaigns in Holland, Kosovo and Spain in 2016 and 2017. Based on that experience we developed a framework and methods and tools for citizen participation in environmental monitoring and action. Their approach is bottom-up and participatory, and we call it \"citizen sensing\". </p>"},{"location":"Resources/Citizen%20Sensing%20Toolkit/#book-sections","title":"Book Sections","text":""},{"location":"Resources/Citizen%20Sensing%20Toolkit/#tools","title":"Tools","text":"<ol> <li>Scoping<ul> <li>Geographical Mapping</li> <li>Commons Mapping</li> <li>Collaboration Pilot Schedule</li> </ul> </li> <li>Community Building<ul> <li>Onboarding</li> <li>Empathy Timeline</li> <li>Recruitment</li> </ul> </li> <li>Planning<ul> <li>Community Level Indicators</li> <li>Sensing Strategy Canvas</li> <li>Calibration</li> <li>Targeted Measurements</li> </ul> </li> <li>Sensing<ul> <li>Sensing Guides</li> <li>Data Journals</li> <li>Operation Manual</li> <li>Open Hardware</li> </ul> </li> <li>Awareness <ul> <li>Awareness Sheet </li> <li>Data Discussion Sheet</li> <li>Data Dashboard</li> </ul> </li> <li>Action<ul> <li>Digital Presence</li> <li>Future News Paper</li> <li>Co-creation Assemblies</li> </ul> </li> <li>Reflection<ul> <li>Questionnaires</li> <li>Pilot Appraisal</li> <li>Graduation Ceremony</li> </ul> </li> <li>Legacy<ul> <li>Storylines</li> <li>Train The Next Generation</li> </ul> </li> </ol>"},{"location":"Resources/Citizen%20Sensing%20Toolkit/#case-studies","title":"Case Studies","text":"<ul> <li>Amsterdam<ul> <li>Gammasense</li> <li>Urban airq</li> </ul> </li> <li>Kosovo<ul> <li>Pilot 1</li> <li>Pilot 3</li> </ul> </li> <li>Barcelona<ul> <li>Beta pilot </li> <li>Gracia sounds pilot </li> </ul> </li> </ul>"},{"location":"Resources/References/","title":"Friend projects","text":"<p>Below there's a list of similar projects in either philosophy, sensors and ideas:</p> <ul> <li>Luftdaten - now sensor.community</li> <li>Purpleair</li> <li>hackAIR</li> <li>VAQUUMS</li> <li>Fiduceo</li> </ul> <p>School project in Barcelona?</p> <p>You can have a look here to borrow sensors and SCKs for a period of time with pedagogical guide included.</p>"},{"location":"Resources/Research/","title":"Research","text":"<p>This is a live compilation of our participation and results in some research projects we are/have been involved with:</p>"},{"location":"Resources/Research/#european-commission","title":"European Commission","text":"<ul> <li>Making Sense: advances and experiments in participatory sensing. (Grant agreement N\u00ba: 688620). Making Sense explored how open source software, open source hardware, digital maker practices and open design can be effectively used by local communities to fabricate their own sensing tools, make sense of their environments and address pressing environmental problems in air, water, soil and sound pollution.</li> <li>iScape:  Improving the Smart Control of Air Pollution in Europe (Grant agreement N\u00ba: 689954). iScape works on integrating and advancing the control of air quality and carbon emissions in European cities in the context of climate change through the development of sustainable and passive air pollution remediation strategies, policy interventions and behavioural change initiatives.</li> <li>GROW Observatory: (Grant agreement N\u00ba: 690199). A citizens' observatory for growers, researchers and decision makers, aiming to build better soil through Citizen Science.</li> </ul>"},{"location":"Resources/Research/#documents-and-results","title":"Documents and results","text":"<ul> <li>Making Sense Citizen Sensing A Toolkit book</li> <li>Making Sense D.23 Smart Citizen Toolkit report</li> <li>Making Sense D.24 Smart Citizen Toolkit report updates</li> <li>iScape Results (iScape site)</li> <li>iScape Results (cordis site)</li> <li>ISCAPE D7.8 Sensor monitoring experiences and technological innovations</li> </ul>"},{"location":"Resources/Research/#more-projects","title":"More projects","text":"<p>Although not H2020 projects, the projects below have allowed us to further our connections with scientific research institutions, and have contributed to the development of the Smart Citizen project. We are proud to have worked with:</p> <ul> <li>Institut Salud Global - iSGlobal: climate shelters project</li> <li>CSIC - UTM - ICM: Pati Cientific Project</li> <li>University of Bologna: Almabike project</li> <li>Fraunhofer institute: https://gis-iq.esri.de/fraunhofer-institut-iao-digital-labor-bad-duerrheim/</li> </ul>"},{"location":"Resources/Research/#academic-publications","title":"Academic publications","text":"<p>Find below some of our own publications, or others' that have used the Smart Citizen hardware and software.</p> <ul> <li>Special Issue on Open tools for environmental monitoring: Hardware X - 2019</li> <li>A citizen science approach for enhancing public understanding of air pollution</li> <li>Citizen Sensing: A Toolkit</li> <li>Onboarding Communities to the IoT</li> <li>Laboratory  evaluation  of  particle  size-selectivity  of  optical  low-cost particulate matter sensors: study lead by the Finnish Meteorological Institute, as part of the iScape project</li> </ul>"},{"location":"Resources/Research/#mentions","title":"Mentions","text":"<ul> <li>The influence of the vegetation cycle on the mitigation of air pollution by a deciduous roadside hedge - Thor-Bj\u00f8rn Ottosen, Prashant Kumar: study lead by the University of Surrey, as part of the iScape project</li> <li>Evaluation of low-cost sensors for quantitative personal exposure monitoring - Sachit Mahajan, PrashantKumar: study lead by the University of Surrey, as part of the iScape project</li> <li>How to get the best from low-cost particulate matter sensors: guidelines and practical recommendations: study lead by the University of Bologna, published as part of the Special Issue for Sensors for Particulate Matter and Air pollution</li> </ul>"},{"location":"Resources/Education/","title":"Smart Citizen and Education","text":"<p>School project in Barcelona?</p> <p>You can have a look here to borrow sensors and SCKs for a period of time with activities and other guides included.</p> <p>Here there is a compilation of projects that we have done around education, directly or indirectly with other partners:</p> <p> Image credit: DOIT</p> <ul> <li>DOIT Toolkit - Measuring our environment (EN)- Future Learning Unit at Fablab Barcelona</li> <li>DOIT Toolkit - Midiendo nuestro entorno (ES)- Future Learning Unit at Fablab Barcelona</li> <li>AULAMAR - T\u00e9cnicas de Muestreo de agua (ES)</li> </ul>"},{"location":"Resources/Education/#external-links","title":"External links","text":"<p>This is a compilation of friend projects in education, or other that we admire in general.</p>"},{"location":"Resources/Education/#cat","title":"CAT","text":"<p>Projecte Atenci\u00f3 Atenci\u00f3 Project - Citizen Science empowerment for students XTEC</p>"},{"location":"Resources/Education/#eng","title":"ENG","text":"<ul> <li>Smart Citizen User Guide Bibliolab Science and Healthy City</li> <li>A Citizen's Guide To Understanding and Monitoring Lakes and Streams</li> </ul> <p> Image credit: DOIT</p>"},{"location":"Resources/Education/AulaMar/","title":"AulaMar","text":"<p>Lo primero es lo primero</p> <p>\u00a1Muy importante! Revisa esta p\u00e1gina antes de hacer nada.</p>"},{"location":"Resources/Education/AulaMar/#guias-por-metrica","title":"Gu\u00edas por m\u00e9trica","text":"<p>Selecciona debajo gu\u00edas y materiales para cada una de las m\u00e9tricas que medimos:</p> pH Ox\u00edgeno disuelto Conductividad Temperatura"},{"location":"Resources/Education/AulaMar/#material-para-el-docente","title":"Material para el docente","text":"<p>En la parte superior de cada p\u00e1gina puedes descargar el contenido de esta web en PDF si lo prefieres. Debajo tienes materiales adicionales para las actividades:</p> <ul> <li>Instrucciones de uso</li> <li>Material Docente (secuencia did\u00e1ctica)</li> </ul>"},{"location":"Resources/Education/AulaMar/#referencias-y-material-adicional","title":"Referencias y material adicional","text":"<p>Gracias a...</p> <p>Todo este material se ha hecho durante el proyecto AULAMAR (Fundaci\u00f3 Bit Habitat, ref. ID253). Este material se ha elaborado junto con el Instituto de Ciencias del Mar (ICM - CSIC, Barcelona)</p> <p>Estas son unas referencias que hemos utilizado como inspiraci\u00f3n, motivaci\u00f3n y referencia para generar este material, aparte de contenido propio:</p> <p>A Citizen\u2019s Guide To Understanding And Monitoring Lakes And Streams: https://apps.ecology.wa.gov/publications/documents/94149.pdf</p> <p>USGS National Field Manual for the Collection of Water-Quality Data: https://www.usgs.gov/mission-areas/water-resources/science/national-field-manual-collection-water-quality-data-nfm</p> <p>U.S. Geological Survey, 2019, Specific conductance: U.S. Geological Survey Techniques and Methods, book 9, chap. A6.3, 15 p., https://doi.org/10.3133/tm9A6.3.</p> <p>NOAA: https://www.noaa.gov/education/resource-collections/ocean-coasts</p> <p>Atlas Scientific: https://atlas-scientific.com/</p>"},{"location":"Resources/Education/AulaMar/EC/","title":"Conductividad","text":""},{"location":"Resources/Education/AulaMar/EC/#que-es-la-conductividad-del-agua","title":"\u00bfQu\u00e9 es la conductividad del agua?","text":"<p>La conductividad del agua es la capacidad que tiene esta para permitir el flujo de cargas el\u00e9ctricas. Para que haya conductividad, el agua necesita tener iones disueltos (cargas el\u00e9ctricas positivas o negativas).</p> <p>\u00bfEl agua conduce o no conduce?</p> <p>Un agua libre de iones (desionizada) o pura (destilada), no es conductora - \u00a1de hecho es un aislante muy bueno! El agua pura, al no tener iones (simplemente es H2O, sin cargas el\u00e9ctricas), no puede ser conductiva, pero al a\u00f1adir sustancias minerales o componentes org\u00e1nicos, se a\u00f1aden en forma de iones disueltos, que permiten que el agua conduzca la electricidad.</p> <p>Existen varias formas de expresar la conductividad: conductancia espec\u00edfica, conductancia el\u00e9ctrica espec\u00edfica, o conductividad el\u00e9ctrica. El t\u00e9rmino conductividad el\u00e9ctrica es directamente relacionada a la temperatura  del agua, por lo que es importante medir la temperatura a la que se hizo esta medici\u00f3n de conductividad. En el caso m\u00e1s general, la conductividad se debe expresar como conductancia espec\u00edfica, es decir, corrigiendo la conductividad a una temperatura de 25\u00baC, respecto a la temperatura a la que se hizo la medici\u00f3n.</p> <p>La conductancia es, por tanto, la capacidad del agua de conducir la corriente el\u00e9ctrica (se mide en Siemens [S]) y es el inverso de la resistencia (que se mide en Ohm [\u03a9]). La conductividad el\u00e9ctrica, tal como la mediremos con nuestro sensor, es la medida de conductancia, normalizada a una unidad de distancia y secci\u00f3n transversal.</p>"},{"location":"Resources/Education/AulaMar/EC/#por-que-es-importante","title":"\u00bfPor qu\u00e9 es importante?","text":"<p>La conductividad, con la temperatura, es utilizada para calcular la salinidad, y otros par\u00e1metros como los s\u00f3lidos disueltos (TDS). La salinidad es la cantidad de sales contenida en 1 kg de agua. Se expresa en PSU (Unidad Pr\u00e1ctica de Salinidad, que equivale aproximadamente a 1mg/g de sales). La salinidad promedia del agua de mar es de 35 psu, o 35 g/kg.</p> <p>En el mar</p> <p>En oceanograf\u00eda, la conductividad se usa como medida para obtener la estimaci\u00f3n de la salinidad del agua de mar (en este caso, corresponde a la salinidad pr\u00e1ctica). Por otra parte,   la salinidad absoluta corresponde a la concentraci\u00f3n de sales contenidas en el agua, y para medirse necesita m\u00e9todos qu\u00edmicos complejos y que toman mucho tiempo. </p> <p>La salinidad es un factor ecol\u00f3gico de gran importancia, y tiene influencia sobre el tipo de organismos (animales y plantas) que pueden vivir en el agua. Las variaciones de salinidad del agua est\u00e1n directamente relacionadas con los aportes de agua dulce de los r\u00edos o de los eventos de lluvias, pero tambi\u00e9n de la evaporaci\u00f3n de las aguas superficiales o de la formaci\u00f3n del hielo marino en los oc\u00e9anos. Tambi\u00e9n tiene un impacto sobre la formaci\u00f3n de aguas profundas en los polos. Finalmente, acompa\u00f1ada de una medida de temperatura, permite definir la densidad de las masas de agua y con esto obtener informaci\u00f3n sobre las corrientes.</p> <p>Estos cambios de densidad debidos a la temperatura y la salinidad provocan cambios en la flotabilidad de las masas de agua. Adem\u00e1s, las variaciones de salinidad pueden tener impacto en la absorci\u00f3n del CO2 en los oc\u00e9anos (en aguas m\u00e1s saladas, el CO2 es menos soluble). Por \u00faltimo, los datos de temperatura, salinidad y densidad son como la tarjeta de identidad de las diferentes masas de aguas contenida en los oc\u00e9anos y nos permite seguir su recorrido a lo largo de su vida (zona de formaci\u00f3n hasta desaparecer o transformarse en otra masa por procesos de difusi\u00f3n o mezcla).</p> <p>Curiosidades</p> <p>La capacidad de carga m\u00e1xima de los buques mercantes var\u00eda en funci\u00f3n de la zona de navegaci\u00f3n y de la \u00e9poca del a\u00f1o. En funci\u00f3n de la densidad del agua que se van a encontrar se pueden cargar m\u00e1s o menos para \"flotar lo mismo\". El disco de Plimsoll es este dibujo que llevan los buques mercantes en los lados, cerca de la l\u00ednea de flotaci\u00f3n. Sirve para ver hasta d\u00f3nde cargar en barco en funci\u00f3n de la ruta</p> <p></p> <p>El Mediterr\u00e1neo</p> <p>La salinidad media del mediterr\u00e1neo es alrededor de 38 psu, lo cual lo hace un mar m\u00e1s salado que la media mundial.</p>"},{"location":"Resources/Education/AulaMar/EC/#como-medir-la-conductividad","title":"\u00bfC\u00f3mo medir la conductividad?","text":"<p>Como norma general, es preferible la toma de medidas in situ, en lugar de la toma de muestras y posterior an\u00e1lisis en laboratorio, debido a los posibles cambios qu\u00edmicos que pueden ocurrir en la muestra.</p> <p>En caso de que no se pueda hacer una medida in situ, trata de tomar una muestra y hacer la medida lo antes posible. Si la muestra cambia mucho de temperatura, o si se forman deposiciones o burbujas en el transporte, la medida no ser\u00e1 representativa.</p>"},{"location":"Resources/Education/AulaMar/EC/#el-sensor","title":"El sensor","text":"<p>Para medir conductividad el\u00e9ctrica, usaremos un sensor llamado conduct\u00edmetro. En el caso de Smart Citizen, usando los sensores de Atlas Scientific, el sensor de conductividad no tiene sensor de temperatura integrado, por lo que deberemos usar un sensor de temperatura adicional para medir la temperatura a la cual estamos tomando la muestra. Este sensor de temperatura debe sumergirse a la vez cuando tomemos medidas de conductividad.</p> <p>En caso de tener un sensor de temperatura, los valores reportados ser\u00e1n referenciados a la temperatura medida, siendo este proceso autom\u00e1tico. En caso de no tener un sensor de temperatura, la lectura ser\u00e1 referenciada a 25\u00baC, y puede representar un origen de errores. Adicionalmente, es importante revisar las correcciones con valores de pH extremos (mayores a 12 o menores a 2), ya que \u00e9stas pueden introducir errores grandes en los resultados en los sensores de Smart Citizen (y Atlas Scientific).</p>"},{"location":"Resources/Education/AulaMar/EC/#como-preparar-el-sensor","title":"C\u00f3mo preparar el sensor","text":"<p>Antes y despu\u00e9s de medir, se debe limpiar con agua desionizada. En caso de que haya restos, se puede limpiar con tejidos de laboratorio para evitar polvo. Se puede limpiar con un poco de detergente y posteriormente limpiar con agua destilada en caso de que est\u00e9 muy sucia, o contenga residuos oleosos. </p> <p>Calibraci\u00f3n</p> <p>Si el sensor no est\u00e1 calibrado, sigue el procedimiento descrito en esta gu\u00eda</p>"},{"location":"Resources/Education/AulaMar/EC/#como-medir","title":"C\u00f3mo medir","text":"<p>Si no conoces el lugar donde vas a tomar la muestra, mide en varios puntos a diferentes profundidades y secciones. En caso de que haya poco movimiento de agua, toma varias muestras a diferentes profundidades.</p> <ol> <li>Toma la medida a la profundidad que toque dejando que se estabilice al menos 60s. Para saber si est\u00e1 en equilibrio, espera variaciones de \u00b15 \u03bcS/cm para medidas \u2264100 \u03bcS/cm o \u00b13% para medidas &gt;100 \u03bcS/cm. No sumerjas la sonda demasiado de forma que nunca entres en zona de sedimentos.</li> <li>Toma medidas de temperatura y conductividad, sin mover las sondas del agua (toma las dos a la vez)</li> <li>Cuando termines, limpia la sonda con agua desionizada</li> </ol> <p>Warning</p> <p>El sensor de conductividad necesita sumergirse hasta el elemento activo:</p> <p> </p> <p>Adem\u00e1s, evita que se acumulen burbujas en la carcasa del sensor. Simplemente agita el sensor un poco para extraer las burbujas:</p> <p></p> <p>Recursos adicionales</p> <p>Sobre importancia de la salinidad para la oceanograf\u00eda f\u00edsica, as\u00ed como su aplicaci\u00f3n a la identificaci\u00f3n de frentes entre diferentes masas de agua:</p> <p>https://www.youtube.com/watch?v=-B5PDNmSidY https://www.youtube.com/watch?v=AsLJLt70Zo4 https://www.youtube.com/watch?v=oxAwn8nunGo</p> <p>En caso de que quieras profundizar m\u00e1s en las medidas de conductividad, puedes revisar las referencias en https://pubs.usgs.gov/tm/09/a6.3/tm9-a6_3.pdf </p>"},{"location":"Resources/Education/AulaMar/General/","title":"Notas generales","text":"<p>\u00a1Lee atentamente esto antes de hacer nada!</p> <p>Tomar muestras y recoger datos \u00fanicamente vale de algo si estamos seguros de los datos que hemos tomado: seguros de que las medidas que hemos tomado realmente son reflejo del entorno, y de que hemos tomado suficientes datos como para poder entenderlo. Aqu\u00ed tienes algunas notas generales sobre la toma de muestras o el proceso de medici\u00f3n:</p> <ol> <li>Lo m\u00e1s importante de todo es la seguridad, sobre todo en entornos marinos, donde puede haber mucho oleaje, o corrientes que no vemos y que pueden suponer un riesgo para nosotros, para nuestros equipos, o para la vida de ese entorno. Nunca entres a tomar muestras si las condiciones no son seguras o si las condiciones son demasiado dif\u00edciles. Para eso, necesitar\u00e1s verificar la predicci\u00f3n meteorol\u00f3gica a partir del d\u00eda anterior para asegurar que las condiciones del mar son accesibles para el muestreo deseado.</li> <li>Usa un chaleco salvavidas siempre que est\u00e9s en un bote. </li> <li>Despu\u00e9s de la seguridad, lo m\u00e1s importante es documentar todo lo que haces. Un registro de c\u00f3mo tomaste tus datos le permitir\u00e1 a otros saber c\u00f3mo se obtuvieron y saber si pueden compararlos con los suyos o con otros. La documentaci\u00f3n es m\u00e1s importante en un programa voluntario, ya que se vuelve una herramienta de capacitaci\u00f3n para otros voluntarios. En el mar, usar papel puede no ser la mejor opci\u00f3n. Si necesitas hacer anotaciones, puedes usar una tablilla que se pueda mojar y escribir en ella con un l\u00e1piz. Adem\u00e1s, esta informaci\u00f3n que llamamos informe de campa\u00f1a, nos permite recordar los eventos d\u00edas despu\u00e9s. En caso de duda en los datos observados, puedes regresar a estas notas y comprobarlos.</li> <li>Todos los recipientes de muestras deben lavarse con \u00e1cido diluido y enjuagar completamente con agua destilada desionizada. Es importante tener estas botellas limpias para la recolecci\u00f3n de muestras. Mant\u00e9n las tapas ajustadas y no las quites hasta que hayas tomado la muestra.</li> <li>Enjuaga cada recipiente con agua de muestra al menos tres veces (el mismo agua que quieres medir) antes de almacenarla o de tomar la medida.</li> <li>Todos los sensores tienen especificaciones para su calibraci\u00f3n (puesta a punto) y mantenimiento. Es importante limpiar los sensores antes y despu\u00e9s de cada uso siguiendo estas indicaciones.</li> <li>Nunca uses un sensor que presente signos de deterioro o comportamiento err\u00e1tico.</li> <li>Cuando tomes aguas de zonas con mucho movimiento (cerca de rompeolas, orilla), ten cuidado de no tomar muestras de zonas perturbadas. Si las tomas en un arroyo, t\u00f3malas en la desembocadura y avanza aguas arriba.</li> <li>Si es necesario ingresar en el agua, da unos pasos aguas arriba o aguas adentro desde donde ingresaste al agua, mira hacia la corriente, incl\u00ednate hacia delante y toma la muestra ah\u00ed.</li> <li>Siempre toma las muestras por debajo de la superficie.</li> <li>Si hay riesgo de que el equipo se pierda, hunda, o caiga, f\u00edjalo antes sobre un objeto s\u00f3lido y estable primero, y luego toma las muestras.</li> <li>Si tomas muestras, etiquetalas con al menos: el nombre del punto de medida, la fecha y hora, la ubicaci\u00f3n. Te aconsejamos preparar los recipientes antes de llegar al campo de medida. Puedes utilizar cinta americana y pegarla en el recipiente para anotar la informaci\u00f3n. De esta manera podr\u00e1s reutilizar m\u00e1s adelante los recipientes una vez has analizado los datos en laboratorio. \u00a1Usa tinta indeleble en la etiqueta!</li> <li>Toma fotos del proceso, para a\u00f1adir esta informaci\u00f3n en el informe de campa\u00f1a.</li> <li>Cuando tomes muestras, o anotes mediciones, toma muchas notas de campo, incluye observaciones meteorol\u00f3gicas, apariencia visual de la estaci\u00f3n de muestreo o calidad del agua, problemas del equipo y descripciones de las t\u00e9cnicas utilizadas.</li> <li>S\u00e9 consistente. No cambies el m\u00e9todo de muestreo, el uso del equipo o la ubicaci\u00f3n de las estaciones entre estaciones de muestreo o d\u00edas de muestreo sin indicar por qu\u00e9 se realiz\u00f3 el cambio e identificar permanentemente qu\u00e9 datos pertenecen a qu\u00e9 conjunto de t\u00e9cnicas de muestreo o equipo utilizado. </li> </ol> <p>\u00bfD\u00f3nde ver el tiempo?</p> <ul> <li>El tiempo en Barcelona - Bolet\u00edn detallado - METEO CONSULT MARINO: https://maritima.meteoconsult.es/tiempo-marino/bolet%C3%ADn-detalle/lugar-de-ski-2057/predicciones-tiempo-barcelona-hoy</li> <li>Previsiones del viento, del oleaje y del tiempo Barcelona Puerto Ol\u00edmpico - Windfinder: https://es.windfinder.com/forecast/barcelona_puerto_olimpico</li> <li>Port Barcelona - Previsions m\u00e9teo i mar (https://portdebarcelona.cat)</li> <li>Pat\u00ed Cient\u00edfic \u2013 Web del projecte Pat\u00ed Cient\u00edfic (https://paticientific.org)</li> <li>https://holfuy.com/es/weather/1201</li> </ul>"},{"location":"Resources/Education/AulaMar/Instrucciones/","title":"Instrucciones","text":"<p>En esta p\u00e1gina detallaremos los distintos aspectos que necesitas saber para usar el sensor.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#introduccion","title":"Introducci\u00f3n","text":"<p>El proyecto Smart Citizen tiene como objetivo proveer herramientas tecnol\u00f3gicas para el empoderamiento ciudadano entorno a la monitorizaci\u00f3n ambiental. Para ello, el proyecto se compone de varias categor\u00edas:</p> <p></p> <p>En esta p\u00e1gina, nos centraremos en explicar c\u00f3mo funcionan los sensores y la plataforma.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#hardware","title":"Hardware","text":"<p>El hardware est\u00e1 construido de forma modular y con la idea de ser un kit, por tanto, no una soluci\u00f3n t\u00e9cnica cerrada (en ning\u00fan sentido).</p> <p></p> <p>El Smart Citizen Kit (SCK) es n\u00facleo de un sistema modular de hardware y software cuya intenci\u00f3n es proporcionar herramientas de monitorizaci\u00f3n ambiental, tanto en ciencia ciudadana como en investigaci\u00f3n. El sistema se compone de los siguientes elementos:</p> <ul> <li>Data Board: data-logger con conectividad Wi-Fi y micro SD-card, a la cual se conectan el resto de componentes.</li> </ul> <p></p> <ul> <li> <p>Sensores, dependiendo del entorno a monitorizar y de la complejidad buscada, existen diferentes formas de conectar sensores al SCK:</p> <ul> <li> <p>Urban Sensor Board: placa que contiene una selecci\u00f3n de sensores de bajo coste para medir par\u00e1metros de calidad de aire, as\u00ed como un conector para un sensor de part\u00edculas externo.</p> <p></p> </li> <li> <p>Sensores de aire: sensores que permiten medir la calidad de aire y diferentes contaminantes. Suelen ser m\u00e1s avanzados y un poco m\u00e1s complejos de analizar</p> <p></p> </li> <li> <p>Sensores de agua: basados en los sensores de Atlas Scientific y otras soluciones, se puede medir par\u00e1metros f\u00edsico-qu\u00edmicos en el agua como pH, ox\u00edgeno disuelto, temperatura, turbidez, entre otros</p> <p></p> </li> </ul> </li> </ul>"},{"location":"Resources/Education/AulaMar/Instrucciones/#modos-de-operacion","title":"Modos de operaci\u00f3n","text":"<p>El kit tiene tres modos fundamentales de operaci\u00f3n: modo configuraci\u00f3n, modo grabaci\u00f3n online y modo grabaci\u00f3n offline o SD-card. En el modo configuraci\u00f3n, el kit no grabar\u00e1 nada, pero nos permite seleccionar el modo en que vamos a grabar los datos (online o en la micro SD-card). Para empezar, seguiremos el proceso de onboarding.</p> <p>Documentaci\u00f3n</p> <p>Los modos se representan mediante distintos colores en el LED, y est\u00e1n documentados en la siguiente p\u00e1gina de la documentaci\u00f3n.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#interfaz-de-usuario","title":"Interfaz de usuario","text":"<p>El usuario tambi\u00e9n tiene la posibilidad de cambiar el modo de operaci\u00f3n a trav\u00e9s del bot\u00f3n:</p> <p></p> <p>Documentaci\u00f3n</p> <p>Las interfaces se encuentran documentadas en la siguiente p\u00e1gina de la documentaci\u00f3n</p> <p>Adem\u00e1s, existe un bot\u00f3n de reset (un poco m\u00e1s oculto), para que puedas resetear el kit:</p> <p></p> <p>Reset</p> <p>En el caso de la estaci\u00f3n de agua, puedes acceder a este bot\u00f3n desde fuera de la carcasa:</p> <p></p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#sensores-de-agua","title":"Sensores de agua","text":"<p>Los sensores soportados para este sistema son:</p> <p>{{ get_snippet_rel(\"docs/includes/es/sensors/water.md\")}}</p> <p>En Aulamar</p> <p>Para el caso de Aulamar hemos preparado mucho material did\u00e1ctico para entender mejor las m\u00e9tricas que vamos a medir.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#calibracion","title":"Calibraci\u00f3n","text":"<p>Los sensores de agua necesitan una calibraci\u00f3n inicial para poder ser usados correctamente. De los diferentes sensores soportados, revisa cu\u00e1les necesitan calibraci\u00f3n en la tabla de arriba.</p> <p>Documentaci\u00f3n</p> <p>La calibraci\u00f3n de los sensores puede ser un proceso un poco m\u00e1s complejo, ya que requiere que conozcas c\u00f3mo usar la Shell del SCK.</p> <p>Si ya est\u00e1s familiarizado con ella, puedes seguir la siguiente gu\u00eda para realizar el procedimiento.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#puesta-en-marcha","title":"Puesta en marcha","text":"<p>El onboarding es una interfaz web que permite configurar el SCK en el modo deseado y asignar el dispositivo a un perfil de usuario en la plataforma. </p> <p>Es importante entender que un mismo dispositivo f\u00edsico puede tener ser asignado a diferentes dispositivos en la plataforma, aunque s\u00f3lo puede enviar datos a uno de ellos simult\u00e1neamente. La manera de conectar ambos se realiza a trav\u00e9s del token, el cual se asigna durante el procedimiento de onboarding, y se asocia a un dispositivo en la plataforma. Este token se introduce en el dispositivo f\u00edsico en configuraci\u00f3n a trav\u00e9s de una interfaz m\u00f3vil, as\u00ed como las credenciales Wi-Fi (SSID y contrase\u00f1a).</p> <p>Documentaci\u00f3n</p> <p>El proceso de onboarding nos guiar\u00e1 en las distintas etapas de configuraci\u00f3n, y est\u00e1 detallado en esta p\u00e1gina de la documentaci\u00f3n</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#datos","title":"Datos","text":"<p>Existen diversar maneras de acceder a los datos capturados por los sensores:</p> <ul> <li>SD Card</li> <li>Visualizaci\u00f3n WEB y Dashboard</li> <li>API</li> </ul>"},{"location":"Resources/Education/AulaMar/Instrucciones/#sd-card","title":"SD-card","text":"<p>Siempre que haya una SD-card presente, el SCK grabar\u00e1 los datos en la misma en formato CSV.</p> <p>Es posible que veas algunos archivos raros en la SD-card, con extensiones como <code>(.01, .02...)</code>. Estos ficheros son en realidad ficheros CSV, pero que el kit necesita renombrar cada vez que ocurre un <code>reset</code> para evitar corromper la SDcard. </p> <p>Reset</p> <p>Cada vez que ocurre un reset, bien manual (con el bot\u00f3n o desconectando la alimentaci\u00f3n), o bien peri\u00f3dico, un fichero nuevo se genera.</p> <p>Cada noche, ocurre un reset de sanidad para asegurar que todo funciona correctamente y que el SCK no se bloquea. Este reset ocurre a las 3-4am (en CET), para evitar que perdamos datos si hay alg\u00fan problema con el kit. Los ficheros en la SD card se generan secuencialmente como YY-MM-DD.01, .02\u2026 dependiendo del n\u00famero de reset que ocurren en un d\u00eda. Puedes simplemente renombrar los ficheros de YY-MM-DD.01 a YY-MM-DD_01.CSV. Tambi\u00e9n puedes revisar esta gu\u00eda para automatizar este proceso.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#plataforma","title":"Plataforma","text":"<p>La plataforma web de Smart Citizen permite realizar las siguientes funciones:</p> <ul> <li> <p>Navegaci\u00f3n geolocalizada y visualizaci\u00f3n de datos por dispositivo</p> </li> <li> <p>Gesti\u00f3n del perfil de usuario y edici\u00f3n de kits</p> </li> <li> <p>Subida de datos de SCKs sin conectividad con SD card</p> </li> <li> <p>Descarga de datos en CSV</p> </li> </ul>"},{"location":"Resources/Education/AulaMar/Instrucciones/#api","title":"API","text":"<p>El API de Smart Citizen te permite descargar informaci\u00f3n de tus dispositivos y hacer cosas chulas con ellos.</p> <p>Es un API REST y te retorna los datos en formato JSON. Esto quiere decir que puedes acceder de forma f\u00e1cil la informaci\u00f3n desde cualquier lenguaje de programaci\u00f3n Javascript, PHP, processing, Python, ... y empezar a hacer cosas muy r\u00e1pidamente.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#usando-scripts","title":"Usando scripts","text":"<p>Si quieres avanzar m\u00e1s r\u00e1pido, hemos preparado una serie de ejemplos y librer\u00edas en python en scdata. scdata es un paquete de <code>python</code> que te permite descargar, visualizar y analizar datos de forma r\u00e1pida. Revisa los ejemplos en el repositorio de git.</p> <p>Ejemplos extras</p> <p>Hay otros muchos ejemplos en otros lenguajes de programaci\u00f3n en el repositorio de smartcitizen-toolkit. En \u00e9l encontrar\u00e1s c\u00f3mo acceder a los datos desde processing, o nodered.</p>"},{"location":"Resources/Education/AulaMar/Instrucciones/#dashboard","title":"Dashboard","text":"<p>El dashboard es una herramienta web muy sencilla que nos permite explorar los datos de un kit de forma r\u00e1pida.</p> <p></p> <p>Se puede utilizar sin gr\u00e1ficos (click en el icono \ud83d\udee0\ufe0f y desmarca Show Graphs):</p> <p></p> <p>Hacking it</p> <p>Si fijas un intervalo de lectura r\u00e1pido (aqu\u00ed tienes c\u00f3mo hacerlo) puedes usar este modo para ver los valores evolucionar mientras haces un experimento.</p>"},{"location":"Resources/Education/AulaMar/OD/","title":"Ox\u00edgeno disuelto","text":""},{"location":"Resources/Education/AulaMar/OD/#que-es-el-oxigeno-disuelto","title":"\u00bfQu\u00e9 es el ox\u00edgeno disuelto?","text":"<p>El ox\u00edgeno disuelto (OD) es un indicador de cu\u00e1nto ox\u00edgeno hay disuelto en el agua (obvio) y que est\u00e1 disponible para los seres vivos en el agua. El movimiento del agua, o su choque contra rocas u otros elementos, provoca la aireaci\u00f3n y una mayor concentraci\u00f3n de ox\u00edgeno en la misma. Por ello, el ox\u00edgeno disuelto es mayor en aguas con mucho movimiento, mientras que disminuye en aguas estancadas. Puede proceder de otros or\u00edgenes, por ejemplo por el intercambio y difusi\u00f3n con la atm\u00f3sfera, aireaci\u00f3n por viento y olas, o por la fotos\u00edntesis de plantas acu\u00e1ticas o concentraci\u00f3n de vida. Asimismo, las variaciones en temperatura, tienen un efecto inversamente proporcional en el ox\u00edgeno disuelto: incrementos en temperatura provocan una disminuci\u00f3n en el ox\u00edgeno disuelto y viceversa.</p> <p>El ox\u00edgeno disuelto es fundamental para la vida acu\u00e1tica. La tabla inferior indica la m\u00ednima cantidad de ox\u00edgeno disuelto necesario para la vida de distintos organismos. Por debajo de esa cantidad de ox\u00edgeno en el agua, se provoca lo que se conoce como hipoxia,  es decir, asfixia por falta de ox\u00edgeno:</p> Organismo OD (mg/l) Salm\u00f3n     9-10     Trucha     6.5     Lubina     6.5     Larva de tric\u00f3ptero     4.0     Siluro     2.5     Carpa     2     Larva de mosquito     1"},{"location":"Resources/Education/AulaMar/OD/#por-que-es-importante","title":"\u00bfPor qu\u00e9 es importante?","text":"<p>El ox\u00edgeno disuelto en el agua es fundamental para la vida. Las bacterias en el agua consumen ox\u00edgeno al descomponer la materia org\u00e1nica. Un exceso de materia org\u00e1nica en descomposici\u00f3n (por ejemplo, con plantas o algas) puede derivar en condiciones de falta de ox\u00edgeno y esto puede provocar la muerte de vida acu\u00e1tica por falta de ox\u00edgeno. Adem\u00e1s, la presencia de ox\u00edgeno es muy importante para ciertas reacciones qu\u00edmicas que ocurren en el agua. Por lo general, la contaminaci\u00f3n del agua tiende a disminuir la cantidad de ox\u00edgeno en el agua, normalmente provocada por la reacci\u00f3n de sustancias que provocan un consumo de ox\u00edgeno elevado.</p> <p>Cuando la falta de ox\u00edgeno se produce por una elevada demanda del mismo, debido a la contaminaci\u00f3n o actividad biol\u00f3gica, esto no suele ocurrir directamente donde se hace el vertido, sino m\u00e1s adelante donde se produce la descomposici\u00f3n. En este caso, suele ser muy complicado establecer relaciones entre vertidos con alta demanda de ox\u00edgeno y una disminuci\u00f3n en cantidades de ox\u00edgeno.</p> <p>Los cambios en la qu\u00edmica del agua (a nivel de Ox\u00edgeno y de pH), pueden sobrepasar la capacidad de los organismos acu\u00e1ticos de aclimatarse y sobrevivir. Esto puede generar reacciones en cadena, donde los h\u00e1bitats se degradan al perder biodiversidad y biomasa.</p> <p>En el mar</p> <p>Los organismos que viven en el mar est\u00e1n generalmente aclimatados a un porcentaje concreto de ox\u00edgeno. Las fluctuaciones en este par\u00e1metro por tanto pueden tener efectos devastadores: si el ox\u00edgeno disuelto desciende, algunas especies podr\u00e1n adaptarse, pero es muy posible que si la disminuci\u00f3n no es suficientemente gradual, se extinguir\u00e1n. Adem\u00e1s, el oc\u00e9ano es un gran productor de ox\u00edgeno a nivel mundial, a trav\u00e9s de la fotos\u00edntesis de algas.</p> <p>Impacto</p> <p>Las zonas muertas (llamadas hip\u00f3xicas) en las que falta ox\u00edgeno se est\u00e1n multiplicando en el oc\u00e9ano. El calentamiento global \u2013 que limita los intercambios entre las diferentes capas de agua \u2013 el aumento de la temperatura del agua \u2013 que en consecuencia contiene menos ox\u00edgeno \u2013 y la presencia cada vez mayor de abonos y fertilizantes crean efecto de zonas fatales para los animales marinos.</p> <p>Hoy en d\u00eda, hay de m\u00e1s de 245.000 km\u00b2 repartidos en 400 zonas muertas. Los peces que sobreviven tienen un peso inferior al normal y su sistema reproductivo parece estar permanentemente da\u00f1ado. Otros animales marinos de movimiento m\u00e1s lento (langostas o cangrejos, por ejemplo), crust\u00e1ceos y moluscos est\u00e1n condenados en \u00e1reas con muy poco ox\u00edgeno. La descomposici\u00f3n de los cad\u00e1veres acent\u00faa entonces el fen\u00f3meno. Estos episodios an\u00f3xicos (durante los cuales la cantidad de ox\u00edgeno es insuficiente) pueden durar algunas horas o algunos meses.</p>"},{"location":"Resources/Education/AulaMar/OD/#como-medir-oxigeno-disuelto","title":"\u00bfC\u00f3mo medir ox\u00edgeno disuelto?","text":"<p>La concentraci\u00f3n de ox\u00edgeno disuelto cambia dr\u00e1sticamente en funci\u00f3n de la profundidad y la distancia respecto a la orilla. Si el objetivo es medir diferencias entre diferentes puntos, es necesario tomar muestras de forma sistem\u00e1tica, a ser posible de forma continua. Si esto no es posible, la muestra se debe tomar lo m\u00e1s aguas adentro posible, mientras que la recogida de muestras o toma de muestras sea segura y a una profundidad de un brazo bajo la superficie.</p> <p>Si se comparan varias muestras o medidas en continua, estas deben tener condiciones similares de agitaci\u00f3n (no tomar algunas cerca de la orilla con muchas olas y otras en zonas estancadas), salvo que, de nuevo, el objetivo sea medir estas diferencias. Las mejores zonas son aquellas donde el agua fluye suavemente y no est\u00e1 en los extremos de agitaci\u00f3n ni quietud.</p> <p>Es importante tener en cuenta las variaciones diarias de ox\u00edgeno disuelto provocadas por la temperatura y por la actividad de las plantas. Toma nota de la hora a la que tomas las muestras, adem\u00e1s de la temperatura de la muestra (tanto del aire como del agua, si puedes). Para comparar diferentes zonas, toma las muestras siempre a la misma hora, salvo que tu objetivo sea entender c\u00f3mo cambia a lo largo de un d\u00eda.</p> <p>\u00a1La medida de ox\u00edgeno disuelto no es f\u00e1cil! Es importante no airear las muestras antes de hacer la medida, y que no tengas burbujas en tu bote de muestras. </p>"},{"location":"Resources/Education/AulaMar/OD/#el-sensor","title":"El sensor","text":"<p>Usaremos un sensor de ox\u00edgeno disuelto, que se compone de una membrana de tefl\u00f3n y dos electrodos, uno de ellos en una soluci\u00f3n de electrolito. El ox\u00edgeno pasa por la membrana de tefl\u00f3n, y  al reducirse en el c\u00e1todo, se crea una diferencia de voltaje entre ellos, que podemos medir. Este tipo de sonda se denomina galv\u00e1nica, y consume un poco de ox\u00edgeno cuando toma lecturas. Por ello, es necesario mover la sonda o el agua alrededor un poco (sin airearla). </p> <p> FUENTE: Atlas Scientific</p> <p>El sensor se puede sumergir completamente, y tiene las siguientes caracter\u00edsticas (aqu\u00ed citamos algunas, tienes todas en el datasheet):</p> <ul> <li>Rango: 1-50mg/l</li> <li>M\u00e1xima profundidad en agua: 70m</li> <li>Velocidad de respuesta: ~0.5 mg/l/por segundo</li> </ul> <p>Cuida de tu sensor</p> <p>Dado que el electrolito forma parte de la reacci\u00f3n con el ox\u00edgeno dentro de la sonda, este se consume a lo largo del tiempo. Normalmente, tarda unos 6 meses hasta que el electrolito se agote. Por ello, se recomienda reemplazar la soluci\u00f3n de electrolito y la membrana de tefl\u00f3n cada 6-12 meses.</p> <p>Antes de hacer nada, revisa este datasheet (hoja de datos):</p> <p>https://files.atlas-scientific.com/Mini_DO_probe.pdf</p>"},{"location":"Resources/Education/AulaMar/OD/#como-preparar-el-sensor","title":"C\u00f3mo preparar el sensor","text":"<p>Existen varios tama\u00f1os para este sensor, en funci\u00f3n de la cantidad de soluci\u00f3n electrol\u00edtica que tenga. Revisa que el sensor tenga electrolito antes de usarlo.</p> <p>Es posible que veas formaci\u00f3n de Cloruro de Potasio (KCl) en la sonda. L\u00edmpialo con agua destilada, sin frotar fuerte, y \u00fasalo normalmente.</p> <p> FUENTE: ThermoScientific - KCl Creep</p> <p>Calibraci\u00f3n</p> <p>Si el sensor no est\u00e1 calibrado, sigue el procedimiento descrito en esta gu\u00eda</p>"},{"location":"Resources/Education/AulaMar/OD/#como-medir","title":"C\u00f3mo medir","text":"<p>Elige, en funci\u00f3n de si vas a tomar una muestra y luego medirla en laboratorio, o si vas a sumergir el sensor directamente</p>"},{"location":"Resources/Education/AulaMar/OD/#tomando-una-muestra","title":"Tomando una muestra","text":"<ol> <li>Introduce una botella m\u00e1s o menos a la mitad y deja que el agua entre en la botella muy lentamente. Si hay mucho movimiento, permite que el agua rebose un par de minutos, o al menos hasta que el agua se haya renovado dos o tres veces en la botella.</li> <li>Verifica que no hay burbujas de agua antes de sacar la botella del agua -  si hay alguna cerca del cuello de la botella, que es donde normalmente se acumulan, inclina la botella y deja que salgan.</li> <li>Llena la botella lo m\u00e1ximo posible para evitar que haya burbujas. Si al dar la vuelta a la botella hay burbujas, tira la muestra y vuelve a empezar.</li> <li>No uses embudos ni recipientes intermedios, ni eches el agua de un recipiente a otro, porque al hacerlo seguramente airear\u00e1s la muestra. Usa un tubo de goma y traspasa el agua de un recipiente a otro, con el extremo del tubo que est\u00e1 en el recipiente que quieres llenar, al fondo del mismo. Poco a poco, a medida que llenas el recipiente, intenta subir el extremo del tubo hasta que llegues al borde.</li> </ol>"},{"location":"Resources/Education/AulaMar/OD/#usando-el-sensor-directamente","title":"Usando el sensor directamente","text":"<ol> <li>Es necesario calibrar la sonda previamente, como se indica en el apartado anterior.</li> <li>Si tomas una muestra, hazlo evitando airearla, como se indica arriba.</li> <li>Introduce la sonda en la muestra y toma varias lecturas. Si tarda mucho tiempo en estabilizarse, remueve suavemente la sonda, \u00a1pero no la agites, porque podr\u00edas provocar cambios en la lectura!.</li> <li>Cuando las lecturas sean estables, toma ese valor como v\u00e1lido y an\u00f3talo. </li> </ol> <p>Un double-check nunca est\u00e1 de m\u00e1s</p> <p>Si puedes, revisa la medida con l\u00edquido calibrado despu\u00e9s de cada lectura.</p> <p></p>"},{"location":"Resources/Education/AulaMar/T/","title":"Temperatura","text":""},{"location":"Resources/Education/AulaMar/T/#que-es-la-temperatura-del-agua","title":"\u00bfQu\u00e9 es la temperatura del agua?","text":"<p>A nivel conceptual, la temperatura del agua puede ser algo muy simple: es un valor que indica c\u00f3mo de caliente o fr\u00edo se encuentra un cuerpo, objeto o, en este caso, l\u00edquido. Sin embargo, el agua, sobre todo en masas grandes, puede presentar enormes variaciones entre distintas partes: en la superficie vs. en profundidad, o en la orilla vs. aguas adentro.</p>"},{"location":"Resources/Education/AulaMar/T/#por-que-es-importante","title":"\u00bfPor qu\u00e9 es importante?","text":"<p>La temperatura es un factor muy importante, porque condiciona todos los otros factores del agua. Adem\u00e1s, es un factor ecol\u00f3gico de importancia considerable, y tiene influencia sobre los tipos de organismos que pueden vivir en el agua: normalmente, a mayor temperatura, mayor actividad biol\u00f3gica. Tiene un impacto directo en ox\u00edgeno disuelto (inverso - a mayor temperatura, menor ox\u00edgeno disuelto a igualdad de condiciones), adem\u00e1s de condicionar la velocidad a la que ocurren las reacciones qu\u00edmicas en el agua. Tiene impacto en disoluci\u00f3n de sales y metales y por ello tiene impacto en la conductividad el\u00e9ctrica.</p> <p>En el mar</p> <p>Est\u00e1 relacionado con la de la salinidad de las corrientes en el oc\u00e9ano, y en general, los cambios de temperatura en los oc\u00e9anos son debidos a los intercambios con la atm\u00f3sfera.</p>"},{"location":"Resources/Education/AulaMar/T/#como-medir-temperatura","title":"\u00bfC\u00f3mo medir temperatura?","text":"<p>Siempre que sea posible, toma lecturas usando la sonda de temperatura in situ, sumergi\u00e9ndola directamente en el agua. Intenta no afectar las medidas, cogiendo el term\u00f3metro lo m\u00e1s separado posible de la parte met\u00e1lica para evitar calentarlo. Si el term\u00f3metro necesita tiempo para estabilizarse, toma varias medidas y an\u00f3talas, junto con la hora, o toma la \u00faltima medida (y s\u00f3lo esa) c\u00f3mo v\u00e1lida.</p> <p>Si no es posible introducir el sensor en el agua, y necesitas tomar una muestra, estabiliza el recipiente para el muestreo antes de medir (sumergi\u00e9ndolo en agua para que se caliente/enfr\u00ede a la misma temperatura que la del agua).</p> <p>OJO!</p> <p>Revisa las especificaciones del sensor en el apartado inferior, porque tiene un tiempo de estabilizaci\u00f3n \u201clargo\u201d, de aproximadamente 13s.</p>"},{"location":"Resources/Education/AulaMar/T/#el-sensor","title":"El sensor","text":"<p>Para medir temperatura, usaremos un sensor resistivo (RTD, resistance temperature detector) del tipo PT1000 (hecho de platino, y con una resistencia a 0\u00baC de 1000\u03a9). Este sensor est\u00e1 encapsulado dentro de una punta de acero inoxidable, para conducir el calor muy eficientemente. Para poder usarlo a temperaturas m\u00e1s extremas, o fijarlo en una tuber\u00eda, usaremos un thermowell:</p> <p></p> <p>El sensor se puede sumergir completamente, y tiene las siguientes caracter\u00edsticas (aqu\u00ed citamos algunas, tienes todas en el datasheet):</p> <ul> <li>Rango: -200 a 850\u00baC (sin thermowell -55\u00b0C a 125\u00b0C)</li> <li>Precisi\u00f3n: \u00b1 (0.15 + (0.002*t))</li> <li>M\u00e1xima profundidad en agua: 70m</li> <li>Velocidad de respuesta: 90% in 13s</li> </ul> <p>Este tipo de sensor no necesita de mantenimiento ni recalibraci\u00f3n, \u00fanicamente limpieza peri\u00f3dica para retirar incrustaciones. Con usar un cepillo normal es suficiente.</p> <p>Antes de hacer nada, revisa este datasheet (hoja de datos):</p> <p>https://files.atlas-scientific.com/PT-1000-probe.pdf </p>"},{"location":"Resources/Education/AulaMar/pH/","title":"pH","text":""},{"location":"Resources/Education/AulaMar/pH/#que-es-el-ph","title":"\u00bfQu\u00e9 es el pH?","text":"<p>Definici\u00f3n</p> <p>El pH es una medida de acidez o alcalinidad de una disoluci\u00f3n acuosa. La definici\u00f3n formal es que el pH es un indicador de la concentraci\u00f3n de iones de hidr\u00f3geno presentes en soluciones acuosas. La concentraci\u00f3n de iones de hidr\u00f3geno se calcula como: </p>  pH = -log(\\alpha_H^+)  <p>Lo que esto quiere decir, es que a un pH m\u00e1s alto, hay menos iones de hidr\u00f3geno libres y que un cambio de una unidad de pH refleja un cambio de diez veces en la concentraci\u00f3n del ion de hidr\u00f3geno. Por ejemplo, hay 10 veces m\u00e1s iones de hidr\u00f3geno disponibles a un pH de 7 que a un pH de 8. La escala de pH va de 0 a 14, y un pH de 7 se considera neutro.  Las sustancias con pH inferior a 7 son \u00e1cidas; mientras que las sustancias con pH superior a 7 son b\u00e1sicas o alcalinas. Es un indicador de aguas que cambian qu\u00edmicamente.</p> <p>Extra ball</p> <p>Un concepto interesante relacionado con el pH es el de alcalinidad, que es la resistencia a cambios en el pH de una soluci\u00f3n.</p>"},{"location":"Resources/Education/AulaMar/pH/#por-que-es-importante","title":"\u00bfPor qu\u00e9 es importante?","text":"<p>El pH determina la solubilidad y la disponibilidad biol\u00f3gica de sustancias qu\u00edmicas como nutrientes (f\u00f3sforo, nitr\u00f3geno y carbono) y de metales pesados (plomo, cobre, cadmio, etc.). En otras palabras, indica qu\u00e9 cantidad de sustancias se puede disolver en el agua y qu\u00e9 cantidad puede ser utilizada por la seres vivos acu\u00e1ticos que la habitan. Por ejemplo, adem\u00e1s de afectar cu\u00e1nto y qu\u00e9 tipo de f\u00f3sforo es m\u00e1s abundante en el agua, el pH tambi\u00e9n determina si la vida acu\u00e1tica puede disponer de \u00e9l. En el caso de los metales pesados, el grado de solubilidad determina su toxicidad. Los metales tienden a ser m\u00e1s t\u00f3xicos a un pH m\u00e1s bajo porque son m\u00e1s solubles. </p> <p>En el caso de los nutrientes, un cambio en el pH puede aumentar la solubilidad del f\u00f3sforo, haci\u00e9ndolo m\u00e1s disponible para el crecimiento de las plantas y resultando en una mayor demanda a largo plazo de ox\u00edgeno disuelto. Normalmente, las condiciones de contaminaci\u00f3n del agua suelen corresponder a un aumento de la fotos\u00edntesis de las plantas, y hace que la contaminaci\u00f3n pueda provocar un aumento del pH a largo plazo. La preocupaci\u00f3n m\u00e1s com\u00fan son los cambios en el pH causados por la descarga de efluentes municipales o industriales. Sin embargo, el pH de la mayor\u00eda de los efluentes es bastante f\u00e1cil de controlar y, a menudo, se regula.</p> <p>En el mar</p> <p>El pH del agua de mar est\u00e1 normalmente en valores neutro-b\u00e1sicos moderados entre 7.4 y 8.5.</p> <p>El grado de pH presenta un rol importante en los ciclos de carbono oce\u00e1nico. Hay evidencia de que la acidificaci\u00f3n de los oc\u00e9anos se ha visto provocada por emisiones de CO2. El oc\u00e9ano absorbe aproximadamente el 30% de las emisiones de CO2 de la atm\u00f3sfera y, cuando esto pasa, se produce una reacci\u00f3n qu\u00edmica que genera iones de hidr\u00f3geno en el agua. Una mayor concentraci\u00f3n de iones de hidr\u00f3geno implica un pH m\u00e1s \u00e1cido. Como dec\u00edamos arriba, el pH determina la solubilidad y la disponibilidad de nutrientes para la vida acu\u00e1tica (Nitr\u00f3geno, f\u00f3sforo, etc.). Es decir, no s\u00f3lo indica si los seres vivos acu\u00e1ticos tienen nutrientes a su disposici\u00f3n, sino si lo pueden absorber. Un pH \u00e1cido podr\u00eda adem\u00e1s limitar el crecimiento de corales, y otras especies que viven fijas, como las ostras o los mejillones, que en aguas \u00e1cidas tendr\u00edan m\u00e1s dificultad para generar sus c\u00e1scaras.</p> <p>El oc\u00e9ano y la fotos\u00edntesis de sus organismos vegetales (fitoplancton en particular) absorben CO2 y producen ox\u00edgeno (O2). El oc\u00e9ano absorbe as\u00ed el 30% del CO2 del planeta y produce entre el 50% y el 75% del ox\u00edgeno que respiramos, dependiendo de las fuentes y zonas geogr\u00e1ficas. El calentamiento del oc\u00e9ano as\u00ed como su acidificaci\u00f3n ponen en peligro la supervivencia del fitoplancton, las praderas de faner\u00f3gamas marinas, los manglares y las marismas que son aut\u00e9nticas trampas de CO2. Sin embargo, el 20% de los manglares del planeta ya desaparecieron entre 1980 y 2005. Siempre m\u00e1s \u00e1cido, el oc\u00e9ano tambi\u00e9n ve aparecer zonas desoxigenadas fatales para la vida marina y para los  equilibrios globales.</p> <p>Impacto de la acidez</p> <p>La acidez del oc\u00e9ano ha sido la misma durante cien millones de a\u00f1os con un pH de 8,18 c. Al absorber el CO2 que producimos, ahora est\u00e1 en 8,08 y la tendencia se acelera. Concretamente, esto significa que el oc\u00e9ano ya es un 30% m\u00e1s \u00e1cido y ser\u00e1 un 50% m\u00e1s \u00e1cido en 2100. Con consecuencias directas sobre los animales marinos. </p> <ul> <li> <p>M\u00e1s CO2: La acidificaci\u00f3n de los oc\u00e9anos dificulta que los peque\u00f1os organismos marinos atrapen CO2 al construir sus caparazones.</p> </li> <li> <p>Menos coral: La acidificaci\u00f3n de los oc\u00e9anos provoca el blanqueamiento y la desaparici\u00f3n de los corales, que albergan el 25 % de las especies de peces y sustentan a m\u00e1s de mil millones de personas.</p> </li> <li> <p>Menos comida: La acidificaci\u00f3n de los oc\u00e9anos es corrosiva para las conchas de los peque\u00f1os caracoles marinos, que son el primer nivel de la cadena alimentaria.</p> </li> </ul> <p>Curiosidades</p> <p>Las aguas con pH alto (alcalino, b\u00e1sico) tienen un gusto amargo, y provocan dep\u00f3sitos en tuber\u00edas. Adem\u00e1s, puede cancelar el efecto del cloro a nivel desinfectante.</p> <p>Por el contrario, aguas con un pH bajo (\u00e1cido) tienden a provocar una mayor corrosi\u00f3n y disoluci\u00f3n de metales y otras substancias.</p>"},{"location":"Resources/Education/AulaMar/pH/#como-medir-ph","title":"\u00bfC\u00f3mo medir pH?","text":"<p>Los valores de pH pueden variar muy r\u00e1pidamente. Este par\u00e1metro se debe medir en campo inmediatamente despu\u00e9s de recoger la muestra. Se puede medir a posteriori en laboratorio, pero no ser\u00e1 completamente representativo. Para medirlo, por tanto, usaremos un sensor de pH.</p>"},{"location":"Resources/Education/AulaMar/pH/#el-sensor","title":"El sensor","text":"<p>Usaremos un sensor de pH, compuesto por una membrana de cristal (muy delicada) a trav\u00e9s de la cual algunos iones de Hidr\u00f3geno del agua pueden pasar y generar una corriente muy peque\u00f1a que mediremos en un electrodo.</p> <p></p> <p>FUENTE: Atlas Scientific</p> <p>El sensor se puede sumergir completamente, y tiene las siguientes caracter\u00edsticas (aqu\u00ed citamos algunas, tienes todas en el datasheet):</p> <ul> <li>Rango en pH: 1 a 13</li> <li>M\u00e1xima profundidad en agua: 35m</li> <li>Velocidad de respuesta: 95% en 4s</li> <li>Seguro para usar en alimentos/bebidas</li> </ul> <p>Antes de hacer nada, revisa este datasheet (hoja de datos):</p> <p>Si tu sensor es transparente (no amarillo): https://files.atlas-scientific.com/consumer-grade-pH-probe.pdf</p> <p>Si tu sensor es transparente y amarillo: https://files.atlas-scientific.com/lab-grade-pH-probe.pdf</p> <p>Si tu sensor es negro: https://files.atlas-scientific.com/lab-grade-pH-probe.pdf</p>"},{"location":"Resources/Education/AulaMar/pH/#como-preparar-el-sensor","title":"C\u00f3mo preparar el sensor","text":"<p>Calibraci\u00f3n</p> <p>Si el sensor no est\u00e1 calibrado, sigue el procedimiento descrito en esta gu\u00eda</p> <p>Para sacar el sensor del bote de protecci\u00f3n:</p> <p> FUENTE: Atlas Scientific</p> <p>El sensor de pH se debe mantener h\u00famedo durante la preparaci\u00f3n de la muestra. Es posible que veas formaci\u00f3n de Cloruro de Potasio (KCl) en la sonda. L\u00edmpialo con agua destilada, con cari\u00f1o, y \u00fasalo normalmente.</p> <p> FUENTE: ThermoScientific - KCl Creep</p> <p>\u00a1Tr\u00e1talo con cuidado!</p> <p>El sensor de pH es muy delicado, y tiene una esfera de cristal en la punta. \u00dasalo con cuidado, y sobre todo no lo golpees. No es buena idea sumergirlo en tierra o sustancias que sean dif\u00edciles de limpiar.</p> <p></p>"},{"location":"Resources/Education/AulaMar/pH/#como-medir","title":"C\u00f3mo medir","text":"<ol> <li>Calibra la sonda previamente, como se indica en el apartado anterior (en caso de que no lo hayas hecho ya, o no lo haya hecho nadie por ti)</li> <li>La muestra se puede tomar en un recipiente de cristal o de pl\u00e1stico. Simplemente, toma suficiente cantidad para que puedas sumergir la sonda. Limpia la sonda con el mismo agua que quieres medir (pero no el de la muestra) antes de introducir la sonda en el recipiente</li> <li>Introduce la sonda en la muestra y toma varias lecturas (en general 3 lecturas son suficientes). Cuando la sonda est\u00e9 sumergida en la muestra, mu\u00e9vela suavemente para que no queden burbujas de aire que puedan afectar a la medida. Si tarda mucho tiempo en estabilizarse, mu\u00e9vela suavemente, \u00a1pero no la agites, porque podr\u00edas provocar cambios en la lectura!</li> <li>Cuando las lecturas sean estables, toma ese valor como v\u00e1lido y an\u00f3talo.</li> <li>Repite la lectura 2 veces m\u00e1s. </li> </ol> <p>Recursos adicionales</p> <p>Sobre la acidificaci\u00f3n de los oc\u00e9anos y su impacto: https://www.noaa.gov/education/resource-collections/ocean-coasts/ocean-acidification</p>"},{"location":"Resources/Education/AulaMar/pH_extras/","title":"pH extras","text":""},{"location":"Resources/Education/AulaMar/pH_extras/#recursos-adicionales","title":"Recursos adicionales","text":"<p>https://www.noaa.gov/education/resource-collections/ocean-coasts/ocean-acidification</p>"},{"location":"Resources/Education/CLAB/","title":"CLAB","text":"<p>Context</p> <p>This content was created by FabLab Barcelona, in the context of the CLAB project - INNOVACI\u00d3N EN PROCESOS DE FABRICACI\u00d3N CIRCULAR Y ABIERTA PARA ENTORNOS EDUCATIVOS, funded by Aid program to support innovative business groups from the Ministry of Industry, Commerce and Tourism. Call 2022</p>"},{"location":"Resources/Education/CLAB/#tutorials","title":"Tutorials","text":"<p>Here you have a compilation of step by step tutorials on how to use some more extra features of the kit, or to make simple data analysis with Orange</p>"},{"location":"Resources/Education/CLAB/#basic-level","title":"Basic Level","text":""},{"location":"Resources/Education/CLAB/#configuring-the-sck","title":"Configuring the SCK","text":"<p>For these tutorials make sure you check how to use the Shell</p> <ul> <li>Using the Arduino serial monitor with the SCK</li> <li>Change data rate in the SCK</li> </ul> <p>Having issues?</p> <p>Check here how to debug the SCK!</p>"},{"location":"Resources/Education/CLAB/#data","title":"Data","text":"<p>These tutorials will help you go through some basic data analysis tools we like, such as Orange:</p> <ul> <li>Configure Orange Data Analysis</li> <li>Smart Citizen Orange Widgets</li> <li>Create a simple workflow for data analysis in Orange</li> <li>Orange and geolocated data</li> </ul> <p></p> <p>Orange workflows</p> <p>If you want to use some existing workflows, you can visit the Orange Workflows Repository https://github.com/fablabbcn/smartcitizen-docs/tree/master/docs/assets/ows</p>"},{"location":"Resources/Education/CLAB/#technical","title":"Technical","text":"<ul> <li>How to start with the SCK (onboarding)</li> <li>Get CSV data</li> <li>Upload SD card data</li> <li>Update WiFi Settings</li> </ul>"},{"location":"Resources/Education/CLAB/#other-references","title":"Other references","text":"<p>Previous works</p> <p>You can find previous references here</p> <p> Image credit: DOIT</p> <ul> <li>DOIT Toolkit - Measuring our environment (EN)- Future Learning Unit at Fablab Barcelona</li> <li>DOIT Toolkit - Midiendo nuestro entorno (ES)- Future Learning Unit at Fablab Barcelona</li> <li>AULAMAR - T\u00e9cnicas de Muestreo de agua (ES)</li> </ul>"},{"location":"Resources/Education/CLAB/#external-links","title":"External links","text":"<p>This is a compilation of friend projects in education, or other that we admire in general.</p>"},{"location":"Resources/Education/CLAB/#cat","title":"CAT","text":"<p>Projecte Atenci\u00f3 Atenci\u00f3 Project - Citizen Science empowerment for students XTEC</p>"},{"location":"Resources/Education/CLAB/#eng","title":"ENG","text":"<ul> <li>Smart Citizen User Guide Bibliolab Science and Healthy City</li> <li>A Citizen's Guide To Understanding and Monitoring Lakes and Streams</li> </ul> <p> Image credit: DOIT</p>"},{"location":"Resources/Education/Technical%20Modules/","title":"Macro Rendering Error","text":"<p>FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/smartcitizen-docs/smartcitizen-docs/aux/tags.md'</p> <pre><code>Traceback (most recent call last):\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/mkdocs_macros/plugin.py\", line 480, in render\n    return md_template.render(**page_variables)\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/jinja2/environment.py\", line 1301, in render\n    self.environment.handle_exception()\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/jinja2/environment.py\", line 936, in handle_exception\n    raise rewrite_traceback_stack(source=source)\n  File \"&lt;template&gt;\", line 3, in top-level template code\n  File \"/home/runner/work/smartcitizen-docs/smartcitizen-docs/main.py\", line 133, in get_cards\n    return template.render(tags=include_tags('aux/tags.md', tags), full=full)\n  File \"/home/runner/work/smartcitizen-docs/smartcitizen-docs/main.py\", line 30, in include_tags\n    with open(full_filename, 'r') as file:\nFileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/smartcitizen-docs/smartcitizen-docs/aux/tags.md'\n</code></pre>"},{"location":"Resources/Education/Technical%20Modules/es/Calibration/Water/","title":"Water Calibration","text":"","tags":["water","hardware","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Calibration/Water/#calibracion","title":"Calibraci\u00f3n","text":"<p>Los sensores de agua necesitan una calibraci\u00f3n inicial para poder ser usados correctamente. De los diferentes sensores soportados, revisa cu\u00e1les necesitan calibraci\u00f3n en la tabla de arriba.</p> <p>Documentaci\u00f3n</p> <p>La calibraci\u00f3n de los sensores puede ser un proceso un poco m\u00e1s complejo, ya que requiere que conozcas c\u00f3mo usar la Shell del SCK.</p> <p>Si ya est\u00e1s familiarizado con ella, puedes seguir la siguiente gu\u00eda para realizar el procedimiento.</p>","tags":["water","hardware","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/","title":"Macro Rendering Error","text":"<p>FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/smartcitizen-docs/smartcitizen-docs/aux/tags.md'</p> <pre><code>Traceback (most recent call last):\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/mkdocs_macros/plugin.py\", line 480, in render\n    return md_template.render(**page_variables)\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/jinja2/environment.py\", line 1301, in render\n    self.environment.handle_exception()\n  File \"/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/jinja2/environment.py\", line 936, in handle_exception\n    raise rewrite_traceback_stack(source=source)\n  File \"&lt;template&gt;\", line 1, in top-level template code\n  File \"/home/runner/work/smartcitizen-docs/smartcitizen-docs/main.py\", line 133, in get_cards\n    return template.render(tags=include_tags('aux/tags.md', tags), full=full)\n  File \"/home/runner/work/smartcitizen-docs/smartcitizen-docs/main.py\", line 30, in include_tags\n    with open(full_filename, 'r') as file:\nFileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/smartcitizen-docs/smartcitizen-docs/aux/tags.md'\n</code></pre>"},{"location":"Resources/Education/Technical%20Modules/es/Datos/dashboard/","title":"Dashboard","text":"","tags":["data","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/dashboard/#dashboard","title":"Dashboard","text":"<p>El dashboard es una herramienta web muy sencilla que nos permite explorar los datos de un kit de forma r\u00e1pida.</p> <p></p> <p>Se puede utilizar sin gr\u00e1ficos (click en el icono \ud83d\udee0\ufe0f y desmarca Show Graphs):</p> <p></p> <p>Hacking it</p> <p>Si fijas un intervalo de lectura r\u00e1pido (aqu\u00ed tienes c\u00f3mo hacerlo) puedes usar este modo para ver los valores evolucionar mientras haces un experimento.</p>","tags":["data","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/platform/","title":"Plataforma","text":"","tags":["data","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/platform/#plataforma","title":"Plataforma","text":"<p>La plataforma web de Smart Citizen permite realizar las siguientes funciones:</p> <ul> <li>Navegaci\u00f3n geolocalizada y visualizaci\u00f3n de datos por dispositivo</li> <li>Gesti\u00f3n del perfil de usuario y edici\u00f3n de kits</li> <li>Subida de datos de SCKs sin conectividad con SD card</li> <li>Descarga de datos en CSV</li> </ul>","tags":["data","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/platform/#api","title":"API","text":"<p>El API de Smart Citizen te permite descargar informaci\u00f3n de tus dispositivos y hacer cosas chulas con ellos.</p> <p>Es un API REST y te retorna los datos en formato JSON. Esto quiere decir que puedes acceder de forma f\u00e1cil la informaci\u00f3n desde cualquier lenguaje de programaci\u00f3n Javascript, PHP, processing, Python, ... y empezar a hacer cosas muy r\u00e1pidamente.</p>","tags":["data","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/platform/#usando-scripts","title":"Usando scripts","text":"<p>Si quieres avanzar m\u00e1s r\u00e1pido, hemos preparado una serie de ejemplos y librer\u00edas en python en scdata. scdata es un paquete de <code>python</code> que te permite descargar, visualizar y analizar datos de forma r\u00e1pida. Revisa los ejemplos en el repositorio de git.</p> <p>Ejemplos extras</p> <p>Hay otros muchos ejemplos en otros lenguajes de programaci\u00f3n en el repositorio de smartcitizen-toolkit. En \u00e9l encontrar\u00e1s c\u00f3mo acceder a los datos desde processing, o nodered.</p>","tags":["data","education","intermediate level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/sdcard/","title":"SD-card","text":"","tags":["data","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Datos/sdcard/#sd-card","title":"SD-card","text":"<p>Siempre que haya una SD-card presente, el SCK grabar\u00e1 los datos en la misma en formato CSV.</p> <p>Es posible que veas algunos archivos raros en la SD-card, con extensiones como <code>(.01, .02...)</code>. Estos ficheros son en realidad ficheros CSV, pero que el kit necesita renombrar cada vez que ocurre un <code>reset</code> para evitar corromper la SDcard. </p> <p>Reset</p> <p>Cada vez que ocurre un reset, bien manual (con el bot\u00f3n o desconectando la alimentaci\u00f3n), o bien peri\u00f3dico, un fichero nuevo se genera.</p> <p>Cada noche, ocurre un reset de sanidad para asegurar que todo funciona correctamente y que el SCK no se bloquea. Este reset ocurre a las 3-4am (en CET), para evitar que perdamos datos si hay alg\u00fan problema con el kit. Los ficheros en la SD card se generan secuencialmente como YY-MM-DD.01, .02\u2026 dependiendo del n\u00famero de reset que ocurren en un d\u00eda. Puedes simplemente renombrar los ficheros de YY-MM-DD.01 a YY-MM-DD_01.CSV. Tambi\u00e9n puedes revisar esta gu\u00eda para automatizar este proceso.</p>","tags":["data","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Hardware/","title":"Hardware","text":"","tags":["basics","hardware","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Hardware/#hardware","title":"Hardware","text":"<p>El hardware est\u00e1 construido de forma modular y con la idea de ser un kit, por tanto, no una soluci\u00f3n t\u00e9cnica cerrada (en ning\u00fan sentido).</p> <p></p> <p>El Smart Citizen Kit (SCK) es n\u00facleo de un sistema modular de hardware y software cuya intenci\u00f3n es proporcionar herramientas de monitorizaci\u00f3n ambiental, tanto en ciencia ciudadana como en investigaci\u00f3n. El sistema se compone de los siguientes elementos:</p> <ul> <li>Data Board: data-logger con conectividad Wi-Fi y micro SD-card, a la cual se conectan el resto de componentes.</li> </ul> <p></p> <ul> <li> <p>Sensores, dependiendo del entorno a monitorizar y de la complejidad buscada, existen diferentes formas de conectar sensores al SCK:</p> <ul> <li> <p>Urban Sensor Board: placa que contiene una selecci\u00f3n de sensores de bajo coste para medir par\u00e1metros de calidad de aire, as\u00ed como un conector para un sensor de part\u00edculas externo.</p> <p></p> </li> <li> <p>Sensores de aire: sensores que permiten medir la calidad de aire y diferentes contaminantes. Suelen ser m\u00e1s avanzados y un poco m\u00e1s complejos de analizar</p> <p></p> </li> <li> <p>Sensores de agua: basados en los sensores de Atlas Scientific y otras soluciones, se puede medir par\u00e1metros f\u00edsico-qu\u00edmicos en el agua como pH, ox\u00edgeno disuelto, temperatura, turbidez, entre otros</p> <p></p> </li> </ul> </li> </ul>","tags":["basics","hardware","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Interface/","title":"Interface","text":"","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Interface/#modos-de-operacion","title":"Modos de operaci\u00f3n","text":"<p>El kit tiene tres modos fundamentales de operaci\u00f3n: modo configuraci\u00f3n, modo grabaci\u00f3n online y modo grabaci\u00f3n offline o SD-card. En el modo configuraci\u00f3n, el kit no grabar\u00e1 nada, pero nos permite seleccionar el modo en que vamos a grabar los datos (online o en la micro SD-card). Para empezar, seguiremos el proceso de onboarding.</p> <p>Documentaci\u00f3n</p> <p>Los modos se representan mediante distintos colores en el LED, y est\u00e1n documentados en la siguiente p\u00e1gina de la documentaci\u00f3n.</p>","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Interface/#interfaz-de-usuario","title":"Interfaz de usuario","text":"<p>El usuario tambi\u00e9n tiene la posibilidad de cambiar el modo de operaci\u00f3n a trav\u00e9s del bot\u00f3n:</p> <p></p> <p>Documentaci\u00f3n</p> <p>Las interfaces se encuentran documentadas en la siguiente p\u00e1gina de la documentaci\u00f3n</p> <p>Adem\u00e1s, existe un bot\u00f3n de reset (un poco m\u00e1s oculto), para que puedas resetear el kit:</p> <p></p>","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Onboarding/","title":"Onboarding","text":"","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Onboarding/#puesta-en-marcha","title":"Puesta en marcha","text":"<p>El onboarding es una interfaz web que permite configurar el SCK en el modo deseado y asignar el dispositivo a un perfil de usuario en la plataforma. </p> <p>Es importante entender que un mismo dispositivo f\u00edsico puede tener ser asignado a diferentes dispositivos en la plataforma, aunque s\u00f3lo puede enviar datos a uno de ellos simult\u00e1neamente. La manera de conectar ambos se realiza a trav\u00e9s del token, el cual se asigna durante el procedimiento de onboarding, y se asocia a un dispositivo en la plataforma. Este token se introduce en el dispositivo f\u00edsico en configuraci\u00f3n a trav\u00e9s de una interfaz m\u00f3vil, as\u00ed como las credenciales Wi-Fi (SSID y contrase\u00f1a).</p> <p>Documentaci\u00f3n</p> <p>El proceso de onboarding nos guiar\u00e1 en las distintas etapas de configuraci\u00f3n, y est\u00e1 detallado en esta p\u00e1gina de la documentaci\u00f3n</p>","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Water/","title":"Water Sensors","text":"","tags":["basics","education","basic level"]},{"location":"Resources/Education/Technical%20Modules/es/Intro/Water/#sensores-de-agua","title":"Sensores de agua","text":"<p>Los sensores soportados para este sistema son:</p> M\u00e9trica Uso Sonda Driver Calibraci\u00f3n Temperatura Suelo y agua Atlas PT-100 + PT-1000 Atlas EZO-RTD No necesaria pH Agua Atlas ENV-40-PH or ENV-35-PH Atlas EZO-PH Atlas CHEM-PH pH Suelo Atlas ENV-45-PH Atlas EZO-PH Atlas CHEM-PH Conductividad el\u00e9ctrica, S\u00f3lidos disueltos totales y Salinidad Suelo y Agua Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Ox\u00edgeno disuelto y Saturaci\u00f3n de Ox\u00edgeno Agua Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Humedad del Suelo Suelo Catnip Chirp! na Vaso de agua","tags":["basics","education","basic level"]},{"location":"Resources/Tutorials/","title":"Tutorials","text":"<p>Here you have a compilation of step by step tutorials on how to use some more extra features of the kit, or to make simple data analysis with Orange</p>"},{"location":"Resources/Tutorials/#basic-level","title":"Basic Level","text":""},{"location":"Resources/Tutorials/#configuring-the-sck","title":"Configuring the SCK","text":"<p>For these tutorials make sure you check how to use the Shell</p> <ul> <li>Using the Arduino serial monitor with the SCK</li> <li>Change data rate in the SCK</li> </ul> <p>Having issues?</p> <p>Check here how to debug the SCK!</p>"},{"location":"Resources/Tutorials/#data","title":"Data","text":"<p>These tutorials will help you go through some basic data analysis tools we like, such as Orange:</p> <ul> <li>Configure Orange Data Analysis</li> <li>Smart Citizen Orange Widgets</li> <li>Create a simple workflow for data analysis in Orange</li> <li>Orange and geolocated data</li> </ul> <p></p> <p>Orange workflows</p> <p>If you want to use some existing workflows, you can visit the Orange Workflows Repository https://github.com/fablabbcn/smartcitizen-docs/tree/master/docs/assets/ows</p>"},{"location":"Resources/Tutorials/#technical","title":"Technical","text":"<ul> <li>How to start with the SCK (onboarding)</li> <li>Get CSV data</li> <li>Upload SD card data</li> <li>Update WiFi Settings</li> </ul>"},{"location":"Resources/Tutorials/Arduino%20Serial/","title":"Using the Arduino serial monitor with the SCK","text":"<p>This tutorial is useful for testing the data recorded in real time and live demostrations. </p> <p>Time estimated: 15 minutes + 15 minutes if you don't have Arduino IDE installed. </p> <p>Requisites: </p> <ul> <li> <p>Smartcitizen Kit that we want to configure.</p> </li> <li> <p>MicroUSB cable.</p> </li> <li> <p>A computer where we're going to configure it. </p> </li> <li> <p>Have Arduino IDE installed or other serial monitor installed (or knowledge about using it through terminal). You can download it from here</p> </li> </ul>"},{"location":"Resources/Tutorials/Arduino%20Serial/#connect-your-kit-to-your-computer","title":"Connect your kit to your Computer","text":"<p>Connect the MicroUSB cable to the Smartcitizen kit </p> <p></p> <p>And the USB to your computer</p> <p></p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#open-the-arduino-ide-and-connect-to-the-kit","title":"Open the Arduino IDE and connect to the kit","text":"<p>We are opening the Arduino IDE. (the screenshots are done Arduino 2.0 in windows) If this is your first start with Arduino IDE we are just focusing in a couple of things</p> <p>Set your port. For doing that we are going to go to  Tools-&gt;Port and we select to the port that says something like \"(Arduino Zero (Native USB Port))\" or \"(Arduino/Genuino Zero (Autodetect Port))\" in MAC or linux. </p> <p></p> <p>If this is your first start it might be asking you to set the Board. You can do it by going again into Tools-&gt;Boards and you set any of them (for example Arduino UNO). </p> <p>Warning</p> <p>Connection troubleshooting</p> <p>\"Couldn't open serial plotter\"</p> <p></p> <p>Check if the USB is properly connected and then, revise if the port is properly selected. Last, check if there is a board selected. </p> <p>If the cable is connected but it's not being recognized by the Arduino IDE, try to reset the smartcitizen kit using the reset button</p> <p></p> <p>Info</p> <p>Alternativately, in Arduino IDE 2.x you can select the port from the display on the top</p> <p></p> <p>If you do, you're going to be asked probably to install the specific board of the board that the smartcitizen has on the bottom. </p> <p></p> <p>You can just follow the steps of installing the board (you may have some warnings from Windows of needing permissions)</p> <p></p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#brief-explanation-of-the-serial-plotter","title":"Brief explanation of the serial plotter","text":"<p>Info</p> <p>More information about serial plotter in Arduino IDE with tutorials:</p> <p>https://docs.arduino.cc/software/ide-v2/tutorials/ide-v2-serial-plotter [EN]</p> <p>https://arduino.cl/como-usar-el-serial-plotter-en-arduino-ide/ [ES]</p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#use-commands-to-select-the-plotting-device","title":"Use commands to select the plotting device.","text":"<p>When you open the serial plotter you will have something like this</p> <p></p> <p>It's important to check the bottom part where it should say \"Carriage Return\" and 115200 baud. </p> <p></p> <p>In the box of \"Type Message\" we can send message to the smartcitizen kit. </p> <p>Info</p> <p>If you want to know more about the available commands you can visit the information about using the shell https://docs.smartcitizen.me/Guides/getting%20started/Using%20the%20Shell/#connectivity-or-configuration-issues</p> <p>These commands are without timestamp and they are usually seen in \"value2\", they will change at very high speed.</p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#noise","title":"Noise","text":"<p>Input this command: </p> <pre><code>monitor noise -notime -noms\n</code></pre> <p>You will get something like this. </p> <p></p> <p>You will get the data in dBA. You can try to clap or stay quiet to keep the noise levels low. </p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#light","title":"Light","text":"<p>Input this command: </p> <pre><code>monitor light -notime -noms\n</code></pre> <p>You will get something like this. </p> <p></p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#temperature","title":"Temperature","text":"<p>Input this command: </p> <pre><code>monitor temp -notime -noms\n</code></pre> <p>You will get something like this.  </p> <p>The output will be in \u00baC. </p> <p>You can put your finger into the temp and humidity sensor to see how it changes over time and go back to normal. </p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#humidity","title":"Humidity","text":"<p>Input this command: </p> <pre><code>monitor humidity -notime -noms\n</code></pre> <p>You will get something like this. </p> <p></p> <p>The output is in % of total humidity. </p> <p>You can put your finger into the temp and humidity sensor to see how it changes over time and go back to normal. </p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#pressure","title":"Pressure","text":"<p>Input this command: </p> <pre><code>monitor pressure -notime -noms\n</code></pre> <p>You will get something like this. </p> <p></p> <p>The output is in kPa </p> <p>You can put your finger and actually press into the barometric pressure sensor to see how it changes over time and go back to normal.</p>"},{"location":"Resources/Tutorials/Arduino%20Serial/#voc-gas-ccs811","title":"VOC Gas CCS811","text":"<p>Input this command: </p> <pre><code>monitor VOC -notime -noms\n</code></pre>"},{"location":"Resources/Tutorials/Arduino%20Serial/#eco2-gas-ccs811","title":"eCO2 Gas CCS811","text":"<p>Input this command: </p> <pre><code>monitor eCO2 -notime -noms\n</code></pre>"},{"location":"Resources/Tutorials/Arduino%20Serial/#pm-10","title":"PM 1.0","text":"<p>Input this command: </p> <pre><code>monitor pm -notime -noms\n</code></pre>"},{"location":"Resources/Tutorials/Arduino%20Serial/#pm-25","title":"PM 2.5","text":"<p>Input this command: </p> <pre><code>monitor PM 2.5 -notime -noms\n</code></pre>"},{"location":"Resources/Tutorials/Arduino%20Serial/#pm-100","title":"PM 10.0","text":"<p>Input this command: </p> <pre><code>monitor PM 10 -notime -noms\n</code></pre>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/","title":"Change data rate in the SCK","text":"<p>This tutorial is useful for changing the default data update. This is useful for doing live demostrations</p> <p>Time estimated: 15 minutes + 15 minutes if you don't have Arduino IDE installed. </p> <p>Requisites: </p> <ul> <li> <p>Smartcitizen Kit that we want to configure.</p> </li> <li> <p>MicroUSB cable.</p> </li> <li> <p>A computer where we're going to configure it. </p> </li> <li> <p>Have Arduino IDE installed or other serial monitor installed (or knowledge about using it through terminal). You can download it from here</p> </li> </ul>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#connect-your-kit-to-your-computer","title":"Connect your kit to your Computer","text":"<p>Connect the MicroUSB cable to the Smartcitizen kit </p> <p></p> <p>And the USB to your computer</p> <p></p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#open-the-arduino-ide-and-connect-to-the-kit","title":"Open the Arduino IDE and connect to the kit","text":"<p>We are opening the Arduino IDE. (the screenshots are done Arduino 2.0 in windows) If this is your first start with Arduino IDE we are just focusing in a couple of things</p> <p>Set your port. For doing that we are going to go to  Tools-&gt;Port and we select to the port that says something like \"(Arduino Zero (Native USB Port))\" or \"(Arduino/Genuino Zero (Autodetect Port))\" in MAC or linux. </p> <p></p> <p>If this is your first start it might be asking you to set the Board. You can do it by going again into Tools-&gt;Boards and you set any of them (for example Arduino UNO). </p> <p></p> <p>Now you can open the serial monitor display going to tools -&gt; Serial Monitor</p> <p></p> <p>In Arduino IDE 2.0 (the newer version) you will see the serial monitor in the bottom of the screen. In older Arduino IDE you will get a pop up window. </p> <p>Check that is set as \"Carriage Return\" and it's set to 115200 bauds as the image below: </p> <p></p> <p>Info</p> <p>It might give you some text even if you don't type anything. This is normal and it means that the smartcitizen is properly connected.   If this happens, you can continue to input the command.</p> <p>To check if everything works as spected you can type \"help\" in the box where it says \"Message (Enter to send message to..)\" and you will get something like this. </p> <p> This is the list of the possible commands of the shell of smartcitizen</p> <p>If this happens, you can continue to the next step. </p> <p>Warning</p> <p>Connection troubleshooting</p> <p>\"Not connected. Select a board and a port to connect automatically.\"</p> <p></p> <p>Check if the USB is properly connected and then, revise if the port is properly selected. Last, check if there is a board selected. </p> <p>If the cable is connected but it's not being recognized by the Arduino IDE, try to reset the smartcitizen kit using the reset button</p> <p></p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#the-command-that-we-have-to-use","title":"The command that we have to use","text":"<p>To state a \"real time sensing\" of the smartcitizen you need to state this command in the command line and press ENTER: </p> <p><pre><code>config -pubint 5 -readint 5\n</code></pre> You will get something like this</p> <p></p> <p>Warning</p> <p>This setup consumes the battery very fast. It's useful for doing a class, but if you're using the smartcitizen with the battery be sure to Set up the default reading and uploading rate to default after the showcase</p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#setting-up-the-default-after-using-the-real-time","title":"Setting up the default after using the real time","text":"<p>Using the 5 s update is going to take a lot of time</p> <p>To restore the default upload rate you have to put this command and press ENTER.  <pre><code>config -pubint 180 -readint 60\n</code></pre></p> <p>You will get something like this</p> <p>And then  <pre><code>sensor pm -interval 300\n</code></pre></p> <p>To get more explanations about how these codes work you can use help command or you can check the guide about Using the Shell</p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#how-to-check-it-out","title":"How to check it out","text":"<p>You can either use dashboard.smartcitizen.me or smartcitizen.me/kits/ to check your own kit.</p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#platform","title":"Platform","text":"<p>Access martcitizen.me/kits and filter the kits to find yours. </p> <p></p> <p>Once you have it you will find this data below</p> <p></p> <p>You will see that the data is updated more less every 6 seconds (5 seconds + the delay to post it into the platform)</p>"},{"location":"Resources/Tutorials/Change%20data%20rate%20in%20the%20SCK/#dashboard","title":"Dashboard","text":"<p>Access dashboard.smartcitizen.me and filter the kits to find yours</p> <p></p> <p>You can use your user, the name of the kit, the city or any data and the search tool is going to find it. </p> <p>Click on the name of the kit once you have found it. </p> <p>You will see something like this of the chosen kit:</p> <p></p> <p>Then, click on \ud83d\udee0\ufe0f, the setup icon on the top right. </p> <p></p> <p>Then it will open up a bar on the right in blue. Here you need to press the button of SHOW GRAPHS</p> <p></p> <p>Then you will get this information on the web:</p> <p>press again the \ud83d\udee0\ufe0f icon to close the menu on the right</p> <p></p> <p>Info</p> <p>You can use the menu for filter the values that you're more interested on. </p> <p>You will see that the data is updated more less every 6 seconds (5 seconds + the delay to post it into the platform)</p>"},{"location":"Resources/Tutorials/Configure%20Orange%20Data%20Analysis/","title":"Tutorial. How to install and configure Orange to make data analysis.","text":""},{"location":"Resources/Tutorials/Configure%20Orange%20Data%20Analysis/#install-orange","title":"Install Orange","text":"<p>Warning</p> <p>You might need admin permissions and you need internet connection</p> <p>Go to the download page of Orange:</p> <p>https://orangedatamining.com/download/</p> <p>Choose your OS and follow the instructions</p> <p>It will also install \"miniconda\". </p>"},{"location":"Resources/Tutorials/Configure%20Orange%20Data%20Analysis/#install-add-ons","title":"Install add-ons","text":"<p>Once you have installed Orange open it and you will see something similar to this:</p> <p></p> <p>You can check the documentation, examples and tutorials from orange. You can dismiss or use that documentation to get familiarized with orange. </p> <p>We will need to install 3 add-ons</p> <ul> <li>Mecoda-orange</li> <li>Timeseries</li> <li>Geo (in the case of using GPS)</li> </ul>"},{"location":"Resources/Tutorials/Configure%20Orange%20Data%20Analysis/#steps-for-installing","title":"Steps for installing","text":"<p>Info</p> <p>Mecoda is a package of widgets for Orange to access data from Minka, Odour Collect, canAIRio, Ictio, Natusfera or Smart Citizen.</p> <p>These steps are also explained here: https://github.com/eosc-cos4cloud/mecoda-orange/blob/master/docs/installation_and_user_guide.md</p> <p>Go to Options -&gt; Add-ons... and you will see a window like this. We need to press \"Add more...\"</p> <p></p> <p>You will see a pop-up window asking for the name</p> <p></p> <p>We write \"mecoda-orange\" and we press add.</p> <p>Now we will find in the previous window a new addion called \"Mecoda Orange\"</p> <p>Now we need to select all the extensions that we want to install from the list. </p> <p>When you sellect them in the collumn action it will say \"Install\"</p> <p></p> <p>In our case we need to select:</p> <ul> <li>Mecoda Orange</li> <li>Timeseries</li> <li>Geo</li> </ul> <p>After that we press OK. </p> <p>It may take some time to install the packages</p> <p></p> <p>You may need to restart Orange to the changes to take effect. </p> <p></p>"},{"location":"Resources/Tutorials/Configure%20Orange%20Data%20Analysis/#check-if-everything-is-installed","title":"Check if everything is installed","text":"<p>If the installation was correct in Orange in the panel on the left you will se new panels of widgets available. (MECODA, Time Series, Geo)</p> <p></p> <p>If you open MECODA you will find the widgets for Smart Citien (Smart citizen Search and Smart Citizen Data) between the others. </p> <p></p> <p>If everything is as expected, the add-ons are correctly installed. </p>"},{"location":"Resources/Tutorials/Orange%20and%20geolocated%20data/","title":"Tutorial of creating a map workflow in orange with SmartCitizen","text":"<p>This is a tutorial meant for someone who hasn't used orange at all to create a very simple, but powerful, workflow that has some geographical data. </p> <p>Requisites</p> <ul> <li>Having installed orange and the add-ons of mecoda-orange  and time series. Here you can find instructions about how to do it</li> <li>Using a kit that has a GPS installed</li> <li>Knowing the kit and the timespan that you want to analyse</li> </ul>"},{"location":"Resources/Tutorials/Orange%20and%20geolocated%20data/#look-for-the-kit-that-you-want-to-use","title":"Look for the kit that you want to use","text":"<p>We're starting from a new file, a white canvas for this example. </p> <p>To start using it we need to click on it in the widgets menu on the left for the widget of Smart Citizen Search. We select the Smart Citizen Search widget from the MECODA extension. </p> <p>It will create the widget on the canvas on the right</p> <p></p> <p>If you click on it it will pop up a window with the available options</p> <p></p> <p>We need to press \"Search devices\" in order to get some data. </p> <p>Here you can try to find your Kit. There are several options  to retrieve this information but in this case we have the URL of our kit</p> <p>https://smartcitizen.me/kits/14471</p> <p>This URL tells us the Device ID that we want at the end of the URL (in this case 14471).</p> <p>If you want to use the map to find your kit follow this instructions.</p> <p>Go to </p> <p>https://smartcitizen.me/kits/</p> <p>Find your kit in the map and select it. </p> <p>For example: </p> <p></p> <p>When you select it the URL of the site will change, in this case to</p> <p>https://smartcitizen.me/kits/14471</p> <p>Here you have the device id in the URL at the end. In this case it's 15618. </p> <p>Once we have it we type it or paste it in Device ID and press \"Search Devices\"</p> <p></p> <p>It will tell us that we have just one data because the icon of exit says that there is only one data. </p> <p></p> <p>Now that we have only just one device we need to retrieve the data that is stored in it. </p>"},{"location":"Resources/Tutorials/Orange%20and%20geolocated%20data/#get-the-data-from-the-kit","title":"Get the data from the kit","text":"<p>Now we need to add another widget from the tools that we have on the left. To do that we click ond the widget Smart Citizen Data </p> <p></p> <p>When we press it it will be set in the canvas near the other widget of Smart Citizen Search that we have already configured.</p> <p></p> <p>We need to connect both of them pressing the dotted lines on the right of the Smart Cizizen Search and dragging the cursor into the Smart Citizen Data. Once you have it would look like this: </p> <p></p> <p>To see if everything is correct we can click on Smart Citizen Data and we can click on it and check it out</p> <p></p> <p>If the Info panel from the image above says the same that yours it will mean that it's working. </p> <p>Now we're setting up the data that we want to collect. In this example we're getting all the data, so we can leave it as it is and just press Get data to fetch the data. </p> <p>It will take some seconds to fetch the data from the back end of smart citizen and it will have in the Info panel \"Device 14471 data downloaded!\"</p>"},{"location":"Resources/Tutorials/Orange%20and%20geolocated%20data/#see-the-data-in-a-table","title":"See the data in a table","text":"<p>The next step we can look at it as a table. To do that we need to use the widget Data table from the left menu in \"Data\"</p> <p></p> <p>We click on it as we have clicked on other widgets and it will appear on the canvas</p> <p></p> <p>We connect it to the Smart Citizen Data dragging the data from the Smart Citizen Data to the Data Table like this:</p> <p></p> <p>If we open it we'll see the data that we have gathered clicking on it. If we scroll to the right using the scroll at the bottom we'll see that we have a column with Latitude and other with Longitude</p> <p></p> <p>The Data tables have more propierties that are explained here:  https://orange3.readthedocs.io/projects/orange-visual-programming/en/latest/widgets/data/datatable.html</p> <p>Now we add one more widget to print this data in a map. </p>"},{"location":"Resources/Tutorials/Orange%20and%20geolocated%20data/#create-the-map-using-geo-map-widget","title":"Create the map using Geo Map widget","text":"<p>Now we go to the panel on the left that says \"Geo\" and we click on Geo Map to add the Geo Map widget. </p> <p></p> <p>It will look like this</p> <p></p> <p>As we have done before, we connect the data table into the Geo Map dragging from the right of the data table (the output) to the left of the geo map (the input)</p> <p>We can open it and we'll see something like this</p> <p></p> <p>In this case we can see the timing of different samples in colour being the bluest the oldest and the most yellow the newest. </p> <p>We can adjust ussing the attributes on the left part of the GUI to see where are the places with, i.e more temperature.</p> <p>Info</p> <p>All the data that doesn't have latitude and longitude is ignored by default</p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/","title":"Create a simple workflow for data analysis in Orange","text":"<p>This is a tutorial meant for someone who hasn't used orange at all to create a very simple, but powerful, workflow. </p> <p>Requisites</p> <ul> <li>Having installed orange and the add-ons of mecoda-orange  and time series. Here you can see the tutorial</li> <li>Knowing the kit and the timespan that you want to analyse</li> </ul>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#look-for-the-kit-that-you-want-to-use","title":"Look for the kit that you want to use","text":"<p>We're starting from a new file, a white canvas for this example. </p> <p>To start using it we need to click on it in the widgets menu on the left for the widget of Smart Citizen Search. We select the Smart Citizen Search widget from the MECODA extension. </p> <p>It will create the widget on the canvas on the right</p> <p></p> <p>If you click on it it will pop up a window with the available options</p> <p></p> <p>We need to press \"Search devices\" in order to get some data. </p> <p>Here you can try to find your Kit. There are several options  to retrieve this information but in this case we have the URL of our kit</p> <p>https://smartcitizen.me/kits/15618</p> <p>This URL tells us the Device ID that we want at the end of the URL (in this case 15618).</p> <p>:::spoiler If you want to use the map to find your kit follow this instructions.</p> <p>Go to </p> <p>https://smartcitizen.me/kits/</p> <p>Find your kit in the map and select it. </p> <p>For example: </p> <p></p> <p>When you select it the URL of the site will change, in this case to</p> <p>https://smartcitizen.me/kits/15618</p> <p>Here you have the device id in the URL at the end. In this case it's 15618. </p> <p>:::</p> <p>Once we have it we type it or paste it in Device ID and press \"Search Devices\"</p> <p></p> <p>It will tell us that we have just one data because the icon of exit says that there is only one data. </p> <p></p> <p>Now that we have only just one device we need to retrieve the data that is stored in it. </p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#get-the-data-from-the-kit","title":"Get the data from the kit","text":"<p>Now we need to add another widget from the tools that we have on the left. To do that we click ond the widget Smart Citizen Data </p> <p></p> <p>When we press it it will be set in the canvas near the other widget of Smart Citizen Search that we have already configured.</p> <p></p> <p>We need to connect both of them pressing the dotted lines on the right of the Smart Cizizen Search and dragging the cursor into the Smart Citizen Data. Once you have it would look like this: </p> <p></p> <p>To see if everything is correct we can click on Smart Citizen Data and we can click on it and check it out</p> <p></p> <p>If the Info panel from the image above says the same that yours it will mean that it's working. </p> <p>Now we're setting up the data that we want to collect. In this example we're getting the data that we have every 10 minutes (10 minutes) and we want to get just from one month. From first of october of 2022 to the last day of that month. </p> <p>To do that we set rollup in 10 and the rollup units in m (minutes). (that's the setting by default) Then we set Initial Date to 2022-10-01 and End Date to 2022-11-01. And we tick off the box of Resample data. You will have something like this:</p> <p></p> <p>Now we have to press Get data to fetch the data. </p> <p></p> <p>It will take some seconds to fetch the data from the back end of smart citizen and it will have in the Info panel \"Device 15618 data downloaded!\"</p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#see-the-data-in-a-table","title":"See the data in a table","text":"<p>As an optional step we can look at it as a table. To do that we need to use the widget Data table from the left menu in \"Data\"</p> <p></p> <p>We click on it as we have clicked on other widgets and it will appear on the canvas</p> <p></p> <p>We connect it to the Smart Citizen Data dragging the data from the Smart Citizen Data to the Data Table like this:</p> <p></p> <p>If we open it we'll see the data that we have gathered clicking on it. </p> <p></p> <p>The Data tables have more propierties that are explained here:  https://orange3.readthedocs.io/projects/orange-visual-programming/en/latest/widgets/data/datatable.html</p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#set-the-data-as-a-timeseries","title":"Set the data as a timeseries","text":"<p>To plot it properly we need to set this data as a timeseries. To do that we need to go to the menu on the left and click on As Timeseries in the menu \"Time Series\". </p> <p></p> <p>:::warning Remember that timeseries is an extra add-on that you need to download. [Link to the docs about how to do it] :::</p> <p>We click it and it will appear in the canvas</p> <p></p> <p>We connect it to the Smart Citizen Data dragging the data from the Smart Citizen Data to the As Timeseries like this:</p> <p></p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#plot-the-results","title":"Plot the results","text":"<p>Lastly, we create one more widget. Line chart. To do that we need to go to the menu on the left and click on Line chart in the menu \"Time Series\". </p> <p></p> <p>:::warning Remember that timeseries is an extra add-on that you need to download. [Link to the docs about how to do it] :::</p> <p>We click it and it will appear in the canvas</p> <p></p> <p>We connect it to the As Timeseries dragging the data from the As Timeseries to the Line chart like this:</p> <p></p> <p>If the edit links windows shows up, select time series to time series as shown.</p> <p>Now we press on the Line Chart and we can see the Chart through time.</p>"},{"location":"Resources/Tutorials/Simple%20Orange%20Workflow/#plot-the-results-and-tinker-it","title":"Plot the results and tinker it","text":"<p>If we click on Line Chart it will show something like this:</p> <p></p> <p>:::info</p> <p>To more information about this you can visit Orange documentation: https://orange3-timeseries.readthedocs.io/en/latest/widgets/line_chart.html#line-chart :::</p> <p>This chart is done with one of the columns (in this case Temperature) and we can see the changes from one day to another and we can see also on the left part of the chart the data that we have missing. </p> <p>On the left we can Add more plots to compare them For example to compare temperature and humidity. </p> <p></p> <p>We can close them to get rid of them usin ghe x arrow. </p> <p>To select the type of data that we want to check we need only to get the appropiate sensor and select it. </p> <p>To save it or retrieve it again we can save the file as a .ows and retrieve it again. </p>"},{"location":"assets/notes/electrochemical%20sensors%20methods/","title":"Electrochemical sensors methods","text":""},{"location":"assets/notes/electrochemical%20sensors%20methods/#sensor-calibration","title":"Sensor Calibration","text":"<p>The model described in the following section is based on the findings of [^1]. This study uses alphasense's 3-electrode sensors, and here it is further extended to the case of 4-electrode sensors, taking into account the auxiliary electrode.</p>"},{"location":"assets/notes/electrochemical%20sensors%20methods/#baseline-correction-based-on-temperature","title":"Baseline correction based on temperature","text":"<p>The mentioned work described the  correction method based on temperature using a baseline correction algorithm which is described in [^2]. This is summarised below:</p> <ol> <li>For each day of gas working electrode readings, and for each point in the time series (i), the minimum value of the working electrode value that is contained within the interval (i-\\delta &lt; i &lt; i+\\delta\\delta) is determined, where \\delta\\delta is an interval ranging from 0 to a day length. The outcome of this procedure is an array where each column is a vector of minimum working electrode values calculated for each \\delta_i\\delta_i value (this is, from now on, baseline_{\\delta_i}baseline_{\\delta_i}).</li> <li>The correlation between each baseline_{\\delta_i}baseline_{\\delta_i} and the temperature is calculated. Relative humidity is not considered in this study since it's generaly inversely correlated with the temperature.</li> <li>The correlation coefficients for each correlation (R^2_{\\delta_i}R^2_{\\delta_i}) are calculated. The maximum R^2R^2 whith this array is obtained.</li> <li>For the equation at which the maximum R^2_{\\delta_i}R^2_{\\delta_i} is found, the temperature reading is used to calculate the corrected baseline.</li> <li>The corrected baseline is substracted from the actual working electrode reading</li> <li>The final pollutant concentration is calculated based on the corrected working electrode reading and the manufacturer's data.</li> </ol> <p>The readings are treated in a day-to-day basis in order to avoid non-stationary temperature trends over several days, but still to account for temperature variations within each day.</p> <p>Finally, a background pollutant concentration is assumed from [^3] which is also summarised below for each pollutant. This background concentration is added to the final result.</p> <p> Background concentrations. Source [^3]</p>"},{"location":"assets/notes/electrochemical%20sensors%20methods/#application-on-4-electrode-sensors","title":"Application on 4-electrode sensors","text":"<p>This algorithm can be used to correct temperature effects on the working electrode based on the temperature in 4-electrode sensors. The results are discussed below for tests validation campaigns performed  within the iScape project. These tests are summarized below:</p> <ul> <li>University of Bologna: data collected from 23/January to 13/February. The measured pollutants with reference equipments were CO, NO2, NO, NOx and O3. Two prototype Smart Citizen Stations were deployed in two different sites, with two Smart Citizen Kits.</li> <li>University College Dublin: data collected from 27/March to 17/April. The measured pollutants with reference equipments were NO, NO2 and NOX. One prototype Smart Citizen Station was deployed with two Smart Citizen Kits.</li> </ul> <p>The results found with this methodology in the reduction sensors (NO2, O3) are significant in a daily basis. Two examples of the variation of the correlation coefficient with respect to the delta used to calculate the baseline are shown below:</p> <p></p> <p></p> <p>The algorithm is set to apply the best performing correlation function from either a linear or an exponential fit, basing this decission on the one that yields better correlation coefficient. NO2 and O3 at high concentrations yield better results with an exponential fit, whilst lower concentrations reflect a linear trend:</p> <p></p> <p>Furthermore, the study from which this methodology is drawn from states that oxidation sensors do not yield a proper baseline correlation methodology and so is validated. The result is indeed far better correlated with the reference measurement if using the manufacturer's methodology:</p> <p></p> <p>This methodology reads as follows:</p>  Concentration \\ [ppm] = {I_{WE}-n(I_{AE}) \\ [nA] \\over Sensitivity \\ [nA/ ppm]}   Concentration \\ [ppm] = {I_{WE}-n(I_{AE}) \\ [nA] \\over Sensitivity \\ [nA/ ppm]}  <p>Where:</p>  I_{WE} (nA) = K (nA/mV) V_{WE} (mV)   I_{WE} (nA) = K (nA/mV) V_{WE} (mV)   I_{AE} (nA) = K (nA/mV) V_{AE} (mV)   I_{AE} (nA) = K (nA/mV) V_{AE} (mV)  <p>Where: * I_{PCBWE}I_{PCBWE} and I_{PCBAE}I_{PCBAE} are the electronic offsets for each electrode * n  = {I_{0WE} \\over I_{0AE}}n  = {I_{0WE} \\over I_{0AE}}, the ratio between alphasense's zero currents * k is a constant convertion factor (~ 6.36 in the case of the SCK Gas Pro Board electronics)</p> <p>In the case of NO2, the results provided by this baseline correction algorithm yield better results: </p> <p>Both, CO and NO2 pollutants, using the best method for each calculation, are shown below:</p> <p></p> <p>Finally, a comparison between the reference measurement results from both methods is detailed below:</p> Manufacturer Method Baseline Method Pollutant RMSE / R2 RMSE / R2 CO (ppm) 0.2-0.3 / 0.3-0.5 &gt;2 / &lt;0.01 NO2 (ppb) 21-24 / 0.3-0.5 6 - 12 / 0.4 - 0.6 O3 (ppb) 20-40 / 0.1-0.3 4-9 / 0.1 - 0.3 <p>As seen above, the NO2 correlation with both methods yields significant results for non-corrected signals, whilst the RMSE values are higher in the case of the manufacturer's proposal. Therefore, for this pollutant, the selected methodology will be the baseline method. On the contrary, the CO measurements are highly uncorrelated with the baseline method, whilst the original manufacturer's proposal yields decent results. Finally, the O3 correlation levels are lower than the CO and NO2 measurements. This is possibly due to the O3 reference measurement equipment used in the Bologna campaing, since it shows an inverse relationship with NO2 which suggests a biased pollutant calculation in the reference equipment:</p> <p></p> <p>As well, the results from UCD that are used as a reference for NO2, suggest a poor zero/span calibration of the equipment as it yields negative results that could spoil the NO2 correlation/model errors from those tests:</p> <p></p>"},{"location":"assets/notes/electrochemical%20sensors%20methods/#baseline-correction-based-on-auxiliary-electrode","title":"Baseline correction based on auxiliary electrode","text":"<p>As seen above, the results from applying this methodology to a low concentration, urban environment measurement with 4-electrode sensors yield significantly correlated results in the case of the reductive sensors. It was also seen that oxidation measurements are significantly correlated with the reference measurements while using the manufacturer's suggested method.</p> <p>However, as detailed in the following section, the use of the auxiliary electrode as the source of the correction yields better results due to:</p> <ul> <li>The auxiliary electrode is accounting for both, temperature and absolute humidity. The latter could be discarded if the relative humidity is not considered.</li> <li>Since data is treated in a day to day basis, variations of mean temperatures during different days could provoke significant correlations to be found at different timelapses. This provokes gaps in the prediction during night hours that are reduced by the use of the auxiliary electrode.</li> <li>Finally, it is preferrably to use data contained in a single sensor (such as the auxiliary electrode for the EC sensor) rather than including additional sensors in the algorithm.</li> </ul> <p>A comparison between the results using this proposed method and the reference measurement from both test campaigns is seen below:</p> Manufacturer Method Baseline Method With Temperature Baseline Method With Auxiliary Electrode Pollutant RMSE / R2 RMSE / R2 RMSE / R2 CO (ppm) 0.2-0.3 / 0.3-0.5 &gt;2 / &lt;0.1 &gt;2 / &lt;0.01 NO2 (ppb) 21-24 / 0.3-0.5 6-12/0.1-0.4 6 - 12 / 0.4 - 0.6 O3 (ppb) 20-40 / 0.1-0.3 4-12 / &lt;0.2 4-9 / 0.1 - 0.3"},{"location":"assets/notes/sensor-evaluation-campaign-notes/","title":"Sensor evaluation campaign notes","text":""},{"location":"assets/notes/sensor-evaluation-campaign-notes/#sensor-evaluation-campaign","title":"Sensor Evaluation Campaign","text":"<p>Prior to sensor deployment for the intervention monitoring, some of the Living Lab Stations will be evaluated and compared against reference measurement under different conditions. They will be deployed in several cities among the iScape partners in order to 1. develop models for sensor calibration under different climatic and pollutant exposure conditions and 2. assess data quality. This campaign intends to evaluate the Living Lab Station before it's deployment, and trying to prevent concerns raised about data quality that other low-cost sensor platforms 2 3 4. </p> <p>This evaluation will focus on the real-world conditions calibration, under wide range of exposure and climatic conditions, rather than developing tests in controlled conditions, as prior studies show discrepancies in the accuracy resulting from evaluation in laboratory conditions, versus that of outdoor conditions 2 5 6. The tests will be conducted by co-location of at least two stations per site with high-end sensors under the conditions indicated in the test section below.</p> <p>The duration of the tests will be of 2,5 months, with two location changes. This is a compromise between the indications given in 1 for at least 3-months campaign and the availability of high-end sensors for the evaluation. Nevertheless, this campaign intends to cover a range of conditions by the deployment of the Living Lab Station in diverse conditions, not only climatic but also exposure-wise. The location changes will also intend to evaluate how well the sensors are able to adapt to these exposure and climatic changes 10. The data will be uploaded to the SmartCitizen Platform and will be analysed using the Sensor Analysis Framework. The results of this evaluation in terms of models will be uploaded to a dedicated repository and will be implemented on the SmartCitizen Platform for on-the-fly sensor data processing. This processing aims to provide an open platform for sensor analysis using data analysis techniques, need which has been highlighted by 2 5 6 9.</p> <p>As well, as stated in 2 10 11, it is necessary to perform individual field calibration for low-cost sensors if measurements comparable to those of high-end solutions are targeted. However, this calibration might not always be feasible in a wide range of conditions, leading to non-generalised models which can perform badly out of the training datasets. This test campaign also aims to study this concern, with an evaluation for a cross calibration methodology, in which results from a limited subset of observations are applied to the complete dataset 7. If successful, this would be set ground for the development of calibration strategies where the sensors are co-located with a high-end sensor and posteriorly deployed for citizen-science activities, or long term monitoring of the iScape Living Labs interventions, where high end sensors might not be available. This co-location could be performed in a recurrent manner, performing sequences of calibration-deployment-calibration, using merging calibrations as suggested in 11.</p> <p>As a summary, this field campaign aims to cover the following points:</p> <ul> <li>Assess data quality levels and positioning with respect to the DQO set by the European Air Quality Directive</li> <li>Stablish match scores for the different range of sensors available in the Living Lab Station</li> <li>Validation and assessment of  EC sensor methodology for NO2 and O3 compounds in urban conditions (urban background and traffic) in various sites</li> <li>Validation of PMS PM raw data accuracy and effect of climatic conditions</li> <li>Calibration of Alphasense\u2019s EC sensors and PMS PM sensors for model quality improvement accounting for climatic conditions</li> <li>Feasibility assessment for the calibration of metal oxide sensor models with the use of reference data and/or Living Lab station data</li> <li>Validation of climatic sensors of the station itself (temperature, humidity, pressure)</li> <li>Drifts and stability:<ul> <li>Drifts and possible root causes for EC sensor sensitivities variations over time</li> <li>Calibration stability for SGX MOS sensors</li> <li>Sensor decay and recoverability of PMS sensors due to dust accumulation or others</li> </ul> </li> </ul>"},{"location":"assets/notes/sensor-evaluation-campaign-notes/#test","title":"Test","text":"<p>The table below shows a description of the proposed test campaign:</p> Stage Duration Exposure Reference equipment Purpose Pre-test 2 weeks Urban Background No Stabilise electrochemical sensors to urban background on site.  and verify overall functioning Low Exposure test 1 month Urban Background Yes Evaluate response in low transient areas and evaluate repeatability of urban background measurements in higher exposure testing phases High Exposure test 1 month Urban with traffic (canyon or junction) Yes Evaluate response in high transient / high concentration areas and validate current model and post-processing approach. Propose further models with more variables <p>The sites at which these calibration deployments are planned are:</p> Site Season Reference equipment Duration Bologna (Italy) Summer YES 1 month Guildford (England) Autumn YES 2.5 months Dublin (Ireland) Autumn YES 2.5 months Bottrop (Germany) Autumn YES 2.5 months Barcelona (Spain) Spring YES &gt;3 months"},{"location":"assets/notes/sensor-evaluation-campaign-notes/#sensor-installation","title":"Sensor Installation","text":"<p>Guidelines for representativeness of the results are given below:</p> <p>Height</p> <p>Between 2,5 and 3,5m. Not reachable by hand.</p> <p>Reference equipment position</p> <p>Within &lt;2m and with similar exposure, air flow (both either on wall, or lamppost) 7</p> <p>Desirable measurements</p> <ul> <li> <p>Chemical compounds (higher priority above): </p> <ul> <li>NO2</li> <li>CO, O3</li> <li>NOx, NO</li> <li>NMHC</li> </ul> </li> <li> <p>Particulate Matter (higher priority above)</p> <ul> <li>PM 2.5</li> <li>PM 1.0, PM 10</li> </ul> </li> <li> <p>Climatic conditions (higher priority above)</p> <ul> <li>Temperature and relative humidity</li> <li>Wind speed and direction</li> </ul> </li> </ul> <p>Important Guidelines</p> <p>Please, refer to the sensor considerations section for general information about the sensors. As well, take into account the following:</p> <ul> <li> <p>Avoid direct exposure to intense sunlight for long periods of time, since this can severely affect the measurements (direct sun or intense transients).</p> </li> <li> <p>Avoid locations where high temperature or humidity transients are present since the sensor response is affected by these rapid changes.</p> </li> <li> <p>Avoid locations with low air flow or with direct exposure to air conditioning exhausts.</p> </li> </ul>"},{"location":"assets/notes/sensor-evaluation-campaign-notes/#references","title":"References","text":"<ol> <li> <p>Spinelle L., Aleixandre M., Gerboles M. - 2013: Protocol of Evaluation and Calibration of Low-cost Gas Sensors for the Monitoring of Air Pollution. Joint Research Centre (Report EUR 26112 EN) \u21a9</p> </li> <li> <p>Nuria Castell, Franck R. Dauge, Philipp Schneider, Matthias  Vogt, Uri Lerner, Barak Fishbain, David Broday, Alena Bartonova - 2018: Can commercial low-cost sensor platforms contribute to air quality monitoring and exposure estimates? \u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>Snyder E., Watkins T., Solomon P., Thoma E.,Williams R., Hagler G., Shelow D., Hindin D., Kilaru V., Preuss P. - 2013: The changing paradigm of air pollution monitoring. Environ. Sci. Technol. 47, 11369\u201311377 \u21a9</p> </li> <li> <p>Lewis A., Edwards P. - 2016: Validate personal air-pollution sensors \u21a9</p> </li> <li> <p>Spinelle L., Gerboles M., Villani M.G., Aleixandre M., Bonavitacola F. - 2015: Field calibration of a cluster of low-cost available sensors for air quality monitoring: Part A: Ozone and nitrogen dioxide \u21a9\u21a9</p> </li> <li> <p>Spinelle L., Gerboles M., Villani M.G., Aleixandre M., Bonavitacola F. - 2015: Field calibration of a cluster of low-cost available sensors for air quality monitoring: Part B: NO, CO and CO2 \u21a9\u21a9</p> </li> <li> <p>David H. Hagan, Gabriel Isaacman-VanWertz, Jonathan P. Franklin, Lisa M. M. Wallace, Benjamin D. Kocar, Colette L. Heald, Jesse H. Kroll - 2018: Calibration and assessment of electrochemical air quality sensors by co-location with regulatory-grade instruments \u21a9\u21a9</p> </li> <li> <p>Olalekan A.M.Popoola, Gregor B.Stewart, Mohammed I.Mead, Roderic L.Jones - 2016: Development of a baseline-temperature correction methodology forelectrochemical sensors and its implications for long-term stability \u21a9</p> </li> <li> <p>Sun L., ChunWong K., Wei P., Ye S., Huang H., Yang F.,Westerdahl D., Louie P.K.K., Luk C.W.Y., Ning Z. - 2016. Development and application of a next generation air sensor network for the Hong Kong Marathon 2015. Air quality monitoring. Sensors 16, 211\u2013229 \u21a9</p> </li> <li> <p>A. Ripoll , M. Viana, M. Padrosa, X. Querol, A.Minutolo, K.M. Houc, J.M. Barcelo-Ordinas, J. Garcia-Vidal - 2018: Testing the performance of sensors for ozone pollution monitoring in a citizen science approach \u21a9\u21a9</p> </li> <li> <p>Philip J. D. Peterson, Amrita Aujla, Kirsty H. Grant, Alex G. Brundle, Martin R. Thompson, Josh Vande Hey and Roland J. Leigh - 2017: Practical Use of Metal Oxide Semiconductor Gas Sensors for Measuring Nitrogen Dioxide and Ozone in Urban Environments, Sensors 2017, 17, 1653 \u21a9\u21a9</p> </li> </ol>"},{"location":"assets/notes/sensor-selection-alphasense/","title":"Sensor selection alphasense","text":""},{"location":"assets/notes/sensor-selection-alphasense/#sensors-selection","title":"Sensors selection","text":"<p>The following characteristics have been considered for the sensor choice</p> <ul> <li> <p>The driver's board designed includes a temperature and humidity sensor for calibrating the temperature dependence of the sensing subsystem.</p> </li> <li> <p>Same technology as the A4 series but more robust when exposed to outdoor environments 24/7. \u00a0</p> </li> <li> <p>Designed for fixed site air quality networks which demand longer term reliability.</p> </li> <li> <p>Manufacturers provide the baseline resistance calibration values per sensor allowing corrections to be easily applied.</p> </li> <li> <p>Low power consumption</p> </li> </ul> <p>The Alphasense EC Sensors were selected to provide a higher linearity, repeatability and resolution with respect to Metal Oxyde sensors found in the Urban Sensor Board.</p> <p>The selection of the sensors was based on the wide variety of literature available on them. Both Penza and EuNetAir Consortium (2014) and Mead et al. (2013) test the NO2A1-A3 against reference instruments, in the laboratory as well as in the field, with well-correlated results. The former concluded that the Data Quality Objective for \"indicative measurements\" (European Parliament and Council of the European Union, 2008) is fulfilled, and the latter report sensitivity in the low ppb region with high linearity. Spinelle et al. tested the Alphasense NO2B4 and O3B4 in a field experiment, with various calibration approaches. Performance evaluation of the same sensors was performed later including a test on a wide range of performance parameters (e.g. response time, calibration function, repeatability, drift, hysteresis effect, and matrix effect) (Spinelle et al. 2017). The experiment found a strong correlation with reference instruments (R2 &gt; 0.9) and identified some cases with significant hysteresis effect related to humidity. In chamber conditions, the performances of the Alphasense CO-B4 was found to be excellent, with the R2 values being greater than 0.9 (Castell et al. 2017) (Mead et al. 2013) (Sun et al. 2016). Two field studies reported moderate to excellent R2  values (0.53--0.97) for the CO-B4 sensor (Castell et al. 2017) (Mead et al. 2013). Finally, some calibration approaches as detailed in Popoola et al. (2016) and Hagan et al. (2018) are used in the post-processing stage as a basis for pollution concentration calculations.</p>"},{"location":"includes/en/education/","title":"Index","text":""},{"location":"includes/en/education/#from-fab-lab-barcelona","title":"From Fab Lab Barcelona","text":"<ul> <li>DOIT Toolkit - Measuring our environment (EN)- Future Learning Unit at Fablab Barcelona</li> <li>DOIT Toolkit - Midiendo nuestro entorno (ES)- Future Learning Unit at Fablab Barcelona</li> <li>AULAMAR - T\u00e9cnicas de Muestreo de agua (ES)</li> </ul>"},{"location":"includes/en/education/#external-links","title":"External links","text":"<p>This is a compilation of friend projects in education, or other that we admire in general.</p>"},{"location":"includes/en/education/#cat","title":"CAT","text":"<p>Projecte Atenci\u00f3 Atenci\u00f3 Project - Citizen Science empowerment for students XTEC</p>"},{"location":"includes/en/education/#eng","title":"ENG","text":"<ul> <li>Smart Citizen User Guide Bibliolab Science and Healthy City</li> <li>A Citizen's Guide To Understanding and Monitoring Lakes and Streams</li> </ul>"},{"location":"includes/en/notes/","title":"Index","text":""},{"location":"includes/en/notes/#noise","title":"Noise","text":"<ul> <li>Noise sampling analysis</li> <li>Noise and DSP analysis</li> </ul>"},{"location":"includes/en/notes/#pms-sensor","title":"PMS Sensor","text":"<ul> <li>One shot PMS5003</li> <li>PM intervals</li> </ul>"},{"location":"includes/en/publications/","title":"Index","text":"<ul> <li>Special Issue on Open tools for environmental monitoring: Hardware X - 2019</li> <li>A citizen science approach for enhancing public understanding of air pollution</li> <li>Citizen Sensing: A Toolkit</li> <li>Onboarding Communities to the IoT</li> <li>Laboratory  evaluation  of  particle  size-selectivity  of  optical  low-cost particulate matter sensors: study lead by the Finnish Meteorological Institute, as part of the iScape project</li> </ul>"},{"location":"includes/en/publications/mentions/","title":"Mentions","text":"<ul> <li>The influence of the vegetation cycle on the mitigation of air pollution by a deciduous roadside hedge - Thor-Bj\u00f8rn Ottosen, Prashant Kumar: study lead by the University of Surrey, as part of the iScape project</li> <li>Evaluation of low-cost sensors for quantitative personal exposure monitoring - Sachit Mahajan, PrashantKumar: study lead by the University of Surrey, as part of the iScape project</li> <li>How to get the best from low-cost particulate matter sensors: guidelines and practical recommendations: study lead by the University of Bologna, published as part of the Special Issue for Sensors for Particulate Matter and Air pollution</li> </ul>"},{"location":"includes/en/sensors/sensors/","title":"Sensors","text":"<p>WIP</p> <p>This list is always a WIP!</p> Field SCK sensor name Units Location Sensor and datasheet Air Temperature \u00baC Urban Board Sensirion SHT31 Air Humidity %RH Urban Board Sensirion SHT31 Air Light lux Urban Board ROHM BH1730 Air Noise dBA na (dBA scale) Urban Board INVENSENSE 43432 Air Noise dBC na (dBC scale) Urban Board INVENSENSE 43432 Air Noise dBZ na (dBZ scale) Urban Board INVENSENSE 43432 Air Noise FFT na Urban Board INVENSENSE 43432 Air Barometric pressure kPa Urban Board NXP MPL3115A2 Air VOC Gas CCS811 ppb Urban Board AMS CCS811 Air eCO2 Gas CCS811 ppm Urban Board AMS CCS811 Air PM_X (X = [1.0, 2.5, 10]) ug/m3 Urban Board PLANTOWER PMS5003 Air PN_X (X = [0.3, 0.5, 1.0, 2.5, 5.0, 10]) #/0.1l Urban Board PLANTOWER PMS5003 Air, soil and water PM board Dallas Temperature \u00baC External Sensor MAXIM DS18B20 Air Ext PM_X (X = [1.0, 2.5, 10]) ug/m3 External Sensor PLANTOWER PMS5003 Air Ext PN_X (X = [0.3, 0.5, 1.0, 2.5, 5.0, 10]) #/0.1l External Sensor PLANTOWER PMS5003 Air SCD30_CO2 ppm External Sensor Sensirion SCD30 Air SCD30_T \u00baC External Sensor Sensirion SCD30 Air SCD30_H %RH External Sensor Sensirion SCD30 Generic ADS1x15 ADC 0x4X ChY (X = [8, 9, A, B)], Y = [0, 1, 2, 3]) V External Sensor ADS 1115 Generic Grove ADC V External Sensor Seeed Grove ADC Location GPS Fix Quality na External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Latitude Deg External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Longitude Deg External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Altitude m External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Speed m/s External Sensor Sparkfun GPS NEO-M8U, SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Horizontal Dilution of Position - External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Location GPS Traked Satellites - External Sensor Sparkfun GPS NEO-M8U , SparkFun GPS XA1110 or SEEED Grove GPS Module Soil and water Atlas PH PH External Sensor Atlas Scientific pH Driver - Probe - Calibration Solution Water Atlas Dissolved Oxygen mg/L External Sensor Atlas Scientific Dissolved Oxygen Driver - Probe - Calibration solution Water Atlas DO Saturation % External Sensor Atlas Scientific Oxygen Saturation Driver - Probe - Calibration solution Soil and water Atlas Conductivity \u00b5S/cm External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Total Dissolved Solids ppm External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Salinity PSU(ppt) External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil and water Atlas Specific gravity - External Sensor Atlas Scientific Electric Conductivity Driver - Probe - Calibration Solution Soil Soil Moisture Raw - External Sensor Chirp Soil Moisture Soil Soil Moisture Percent % External Sensor Chirp Soil Moisture Soil Soil Temperature degC External Sensor Chirp Soil Moisture Soil Soil Light - External Sensor Chirp Soil Moisture Air, soil and water Atlas Temperature degC External Sensor PT-100 or PT-1000 Atlas Scientific Temperature Other Battery % Urban Board - Other Battery Voltage V Urban Board - Other INA219 Bus voltage V External Sensor Adafruit INA219 Other INA219 Shunt voltage mV External Sensor Adafruit INA219 Other INA219 Current mA External Sensor Adafruit INA219 Other INA219 Load voltage V External Sensor Adafruit INA219"},{"location":"includes/en/sensors/water/","title":"Water","text":"Metric Usage Probe Driver Calibration Temperature Soil and water Atlas PT-100 + PT-1000 Atlas EZO-RTD Not required PH Water Atlas ENV-40-PH or ENV-35-PH Atlas EZO-PH Atlas CHEM-PH PH Soil Atlas ENV-45-PH Atlas EZO-PH Atlas CHEM-PH Electrical Conductivity Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Total Dissolved Solids Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Salinity Soil and water Atlas ENV-40-EC-K Atlas Atlas EZO-EC Atlas Atlas CHEM-EC Specific Gravity Soil and water Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Dissolved Oxygen Water Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Oxygen Saturation Water Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Soil Moisture Soil Catnip Chirp! None Cup of water"},{"location":"includes/en/webinars/minke/","title":"Minke","text":"<p>Working on it</p> <p>These webinars are currently ongoing!</p> <ul> <li>MINKE Webinar Basics - Online, 2022</li> <li>MINKE Webinar Advanced - Online, 2022</li> <li>MINKE Webinar Water Metrics - Online, 2022</li> <li>MINKE Webinar Air Metrics - Online, 2022</li> <li>MINKE Webinar Data Analysis (1) - Online, 2022</li> <li>MINKE Webinar Data Analysis (2) - Online, 2022</li> </ul> <p>View the edited video capsules!</p> <p>You can view the edited capsules here!</p>"},{"location":"includes/es/sensors/water/","title":"Water","text":"M\u00e9trica Uso Sonda Driver Calibraci\u00f3n Temperatura Suelo y agua Atlas PT-100 + PT-1000 Atlas EZO-RTD No necesaria pH Agua Atlas ENV-40-PH or ENV-35-PH Atlas EZO-PH Atlas CHEM-PH pH Suelo Atlas ENV-45-PH Atlas EZO-PH Atlas CHEM-PH Conductividad el\u00e9ctrica, S\u00f3lidos disueltos totales y Salinidad Suelo y Agua Atlas ENV-40-EC-K Atlas EZO-EC Atlas CHEM-EC Ox\u00edgeno disuelto y Saturaci\u00f3n de Ox\u00edgeno Agua Atlas ENV-40-DO Atlas EZO-DO Atlas CHEM-DO Humedad del Suelo Suelo Catnip Chirp! na Vaso de agua"}]}